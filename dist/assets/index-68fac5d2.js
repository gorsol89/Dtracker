var Ap=Object.defineProperty;var Mp=(i,e,t)=>e in i?Ap(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var at=(i,e,t)=>(Mp(i,typeof e!="symbol"?e+"":e,t),t),Do=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var B=(i,e,t)=>(Do(i,e,"read from private field"),t?t.call(i):e.get(i)),De=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},Pe=(i,e,t,n)=>(Do(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t);var ds=(i,e,t,n)=>({set _(r){Pe(i,e,r,t)},get _(){return B(i,e,n)}}),Ce=(i,e,t)=>(Do(i,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();class Pp{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Wi=Pp,fr={PROPERTYCHANGE:"propertychange"};class Lp{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const ao=Lp;function Op(i,e,t){let n,r;t=t||Oi;let s=0,o=i.length,a=!1;for(;s<o;)n=s+(o-s>>1),r=+t(i[n],e),r<0?s=n+1:(o=n,a=!r);return a?s:~s}function Oi(i,e){return i>e?1:i<e?-1:0}function kp(i,e){return i<e?1:i>e?-1:0}function nh(i,e,t){if(i[0]<=e)return 0;const n=i.length;if(e<=i[n-1])return n-1;if(typeof t=="function"){for(let r=1;r<n;++r){const s=i[r];if(s===e)return r;if(s<e)return t(e,i[r-1],s)>0?r-1:r}return n-1}if(t>0){for(let r=1;r<n;++r)if(i[r]<e)return r-1;return n-1}if(t<0){for(let r=1;r<n;++r)if(i[r]<=e)return r;return n-1}for(let r=1;r<n;++r){if(i[r]==e)return r;if(i[r]<e)return i[r-1]-e<e-i[r]?r-1:r}return n-1}function Dp(i,e,t){for(;e<t;){const n=i[e];i[e]=i[t],i[t]=n,++e,--t}}function rh(i,e){const t=Array.isArray(e)?e:[e],n=t.length;for(let r=0;r<n;r++)i[i.length]=t[r]}function un(i,e){const t=i.length;if(t!==e.length)return!1;for(let n=0;n<t;n++)if(i[n]!==e[n])return!1;return!0}function Fp(i,e,t){const n=e||Oi;return i.every(function(r,s){if(s===0)return!0;const o=n(i[s-1],r);return!(o>0||t&&o===0)})}function Xr(){return!0}function lo(){return!1}function dr(){}function uf(i){let e,t,n;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==n||!un(r,t))&&(n=this,t=r,e=i.apply(this,arguments)),e}}function Np(i){function e(){let t;try{t=i()}catch(n){return Promise.reject(n)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function os(i){for(const e in i)delete i[e]}function gr(i){let e;for(e in i)return!1;return!e}class Bp extends ao{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const n=this.listeners_||(this.listeners_={}),r=n[e]||(n[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",n=t?e:e.type,r=this.listeners_&&this.listeners_[n];if(!r)return;const s=t?new Wi(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,a[n]=0),++o[n];let l;for(let h=0,c=r.length;h<c;++h)if("handleEvent"in r[h]?l=r[h].handleEvent(s):l=r[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let h=a[n];for(delete a[n];h--;)this.removeEventListener(n,dr);delete o[n]}return l}disposeInternal(){this.listeners_&&os(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const n=this.listeners_[e];if(!n)return;const r=n.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(n[r]=dr,++this.pendingRemovals_[e]):(n.splice(r,1),n.length===0&&delete this.listeners_[e]))}}const ho=Bp,ke={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function je(i,e,t,n,r){if(r){const o=t;t=function(){i.removeEventListener(e,t),o.apply(n??this,arguments)}}else n&&n!==i&&(t=t.bind(n));const s={target:i,type:e,listener:t};return i.addEventListener(e,t),s}function Us(i,e,t,n){return je(i,e,t,n,!0)}function it(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),os(i))}class co extends ho{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ke.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const n=e.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=je(this,e[s],t);return r}return je(this,e,t)}onceInternal(e,t){let n;if(Array.isArray(e)){const r=e.length;n=new Array(r);for(let s=0;s<r;++s)n[s]=Us(this,e[s],t)}else n=Us(this,e,t);return t.ol_key=n,n}unInternal(e,t){const n=t.ol_key;if(n)Up(n);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}co.prototype.on;co.prototype.once;co.prototype.un;function Up(i){if(Array.isArray(i))for(let e=0,t=i.length;e<t;++e)it(i[e]);else it(i)}const ff=co;function We(){throw new Error("Unimplemented abstract method.")}let jp=0;function Xe(i){return i.ol_uid||(i.ol_uid=String(++jp))}class fc extends Wi{constructor(e,t,n){super(e),this.key=t,this.oldValue=n}}class Wp extends ff{constructor(e){super(),this.on,this.once,this.un,Xe(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let n;n=`change:${e}`,this.hasListener(n)&&this.dispatchEvent(new fc(n,e,t)),n=fr.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new fc(n,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,n){const r=this.values_||(this.values_={});if(n)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const n in e)this.set(n,e[n],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const n=this.values_[e];delete this.values_[e],gr(this.values_)&&(this.values_=null),t||this.notify(e,n)}}}const yi=Wp,Bt={ADD:"add",REMOVE:"remove"},dc={LENGTH:"length"};class gs extends Wi{constructor(e,t,n){super(e),this.element=t,this.index=n}}class Gp extends yi{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let n=0,r=this.array_.length;n<r;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,n=e.length;t<n;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)e(t[n],n,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(dc.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new gs(Bt.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let n=0,r=t.length;n<r;++n)if(t[n]===e)return this.removeAt(n)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new gs(Bt.REMOVE,t,e)),t}setAt(e,t){const n=this.getLength();if(e>=n){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new gs(Bt.REMOVE,r,e)),this.dispatchEvent(new gs(Bt.ADD,t,e))}updateLength_(){this.set(dc.LENGTH,this.array_.length)}assertUnique_(e,t){for(let n=0,r=this.array_.length;n<r;++n)if(this.array_[n]===e&&n!==t)throw new Error("Duplicate item added to a unique collection")}}const gi=Gp,Ke={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};function Ge(i,e){if(!i)throw new Error(e)}function gt(i,e,t){return Math.min(Math.max(i,e),t)}function zp(i,e,t,n,r,s){const o=r-t,a=s-n;if(o!==0||a!==0){const l=((i-t)*o+(e-n)*a)/(o*o+a*a);l>1?(t=r,n=s):l>0&&(t+=o*l,n+=a*l)}return or(i,e,t,n)}function or(i,e,t,n){const r=t-i,s=n-e;return r*r+s*s}function Yp(i){const e=i.length;for(let n=0;n<e;n++){let r=n,s=Math.abs(i[n][n]);for(let a=n+1;a<e;a++){const l=Math.abs(i[a][n]);l>s&&(s=l,r=a)}if(s===0)return null;const o=i[r];i[r]=i[n],i[n]=o;for(let a=n+1;a<e;a++){const l=-i[a][n]/i[n][n];for(let h=n;h<e+1;h++)n==h?i[a][h]=0:i[a][h]+=l*i[n][h]}}const t=new Array(e);for(let n=e-1;n>=0;n--){t[n]=i[n][e]/i[n][n];for(let r=n-1;r>=0;r--)i[r][e]-=i[r][n]*t[n]}return t}function gc(i){return i*180/Math.PI}function an(i){return i*Math.PI/180}function ar(i,e){const t=i%e;return t*e<0?t+e:t}function Zt(i,e,t){return i+t*(e-i)}function sh(i,e){const t=Math.pow(10,e);return Math.round(i*t)/t}function ps(i,e){return Math.floor(sh(i,e))}function _s(i,e){return Math.ceil(sh(i,e))}function ma(i,e,t){if(i>=e&&i<t)return i;const n=t-e;return((i-e)%n+n)%n+e}class Xp extends yi{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[Ke.OPACITY]=e.opacity!==void 0?e.opacity:1,Ge(typeof t[Ke.OPACITY]=="number","Layer opacity must be a number"),t[Ke.VISIBLE]=e.visible!==void 0?e.visible:!0,t[Ke.Z_INDEX]=e.zIndex,t[Ke.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[Ke.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[Ke.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[Ke.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},n=this.getZIndex();return t.opacity=gt(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=n===void 0&&!t.managed?1/0:n,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return We()}getLayerStatesArray(e){return We()}getExtent(){return this.get(Ke.EXTENT)}getMaxResolution(){return this.get(Ke.MAX_RESOLUTION)}getMinResolution(){return this.get(Ke.MIN_RESOLUTION)}getMinZoom(){return this.get(Ke.MIN_ZOOM)}getMaxZoom(){return this.get(Ke.MAX_ZOOM)}getOpacity(){return this.get(Ke.OPACITY)}getSourceState(){return We()}getVisible(){return this.get(Ke.VISIBLE)}getZIndex(){return this.get(Ke.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(Ke.EXTENT,e)}setMaxResolution(e){this.set(Ke.MAX_RESOLUTION,e)}setMinResolution(e){this.set(Ke.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(Ke.MAX_ZOOM,e)}setMinZoom(e){this.set(Ke.MIN_ZOOM,e)}setOpacity(e){Ge(typeof e=="number","Layer opacity must be a number"),this.set(Ke.OPACITY,e)}setVisible(e){this.set(Ke.VISIBLE,e)}setZIndex(e){this.set(Ke.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const df=Xp,Jt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Dt={ANIMATING:0,INTERACTING:1},ti={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},$p=42,oh=256,$r={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Vp{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||$r[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const ah=Vp,as=6378137,tr=Math.PI*as,Kp=[-tr,-tr,tr,tr],Hp=[-180,-85,180,85],ms=as*Math.log(Math.tan(Math.PI/2));class jn extends ah{constructor(e){super({code:e,units:"m",extent:Kp,global:!0,worldExtent:Hp,getPointResolution:function(t,n){return t/Math.cosh(n[1]/as)}})}}const pc=[new jn("EPSG:3857"),new jn("EPSG:102100"),new jn("EPSG:102113"),new jn("EPSG:900913"),new jn("http://www.opengis.net/def/crs/EPSG/0/3857"),new jn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function qp(i,e,t,n){const r=i.length;t=t>1?t:2,n=n??t,e===void 0&&(t>2?e=i.slice():e=new Array(r));for(let s=0;s<r;s+=n){e[s]=tr*i[s]/180;let o=as*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));o>ms?o=ms:o<-ms&&(o=-ms),e[s+1]=o}return e}function Zp(i,e,t,n){const r=i.length;t=t>1?t:2,n=n??t,e===void 0&&(t>2?e=i.slice():e=new Array(r));for(let s=0;s<r;s+=n)e[s]=180*i[s]/tr,e[s+1]=360*Math.atan(Math.exp(i[s+1]/as))/Math.PI-90;return e}const Jp=6378137,_c=[-180,-90,180,90],Qp=Math.PI*Jp/180;class dn extends ah{constructor(e,t){super({code:e,units:"degrees",extent:_c,axisOrientation:t,global:!0,metersPerUnit:Qp,worldExtent:_c})}}const mc=[new dn("CRS:84"),new dn("EPSG:4326","neu"),new dn("urn:ogc:def:crs:OGC:1.3:CRS84"),new dn("urn:ogc:def:crs:OGC:2:84"),new dn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new dn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new dn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let ya={};function e_(i){return ya[i]||ya[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function t_(i,e){ya[i]=e}let lr={};function Vr(i,e,t){const n=i.getCode(),r=e.getCode();n in lr||(lr[n]={}),lr[n][r]=t}function Fo(i,e){return i in lr&&e in lr[i]?lr[i][e]:null}const xt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function yc(i){const e=Kt();for(let t=0,n=i.length;t<n;++t)Gr(e,i[t]);return e}function lh(i,e,t){return t?(t[0]=i[0]-e,t[1]=i[1]-e,t[2]=i[2]+e,t[3]=i[3]+e,t):[i[0]-e,i[1]-e,i[2]+e,i[3]+e]}function gf(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i.slice()}function pf(i,e,t){let n,r;return e<i[0]?n=i[0]-e:i[2]<e?n=e-i[2]:n=0,t<i[1]?r=i[1]-t:i[3]<t?r=t-i[3]:r=0,n*n+r*r}function pr(i,e){return _f(i,e[0],e[1])}function ir(i,e){return i[0]<=e[0]&&e[2]<=i[2]&&i[1]<=e[1]&&e[3]<=i[3]}function _f(i,e,t){return i[0]<=e&&e<=i[2]&&i[1]<=t&&t<=i[3]}function wa(i,e){const t=i[0],n=i[1],r=i[2],s=i[3],o=e[0],a=e[1];let l=xt.UNKNOWN;return o<t?l=l|xt.LEFT:o>r&&(l=l|xt.RIGHT),a<n?l=l|xt.BELOW:a>s&&(l=l|xt.ABOVE),l===xt.UNKNOWN&&(l=xt.INTERSECTING),l}function Kt(){return[1/0,1/0,-1/0,-1/0]}function hn(i,e,t,n,r){return r?(r[0]=i,r[1]=e,r[2]=t,r[3]=n,r):[i,e,t,n]}function uo(i){return hn(1/0,1/0,-1/0,-1/0,i)}function mf(i,e){const t=i[0],n=i[1];return hn(t,n,t,n,e)}function hh(i,e,t,n,r){const s=uo(r);return wf(s,i,e,t,n)}function Kr(i,e){return i[0]==e[0]&&i[2]==e[2]&&i[1]==e[1]&&i[3]==e[3]}function yf(i,e){return e[0]<i[0]&&(i[0]=e[0]),e[2]>i[2]&&(i[2]=e[2]),e[1]<i[1]&&(i[1]=e[1]),e[3]>i[3]&&(i[3]=e[3]),i}function Gr(i,e){e[0]<i[0]&&(i[0]=e[0]),e[0]>i[2]&&(i[2]=e[0]),e[1]<i[1]&&(i[1]=e[1]),e[1]>i[3]&&(i[3]=e[1])}function wf(i,e,t,n,r){for(;t<n;t+=r)i_(i,e[t],e[t+1]);return i}function i_(i,e,t){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}function bf(i,e){let t;return t=e(fo(i)),t||(t=e(go(i)),t)||(t=e(po(i)),t)||(t=e(Fi(i)),t)?t:!1}function Hr(i){let e=0;return _o(i)||(e=Ue(i)*wt(i)),e}function fo(i){return[i[0],i[1]]}function go(i){return[i[2],i[1]]}function On(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function n_(i,e){let t;if(e==="bottom-left")t=fo(i);else if(e==="bottom-right")t=go(i);else if(e==="top-left")t=Fi(i);else if(e==="top-right")t=po(i);else throw new Error("Invalid corner");return t}function ba(i,e,t,n,r){const[s,o,a,l,h,c,u,f]=r_(i,e,t,n);return hn(Math.min(s,a,h,u),Math.min(o,l,c,f),Math.max(s,a,h,u),Math.max(o,l,c,f),r)}function r_(i,e,t,n){const r=e*n[0]/2,s=e*n[1]/2,o=Math.cos(t),a=Math.sin(t),l=r*o,h=r*a,c=s*o,u=s*a,f=i[0],d=i[1];return[f-l+u,d-h-c,f-l-u,d-h+c,f+l-u,d+h+c,f+l+u,d+h-c,f-l+u,d-h-c]}function wt(i){return i[3]-i[1]}function ai(i,e,t){const n=t||Kt();return Wt(i,e)?(i[0]>e[0]?n[0]=i[0]:n[0]=e[0],i[1]>e[1]?n[1]=i[1]:n[1]=e[1],i[2]<e[2]?n[2]=i[2]:n[2]=e[2],i[3]<e[3]?n[3]=i[3]:n[3]=e[3]):uo(n),n}function Fi(i){return[i[0],i[3]]}function po(i){return[i[2],i[3]]}function Ue(i){return i[2]-i[0]}function Wt(i,e){return i[0]<=e[2]&&i[2]>=e[0]&&i[1]<=e[3]&&i[3]>=e[1]}function _o(i){return i[2]<i[0]||i[3]<i[1]}function s_(i,e){return e?(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e):i}function o_(i,e,t){let n=!1;const r=wa(i,e),s=wa(i,t);if(r===xt.INTERSECTING||s===xt.INTERSECTING)n=!0;else{const o=i[0],a=i[1],l=i[2],h=i[3],c=e[0],u=e[1],f=t[0],d=t[1],g=(d-u)/(f-c);let y,w;s&xt.ABOVE&&!(r&xt.ABOVE)&&(y=f-(d-h)/g,n=y>=o&&y<=l),!n&&s&xt.RIGHT&&!(r&xt.RIGHT)&&(w=d-(f-l)*g,n=w>=a&&w<=h),!n&&s&xt.BELOW&&!(r&xt.BELOW)&&(y=f-(d-a)/g,n=y>=o&&y<=l),!n&&s&xt.LEFT&&!(r&xt.LEFT)&&(w=d-(f-o)*g,n=w>=a&&w<=h)}return n}function vf(i,e){const t=e.getExtent(),n=On(i);if(e.canWrapX()&&(n[0]<t[0]||n[0]>=t[2])){const r=Ue(t),o=Math.floor((n[0]-t[0])/r)*r;i[0]-=o,i[2]-=o}return i}function ch(i,e,t){if(e.canWrapX()){const n=e.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[n[0],i[1],n[2],i[3]]];vf(i,e);const r=Ue(n);if(Ue(i)>r&&!t)return[[n[0],i[1],n[2],i[3]]];if(i[0]<n[0])return[[i[0]+r,i[1],n[2],i[3]],[n[0],i[1],i[2],i[3]]];if(i[2]>n[2])return[[i[0],i[1],n[2],i[3]],[n[0],i[1],i[2]-r,i[3]]]}return[i]}function a_(i,e){return i[0]+=+e[0],i[1]+=+e[1],i}function js(i,e){let t=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=e[n]){t=!1;break}return t}function uh(i,e){const t=Math.cos(e),n=Math.sin(e),r=i[0]*t-i[1]*n,s=i[1]*t+i[0]*n;return i[0]=r,i[1]=s,i}function l_(i,e){return i[0]*=e,i[1]*=e,i}function Ef(i,e){if(e.canWrapX()){const t=Ue(e.getExtent()),n=h_(i,e,t);n&&(i[0]-=n*t)}return i}function h_(i,e,t){const n=e.getExtent();let r=0;return e.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(t=t||Ue(n),r=Math.floor((i[0]-n[0])/t)),r}const c_=63710088e-1;function wc(i,e,t){t=t||c_;const n=an(i[1]),r=an(e[1]),s=(r-n)/2,o=an(e[0]-i[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}const Ws=.9996,ei=.00669438,mo=ei*ei,yo=mo*ei,xn=ei/(1-ei),bc=Math.sqrt(1-ei),_r=(1-bc)/(1+bc),Sf=_r*_r,fh=Sf*_r,dh=fh*_r,xf=dh*_r,Tf=1-ei/4-3*mo/64-5*yo/256,u_=3*ei/8+3*mo/32+45*yo/1024,f_=15*mo/256+45*yo/1024,d_=35*yo/3072,g_=3/2*_r-27/32*fh+269/512*xf,p_=21/16*Sf-55/32*dh,__=151/96*fh-417/128*xf,m_=1097/512*dh,Gs=6378137;function y_(i,e,t){const n=i-5e5,o=(t.north?e:e-1e7)/Ws/(Gs*Tf),a=o+g_*Math.sin(2*o)+p_*Math.sin(4*o)+__*Math.sin(6*o)+m_*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),u=l/c,f=u*u,d=f*f,g=1-ei*h,y=Math.sqrt(1-ei*h),w=Gs/y,E=(1-ei)/g,b=xn*c**2,v=b*b,S=n/(w*Ws),x=S*S,T=x*S,I=T*S,A=I*S,O=A*S,j=a-u/E*(x/2-I/24*(5+3*f+10*b-4*v-9*xn))+O/720*(61+90*f+298*b+45*d-252*xn-3*v);let K=(S-T/6*(1+2*f+b)+A/120*(5-2*b+28*f-3*v+8*xn+24*d))/c;return K=ma(K+an(Rf(t.number)),-Math.PI,Math.PI),[gc(K),gc(j)]}const vc=-80,Ec=84,w_=-180,b_=180;function v_(i,e,t){i=ma(i,w_,b_),e<vc?e=vc:e>Ec&&(e=Ec);const n=an(e),r=Math.sin(n),s=Math.cos(n),o=r/s,a=o*o,l=a*a,h=an(i),c=Rf(t.number),u=an(c),f=Gs/Math.sqrt(1-ei*r**2),d=xn*s**2,g=s*ma(h-u,-Math.PI,Math.PI),y=g*g,w=y*g,E=w*g,b=E*g,v=b*g,S=Gs*(Tf*n-u_*Math.sin(2*n)+f_*Math.sin(4*n)-d_*Math.sin(6*n)),x=Ws*f*(g+w/6*(1-a+d)+b/120*(5-18*a+l+72*d-58*xn))+5e5;let T=Ws*(S+f*o*(y/2+E/24*(5-a+9*d+4*d**2)+v/720*(61-58*a+l+600*d-330*xn)));return t.north||(T+=1e7),[x,T]}function Rf(i){return(i-1)*6-180+3}const E_=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function If(i){let e=0;for(const r of E_){const s=i.match(r);if(s){e=parseInt(s[1]);break}}if(!e)return null;let t=0,n=!1;return e>32700&&e<32761?t=e-32700:e>32600&&e<32661&&(n=!0,t=e-32600),t?{number:t,north:n}:null}function Sc(i,e){return function(t,n,r,s){const o=t.length;r=r>1?r:2,s=s??r,n||(r>2?n=t.slice():n=new Array(o));for(let a=0;a<o;a+=s){const l=t[a],h=t[a+1],c=i(l,h,e);n[a]=c[0],n[a+1]=c[1]}return n}}function S_(i){return If(i)?new ah({code:i,units:"m"}):null}function x_(i){const e=If(i.getCode());return e?{forward:Sc(v_,e),inverse:Sc(y_,e)}:null}const Cf={info:1,warn:2,error:3,none:4};let T_=Cf.info;function Af(...i){T_>Cf.warn||console.warn(...i)}const R_=[x_],I_=[S_];let va=!0;function Mf(i){va=!(i===void 0?!0:i)}function gh(i,e){if(e!==void 0){for(let t=0,n=i.length;t<n;++t)e[t]=i[t];e=e}else e=i.slice();return e}function Ea(i){t_(i.getCode(),i),Vr(i,i,gh)}function C_(i){i.forEach(Ea)}function Yt(i){if(typeof i!="string")return i;const e=e_(i);if(e)return e;for(const t of I_){const n=t(i);if(n)return n}return null}function xc(i,e,t,n){i=Yt(i);let r;const s=i.getPointResolutionFunc();if(s){if(r=s(e,t),n&&n!==i.getUnits()){const o=i.getMetersPerUnit();o&&(r=r*o/$r[n])}}else{const o=i.getUnits();if(o=="degrees"&&!n||n=="degrees")r=e;else{const a=wo(i,Yt("EPSG:4326"));if(!a&&o!=="degrees")r=e*i.getMetersPerUnit();else{let h=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];h=a(h,h,2);const c=wc(h.slice(0,2),h.slice(2,4)),u=wc(h.slice(4,6),h.slice(6,8));r=(c+u)/2}const l=n?$r[n]:i.getMetersPerUnit();l!==void 0&&(r/=l)}}return r}function Tc(i){C_(i),i.forEach(function(e){i.forEach(function(t){e!==t&&Vr(e,t,gh)})})}function A_(i,e,t,n){i.forEach(function(r){e.forEach(function(s){Vr(r,s,t),Vr(s,r,n)})})}function ph(i,e){return i?typeof i=="string"?Yt(i):i:Yt(e)}function M_(i){return function(e,t,n,r){const s=e.length;n=n!==void 0?n:2,r=r??n,t=t!==void 0?t:new Array(s);for(let o=0;o<s;o+=r){const a=i(e.slice(o,o+n)),l=a.length;for(let h=0,c=r;h<c;++h)t[o+h]=h>=l?e[o+h]:a[h]}return t}}function _h(i,e){return Mf(),mh(i,"EPSG:4326",e!==void 0?e:"EPSG:3857")}function No(i,e){if(i===e)return!0;const t=i.getUnits()===e.getUnits();return(i.getCode()===e.getCode()||wo(i,e)===gh)&&t}function wo(i,e){const t=i.getCode(),n=e.getCode();let r=Fo(t,n);if(r)return r;let s=null,o=null;for(const l of R_)s||(s=l(i)),o||(o=l(e));if(!s&&!o)return null;const a="EPSG:4326";if(o)if(s)r=Bo(s.inverse,o.forward);else{const l=Fo(t,a);l&&(r=Bo(l,o.forward))}else{const l=Fo(a,n);l&&(r=Bo(s.inverse,l))}return r&&(Ea(i),Ea(e),Vr(i,e,r)),r}function Bo(i,e){return function(t,n,r,s){return n=i(t,n,r,s),e(n,n,r,s)}}function zs(i,e){const t=Yt(i),n=Yt(e);return wo(t,n)}function mh(i,e,t){const n=zs(e,t);if(!n){const r=Yt(e).getCode(),s=Yt(t).getCode();throw new Error(`No transform available between ${r} and ${s}`)}return n(i,void 0,i.length)}let P_=null;function L_(){return P_}function Sa(i,e){return i}function Si(i,e){return va&&!js(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(va=!1,Af("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function yh(i,e){return i}function sn(i,e){return i}function O_(){Tc(pc),Tc(mc),A_(mc,pc,qp,Zp)}O_();function Rc(i,e,t){return function(n,r,s,o,a){if(!n)return;if(!r&&!e)return n;const l=e?0:s[0]*r,h=e?0:s[1]*r,c=a?a[0]:0,u=a?a[1]:0;let f=i[0]+l/2+c,d=i[2]-l/2+c,g=i[1]+h/2+u,y=i[3]-h/2+u;f>d&&(f=(d+f)/2,d=f),g>y&&(g=(y+g)/2,y=g);let w=gt(n[0],f,d),E=gt(n[1],g,y);if(o&&t&&r){const b=30*r;w+=-b*Math.log(1+Math.max(0,f-n[0])/b)+b*Math.log(1+Math.max(0,n[0]-d)/b),E+=-b*Math.log(1+Math.max(0,g-n[1])/b)+b*Math.log(1+Math.max(0,n[1]-y)/b)}return[w,E]}}function k_(i){return i}function wh(i,e,t,n){const r=Ue(e)/t[0],s=wt(e)/t[1];return n?Math.min(i,Math.max(r,s)):Math.min(i,Math.min(r,s))}function bh(i,e,t){let n=Math.min(i,e);const r=50;return n*=Math.log(1+r*Math.max(0,i/e-1))/r+1,t&&(n=Math.max(n,t),n/=Math.log(1+r*Math.max(0,t/i-1))/r+1),gt(n,t/2,e*2)}function D_(i,e,t,n){return e=e!==void 0?e:!0,function(r,s,o,a){if(r!==void 0){const l=i[0],h=i[i.length-1],c=t?wh(l,t,o,n):l;if(a)return e?bh(r,c,h):gt(r,h,c);const u=Math.min(c,r),f=Math.floor(nh(i,u,s));return i[f]>c&&f<i.length-1?i[f+1]:i[f]}}}function F_(i,e,t,n,r,s){return n=n!==void 0?n:!0,t=t!==void 0?t:0,function(o,a,l,h){if(o!==void 0){const c=r?wh(e,r,l,s):e;if(h)return n?bh(o,c,t):gt(o,t,c);const u=1e-9,f=Math.ceil(Math.log(e/c)/Math.log(i)-u),d=-a*(.5-u)+.5,g=Math.min(c,o),y=Math.floor(Math.log(e/g)/Math.log(i)+d),w=Math.max(f,y),E=e/Math.pow(i,w);return gt(E,t,c)}}}function Ic(i,e,t,n,r){return t=t!==void 0?t:!0,function(s,o,a,l){if(s!==void 0){const h=n?wh(i,n,a,r):i;return!t||!l?gt(s,e,h):bh(s,h,e)}}}function vh(i){if(i!==void 0)return 0}function Cc(i){if(i!==void 0)return i}function N_(i){const e=2*Math.PI/i;return function(t,n){if(n)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function B_(i){const e=i===void 0?an(5):i;return function(t,n){return n||t===void 0?t:Math.abs(t)<=e?0:t}}function Pf(i){return Math.pow(i,3)}function vr(i){return 1-Pf(1-i)}function U_(i){return 3*i*i-2*i*i*i}function j_(i){return i}new Array(6);function li(){return[1,0,0,1,0,0]}function W_(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i}function Tt(i,e){const t=e[0],n=e[1];return e[0]=i[0]*t+i[2]*n+i[4],e[1]=i[1]*t+i[3]*n+i[5],e}function Ni(i,e,t,n,r,s,o,a){const l=Math.sin(s),h=Math.cos(s);return i[0]=n*h,i[1]=r*l,i[2]=-n*l,i[3]=r*h,i[4]=o*n*h-a*n*l+e,i[5]=o*r*l+a*r*h+t,i}function Lf(i,e){const t=G_(e);Ge(t!==0,"Transformation matrix cannot be inverted");const n=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5];return i[0]=o/t,i[1]=-r/t,i[2]=-s/t,i[3]=n/t,i[4]=(s*l-o*a)/t,i[5]=-(n*l-r*a)/t,i}function G_(i){return i[0]*i[3]-i[1]*i[2]}const Ac=[1e6,1e6,1e6,1e6,2,2];function z_(i){return"matrix("+i.map((t,n)=>Math.round(t*Ac[n])/Ac[n]).join(", ")+")"}function ln(i,e,t,n,r,s,o){s=s||[],o=o||2;let a=0;for(let l=e;l<t;l+=n){const h=i[l],c=i[l+1];s[a++]=r[0]*h+r[2]*c+r[4],s[a++]=r[1]*h+r[3]*c+r[5];for(let u=2;u<o;u++)s[a++]=i[l+u]}return s&&s.length!=a&&(s.length=a),s}function Of(i,e,t,n,r,s,o){o=o||[];const a=Math.cos(r),l=Math.sin(r),h=s[0],c=s[1];let u=0;for(let f=e;f<t;f+=n){const d=i[f]-h,g=i[f+1]-c;o[u++]=h+d*a-g*l,o[u++]=c+d*l+g*a;for(let y=f+2;y<f+n;++y)o[u++]=i[y]}return o&&o.length!=u&&(o.length=u),o}function Y_(i,e,t,n,r,s,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let u=e;u<t;u+=n){const f=i[u]-l,d=i[u+1]-h;a[c++]=l+r*f,a[c++]=h+s*d;for(let g=u+2;g<u+n;++g)a[c++]=i[g]}return a&&a.length!=c&&(a.length=c),a}function X_(i,e,t,n,r,s,o){o=o||[];let a=0;for(let l=e;l<t;l+=n){o[a++]=i[l]+r,o[a++]=i[l+1]+s;for(let h=l+2;h<l+n;++h)o[a++]=i[h]}return o&&o.length!=a&&(o.length=a),o}const Mc=li();class $_ extends yi{constructor(){super(),this.extent_=Kt(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=uf((e,t,n)=>{if(!n)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(n),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return We()}closestPointXY(e,t,n,r){return We()}containsXY(e,t){const n=this.getClosestPoint([e,t]);return n[0]===e&&n[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return We()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&uo(t),this.extentRevision_=this.getRevision()}return s_(this.extent_,e)}rotate(e,t){We()}scale(e,t,n){We()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return We()}getType(){return We()}applyTransform(e){We()}intersectsExtent(e){return We()}translate(e,t){We()}transform(e,t){const n=Yt(e),r=n.getUnits()=="tile-pixels"?function(s,o,a){const l=n.getExtent(),h=n.getWorldExtent(),c=wt(h)/wt(l);Ni(Mc,h[0],h[3],c,-c,0,0,0);const u=ln(s,0,s.length,a,Mc,o),f=zs(n,t);return f?f(u,u,a):u}:zs(n,t);return this.applyTransform(r),this}}const V_=$_;class K_ extends V_{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return hh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return We()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=Pc(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){We()}setLayout(e,t,n){let r;if(e)r=Pc(e);else{for(let s=0;s<n;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=H_(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();Of(n,0,n.length,r,e,t,n),this.changed()}}scale(e,t,n){t===void 0&&(t=e),n||(n=On(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Y_(r,0,r.length,s,e,t,n,r),this.changed()}}translate(e,t){const n=this.getFlatCoordinates();if(n){const r=this.getStride();X_(n,0,n.length,r,e,t,n),this.changed()}}}function H_(i){let e;return i==2?e="XY":i==3?e="XYZ":i==4&&(e="XYZM"),e}function Pc(i){let e;return i=="XY"?e=2:i=="XYZ"||i=="XYM"?e=3:i=="XYZM"&&(e=4),e}function q_(i,e,t){const n=i.getFlatCoordinates();if(!n)return null;const r=i.getStride();return ln(n,0,n.length,r,e,t)}const Eh=K_;function Lc(i,e,t,n,r,s,o){const a=i[e],l=i[e+1],h=i[t]-a,c=i[t+1]-l;let u;if(h===0&&c===0)u=e;else{const f=((r-a)*h+(s-l)*c)/(h*h+c*c);if(f>1)u=t;else if(f>0){for(let d=0;d<n;++d)o[d]=Zt(i[e+d],i[t+d],f);o.length=n;return}else u=e}for(let f=0;f<n;++f)o[f]=i[u+f];o.length=n}function kf(i,e,t,n,r){let s=i[e],o=i[e+1];for(e+=n;e<t;e+=n){const a=i[e],l=i[e+1],h=or(s,o,a,l);h>r&&(r=h),s=a,o=l}return r}function Z_(i,e,t,n,r){for(let s=0,o=t.length;s<o;++s){const a=t[s];r=kf(i,e,a,n,r),e=a}return r}function Df(i,e,t,n,r,s,o,a,l,h,c){if(e==t)return h;let u,f;if(r===0){if(f=or(o,a,i[e],i[e+1]),f<h){for(u=0;u<n;++u)l[u]=i[e+u];return l.length=n,f}return h}c=c||[NaN,NaN];let d=e+n;for(;d<t;)if(Lc(i,d-n,d,n,o,a,c),f=or(o,a,c[0],c[1]),f<h){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n,d+=n}else d+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/r|0,1);if(s&&(Lc(i,t-n,e,n,o,a,c),f=or(o,a,c[0],c[1]),f<h)){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function J_(i,e,t,n,r,s,o,a,l,h,c){c=c||[NaN,NaN];for(let u=0,f=t.length;u<f;++u){const d=t[u];h=Df(i,e,d,n,r,s,o,a,l,h,c),e=d}return h}function Q_(i,e,t,n){for(let r=0,s=t.length;r<s;++r)i[e++]=t[r];return e}function Ff(i,e,t,n){for(let r=0,s=t.length;r<s;++r){const o=t[r];for(let a=0;a<n;++a)i[e++]=o[a]}return e}function em(i,e,t,n,r){r=r||[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=Ff(i,e,t[o],n);r[s++]=l,e=l}return r.length=s,r}function Sh(i,e,t,n,r,s,o){const a=(t-e)/n;if(a<3){for(;e<t;e+=n)s[o++]=i[e],s[o++]=i[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[e,t-n];let c=0;for(;h.length>0;){const u=h.pop(),f=h.pop();let d=0;const g=i[f],y=i[f+1],w=i[u],E=i[u+1];for(let b=f+n;b<u;b+=n){const v=i[b],S=i[b+1],x=zp(v,S,g,y,w,E);x>d&&(c=b,d=x)}d>r&&(l[(c-e)/n]=1,f+n<c&&h.push(f,c),c+n<u&&h.push(c,u))}for(let u=0;u<a;++u)l[u]&&(s[o++]=i[e+u*n],s[o++]=i[e+u*n+1]);return o}function tm(i,e,t,n,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=Sh(i,e,c,n,r,s,o),a.push(o),e=c}return o}function vn(i,e){return e*Math.round(i/e)}function im(i,e,t,n,r,s,o){if(e==t)return o;let a=vn(i[e],r),l=vn(i[e+1],r);e+=n,s[o++]=a,s[o++]=l;let h,c;do if(h=vn(i[e],r),c=vn(i[e+1],r),e+=n,e==t)return s[o++]=h,s[o++]=c,o;while(h==a&&c==l);for(;e<t;){const u=vn(i[e],r),f=vn(i[e+1],r);if(e+=n,u==h&&f==c)continue;const d=h-a,g=c-l,y=u-a,w=f-l;if(d*w==g*y&&(d<0&&y<d||d==y||d>0&&y>d)&&(g<0&&w<g||g==w||g>0&&w>g)){h=u,c=f;continue}s[o++]=h,s[o++]=c,a=h,l=c,h=u,c=f}return s[o++]=h,s[o++]=c,o}function Nf(i,e,t,n,r,s,o,a){for(let l=0,h=t.length;l<h;++l){const c=t[l];o=im(i,e,c,n,r,s,o),a.push(o),e=c}return o}function nr(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=e;o<t;o+=n)r[s++]=i.slice(o,o+n);return r.length=s,r}function Ys(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=nr(i,e,l,n,r[s]),e=l}return r.length=s,r}function Oc(i,e,t,n,r){r=r!==void 0?r:[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o];r[s++]=l.length===1&&l[0]===e?[]:Ys(i,e,l,n,r[s]),e=l[l.length-1]}return r.length=s,r}function Bf(i,e,t,n){let r=0;const s=i[t-n],o=i[t-n+1];let a=0,l=0;for(;e<t;e+=n){const h=i[e]-s,c=i[e+1]-o;r+=l*h-a*c,a=h,l=c}return r/2}function nm(i,e,t,n){let r=0;for(let s=0,o=t.length;s<o;++s){const a=t[s];r+=Bf(i,e,a,n),e=a}return r}class Xs extends Eh{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new Xs(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,n,r){return r<pf(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(kf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Df(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,n,r))}getArea(){return Bf(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return nr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=Sh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Xs(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Ff(this.flatCoordinates,0,e,this.stride),this.changed()}}const kc=Xs;class xh extends Eh{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new xh(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const s=this.flatCoordinates,o=or(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let l=0;l<a;++l)n[l]=s[l];return n.length=a,o}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return mf(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return _f(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Q_(this.flatCoordinates,0,e,this.stride),this.changed()}}const Th=xh;function rm(i,e,t,n,r){return!bf(r,function(o){return!Tn(i,e,t,n,o[0],o[1])})}function Tn(i,e,t,n,r,s){let o=0,a=i[t-n],l=i[t-n+1];for(;e<t;e+=n){const h=i[e],c=i[e+1];l<=s?c>s&&(h-a)*(s-l)-(r-a)*(c-l)>0&&o++:c<=s&&(h-a)*(s-l)-(r-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Uf(i,e,t,n,r,s){if(t.length===0||!Tn(i,e,t[0],n,r,s))return!1;for(let o=1,a=t.length;o<a;++o)if(Tn(i,t[o-1],t[o],n,r,s))return!1;return!0}function Rh(i,e,t,n,r,s,o){let a,l,h,c,u,f,d;const g=r[s+1],y=[];for(let b=0,v=t.length;b<v;++b){const S=t[b];for(c=i[S-n],f=i[S-n+1],a=e;a<S;a+=n)u=i[a],d=i[a+1],(g<=f&&d<=g||f<=g&&g<=d)&&(h=(g-f)/(d-f)*(u-c)+c,y.push(h)),c=u,f=d}let w=NaN,E=-1/0;for(y.sort(Oi),c=y[0],a=1,l=y.length;a<l;++a){u=y[a];const b=Math.abs(u-c);b>E&&(h=(c+u)/2,Uf(i,e,t,n,h,g)&&(w=h,E=b)),c=u}return isNaN(w)&&(w=r[s]),o?(o.push(w,g,E),o):[w,g,E]}function sm(i,e,t,n,r){let s=[];for(let o=0,a=t.length;o<a;++o){const l=t[o];s=Rh(i,e,l,n,r,2*o,s),e=l[l.length-1]}return s}function om(i,e,t,n,r){let s;for(e+=n;e<t;e+=n)if(s=r(i.slice(e-n,e),i.slice(e,e+n)),s)return s;return!1}function jf(i,e,t,n,r){const s=wf(Kt(),i,e,t,n);return Wt(r,s)?ir(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:om(i,e,t,n,function(o,a){return o_(r,o,a)}):!1}function Wf(i,e,t,n,r){return!!(jf(i,e,t,n,r)||Tn(i,e,t,n,r[0],r[1])||Tn(i,e,t,n,r[0],r[3])||Tn(i,e,t,n,r[2],r[1])||Tn(i,e,t,n,r[2],r[3]))}function am(i,e,t,n,r){if(!Wf(i,e,t[0],n,r))return!1;if(t.length===1)return!0;for(let s=1,o=t.length;s<o;++s)if(rm(i,t[s-1],t[s],n,r)&&!jf(i,t[s-1],t[s],n,r))return!1;return!0}function lm(i,e,t,n){for(;e<t-n;){for(let r=0;r<n;++r){const s=i[e+r];i[e+r]=i[t-n+r],i[t-n+r]=s}e+=n,t-=n}}function Ih(i,e,t,n){let r=0,s=i[t-n],o=i[t-n+1];for(;e<t;e+=n){const a=i[e],l=i[e+1];r+=(a-s)*(l+o),s=a,o=l}return r===0?void 0:r>0}function hm(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Ih(i,e,a,n);if(s===0){if(r&&l||!r&&!l)return!1}else if(r&&!l||!r&&l)return!1;e=a}return!0}function Dc(i,e,t,n,r){r=r!==void 0?r:!1;for(let s=0,o=t.length;s<o;++s){const a=t[s],l=Ih(i,e,a,n);(s===0?r&&l||!r&&!l:r&&!l||!r&&l)&&lm(i,e,a,n),e=a}return e}function cm(i,e){const t=[];let n=0,r=0,s;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=Ih(i,n,l,2);if(s===void 0&&(s=h),h===s)t.push(e.slice(r,o+1));else{if(t.length===0)continue;t[t.length-1].push(e[r])}r=o+1,n=l}return t}class qr extends Eh{constructor(e,t,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&n?(this.setFlatCoordinates(t,e),this.ends_=n):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?rh(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new qr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,n,r){return r<pf(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Z_(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),J_(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,n,r))}containsXY(e,t){return Uf(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return nm(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),Dc(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,Ys(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=On(this.getExtent());this.flatInteriorPoint_=Rh(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Th(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new kc(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,n=this.ends_,r=[];let s=0;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=new kc(t.slice(s,l),e);r.push(h),s=l}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;hm(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=Dc(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],n=[];return t.length=Nf(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,n),new qr(t,"XY",n)}getType(){return"Polygon"}intersectsExtent(e){return am(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=em(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Fc(i){if(_o(i))throw new Error("Cannot create polygon from empty extent");const e=i[0],t=i[1],n=i[2],r=i[3],s=[e,t,e,r,n,r,n,t,e,t];return new qr(s,"XY",[s.length])}const Uo=0;class um extends yi{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=ph(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&Mf(),e.center&&(e.center=Si(e.center,this.projection_)),e.extent&&(e.extent=sn(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const a in ti)delete t[a];this.setProperties(t,!0);const n=dm(e);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=n.minZoom;const r=fm(e),s=n.constraint,o=gm(e);this.constraints_={center:r,resolution:s,rotation:o},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const n=this.getCenterInternal();if(n){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),o=s/2*(r[3]-t[3]+t[1]-r[1]),a=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([n[0]+o,n[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let n=0;n<t.length;++n){let r=arguments[n];r.center&&(r=Object.assign({},r),r.center=Si(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=Si(r.anchor,this.getProjection())),t[n]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,n;t>1&&typeof arguments[t-1]=="function"&&(n=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const c=arguments[r];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(r===t){n&&ys(n,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;r<t;++r){const c=arguments[r],u={start:s,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||U_,callback:n};if(c.center&&(u.sourceCenter=o,u.targetCenter=c.center.slice(),o=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=a,u.targetResolution=this.getResolutionForZoom(c.zoom),a=u.targetResolution):c.resolution&&(u.sourceResolution=a,u.targetResolution=c.resolution,a=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const f=ar(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+f,l=u.targetRotation}pm(u)?u.complete=!0:s+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(Dt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Dt.ANIMATING]>0}getInteracting(){return this.hints_[Dt.INTERACTING]>0}cancelAnimations(){this.setHint(Dt.ANIMATING,-this.hints_[Dt.ANIMATING]);let e;for(let t=0,n=this.animations_.length;t<n;++t){const r=this.animations_[t];if(r[0].callback&&ys(r[0].callback,!1),!e)for(let s=0,o=r.length;s<o;++s){const a=r[s];if(!a.complete){e=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let n=this.animations_.length-1;n>=0;--n){const r=this.animations_[n];let s=!0;for(let o=0,a=r.length;o<a;++o){const l=r[o];if(l.complete)continue;const h=e-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):s=!1;const u=l.easing(c);if(l.sourceCenter){const f=l.sourceCenter[0],d=l.sourceCenter[1],g=l.targetCenter[0],y=l.targetCenter[1];this.nextCenter_=l.targetCenter;const w=f+u*(g-f),E=d+u*(y-d);this.targetCenter_=[w,E]}if(l.sourceResolution&&l.targetResolution){const f=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const d=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(f,0,d,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=u===1?ar(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const d=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(d,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),t=!0,!l.complete)break}if(s){this.animations_[n]=null,this.setHint(Dt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=r[0].callback;o&&ys(o,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let n;const r=this.getCenterInternal();return r!==void 0&&(n=[r[0]-t[0],r[1]-t[1]],uh(n,e-this.getRotation()),a_(n,t)),n}calculateCenterZoom(e,t){let n;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const o=t[0]-e*(t[0]-r[0])/s,a=t[1]-e*(t[1]-r[1])/s;n=[o,a]}return n}getViewportSize_(e){const t=this.viewportSize_;if(e){const n=t[0],r=t[1];return[Math.abs(n*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(n*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Sa(e,this.getProjection())}getCenterInternal(){return this.get(ti.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return yh(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Ge(t,"The view center is not defined");const n=this.getResolution();Ge(n!==void 0,"The view resolution is not defined");const r=this.getRotation();return Ge(r!==void 0,"The view rotation is not defined"),ba(t,n,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(ti.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(sn(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const n=Ue(e)/t[0],r=wt(e)/t[1];return Math.max(n,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(t/n)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(ti.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),n=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(n/r)/t;return function(o){return Math.log(n/o)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const n=this.padding_;return n&&(t=[t[0]-n[1]-n[3],t[1]-n[0]-n[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),n=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();r=jo(r,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],t,n)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,n,r;if(this.resolutions_){const s=nh(this.resolutions_,e,1);t=s,n=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=n/this.resolutions_[s+1]}else n=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(n/e)/Math.log(r)}getResolutionForZoom(e){var t;if((t=this.resolutions_)!=null&&t.length){if(this.resolutions_.length===1)return this.resolutions_[0];const n=gt(Math.floor(e),0,this.resolutions_.length-2),r=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(r,gt(e-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let n;if(Ge(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Ge(!_o(e),"Cannot fit empty extent provided as `geometry`");const r=sn(e,this.getProjection());n=Fc(r)}else if(e.getType()==="Circle"){const r=sn(e.getExtent(),this.getProjection());n=Fc(r),n.rotate(this.getRotation(),On(r))}else n=e;this.fitInternal(n,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),n=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),o=e.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,f=s.length;u<f;u+=o){const d=s[u]*n-s[u+1]*r,g=s[u]*r+s[u+1]*n;a=Math.min(a,d),l=Math.min(l,g),h=Math.max(h,d),c=Math.max(c,g)}return[a,l,h,c]}fitInternal(e,t){t=t||{};let n=t.size;n||(n=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let o;t.minResolution!==void 0?o=t.minResolution:t.maxZoom!==void 0?o=this.getResolutionForZoom(t.maxZoom):o=0;const a=this.rotatedExtentForGeometry(e);let l=this.getResolutionForExtentInternal(a,[n[0]-r[1]-r[3],n[1]-r[0]-r[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),f=On(a);f[0]+=(r[1]-r[3])/2*l,f[1]+=(r[0]-r[2])/2*l;const d=f[0]*u-f[1]*c,g=f[1]*u+f[0]*c,y=this.getConstrainedCenter([d,g],l),w=t.callback?t.callback:dr;t.duration!==void 0?this.animateInternal({resolution:l,center:y,duration:t.duration,easing:t.easing},w):(this.targetResolution_=l,this.targetCenter_=y,this.applyTargetState_(!1,!0),ys(w,!0))}centerOn(e,t,n){this.centerOnInternal(Si(e,this.getProjection()),t,n)}centerOnInternal(e,t,n){this.setCenterInternal(jo(e,t,n,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,n,r){let s;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-n),l=jo(e,r,[a[0]/2+o[3],a[1]/2+o[0]],t,n);s=[e[0]-l[0],e[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Sa(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&Si(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,n);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=Si(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const n=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,n);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&Si(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const n=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,0,s,n),a=this.constraints_.center(this.targetCenter_,o,s,n,this.calculateCenterShift(this.targetCenter_,o,r,s));this.get(ti.ROTATION)!==r&&this.set(ti.ROTATION,r),this.get(ti.RESOLUTION)!==o&&(this.set(ti.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(ti.CENTER)||!js(this.get(ti.CENTER),a))&&this.set(ti.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,n){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,r,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(e===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}n=n||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!js(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:e,easing:vr,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Dt.INTERACTING,1)}endInteraction(e,t,n){n=n&&Si(n,this.getProjection()),this.endInteractionInternal(e,t,n)}endInteractionInternal(e,t,n){this.getInteracting()&&(this.setHint(Dt.INTERACTING,-1),this.resolveConstraints(e,t,n))}getConstrainedCenter(e,t){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),n)}getConstrainedZoom(e,t){const n=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(n,t))}getConstrainedResolution(e,t){t=t||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,n)}}function ys(i,e){setTimeout(function(){i(e)},0)}function fm(i){if(i.extent!==void 0){const t=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Rc(i.extent,i.constrainOnlyCenter,t)}const e=ph(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,Rc(t,!1,!1)}return k_}function dm(i){let e,t,n,o=i.minZoom!==void 0?i.minZoom:Uo,a=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,f=ph(i.projection,"EPSG:3857"),d=f.getExtent();let g=i.constrainOnlyCenter,y=i.extent;if(!h&&!y&&f.isGlobal()&&(g=!1,y=d),i.resolutions!==void 0){const w=i.resolutions;t=w[o],n=w[a]!==void 0?w[a]:w[w.length-1],i.constrainResolution?e=D_(w,c,!g&&y,u):e=Ic(t,n,c,!g&&y,u)}else{const E=(d?Math.max(Ue(d),wt(d)):360*$r.degrees/f.getMetersPerUnit())/oh/Math.pow(2,Uo),b=E/Math.pow(2,28-Uo);t=i.maxResolution,t!==void 0?o=0:t=E/Math.pow(l,o),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=t/Math.pow(l,a):n=E/Math.pow(l,a):n=b),a=o+Math.floor(Math.log(t/n)/Math.log(l)),n=t/Math.pow(l,a-o),i.constrainResolution?e=F_(l,t,n,c,!g&&y,u):e=Ic(t,n,c,!g&&y,u)}return{constraint:e,maxResolution:t,minResolution:n,minZoom:o,zoomFactor:l}}function gm(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const t=i.constrainRotation;return t===void 0||t===!0?B_():t===!1?Cc:typeof t=="number"?N_(t):Cc}return vh}function pm(i){return!(i.sourceCenter&&i.targetCenter&&!js(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function jo(i,e,t,n,r){const s=Math.cos(-r);let o=Math.sin(-r),a=i[0]*s-i[1]*o,l=i[1]*s+i[0]*o;a+=(e[0]/2-t[0])*n,l+=(t[1]-e[1]/2)*n,o=-o;const h=a*s-l*o,c=l*s+a*o;return[h,c]}const fi=um;class _m extends df{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Ke.SOURCE,this.handleSourcePropertyChange_);const n=e.source?e.source:null;this.setSource(n)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(Ke.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(it(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=je(e,ke.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const n=this.getMapInternal();!e&&n&&(e=n.getView()),e instanceof fi?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&n&&(t.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let r;if(t.layerStatesArray){if(r=t.layerStatesArray.find(o=>o.layer===this),!r)return!1}else r=this.getLayerState();const s=this.getExtent();return Ch(r,t.viewState)&&(!s||Wt(s,t.extent))}getAttributions(e){var s;if(!this.isVisible(e))return[];const t=(s=this.getSource())==null?void 0:s.getAttributions();if(!t)return[];const n=e instanceof fi?e.getViewStateAndExtent():e;let r=t(n);return Array.isArray(r)||(r=[r]),r}render(e,t){const n=this.getRenderer();return n.prepareFrame(e)?(this.rendered=!0,n.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(Ke.MAP,e)}getMapInternal(){return this.get(Ke.MAP)}setMap(e){this.mapPrecomposeKey_&&(it(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(it(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=je(e,Jt.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=je(this,ke.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,n=this.getLayerState(!1);Ge(!t.some(r=>r.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(n)}setSource(e){this.set(Ke.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Ch(i,e){if(!i.visible)return!1;const t=e.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;const n=e.zoom;return n>i.minZoom&&n<=i.maxZoom}const bo=_m;function Gf(i,e,t=0,n=i.length-1,r=mm){for(;n>t;){if(n-t>600){const l=n-t+1,h=e-t+1,c=Math.log(l),u=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),d=Math.max(t,Math.floor(e-h*u/l+f)),g=Math.min(n,Math.floor(e+(l-h)*u/l+f));Gf(i,e,d,g,r)}const s=i[e];let o=t,a=n;for(Tr(i,t,e),r(i[n],s)>0&&Tr(i,t,n);o<a;){for(Tr(i,o,a),o++,a--;r(i[o],s)<0;)o++;for(;r(i[a],s)>0;)a--}r(i[t],s)===0?Tr(i,t,a):(a++,Tr(i,a,n)),a<=e&&(t=a+1),e<=a&&(n=a-1)}}function Tr(i,e,t){const n=i[e];i[e]=i[t],i[t]=n}function mm(i,e){return i<e?-1:i>e?1:0}let zf=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const n=[];if(!bs(e,t))return n;const r=this.toBBox,s=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?r(a):a;bs(e,l)&&(t.leaf?n.push(a):Go(e,l)?this._all(a,n):s.push(a))}t=s.pop()}return n}collides(e){let t=this.data;if(!bs(e,t))return!1;const n=[];for(;t;){for(let r=0;r<t.children.length;r++){const s=t.children[r],o=t.leaf?this.toBBox(s):s;if(bs(e,o)){if(t.leaf||Go(e,o))return!0;n.push(s)}}t=n.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let n=0;n<e.length;n++)this.insert(e[n]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const n=this.data;this.data=t,t=n}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=qn([]),this}remove(e,t){if(!e)return this;let n=this.data;const r=this.toBBox(e),s=[],o=[];let a,l,h;for(;n||s.length;){if(n||(n=s.pop(),l=s[s.length-1],a=o.pop(),h=!0),n.leaf){const c=ym(e,n.children,t);if(c!==-1)return n.children.splice(c,1),s.push(n),this._condense(s),this}!h&&!n.leaf&&Go(n,r)?(s.push(n),o.push(a),a=0,l=n,n=n.children[0]):l?(a++,n=l.children[a],h=!1):n=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){const s=n-t+1;let o=this._maxEntries,a;if(s<=o)return a=qn(e.slice(t,n+1)),Wn(a,this.toBBox),a;r||(r=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,r-1))),a=qn([]),a.leaf=!1,a.height=r;const l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));Nc(e,t,n,h,this.compareMinX);for(let c=t;c<=n;c+=h){const u=Math.min(c+h-1,n);Nc(e,c,u,l,this.compareMinY);for(let f=c;f<=u;f+=l){const d=Math.min(f+l-1,u);a.children.push(this._build(e,f,d,r-1))}}return Wn(a,this.toBBox),a}_chooseSubtree(e,t,n,r){for(;r.push(t),!(t.leaf||r.length-1===n);){let s=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],c=Wo(h),u=vm(e,h)-c;u<o?(o=u,s=c<s?c:s,a=h):u===o&&c<s&&(s=c,a=h)}t=a||t.children[0]}return t}_insert(e,t,n){const r=n?e:this.toBBox(e),s=[],o=this._chooseSubtree(r,this.data,t,s);for(o.children.push(e),kr(o,r);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(r,s,t)}_split(e,t){const n=e[t],r=n.children.length,s=this._minEntries;this._chooseSplitAxis(n,s,r);const o=this._chooseSplitIndex(n,s,r),a=qn(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,Wn(n,this.toBBox),Wn(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}_splitRoot(e,t){this.data=qn([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Wn(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r,s=1/0,o=1/0;for(let a=t;a<=n-t;a++){const l=Or(e,0,a,this.toBBox),h=Or(e,a,n,this.toBBox),c=Em(l,h),u=Wo(l)+Wo(h);c<s?(s=c,r=a,o=u<o?u:o):c===s&&u<o&&(o=u,r=a)}return r||n-t}_chooseSplitAxis(e,t,n){const r=e.leaf?this.compareMinX:wm,s=e.leaf?this.compareMinY:bm,o=this._allDistMargin(e,t,n,r),a=this._allDistMargin(e,t,n,s);o<a&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);const s=this.toBBox,o=Or(e,0,t,s),a=Or(e,n-t,n,s);let l=ws(o)+ws(a);for(let h=t;h<n-t;h++){const c=e.children[h];kr(o,e.leaf?s(c):c),l+=ws(o)}for(let h=n-t-1;h>=t;h--){const c=e.children[h];kr(a,e.leaf?s(c):c),l+=ws(a)}return l}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)kr(t[r],e)}_condense(e){for(let t=e.length-1,n;t>=0;t--)e[t].children.length===0?t>0?(n=e[t-1].children,n.splice(n.indexOf(e[t]),1)):this.clear():Wn(e[t],this.toBBox)}};function ym(i,e,t){if(!t)return e.indexOf(i);for(let n=0;n<e.length;n++)if(t(i,e[n]))return n;return-1}function Wn(i,e){Or(i,0,i.children.length,e,i)}function Or(i,e,t,n,r){r||(r=qn(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=e;s<t;s++){const o=i.children[s];kr(r,i.leaf?n(o):o)}return r}function kr(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function wm(i,e){return i.minX-e.minX}function bm(i,e){return i.minY-e.minY}function Wo(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function ws(i){return i.maxX-i.minX+(i.maxY-i.minY)}function vm(i,e){return(Math.max(e.maxX,i.maxX)-Math.min(e.minX,i.minX))*(Math.max(e.maxY,i.maxY)-Math.min(e.minY,i.minY))}function Em(i,e){const t=Math.max(i.minX,e.minX),n=Math.max(i.minY,e.minY),r=Math.min(i.maxX,e.maxX),s=Math.min(i.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,s-n)}function Go(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function bs(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function qn(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Nc(i,e,t,n,r){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=n)continue;const o=e+Math.ceil((t-e)/n/2)*n;Gf(i,o,e,t,r),s.push(e,o,o,t)}}const Ne={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},Zr={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var It={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};It.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};It.max=It.whitepoint[2].D65;It.rgb=function(i,e){e=e||It.whitepoint[2].E;var t=i[0]/e[0],n=i[1]/e[1],r=i[2]/e[2],s,o,a;return s=t*3.240969941904521+n*-1.537383177570093+r*-.498610760293,o=t*-.96924363628087+n*1.87596750150772+r*.041555057407175,a=t*.055630079696993+n*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,s=Math.min(Math.max(0,s),1),o=Math.min(Math.max(0,o),1),a=Math.min(Math.max(0,a),1),[s*255,o*255,a*255]};Zr.xyz=function(i,e){var t=i[0]/255,n=i[1]/255,r=i[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.41239079926595+n*.35758433938387+r*.18048078840183,o=t*.21263900587151+n*.71516867876775+r*.072192315360733,a=t*.019330818715591+n*.11919477979462+r*.95053215224966;return e=e||It.whitepoint[2].E,[s*e[0],o*e[1],a*e[2]]};const Ah={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(i,e,t){var n,r,s,o,a,l,h,c,u,f,d,g,y;if(s=i[0],o=i[1],a=i[2],s===0)return[0,0,0];var w=.0011070564598794539;return e=e||"D65",t=t||2,u=It.whitepoint[t][e][0],f=It.whitepoint[t][e][1],d=It.whitepoint[t][e][2],g=4*u/(u+15*f+3*d),y=9*f/(u+15*f+3*d),n=o/(13*s)+g||0,r=a/(13*s)+y||0,h=s>8?f*Math.pow((s+16)/116,3):f*s*w,l=h*9*n/(4*r)||0,c=h*(12-3*n-20*r)/(4*r)||0,[l,h,c]}};It.luv=function(i,e,t){var n,r,s,o,a,l,h,c,u,f,d,g,y,w=.008856451679035631,E=903.2962962962961;e=e||"D65",t=t||2,u=It.whitepoint[t][e][0],f=It.whitepoint[t][e][1],d=It.whitepoint[t][e][2],g=4*u/(u+15*f+3*d),y=9*f/(u+15*f+3*d),l=i[0],h=i[1],c=i[2],n=4*l/(l+15*h+3*c)||0,r=9*h/(l+15*h+3*c)||0;var b=h/f;return s=b<=w?E*b:116*Math.pow(b,1/3)-16,o=13*s*(n-g),a=13*s*(r-y),[s,o,a]};var Yf={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(i){var e=i[0],t=i[1],n=i[2],r,s,o;return o=n/360*2*Math.PI,r=t*Math.cos(o),s=t*Math.sin(o),[e,r,s]},xyz:function(i){return Ah.xyz(Yf.luv(i))}};Ah.lchuv=function(i){var e=i[0],t=i[1],n=i[2],r=Math.sqrt(t*t+n*n),s=Math.atan2(n,t),o=s*360/2/Math.PI;return o<0&&(o+=360),[e,r,o]};It.lchuv=function(i){return Ah.lchuv(It.luv(i))};const Bc={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var Uc={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Sm(i){var c,u;var e,t=[],n=1,r;if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(typeof i=="number")return{space:"rgb",values:[i>>>16,(i&65280)>>>8,i&255],alpha:1};if(i=String(i).toLowerCase(),Bc[i])t=Bc[i].slice(),r="rgb";else if(i==="transparent")n=0,r="rgb",t=[0,0,0];else if(i[0]==="#"){var s=i.slice(1),o=s.length,a=o<=4;n=1,a?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],o===4&&(n=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],o===8&&(n=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),r="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(i)){var l=e[1];r=l.replace(/a$/,"");var h=r==="cmyk"?4:r==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=t.shift()),t=t.map(function(f,d){if(f[f.length-1]==="%")return f=parseFloat(f)/100,d===3?f:r==="rgb"?f*255:r[0]==="h"||r[0]==="l"&&!d?f*100:r==="lab"?f*125:r==="lch"?d<2?f*150:f*360:r[0]==="o"&&!d?f:r==="oklab"?f*.4:r==="oklch"?d<2?f*.4:f*360:f;if(r[d]==="h"||d===2&&r[r.length-1]==="h"){if(Uc[f]!==void 0)return Uc[f];if(f.endsWith("deg"))return parseFloat(f);if(f.endsWith("turn"))return parseFloat(f)*360;if(f.endsWith("grad"))return parseFloat(f)*360/400;if(f.endsWith("rad"))return parseFloat(f)*180/Math.PI}return f==="none"?0:parseFloat(f)}),n=t.length>h?t.pop():1}else/[0-9](?:\s|\/|,)/.test(i)&&(t=i.match(/([0-9]+)/g).map(function(f){return parseFloat(f)}),r=((u=(c=i.match(/([a-z])/ig))==null?void 0:c.join(""))==null?void 0:u.toLowerCase())||"rgb");return{space:r,values:t,alpha:n}}const zo={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(i){var e=i[0]/360,t=i[1]/100,n=i[2]/100,r,s,o,a,l,h=0;if(t===0)return l=n*255,[l,l,l];for(s=n<.5?n*(1+t):n+t-n*t,r=2*n-s,a=[0,0,0];h<3;)o=e+1/3*-(h-1),o<0?o++:o>1&&o--,l=6*o<1?r+(s-r)*6*o:2*o<1?s:3*o<2?r+(s-r)*(2/3-o)*6:r,a[h++]=l*255;return a}};Zr.hsl=function(i){var e=i[0]/255,t=i[1]/255,n=i[2]/255,r=Math.min(e,t,n),s=Math.max(e,t,n),o=s-r,a,l,h;return s===r?a=0:e===s?a=(t-n)/o:t===s?a=2+(n-e)/o:n===s&&(a=4+(e-t)/o),a=Math.min(a*60,360),a<0&&(a+=360),h=(r+s)/2,s===r?l=0:h<=.5?l=o/(s+r):l=o/(2-s-r),[a,l*100,h*100]};function xm(i){Array.isArray(i)&&i.raw&&(i=String.raw(...arguments)),i instanceof Number&&(i=+i);var e,t=Sm(i);if(!t.space)return[];const n=t.space[0]==="h"?zo.min:Zr.min,r=t.space[0]==="h"?zo.max:Zr.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],n[0]),r[0]),e[1]=Math.min(Math.max(t.values[1],n[1]),r[1]),e[2]=Math.min(Math.max(t.values[2],n[2]),r[2]),t.space[0]==="h"&&(e=zo.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}const Mh=[NaN,NaN,NaN,0];function Tm(i){return typeof i=="string"?i:Lh(i)}const Rm=1024,Rr={};let Yo=0;function Im(i){if(i.length===4)return i;const e=i.slice();return e[3]=1,e}function jc(i){const e=It.lchuv(Zr.xyz(i));return e[3]=i[3],e}function Cm(i){const e=It.rgb(Yf.xyz(i));return e[3]=i[3],e}function Ph(i){if(i==="none")return Mh;if(Rr.hasOwnProperty(i))return Rr[i];if(Yo>=Rm){let t=0;for(const n in Rr)t++&3||(delete Rr[n],--Yo)}const e=xm(i);if(e.length!==4)throw new Error('failed to parse "'+i+'" as color');for(const t of e)if(isNaN(t))throw new Error('failed to parse "'+i+'" as color');return Xf(e),Rr[i]=e,++Yo,e}function mr(i){return Array.isArray(i)?i:Ph(i)}function Xf(i){return i[0]=gt(i[0]+.5|0,0,255),i[1]=gt(i[1]+.5|0,0,255),i[2]=gt(i[2]+.5|0,0,255),i[3]=gt(i[3],0,1),i}function Lh(i){let e=i[0];e!=(e|0)&&(e=e+.5|0);let t=i[1];t!=(t|0)&&(t=t+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const r=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+e+","+t+","+n+","+r+")"}const cn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Am=cn.includes("firefox"),Mm=cn.includes("safari")&&!cn.includes("chrom");Mm&&(cn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(cn));const Pm=cn.includes("webkit")&&!cn.includes("edge"),$f=cn.includes("macintosh"),Vf=typeof devicePixelRatio<"u"?devicePixelRatio:1,Oh=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Kf=typeof Image<"u"&&Image.prototype.decode,Hf=function(){let i=!1;try{const e=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return i}();function _t(i,e,t,n){let r;return t&&t.length?r=t.shift():Oh?r=new OffscreenCanvas(i||300,e||300):r=document.createElement("canvas"),i&&(r.width=i),e&&(r.height=e),r.getContext("2d",n)}let Xo;function $s(){return Xo||(Xo=_t(1,1)),Xo}function vo(i){const e=i.canvas;e.width=1,e.height=1,i.clearRect(0,0,1,1)}function Wc(i,e){const t=e.parentNode;t&&t.replaceChild(i,e)}function Lm(i){for(;i.lastChild;)i.lastChild.remove()}function Om(i,e){const t=i.childNodes;for(let n=0;;++n){const r=t[n],s=e[n];if(!r&&!s)break;if(r!==s){if(!r){i.appendChild(s);continue}if(!s){i.removeChild(r),--n;continue}i.insertBefore(s,r)}}}function km(i,e,t){const n=i;let r=!0,s=!1,o=!1;const a=[Us(n,ke.LOAD,function(){o=!0,s||e()})];return n.src&&Kf?(s=!0,n.decode().then(function(){r&&e()}).catch(function(l){r&&(o?e():t())})):a.push(Us(n,ke.ERROR,t)),function(){r=!1,a.forEach(it)}}function Dm(i,e){return new Promise((t,n)=>{function r(){o(),t(i)}function s(){o(),n(new Error("Image load error"))}function o(){i.removeEventListener("load",r),i.removeEventListener("error",s)}i.addEventListener("load",r),i.addEventListener("error",s),e&&(i.src=e)})}function Fm(i,e){return e&&(i.src=e),i.src&&Kf?new Promise((t,n)=>i.decode().then(()=>t(i)).catch(r=>i.complete&&i.width?t(i):n(r))):Dm(i)}class Nm{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const n=this.cache_[t];!(e++&3)&&!n.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,n){const r=$o(e,t,n);return r in this.cache_?this.cache_[r]:null}getPattern(e,t,n){const r=$o(e,t,n);return r in this.patternCache_?this.patternCache_[r]:null}set(e,t,n,r,s){const o=$o(e,t,n),a=o in this.cache_;this.cache_[o]=r,s&&(r.getImageState()===Ne.IDLE&&r.load(),r.getImageState()===Ne.LOADING?r.ready().then(()=>{this.patternCache_[o]=$s().createPattern(r.getImage(1),"repeat")}):this.patternCache_[o]=$s().createPattern(r.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function $o(i,e,t){const n=t?mr(t):"null";return e+":"+i+":"+n}const Qt=new Nm;let Ir=null;class qf extends ho{constructor(e,t,n,r,s){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=r===void 0?Ne.IDLE:r,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===Ne.LOADED){Ir||(Ir=_t(1,1,void 0,{willReadFrequently:!0})),Ir.drawImage(this.image_,0,0);try{Ir.getImageData(0,0,1,1),this.tainted_=!1}catch{Ir=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ke.CHANGE)}handleImageError_(){this.imageState_=Ne.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=Ne.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],n=_t(e,t);n.fillRect(0,0,e,t),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===Ne.IDLE){this.image_||this.initializeImage_(),this.imageState_=Ne.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Fm(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==Ne.LOADED)return;const t=this.image_,n=_t(Math.ceil(t.width*e),Math.ceil(t.height*e)),r=n.canvas;n.scale(e,e),n.drawImage(t,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Tm(this.color_),n.fillRect(0,0,r.width/e,r.height/e),n.globalCompositeOperation="destination-in",n.drawImage(t,0,0),this.canvas_[e]=r}ready(){return this.ready_||(this.ready_=new Promise(e=>{if(this.imageState_===Ne.LOADED||this.imageState_===Ne.ERROR)e();else{const t=()=>{(this.imageState_===Ne.LOADED||this.imageState_===Ne.ERROR)&&(this.removeEventListener(ke.CHANGE,t),e())};this.addEventListener(ke.CHANGE,t)}})),this.ready_}}function kh(i,e,t,n,r,s){let o=e===void 0?void 0:Qt.get(e,t,r);return o||(o=new qf(i,i&&"src"in i?i.src||void 0:e,t,n,r),Qt.set(e,t,r,o,s)),s&&o&&!Qt.getPattern(e,t,r)&&Qt.set(e,t,r,o,s),o}function Gc(i){return i[0]>0&&i[1]>0}function Bm(i,e,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*e+.5|0,t[1]=i[1]*e+.5|0,t}function zt(i,e){return Array.isArray(i)?i:(e===void 0?e=[i,i]:(e[0]=i,e[1]=i),e)}class Dh{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=zt(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Dh({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return We()}getImage(e){return We()}getHitDetectionImage(){return We()}getPixelRatio(e){return 1}getImageState(){return We()}getImageSize(){return We()}getOrigin(){return We()}getSize(){return We()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=zt(e)}listenImageChange(e){We()}load(){We()}unlistenImageChange(e){We()}ready(){return Promise.resolve()}}const Zf=Dh;function pi(i){return i?Array.isArray(i)?Lh(i):typeof i=="object"&&"src"in i?Um(i):i:null}function Um(i){if(!i.offset||!i.size)return Qt.getPattern(i.src,"anonymous",i.color);const e=i.src+":"+i.offset,t=Qt.getPattern(e,void 0,i.color);if(t)return t;const n=Qt.get(i.src,"anonymous",null);if(n.getImageState()!==Ne.LOADED)return null;const r=_t(i.size[0],i.size[1]);return r.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),kh(r.canvas,e,void 0,Ne.LOADED,i.color,!0),Qt.getPattern(e,void 0,i.color)}const vs="ol-hidden",Eo="ol-unselectable",Fh="ol-control",zc="ol-collapsed",jm=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Yc=["style","variant","weight","size","lineHeight","family"],Jf=function(i){const e=i.match(jm);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,r=Yc.length;n<r;++n){const s=e[n+1];s!==void 0&&(t[Yc[n]]=s)}return t.families=t.family.split(/,\s?/),t},Qf="10px sans-serif",Ut="#000",yr="round",ki=[],Di=0,wr="round",Jr=10,Qr="#000",es="center",Vs="middle",Rn=[0,0,0,0],ts=1,xi=new yi;let Zn=null,xa;const Ta={},Wm=function(){const e="32px ",t=["monospace","serif"],n=t.length,r="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(h,c,u){let f=!0;for(let d=0;d<n;++d){const g=t[d];if(o=Ks(h+" "+c+" "+e+g,r),u!=g){const y=Ks(h+" "+c+" "+e+u+","+g,r);f=f&&y!=o}}return!!f}function l(){let h=!0;const c=xi.getKeys();for(let u=0,f=c.length;u<f;++u){const d=c[u];if(xi.get(d)<100){const[g,y,w]=d.split(`
`);a(g,y,w)?(os(Ta),Zn=null,xa=void 0,xi.set(d,100)):(xi.set(d,xi.get(d)+1,!0),h=!1)}}h&&(clearInterval(s),s=void 0)}return function(h){const c=Jf(h);if(!c)return;const u=c.families;for(let f=0,d=u.length;f<d;++f){const g=u[f],y=c.style+`
`+c.weight+`
`+g;xi.get(y)===void 0&&(xi.set(y,100,!0),a(c.style,c.weight,g)||(xi.set(y,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),Gm=function(){let i;return function(e){let t=Ta[e];if(t==null){if(Oh){const n=Jf(e),r=ed(e,"g");t=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=e,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);Ta[e]=t}return t}}();function ed(i,e){return Zn||(Zn=_t(1,1)),i!=xa&&(Zn.font=i,xa=Zn.font),Zn.measureText(e)}function Ks(i,e){return ed(i,e).width}function Xc(i,e,t){if(e in t)return t[e];const n=e.split(`
`).reduce((r,s)=>Math.max(r,Ks(i,s)),0);return t[e]=n,n}function zm(i,e){const t=[],n=[],r=[];let s=0,o=0,a=0,l=0;for(let h=0,c=e.length;h<=c;h+=2){const u=e[h];if(u===`
`||h===c){s=Math.max(s,o),r.push(o),o=0,a+=l,l=0;continue}const f=e[h+1]||i.font,d=Ks(f,u);t.push(d),o+=d;const g=Gm(f);n.push(g),l=Math.max(l,g)}return{width:s,height:a,widths:t,heights:n,lineWidths:r}}function Ym(i,e,t,n,r,s,o,a,l,h,c){i.save(),t!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=t:i.globalAlpha*=t),e&&i.transform.apply(i,e),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),Xm(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,r,s,o,a,0,0,o,a)):i.drawImage(n,r,s,o,a,l,h,o*c[0],a*c[1]),i.restore()}function Xm(i,e){const t=i.contextInstructions;for(let n=0,r=t.length;n<r;n+=2)Array.isArray(t[n+1])?e[t[n]].apply(e,t[n+1]):e[t[n]]=t[n+1]}class Nh extends Zf{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?Ne.LOADING:Ne.LOADED,this.imageState_===Ne.LOADING&&this.ready().then(()=>this.imageState_=Ne.LOADED),this.render()}clone(){const e=this.getScale(),t=new Nh({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),n=this.getScaleArray();return[e[0]/2-t[0]/n[0],e[1]/2+t[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){var s,o;const t=(s=this.fill_)==null?void 0:s.getKey(),n=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let r=(o=Qt.get(n,null,null))==null?void 0:o.getImage(1);if(!r){const a=this.renderOptions_,l=Math.ceil(a.size*e),h=_t(l,l);this.draw_(a,h,e),r=h.canvas,Qt.set(n,null,null,new qf(r,void 0,null,Ne.LOADED,null))}return r}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,n){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const T=r;r=s,s=T}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),c=r-h,u=Math.sqrt(l*l+c*c),f=u/l;if(e==="miter"&&f<=n)return f*t;const d=t/2/f,g=t/2*(c/u),w=Math.sqrt((r+d)*(r+d)+g*g)-r;if(this.radius2_===void 0||e==="bevel")return w*2;const E=r*Math.sin(a),b=Math.sqrt(r*r-E*E),v=s-b,x=Math.sqrt(E*E+v*v)/E;if(x<=n){const T=x*t/2-s-r;return 2*Math.max(w,T)}return w*2}createRenderOptions(){let e=yr,t=wr,n=0,r=null,s=0,o,a=0;this.stroke_&&(o=pi(this.stroke_.getColor()??Qr),a=this.stroke_.getWidth()??ts,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??wr,e=this.stroke_.getLineCap()??yr,n=this.stroke_.getMiterLimit()??Jr);const l=this.calculateLineJoinSize_(t,a,n),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:e,lineDash:r,lineDashOffset:s,lineJoin:t,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,n){if(t.scale(n,n),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=Ut),t.fillStyle=pi(r),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let n=this.fill_.getColor(),r=0;typeof n=="string"&&(n=mr(n)),n===null?r=1:Array.isArray(n)&&(r=n.length===4?n[3]:1),r===0&&(t=_t(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const n=this.radius;if(t===1/0)e.arc(0,0,n,0,2*Math.PI);else{const r=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const l=s+a*o,h=a%2===0?n:r;e.lineTo(h*Math.cos(l),h*Math.sin(l))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Ut,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const td=Nh;class Bh extends td{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Bh({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}const id=Bh;class Uh{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new Uh({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=kh(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===Ne.IDLE&&t.load(),t.getImageState()===Ne.LOADING&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?Xe(e):typeof e=="object"&&"src"in e?e.src+":"+e.offset:mr(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const jh=Uh;class Wh{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Wh({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const nd=Wh;class So{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=$c,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new So({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=$c,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function $m(i){let e;if(typeof i=="function")e=i;else{let t;Array.isArray(i)?t=i:(Ge(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[i]),e=function(){return t}}return e}let Vo=null;function rd(i,e){if(!Vo){const t=new jh({color:"rgba(255,255,255,0.4)"}),n=new nd({color:"#3399CC",width:1.25});Vo=[new So({image:new id({fill:t,stroke:n,radius:5}),fill:t,stroke:n})]}return Vo}function $c(i){return i.getGeometry()}const hr=So;function Vc(i,e,t,n){return t!==void 0&&n!==void 0?[t/i,n/e]:t!==void 0?t/i:n!==void 0?n/e:1}class Gh extends Zf{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,n=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:n,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;let a=e.src;Ge(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||Xe(o)),Ge(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),Ge(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(e.src!==void 0?l=Ne.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?Ne.LOADED:Ne.IDLE:l=Ne.LOADING:l=Ne.LOADED),this.color_=e.color!==void 0?mr(e.color):null,this.iconImage_=kh(o,a,this.crossOrigin_,l,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,this.initialOptions_,e.width!==void 0||e.height!==void 0){let h,c;if(e.size)[h,c]=e.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=e;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const d=this.iconImage_.getSize();this.setScale(Vc(d[0],d[1],e.width,e.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(Vc(h,c,e.width,e.height))}}clone(){let e,t,n;return this.initialOptions_?(t=this.initialOptions_.width,n=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Gh({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),n=this.getScaleArray();return[e[0]-t[0]/n[0],e[1]+t[1]/n[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),n=this.iconImage_.getSize();if(!t||!n)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=n[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=n[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==Ne.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==Ne.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(ke.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(ke.CHANGE,e)}ready(){return this.iconImage_.ready()}}const xo=Gh,Vm="#333";class zh{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=zt(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new jh({color:Vm}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new zh({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=zt(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const Km=zh;let Dn=0;const Ft=1<<Dn++,Be=1<<Dn++,jt=1<<Dn++,oi=1<<Dn++,kn=1<<Dn++,Dr=1<<Dn++,Es=Math.pow(2,Dn)-1,Yh={[Ft]:"boolean",[Be]:"number",[jt]:"string",[oi]:"color",[kn]:"number[]",[Dr]:"size"},Hm=Object.keys(Yh).map(Number).sort(Oi);function qm(i){return i in Yh}function Fr(i){const e=[];for(const t of Hm)Nr(i,t)&&e.push(Yh[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function Nr(i,e){return(i&e)===e}function $i(i,e){return i===e}class yt{constructor(e,t){if(!qm(e))throw new Error(`literal expressions must have a specific type, got ${Fr(e)}`);this.type=e,this.value=t}}class Zm{constructor(e,t,...n){this.type=e,this.operator=t,this.args=n}}function sd(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1}}function Ct(i,e,t){switch(typeof i){case"boolean":{if($i(e,jt))return new yt(jt,i?"true":"false");if(!Nr(e,Ft))throw new Error(`got a boolean, but expected ${Fr(e)}`);return new yt(Ft,i)}case"number":{if($i(e,Dr))return new yt(Dr,zt(i));if($i(e,Ft))return new yt(Ft,!!i);if($i(e,jt))return new yt(jt,i.toString());if(!Nr(e,Be))throw new Error(`got a number, but expected ${Fr(e)}`);return new yt(Be,i)}case"string":{if($i(e,oi))return new yt(oi,Ph(i));if($i(e,Ft))return new yt(Ft,!!i);if(!Nr(e,jt))throw new Error(`got a string, but expected ${Fr(e)}`);return new yt(jt,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return l0(i,e,t);for(const n of i)if(typeof n!="number")throw new Error("expected an array of numbers");if($i(e,Dr)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new yt(Dr,i)}if($i(e,oi)){if(i.length===3)return new yt(oi,[...i,1]);if(i.length===4)return new yt(oi,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!Nr(e,kn))throw new Error(`got an array of numbers, but expected ${Fr(e)}`);return new yt(kn,i)}const ce={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Jm={[ce.Get]:Oe(Fe(1,1/0),Kc),[ce.Var]:Oe(Fe(1,1),Qm),[ce.Has]:Oe(Fe(1,1/0),Kc),[ce.Id]:Oe(e0,Gn),[ce.Concat]:Oe(Fe(2,1/0),Ye(jt)),[ce.GeometryType]:Oe(t0,Gn),[ce.LineMetric]:Oe(Gn),[ce.Resolution]:Oe(Gn),[ce.Zoom]:Oe(Gn),[ce.Time]:Oe(Gn),[ce.Any]:Oe(Fe(2,1/0),Ye(Ft)),[ce.All]:Oe(Fe(2,1/0),Ye(Ft)),[ce.Not]:Oe(Fe(1,1),Ye(Ft)),[ce.Equal]:Oe(Fe(2,2),Ye(Es)),[ce.NotEqual]:Oe(Fe(2,2),Ye(Es)),[ce.GreaterThan]:Oe(Fe(2,2),Ye(Be)),[ce.GreaterThanOrEqualTo]:Oe(Fe(2,2),Ye(Be)),[ce.LessThan]:Oe(Fe(2,2),Ye(Be)),[ce.LessThanOrEqualTo]:Oe(Fe(2,2),Ye(Be)),[ce.Multiply]:Oe(Fe(2,1/0),Hc),[ce.Coalesce]:Oe(Fe(2,1/0),Hc),[ce.Divide]:Oe(Fe(2,2),Ye(Be)),[ce.Add]:Oe(Fe(2,1/0),Ye(Be)),[ce.Subtract]:Oe(Fe(2,2),Ye(Be)),[ce.Clamp]:Oe(Fe(3,3),Ye(Be)),[ce.Mod]:Oe(Fe(2,2),Ye(Be)),[ce.Pow]:Oe(Fe(2,2),Ye(Be)),[ce.Abs]:Oe(Fe(1,1),Ye(Be)),[ce.Floor]:Oe(Fe(1,1),Ye(Be)),[ce.Ceil]:Oe(Fe(1,1),Ye(Be)),[ce.Round]:Oe(Fe(1,1),Ye(Be)),[ce.Sin]:Oe(Fe(1,1),Ye(Be)),[ce.Cos]:Oe(Fe(1,1),Ye(Be)),[ce.Atan]:Oe(Fe(1,2),Ye(Be)),[ce.Sqrt]:Oe(Fe(1,1),Ye(Be)),[ce.Match]:Oe(Fe(4,1/0),qc,n0),[ce.Between]:Oe(Fe(3,3),Ye(Be)),[ce.Interpolate]:Oe(Fe(6,1/0),qc,r0),[ce.Case]:Oe(Fe(3,1/0),i0,s0),[ce.In]:Oe(Fe(2,2),o0),[ce.Number]:Oe(Fe(1,1/0),Ye(Es)),[ce.String]:Oe(Fe(1,1/0),Ye(Es)),[ce.Array]:Oe(Fe(1,1/0),Ye(Be)),[ce.Color]:Oe(Fe(1,4),Ye(Be)),[ce.Band]:Oe(Fe(1,3),Ye(Be)),[ce.Palette]:Oe(Fe(2,2),a0),[ce.ToString]:Oe(Fe(1,1),Ye(Ft|Be|jt|oi))};function Kc(i,e,t){const n=i.length-1,r=new Array(n);for(let s=0;s<n;++s){const o=i[s+1];switch(typeof o){case"number":{r[s]=new yt(Be,o);break}case"string":{r[s]=new yt(jt,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}s===0&&t.properties.add(String(o))}return r}function Qm(i,e,t){const n=i[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return t.variables.add(n),[new yt(jt,n)]}function e0(i,e,t){t.featureId=!0}function t0(i,e,t){t.geometryType=!0}function Gn(i,e,t){const n=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function Fe(i,e){return function(t,n,r){const s=t[0],o=t.length-1;if(i===e){if(o!==i){const a=i===1?"":"s";throw new Error(`expected ${i} argument${a} for ${s}, got ${o}`)}}else if(o<i||o>e){const a=e===1/0?`${i} or more`:`${i} to ${e}`;throw new Error(`expected ${a} arguments for ${s}, got ${o}`)}}}function Hc(i,e,t){const n=i.length-1,r=new Array(n);for(let s=0;s<n;++s){const o=Ct(i[s+1],e,t);r[s]=o}return r}function Ye(i){return function(e,t,n){const r=e.length-1,s=new Array(r);for(let o=0;o<r;++o){const a=Ct(e[o+1],i,n);s[o]=a}return s}}function i0(i,e,t){const n=i[0],r=i.length-1;if(r%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${r} instead`)}function qc(i,e,t){const n=i[0],r=i.length-1;if(r%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${r} instead`)}function n0(i,e,t){const n=i.length-1,r=jt|Be|Ft,s=Ct(i[1],r,t),o=Ct(i[i.length-1],e,t),a=new Array(n-2);for(let l=0;l<n-2;l+=2){try{const h=Ct(i[l+2],s.type,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Ct(i[l+3],o.type,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[s,...a,o]}function r0(i,e,t){const n=i[1];let r;switch(n[0]){case"linear":r=1;break;case"exponential":const l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);r=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const s=new yt(Be,r);let o;try{o=Ct(i[2],Be,t)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(i.length-3);for(let l=0;l<a.length;l+=2){try{const h=Ct(i[l+3],Be,t);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Ct(i[l+4],e,t);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[s,o,...a]}function s0(i,e,t){const n=Ct(i[i.length-1],e,t),r=new Array(i.length-1);for(let s=0;s<r.length-1;s+=2){try{const o=Ct(i[s+1],Ft,t);r[s]=o}catch(o){throw new Error(`failed to parse argument ${s} of case expression: ${o.message}`)}try{const o=Ct(i[s+2],n.type,t);r[s+1]=o}catch(o){throw new Error(`failed to parse argument ${s+1} of case expression: ${o.message}`)}}return r[r.length-1]=n,r}function o0(i,e,t){let n=i[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let r;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],r=jt}else r=Be;const s=new Array(n.length);for(let a=0;a<s.length;a++)try{const l=Ct(n[a],r,t);s[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Ct(i[1],r,t),...s]}function a0(i,e,t){let n;try{n=Ct(i[1],Be,t)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const r=i[2];if(!Array.isArray(r))throw new Error("the second argument of palette must be an array");const s=new Array(r.length);for(let o=0;o<s.length;o++){let a;try{a=Ct(r[o],oi,t)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof yt))throw new Error(`the palette color at index ${o} must be a literal value`);s[o]=a}return[n,...s]}function Oe(...i){return function(e,t,n){const r=e[0];let s;for(let o=0;o<i.length;o++){const a=i[o](e,t,n);if(o==i.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");s=a}}return new Zm(t,r,...s)}}function l0(i,e,t){const n=i[0],r=Jm[n];if(!r)throw new Error(`unknown operator: ${n}`);return r(i,e,t)}function od(i){if(!i)return"";const e=i.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return od(i.getGeometries()[0]);default:return""}}function ad(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Gi(i,e,t){const n=Ct(i,e,t);return hi(n)}function hi(i,e){if(i instanceof yt){if(i.type===oi&&typeof i.value=="string"){const n=Ph(i.value);return function(){return n}}return function(){return i.value}}const t=i.operator;switch(t){case ce.Number:case ce.String:case ce.Coalesce:return h0(i);case ce.Get:case ce.Var:case ce.Has:return c0(i);case ce.Id:return n=>n.featureId;case ce.GeometryType:return n=>n.geometryType;case ce.Concat:{const n=i.args.map(r=>hi(r));return r=>"".concat(...n.map(s=>s(r).toString()))}case ce.Resolution:return n=>n.resolution;case ce.Any:case ce.All:case ce.Between:case ce.In:case ce.Not:return f0(i);case ce.Equal:case ce.NotEqual:case ce.LessThan:case ce.LessThanOrEqualTo:case ce.GreaterThan:case ce.GreaterThanOrEqualTo:return u0(i);case ce.Multiply:case ce.Divide:case ce.Add:case ce.Subtract:case ce.Clamp:case ce.Mod:case ce.Pow:case ce.Abs:case ce.Floor:case ce.Ceil:case ce.Round:case ce.Sin:case ce.Cos:case ce.Atan:case ce.Sqrt:return d0(i);case ce.Case:return g0(i);case ce.Match:return p0(i);case ce.Interpolate:return _0(i);case ce.ToString:return m0(i);default:throw new Error(`Unsupported operator ${t}`)}}function h0(i,e){const t=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=hi(i.args[s]);switch(t){case ce.Coalesce:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case ce.Number:case ce.String:return s=>{for(let o=0;o<n;++o){const a=r[o](s);if(typeof a===t)return a}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function c0(i,e){const n=i.args[0].value;switch(i.operator){case ce.Get:return r=>{const s=i.args;let o=r.properties[n];for(let a=1,l=s.length;a<l;++a){const c=s[a].value;o=o[c]}return o};case ce.Var:return r=>r.variables[n];case ce.Has:return r=>{const s=i.args;if(!(n in r.properties))return!1;let o=r.properties[n];for(let a=1,l=s.length;a<l;++a){const c=s[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function u0(i,e){const t=i.operator,n=hi(i.args[0]),r=hi(i.args[1]);switch(t){case ce.Equal:return s=>n(s)===r(s);case ce.NotEqual:return s=>n(s)!==r(s);case ce.LessThan:return s=>n(s)<r(s);case ce.LessThanOrEqualTo:return s=>n(s)<=r(s);case ce.GreaterThan:return s=>n(s)>r(s);case ce.GreaterThanOrEqualTo:return s=>n(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${t}`)}}function f0(i,e){const t=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=hi(i.args[s]);switch(t){case ce.Any:return s=>{for(let o=0;o<n;++o)if(r[o](s))return!0;return!1};case ce.All:return s=>{for(let o=0;o<n;++o)if(!r[o](s))return!1;return!0};case ce.Between:return s=>{const o=r[0](s),a=r[1](s),l=r[2](s);return o>=a&&o<=l};case ce.In:return s=>{const o=r[0](s);for(let a=1;a<n;++a)if(o===r[a](s))return!0;return!1};case ce.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${t}`)}}function d0(i,e){const t=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=hi(i.args[s]);switch(t){case ce.Multiply:return s=>{let o=1;for(let a=0;a<n;++a)o*=r[a](s);return o};case ce.Divide:return s=>r[0](s)/r[1](s);case ce.Add:return s=>{let o=0;for(let a=0;a<n;++a)o+=r[a](s);return o};case ce.Subtract:return s=>r[0](s)-r[1](s);case ce.Clamp:return s=>{const o=r[0](s),a=r[1](s);if(o<a)return a;const l=r[2](s);return o>l?l:o};case ce.Mod:return s=>r[0](s)%r[1](s);case ce.Pow:return s=>Math.pow(r[0](s),r[1](s));case ce.Abs:return s=>Math.abs(r[0](s));case ce.Floor:return s=>Math.floor(r[0](s));case ce.Ceil:return s=>Math.ceil(r[0](s));case ce.Round:return s=>Math.round(r[0](s));case ce.Sin:return s=>Math.sin(r[0](s));case ce.Cos:return s=>Math.cos(r[0](s));case ce.Atan:return n===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case ce.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${t}`)}}function g0(i,e){const t=i.args.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=hi(i.args[r]);return r=>{for(let s=0;s<t-1;s+=2)if(n[s](r))return n[s+1](r);return n[t-1](r)}}function p0(i,e){const t=i.args.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=hi(i.args[r]);return r=>{const s=n[0](r);for(let o=1;o<t;o+=2)if(s===n[o](r))return n[o+1](r);return n[t-1](r)}}function _0(i,e){const t=i.args.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=hi(i.args[r]);return r=>{const s=n[0](r),o=n[1](r);let a,l;for(let h=2;h<t;h+=2){const c=n[h](r);let u=n[h+1](r);const f=Array.isArray(u);if(f&&(u=Im(u)),c>=o)return h===2?u:f?y0(s,o,a,l,c,u):Br(s,o,a,l,c,u);a=c,l=u}return l}}function m0(i,e){const t=i.operator,n=i.args.length,r=new Array(n);for(let s=0;s<n;++s)r[s]=hi(i.args[s]);switch(t){case ce.ToString:return s=>{const o=r[0](s);return i.args[0].type===oi?Lh(o):o.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function Br(i,e,t,n,r,s){const o=r-t;if(o===0)return n;const a=e-t,l=i===1?a/o:(Math.pow(i,a)-1)/(Math.pow(i,o)-1);return n+l*(s-n)}function y0(i,e,t,n,r,s){if(r-t===0)return n;const a=jc(n),l=jc(s);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[Br(i,e,t,a[0],r,l[0]),Br(i,e,t,a[1],r,l[1]),a[2]+Br(i,e,t,0,r,h),Br(i,e,t,n[3],r,s[3])];return Xf(Cm(c))}function w0(i){return!0}function b0(i){const e=sd(),t=v0(i,e),n=ad();return function(r,s){if(n.properties=r.getPropertiesInternal(),n.resolution=s,e.featureId){const o=r.getId();o!==void 0?n.featureId=o:n.featureId=null}return e.geometryType&&(n.geometryType=od(r.getGeometry())),t(n)}}function Zc(i){const e=sd(),t=i.length,n=new Array(t);for(let o=0;o<t;++o)n[o]=Ra(i[o],e);const r=ad(),s=new Array(t);return function(o,a){if(r.properties=o.getPropertiesInternal(),r.resolution=a,e.featureId){const h=o.getId();h!==void 0?r.featureId=h:r.featureId=null}let l=0;for(let h=0;h<t;++h){const c=n[h](r);c&&(s[l]=c,l+=1)}return s.length=l,s}}function v0(i,e){const t=i.length,n=new Array(t);for(let r=0;r<t;++r){const s=i[r],o="filter"in s?Gi(s.filter,Ft,e):w0;let a;if(Array.isArray(s.style)){const l=s.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=Ra(s.style[h],e)}else a=[Ra(s.style,e)];n[r]={filter:o,styles:a}}return function(r){const s=[];let o=!1;for(let a=0;a<t;++a){const l=n[a].filter;if(l(r)&&!(i[a].else&&o)){o=!0;for(const h of n[a].styles){const c=h(r);c&&s.push(c)}}}return s}}function Ra(i,e){const t=is(i,"",e),n=ns(i,"",e),r=E0(i,e),s=S0(i,e),o=Gt(i,"z-index",e);if(!t&&!n&&!r&&!s&&!gr(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const a=new hr;return function(l){let h=!0;if(t){const c=t(l);c&&(h=!1),a.setFill(c)}if(n){const c=n(l);c&&(h=!1),a.setStroke(c)}if(r){const c=r(l);c&&(h=!1),a.setText(c)}if(s){const c=s(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function is(i,e,t){let n;if(e+"fill-pattern-src"in i)n=I0(i,e+"fill-",t);else{if(i[e+"fill-color"]==="none")return s=>null;n=Xh(i,e+"fill-color",t)}if(!n)return null;const r=new jh;return function(s){const o=n(s);return o===Mh?null:(r.setColor(o),r)}}function ns(i,e,t){const n=Gt(i,e+"stroke-width",t),r=Xh(i,e+"stroke-color",t);if(!n&&!r)return null;const s=Ai(i,e+"stroke-line-cap",t),o=Ai(i,e+"stroke-line-join",t),a=ld(i,e+"stroke-line-dash",t),l=Gt(i,e+"stroke-line-dash-offset",t),h=Gt(i,e+"stroke-miter-limit",t),c=new nd;return function(u){if(r){const f=r(u);if(f===Mh)return null;c.setColor(f)}if(n&&c.setWidth(n(u)),s){const f=s(u);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(f)}if(o){const f=o(u);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(f)}return a&&c.setLineDash(a(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function E0(i,e){const t="text-",n=Ai(i,t+"value",e);if(!n)return null;const r=is(i,t,e),s=is(i,t+"background-",e),o=ns(i,t,e),a=ns(i,t+"background-",e),l=Ai(i,t+"font",e),h=Gt(i,t+"max-angle",e),c=Gt(i,t+"offset-x",e),u=Gt(i,t+"offset-y",e),f=cr(i,t+"overflow",e),d=Ai(i,t+"placement",e),g=Gt(i,t+"repeat",e),y=To(i,t+"scale",e),w=cr(i,t+"rotate-with-view",e),E=Gt(i,t+"rotation",e),b=Ai(i,t+"align",e),v=Ai(i,t+"justify",e),S=Ai(i,t+"baseline",e),x=cr(i,t+"keep-upright",e),T=ld(i,t+"padding",e),I=Ro(i,t+"declutter-mode"),A=new Km({declutterMode:I});return function(O){if(A.setText(n(O)),r&&A.setFill(r(O)),s&&A.setBackgroundFill(s(O)),o&&A.setStroke(o(O)),a&&A.setBackgroundStroke(a(O)),l&&A.setFont(l(O)),h&&A.setMaxAngle(h(O)),c&&A.setOffsetX(c(O)),u&&A.setOffsetY(u(O)),f&&A.setOverflow(f(O)),d){const j=d(O);if(j!=="point"&&j!=="line")throw new Error("Expected point or line for text-placement");A.setPlacement(j)}if(g&&A.setRepeat(g(O)),y&&A.setScale(y(O)),w&&A.setRotateWithView(w(O)),E&&A.setRotation(E(O)),b){const j=b(O);if(j!=="left"&&j!=="center"&&j!=="right"&&j!=="end"&&j!=="start")throw new Error("Expected left, right, center, start, or end for text-align");A.setTextAlign(j)}if(v){const j=v(O);if(j!=="left"&&j!=="right"&&j!=="center")throw new Error("Expected left, right, or center for text-justify");A.setJustify(j)}if(S){const j=S(O);if(j!=="bottom"&&j!=="top"&&j!=="middle"&&j!=="alphabetic"&&j!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");A.setTextBaseline(j)}return T&&A.setPadding(T(O)),x&&A.setKeepUpright(x(O)),A}}function S0(i,e){return"icon-src"in i?x0(i,e):"shape-points"in i?T0(i,e):"circle-radius"in i?R0(i,e):null}function x0(i,e){const t="icon-",n=t+"src",r=hd(i[n],n),s=Hs(i,t+"anchor",e),o=To(i,t+"scale",e),a=Gt(i,t+"opacity",e),l=Hs(i,t+"displacement",e),h=Gt(i,t+"rotation",e),c=cr(i,t+"rotate-with-view",e),u=Qc(i,t+"anchor-origin"),f=eu(i,t+"anchor-x-units"),d=eu(i,t+"anchor-y-units"),g=P0(i,t+"color"),y=A0(i,t+"cross-origin"),w=M0(i,t+"offset"),E=Qc(i,t+"offset-origin"),b=qs(i,t+"width"),v=qs(i,t+"height"),S=C0(i,t+"size"),x=Ro(i,t+"declutter-mode"),T=new xo({src:r,anchorOrigin:u,anchorXUnits:f,anchorYUnits:d,color:g,crossOrigin:y,offset:w,offsetOrigin:E,height:v,width:b,size:S,declutterMode:x});return function(I){return a&&T.setOpacity(a(I)),l&&T.setDisplacement(l(I)),h&&T.setRotation(h(I)),c&&T.setRotateWithView(c(I)),o&&T.setScale(o(I)),s&&T.setAnchor(s(I)),T}}function T0(i,e){const t="shape-",n=t+"points",r=t+"radius",s=Ia(i[n],n),o=Ia(i[r],r),a=is(i,t,e),l=ns(i,t,e),h=To(i,t+"scale",e),c=Hs(i,t+"displacement",e),u=Gt(i,t+"rotation",e),f=cr(i,t+"rotate-with-view",e),d=qs(i,t+"radius2"),g=qs(i,t+"angle"),y=Ro(i,t+"declutter-mode"),w=new td({points:s,radius:o,radius2:d,angle:g,declutterMode:y});return function(E){return a&&w.setFill(a(E)),l&&w.setStroke(l(E)),c&&w.setDisplacement(c(E)),u&&w.setRotation(u(E)),f&&w.setRotateWithView(f(E)),h&&w.setScale(h(E)),w}}function R0(i,e){const t="circle-",n=is(i,t,e),r=ns(i,t,e),s=Gt(i,t+"radius",e),o=To(i,t+"scale",e),a=Hs(i,t+"displacement",e),l=Gt(i,t+"rotation",e),h=cr(i,t+"rotate-with-view",e),c=Ro(i,t+"declutter-mode"),u=new id({radius:5,declutterMode:c});return function(f){return s&&u.setRadius(s(f)),n&&u.setFill(n(f)),r&&u.setStroke(r(f)),a&&u.setDisplacement(a(f)),l&&u.setRotation(l(f)),h&&u.setRotateWithView(h(f)),o&&u.setScale(o(f)),u}}function Gt(i,e,t){if(!(e in i))return;const n=Gi(i[e],Be,t);return function(r){return Ia(n(r),e)}}function Ai(i,e,t){if(!(e in i))return null;const n=Gi(i[e],jt,t);return function(r){return hd(n(r),e)}}function I0(i,e,t){const n=Ai(i,e+"pattern-src",t),r=Jc(i,e+"pattern-offset",t),s=Jc(i,e+"pattern-size",t),o=Xh(i,e+"color",t);return function(a){return{src:n(a),offset:r&&r(a),size:s&&s(a),color:o&&o(a)}}}function cr(i,e,t){if(!(e in i))return null;const n=Gi(i[e],Ft,t);return function(r){const s=n(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${e}`);return s}}function Xh(i,e,t){if(!(e in i))return null;const n=Gi(i[e],oi,t);return function(r){return cd(n(r),e)}}function ld(i,e,t){if(!(e in i))return null;const n=Gi(i[e],kn,t);return function(r){return ls(n(r),e)}}function Hs(i,e,t){if(!(e in i))return null;const n=Gi(i[e],kn,t);return function(r){const s=ls(n(r),e);if(s.length!==2)throw new Error(`Expected two numbers for ${e}`);return s}}function Jc(i,e,t){if(!(e in i))return null;const n=Gi(i[e],kn,t);return function(r){return ud(n(r),e)}}function To(i,e,t){if(!(e in i))return null;const n=Gi(i[e],kn|Be,t);return function(r){return L0(n(r),e)}}function qs(i,e){const t=i[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function C0(i,e){const t=i[e];if(t!==void 0){if(typeof t=="number")return zt(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function A0(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function Qc(i,e){const t=i[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function eu(i,e){const t=i[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function M0(i,e){const t=i[e];if(t!==void 0)return ls(t,e)}function Ro(i,e){const t=i[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function P0(i,e){const t=i[e];if(t!==void 0)return cd(t,e)}function ls(i,e){if(!Array.isArray(i))throw new Error(`Expected an array for ${e}`);const t=i.length;for(let n=0;n<t;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${e}`);return i}function hd(i,e){if(typeof i!="string")throw new Error(`Expected a string for ${e}`);return i}function Ia(i,e){if(typeof i!="number")throw new Error(`Expected a number for ${e}`);return i}function cd(i,e){if(typeof i=="string")return i;const t=ls(i,e),n=t.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function ud(i,e){const t=ls(i,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function L0(i,e){return typeof i=="number"?i:ud(i,e)}const tu={RENDER_ORDER:"renderOrder"};class O0 extends bo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(tu.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const n=this.getDeclutter();n in e.declutter||(e.declutter[n]=new zf(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(tu.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?rd:e;const t=k0(e);this.styleFunction_=e===null?void 0:$m(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}}function k0(i){if(i===void 0)return rd;if(!i)return null;if(typeof i=="function"||i instanceof hr)return i;if(!Array.isArray(i))return Zc([i]);if(i.length===0)return[];const e=i.length,t=i[0];if(t instanceof hr){const r=new Array(e);for(let s=0;s<e;++s){const o=i[s];if(!(o instanceof hr))throw new Error("Expected a list of style instances");r[s]=o}return r}if("style"in t){const r=new Array(e);for(let s=0;s<e;++s){const o=i[s];if(!("style"in o))throw new Error("Expected a list of rules with a style property");r[s]=o}return b0(r)}return Zc(i)}const fd=O0;class D0 extends ao{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){We()}calculateMatrices2D(e){const t=e.viewState,n=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;Ni(n,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Lf(r,n)}forEachFeatureAtCoordinate(e,t,n,r,s,o,a,l){let h;const c=t.viewState;function u(S,x,T,I){return s.call(o,x,S?T:null,I)}const f=c.projection,d=Ef(e.slice(),f),g=[[0,0]];if(f.canWrapX()&&r){const S=f.getExtent(),x=Ue(S);g.push([-x,0],[x,0])}const y=t.layerStatesArray,w=y.length,E=[],b=[];for(let S=0;S<g.length;S++)for(let x=w-1;x>=0;--x){const T=y[x],I=T.layer;if(I.hasRenderer()&&Ch(T,c)&&a.call(l,I)){const A=I.getRenderer(),O=I.getSource();if(A&&O){const j=O.getWrapX()?d:e,K=u.bind(null,T.managed);b[0]=j[0]+g[S][0],b[1]=j[1]+g[S][1],h=A.forEachFeatureAtCoordinate(b,t,n,K,E)}if(h)return h}}if(E.length===0)return;const v=1/E.length;return E.forEach((S,x)=>S.distanceSq+=x*v),E.sort((S,x)=>S.distanceSq-x.distanceSq),E.some(S=>h=S.callback(S.feature,S.layer,S.geometry)),h}hasFeatureAtCoordinate(e,t,n,r,s,o){return this.forEachFeatureAtCoordinate(e,t,n,r,Xr,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(e){We()}scheduleExpireIconCache(e){Qt.canExpireCache()&&e.postRenderFunctions.push(F0)}}function F0(i,e){Qt.expire()}const N0=D0;class B0 extends Wi{constructor(e,t,n,r){super(e),this.inversePixelTransform=t,this.frameState=n,this.context=r}}const dd=B0;class U0 extends N0{constructor(e){super(e),this.fontChangeListenerKey_=je(xi,fr.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Eo+" ol-layers";const n=e.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const n=this.getMap();if(n.hasListener(e)){const r=new dd(e,void 0,t);n.dispatchEvent(r)}}disposeInternal(){it(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(Jt.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);t.some(a=>a.layer instanceof fd&&a.layer.getDeclutter())&&(e.declutter={});const r=e.viewState;this.children_.length=0;const s=[];let o=null;for(let a=0,l=t.length;a<l;++a){const h=t[a];e.layerIndex=a;const c=h.layer,u=c.getSourceState();if(!Ch(h,r)||u!="ready"&&u!="undefined"){c.unrender();continue}const f=c.render(e,o);f&&(f!==o&&(this.children_.push(f),o=f),s.push(h))}this.declutter(e,s),Om(this.element_,this.children_),this.dispatchRenderEvent(Jt.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let n=t.length-1;n>=0;--n){const r=t[n],s=r.layer;s.getDeclutter()&&s.renderDeclutter(e,r)}t.forEach(n=>n.layer.renderDeferred(e))}}}const j0=U0;class rn extends Wi{constructor(e,t){super(e),this.layer=t}}const Ko={LAYERS:"layers"};class $h extends df{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let n=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Ko.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new gi(n.slice(),{unique:!0}):Ge(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new gi(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(it),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(je(e,Bt.ADD,this.handleLayersAdd_,this),je(e,Bt.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(it);os(this.listenerKeys_);const t=e.getArray();for(let n=0,r=t.length;n<r;n++){const s=t[n];this.registerLayerListeners_(s),this.dispatchEvent(new rn("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[je(e,fr.PROPERTYCHANGE,this.handleLayerChange_,this),je(e,ke.CHANGE,this.handleLayerChange_,this)];e instanceof $h&&t.push(je(e,"addlayer",this.handleLayerGroupAdd_,this),je(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Xe(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new rn("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new rn("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new rn("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,n=Xe(t);this.listenerKeys_[n].forEach(it),delete this.listenerKeys_[n],this.dispatchEvent(new rn("removelayer",t)),this.changed()}getLayers(){return this.get(Ko.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const n=t.getArray();for(let r=0,s=n.length;r<s;++r)this.dispatchEvent(new rn("removelayer",n[r]))}this.set(Ko.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],n=t.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let o=n,a=t.length;o<a;o++){const l=t[o];l.opacity*=r.opacity,l.visible=l.visible&&r.visible,l.maxResolution=Math.min(l.maxResolution,r.maxResolution),l.minResolution=Math.max(l.minResolution,r.minResolution),l.minZoom=Math.max(l.minZoom,r.minZoom),l.maxZoom=Math.min(l.maxZoom,r.maxZoom),r.extent!==void 0&&(l.extent!==void 0?l.extent=ai(l.extent,r.extent):l.extent=r.extent),l.zIndex===void 0&&(l.zIndex=s)}return t}getSourceState(){return"ready"}}const Io=$h;class W0 extends Wi{constructor(e,t,n){super(e),this.map=t,this.frameState=n!==void 0?n:null}}const Jn=W0;class G0 extends Jn{constructor(e,t,n,r,s,o){super(e,t,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Zi=G0,dt={SINGLECLICK:"singleclick",CLICK:ke.CLICK,DBLCLICK:ke.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Ca={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class z0 extends ho{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=je(n,Ca.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=je(n,Ca.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ke.TOUCHMOVE,this.boundHandleTouchMove_,Hf?{passive:!1}:!1)}emulateClick_(e){let t=new Zi(dt.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Zi(dt.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Zi(dt.SINGLECLICK,this.map_,e);this.dispatchEvent(n)},250)}updateActivePointers_(e){const t=e,n=t.pointerId;if(t.type==dt.POINTERUP||t.type==dt.POINTERCANCEL){delete this.trackedTouches_[n];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==dt.POINTERDOWN||t.type==dt.POINTERMOVE)&&(this.trackedTouches_[n]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Zi(dt.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(it),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Zi(dt.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(je(n,dt.POINTERMOVE,this.handlePointerMove_,this),je(n,dt.POINTERUP,this.handlePointerUp_,this),je(this.element_,dt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(je(this.element_.getRootNode(),dt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Zi(dt.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Zi(dt.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(it(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ke.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(it(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(it),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Y0=z0,Ji={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},kt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Zs=1/0;class X0{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,os(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,n=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(n);return delete this.queuedElements_[r],n}enqueue(e){Ge(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=Zs?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,n=this.priorities_,r=t.length,s=t[e],o=n[e],a=e;for(;e<r>>1;){const l=this.getLeftChildIndex_(e),h=this.getRightChildIndex_(e),c=h<r&&n[h]<n[l]?h:l;t[e]=t[c],n[e]=n[c],e=c}t[e]=s,n[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const n=this.elements_,r=this.priorities_,s=n[t],o=r[t];for(;t>e;){const a=this.getParentIndex_(t);if(r[a]>o)n[t]=n[a],r[t]=r[a],t=a;else break}n[t]=s,r[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,n=this.priorities_;let r=0;const s=t.length;let o,a,l;for(a=0;a<s;++a)o=t[a],l=e(o),l==Zs?delete this.queuedElements_[this.keyFunction_(o)]:(n[r]=l,t[r++]=o);t.length=r,n.length=r,this.heapify_()}}const $0=X0,Te={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class V0 extends $0{constructor(e,t){super(function(n){return e.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(ke.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,n=t.getState();if(n===Te.LOADED||n===Te.ERROR||n===Te.EMPTY){n!==Te.ERROR&&t.removeEventListener(ke.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let n=0;for(;this.tilesLoading_<e&&n<t&&this.getCount()>0;){const r=this.dequeue()[0],s=r.getKey();r.getState()===Te.IDLE&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++n,r.load())}}}const K0=V0;function H0(i,e,t,n,r){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][e.getKey()])return Zs;const s=i.viewState.center,o=n[0]-s[0],a=n[1]-s[1];return 65536*Math.log(r)+Math.sqrt(o*o+a*a)/r}class q0 extends yi{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){var e;(e=this.element)==null||e.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){var t;this.map_&&((t=this.element)==null||t.remove());for(let n=0,r=this.listenerKeys.length;n<r;++n)it(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=e,e){const n=this.target_??e.getOverlayContainerStopEvent();this.element&&n.appendChild(this.element),this.render!==dr&&this.listenerKeys.push(je(e,Ji.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}const Vh=q0;class Z0 extends Vh{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",n=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=r):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(ke.CLICK,this.handleClick_.bind(this),!1);const h=t+" "+Eo+" "+Fh+(this.collapsed_&&this.collapsible_?" "+zc:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),n=new Set(t.flatMap(r=>r.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(r=>n.add(r)):n.add(this.attributions_)),!this.overrideCollapsible_){const r=!t.some(s=>{var o;return((o=s.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(r)}return Array.from(n)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(r=>Np(()=>r))),n=t.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!un(t,this.renderedAttributions_)){Lm(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const o=document.createElement("li");o.innerHTML=t[r],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(zc),this.collapsed_?Wc(this.collapseLabel_,this.label_):Wc(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}const J0=Z0;class Q0 extends Vh{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",n=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(ke.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+Eo+" "+Fh,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(vs)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const n=t.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:vr}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const n=t.viewState.rotation;if(n!=this.rotation_){const r="rotate("+n+"rad)";if(this.autoHide_){const s=this.element.classList.contains(vs);!s&&n===0?this.element.classList.add(vs):s&&n!==0&&this.element.classList.remove(vs)}this.label_.style.transform=r}this.rotation_=n}}const ey=Q0;class ty extends Vh{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",n=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",h=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=r,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(ke.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=s,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof a=="string"?document.createTextNode(a):a),u.addEventListener(ke.CLICK,this.handleClick_.bind(this,-n),!1);const f=t+" "+Eo+" "+Fh,d=this.element;d.className=f,d.appendChild(c),d.appendChild(u),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const n=this.getMap().getView();if(!n)return;const r=n.getZoom();if(r!==void 0){const s=n.getConstrainedZoom(r+e);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:vr})):n.setZoom(s)}}}const iy=ty;function ny(i){i=i||{};const e=new gi;return(i.zoom!==void 0?i.zoom:!0)&&e.push(new iy(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&e.push(new ey(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&e.push(new J0(i.attributionOptions)),e}const iu={ACTIVE:"active"};class ry extends yi{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(iu.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(iu.ACTIVE,e)}setMap(e){this.map_=e}}function sy(i,e,t){const n=i.getCenterInternal();if(n){const r=[n[0]+e[0],n[1]+e[1]];i.animateInternal({duration:t!==void 0?t:250,easing:j_,center:i.getConstrainedCenter(r)})}}function Kh(i,e,t,n){const r=i.getZoom();if(r===void 0)return;const s=i.getConstrainedZoom(r+e),o=i.getResolutionForZoom(s);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:o,anchor:t,duration:n!==void 0?n:250,easing:vr})}const hs=ry;class oy extends hs{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==dt.DBLCLICK){const n=e.originalEvent,r=e.map,s=e.coordinate,o=n.shiftKey?-this.delta_:this.delta_,a=r.getView();Kh(a,o,s,this.duration_),n.preventDefault(),t=!0}return!t}}const ay=oy;class ly extends hs{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==dt.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==dt.POINTERUP){const n=this.handleUpEvent(e);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(e.type==dt.POINTERDOWN){const n=this.handleDownEvent(e);this.handlingDownUpSequence=n,t=this.stopDown(n)}else e.type==dt.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Hh(i){const e=i.length;let t=0,n=0;for(let r=0;r<e;r++)t+=i[r].clientX,n+=i[r].clientY;return{clientX:t/e,clientY:n/e}}const cs=ly;function Aa(i){const e=arguments;return function(t){let n=!0;for(let r=0,s=e.length;r<s&&(n=n&&e[r](t),!!n);++r);return n}}const hy=function(i){const e=i.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},cy=function(i){const e=i.map.getTargetElement(),t=e.getRootNode(),n=i.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(n):e.contains(n)},gd=function(i){const e=i.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?cy(i):!0},uy=Xr,pd=function(i){const e=i.originalEvent;return e.button==0&&!(Pm&&$f&&e.ctrlKey)},_d=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},fy=function(i){const e=i.originalEvent;return $f?e.metaKey:e.ctrlKey},dy=function(i){const e=i.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},md=function(i){const e=i.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},Ho=function(i){const e=i.originalEvent;return Ge(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},gy=function(i){const e=i.originalEvent;return Ge(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0};class py extends cs{constructor(e){super({stopDown:lo}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:Aa(_d,gy);this.condition_=e.onFocusOnly?Aa(gd,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const n=this.targetPointers,r=t.getEventPixel(Hh(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],a=e.map.getView();l_(s,a.getResolution()),uh(s,a.getRotation()),a.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,n=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=n.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-r*Math.cos(s),a[1]-r*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:vr})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const n=e.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const _y=py;class my extends cs{constructor(e){e=e||{},super({stopDown:lo}),this.condition_=e.condition?e.condition:hy,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!Ho(e))return;const t=e.map,n=t.getView();if(n.getConstraints().rotation===vh)return;const r=t.getSize(),s=e.pixel,o=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;n.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return Ho(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return Ho(e)&&pd(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}const yy=my;class wy extends ao{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,n="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+n,r.top=Math.min(e[1],t[1])+n,r.width=Math.abs(t[0]-e[0])+n,r.height=Math.abs(t[1]-e[1])+n}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new qr([r])}getGeometry(){return this.geometry_}}const by=wy,zn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Cr extends Wi{constructor(e,t,n){super(e),this.coordinate=t,this.mapBrowserEvent=n}}class vy extends cs{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new by(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??pd,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,n){const r=n[0]-t[0],s=n[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new Cr(zn.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new Cr(t?zn.BOXEND:zn.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Cr(zn.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Cr(zn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Cr(zn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}const Ey=vy;class Sy extends Ey{constructor(e){e=e||{};const t=e.condition?e.condition:dy;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const n=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=n.rotatedExtentForGeometry(r),o=n.getResolutionForExtentInternal(s),a=n.getResolution()/o;r=r.clone(),r.scale(a*a)}n.fitInternal(r,{duration:this.duration_,easing:vr})}}const xy=Sy,gn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Ty extends hs{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return _d(t)&&md(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==ke.KEYDOWN){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==gn.DOWN||r==gn.LEFT||r==gn.RIGHT||r==gn.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;r==gn.DOWN?h=-a:r==gn.LEFT?l=-a:r==gn.RIGHT?l=a:h=a;const c=[l,h];uh(c,o.getRotation()),sy(o,c,this.duration_),n.preventDefault(),t=!0}}return!t}}const Ry=Ty;class Iy extends hs{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!fy(t)&&md(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==ke.KEYDOWN||e.type==ke.KEYPRESS){const n=e.originalEvent,r=n.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,o=r==="+"?this.delta_:-this.delta_,a=s.getView();Kh(a,o,void 0,this.duration_),n.preventDefault(),t=!0}}return!t}}const Cy=Iy;class Ay{constructor(e,t,n){this.decay_=e,this.minVelocity_=t,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let n=t-3;for(;n>0&&this.points_[n+2]>e;)n-=3;const r=this.points_[t+2]-this.points_[n+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[n],o=this.points_[t+1]-this.points_[n+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const My=Ay;class Py extends hs{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:uy;this.condition_=e.onFocusOnly?Aa(gd,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==ke.WHEEL)return!0;const n=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let s;if(e.type==ke.WHEEL&&(s=r.deltaY,Am&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Vf),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=n.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let n=-gt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Kh(t,n,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}const Ly=Py;class Oy extends cs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=lo),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const n=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-n.clientY,r.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=s;const o=e.map,a=o.getView();a.getConstraints().rotation!==vh&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Hh(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const ky=Oy;class Dy extends cs{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=lo),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const n=this.targetPointers[0],r=this.targetPointers[1],s=n.clientX-r.clientX,o=n.clientY-r.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,h=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Hh(this.targetPointers))),l.render(),h.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const n=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const Fy=Dy;function Ny(i){i=i||{};const e=new gi,t=new My(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&e.push(new yy),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&e.push(new ay({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&e.push(new _y({onFocusOnly:i.onFocusOnly,kinetic:t})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&e.push(new ky),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&e.push(new Fy({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(e.push(new Ry),e.push(new Cy({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&e.push(new Ly({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&e.push(new xy({duration:i.zoomDuration})),e}function yd(i){if(i instanceof bo){i.setMapInternal(null);return}i instanceof Io&&i.getLayers().forEach(yd)}function wd(i,e){if(i instanceof bo){i.setMapInternal(e);return}if(i instanceof Io){const t=i.getLayers().getArray();for(let n=0,r=t.length;n<r;++n)wd(t[n],e)}}let By=class extends yi{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Uy(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Vf,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=li(),this.pixelToCoordinateTransform_=li(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||ny(),this.interactions=t.interactions||Ny({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new K0(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(kt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(kt.VIEW,this.handleViewChanged_),this.addChangeListener(kt.SIZE,this.handleSizeChanged_),this.addChangeListener(kt.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const n=this;e.view&&!(e.view instanceof fi)&&e.view.then(function(r){n.setView(new fi(r))}),this.controls.addEventListener(Bt.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Bt.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Bt.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Bt.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Bt.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Bt.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){wd(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,n){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};const s=n.hitTolerance!==void 0?n.hitTolerance:0,o=n.layerFilter!==void 0?n.layerFilter:Xr,a=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,a,t,null,o,null)}getFeaturesAtPixel(e,t){const n=[];return this.forEachFeatureAtPixel(e,function(r){n.push(r)},t),n}getAllLayers(){const e=[];function t(n){n.forEach(function(r){r instanceof Io?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:Xr,s=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,o,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const n=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=n.width/r[0],o=n.height/r[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-n.left)/s,(a.clientY-n.top)/o]}getTarget(){return this.get(kt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Sa(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Tt(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(kt.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof gi){t.setLayers(e);return}const n=t.getLayers();n.clear(),n.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const r=e[t];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const o=r.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=Si(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Tt(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(kt.SIZE)}getView(){return this.get(kt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,n,r){return H0(this.frameState_,e,t,n,r)}handleBrowserEvent(e,t){t=t||e.type;const n=new Zi(t,this,e);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,n=t.type;if(n===Ca.POINTERDOWN||n===ke.WHEEL||n===ke.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,o=t.target,a=s instanceof ShadowRoot?s.host===o?s.host.ownerDocument:s:s===r?r.documentElement:s;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,s=r;if(e){const o=e.viewHints;if(o[Dt.ANIMATING]||o[Dt.INTERACTING]){const a=Date.now()-e.time>8;r=a?0:8,s=a?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(Jt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Jt.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Jn(Ji.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Jn(Ji.LOADSTART,this,e))));const n=this.postRenderFunctions_;if(e)for(let r=0,s=n.length;r<s;++r)n[r](this,e);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,r=this.targetChangeHandlerKeys_.length;n<r;++n)it(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ke.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ke.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new j0(this)),this.mapBrowserEventHandler_=new Y0(this,this.moveTolerance_);for(const s in dt)this.mapBrowserEventHandler_.addEventListener(dt[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ke.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ke.WHEEL,this.boundHandleBrowserEvent_,Hf?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{const s=t.getRootNode();n=s instanceof ShadowRoot?s.host:t}this.targetChangeHandlerKeys_=[je(n,ke.KEYDOWN,this.handleBrowserEvent,this),je(n,ke.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(it(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(it(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=je(e,fr.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=je(e,ke.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(it),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new rn("addlayer",e)),this.layerGroupPropertyListenerKeys_=[je(e,fr.PROPERTYCHANGE,this.render,this),je(e,ke.CHANGE,this.render,this),je(e,"addlayer",this.handleLayerAdd_,this),je(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,n=e.length;t<n;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){yd(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),n=this.getView(),r=this.frameState_;let s=null;if(t!==void 0&&Gc(t)&&n&&n.isDef()){const o=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:ba(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Xe(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=ba(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!_o(this.previousExtent_)&&!Kr(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Jn(Ji.MOVESTART,this,r)),this.previousExtent_=uo(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Dt.ANIMATING]&&!s.viewHints[Dt.INTERACTING]&&!Kr(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Jn(Ji.MOVEEND,this,s)),gf(s.extent,this.previousExtent_))),this.dispatchEvent(new Jn(Ji.POSTRENDER,this,s)),this.renderComplete_=(this.hasListener(Ji.LOADSTART)||this.hasListener(Ji.LOADEND)||this.hasListener(Jt.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new rn("removelayer",t)),this.set(kt.LAYERGROUP,e)}setSize(e){this.set(kt.SIZE,e)}setTarget(e){this.set(kt.TARGET,e)}setView(e){if(!e||e instanceof fi){this.set(kt.VIEW,e);return}this.set(kt.VIEW,new fi);const t=this;e.then(function(n){t.setView(new fi(n))})}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),s=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),o=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(o)&&(t=[Math.max(0,s),Math.max(0,o)],!Gc(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Af("No map visible because the map container's width or height are 0."))}const n=this.getSize();t&&(!n||!un(t,n))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function Uy(i){let e=null;i.keyboardEventTarget!==void 0&&(e=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const t={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Io({layers:i.layers});t[kt.LAYERGROUP]=n,t[kt.TARGET]=i.target,t[kt.VIEW]=i.view instanceof fi?i.view:new fi;let r;i.controls!==void 0&&(Array.isArray(i.controls)?r=new gi(i.controls.slice()):(Ge(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=i.controls));let s;i.interactions!==void 0&&(Array.isArray(i.interactions)?s=new gi(i.interactions.slice()):(Ge(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=i.interactions));let o;return i.overlays!==void 0?Array.isArray(i.overlays)?o=new gi(i.overlays.slice()):(Ge(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=i.overlays):o=new gi,{controls:r,interactions:s,keyboardEventTarget:e,overlays:o,values:t}}const jy=By,Ss={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Wy extends bo{constructor(e){e=e||{};const t=Object.assign({},e),n=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Ss.PRELOAD)}setPreload(e){this.set(Ss.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(Ss.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(Ss.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}const Gy=Wy,zy=5;class Yy extends ff{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=zy}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return We()}getData(e){return null}prepareFrame(e){return We()}renderFrame(e,t){return We()}forEachFeatureAtCoordinate(e,t,n,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===Ne.LOADED||t.getState()===Ne.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=Ne.LOADED&&t!=Ne.ERROR&&e.addEventListener(ke.CHANGE,this.boundHandleImageChange_),t==Ne.IDLE&&(e.load(),t=e.getState()),t==Ne.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Xy=Yy;class $y{constructor(){at(this,"pushMethodArgs_",(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy($s(),{get:(e,t)=>{if(typeof $s()[t]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,n),!0)})}pushFunction(e){this.instructions_[this.zIndex+this.offset_].push(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let n=0,r=t.length;n<r;++n){const s=t[n];if(typeof s=="function"){s(e);continue}const o=t[++n];if(typeof e[s]=="function")e[s](...o);else{if(typeof o=="function"){e[s]=o(e);continue}e[s]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const bd=$y,nu=[];let Qn=null;function Vy(){Qn=_t(1,1,void 0,{willReadFrequently:!0})}class Ky extends Xy{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=li(),this.pixelTransform=li(),this.inversePixelTransform=li(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,n){Qn||Vy(),Qn.clearRect(0,0,1,1);let r;try{Qn.drawImage(e,t,n,1,1,0,0,1,1),r=Qn.getImageData(0,0,1,1).data}catch{return Qn=null,null}return r}getBackground(e){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(e.viewState.resolution)),n||void 0}useContainer(e,t,n){const r=this.getLayer().getClassName();let s,o;if(e&&e.className===r&&(!n||e&&e.style.backgroundColor&&un(mr(e.style.backgroundColor),mr(n)))){const a=e.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===t?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=_t();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(e,t,n){const r=Fi(n),s=po(n),o=go(n),a=fo(n);Tt(t.coordinateToPixelTransform,r),Tt(t.coordinateToPixelTransform,s),Tt(t.coordinateToPixelTransform,o),Tt(t.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Tt(l,r),Tt(l,s),Tt(l,o),Tt(l,a),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const n=e.extent,r=e.viewState.resolution,s=e.viewState.rotation,o=e.pixelRatio,a=Math.round(Ue(n)/r*o),l=Math.round(wt(n)/r*o);Ni(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,s,-a/2,-l/2),Lf(this.inversePixelTransform,this.pixelTransform);const h=z_(this.pixelTransform);if(this.useContainer(t,h,this.getBackground(e)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(e,t,n){const r=this.getLayer();if(r.hasListener(e)){const s=new dd(e,this.inversePixelTransform,n,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(Jt.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(Jt.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new bd),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(Jt.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(Jt.POSTRENDER,this.context,e))}getRenderTransform(e,t,n,r,s,o,a){const l=s/2,h=o/2,c=r/t,u=-c,f=-e[0]+a,d=-e[1];return Ni(this.tempTransform,l,h,c,u,-n,f,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}}const vd=Ky;class Hy extends ho{constructor(e,t,n){super(),n=n||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(ke.CHANGE)}release(){this.state===Te.ERROR&&this.setState(Te.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Te.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){We()}getAlpha(e,t){if(!this.transition_)return 1;let n=this.transitionStarts_[e];if(!n)n=t,this.transitionStarts_[e]=n;else if(n===-1)return 1;const r=t-n+1e3/60;return r>=this.transition_?1:Pf(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}const qh=Hy;function Js(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function qy(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const Zy=new Error("disposed");let Yn=null;function Jy(i){Yn||(Yn=_t(i.width,i.height,void 0,{willReadFrequently:!0}));const e=Yn.canvas,t=i.width;e.width!==t&&(e.width=t);const n=i.height;return e.height!==n&&(e.height=n),Yn.clearRect(0,0,t,n),Yn.drawImage(i,0,0),Yn.getImageData(0,0,t,n).data}const Qy=[256,256];class e1 extends qh{constructor(e){const t=Te.IDLE;super(e.tileCoord,t,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Js(this.data_);return e?[e.width,e.height]:Qy}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==Te.IDLE&&this.state!==Te.ERROR)return;this.state=Te.LOADING,this.changed();const e=this;this.loader_().then(function(t){e.data_=t,e.state=Te.LOADED,e.changed()}).catch(function(t){e.error_=t,e.state=Te.ERROR,e.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Zy),this.controller_=null),super.disposeInternal()}}const Ma=e1;class t1 extends qh{constructor(e,t,n,r,s,o){super(e,t,o),this.crossOrigin_=r,this.src_=n,this.key=n,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Te.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Te.ERROR,this.unlistenImage_(),this.image_=i1(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Te.LOADED:this.state=Te.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Te.ERROR&&(this.state=Te.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Te.IDLE&&(this.state=Te.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=km(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function i1(){const i=_t(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}const Ed=t1;class n1{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof ao&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const n=this.entries_[e];return Ge(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(e){const t=this.entries_[e];return Ge(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.key_;return e}getValues(){const e=new Array(this.count_);let t=0,n;for(n=this.newest_;n;n=n.older)e[t++]=n.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Ge(!(e in this.entries_),"Tried to set a value for a key that is used already");const n={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[e]=n,++this.count_}setSize(e){this.highWaterMark=e}}const r1=n1,Sd=.5,s1=10,ru=.25;class o1{constructor(e,t,n,r,s,o,a){this.sourceProj_=e,this.targetProj_=t;let l={};const h=a?M_(v=>Tt(a,mh(v,this.targetProj_,this.sourceProj_))):zs(this.targetProj_,this.sourceProj_);this.transformInv_=function(v){const S=v[0]+"/"+v[1];return l[S]||(l[S]=h(v)),l[S]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Ue(r)>=Ue(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ue(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ue(this.targetProj_.getExtent()):null;const c=Fi(n),u=po(n),f=go(n),d=fo(n),g=this.transformInv_(c),y=this.transformInv_(u),w=this.transformInv_(f),E=this.transformInv_(d),b=s1+(o?Math.max(0,Math.ceil(Math.log2(Hr(n)/(o*o*256*256)))):0);if(this.addQuad_(c,u,f,d,g,y,w,E,b),this.wrapsXInSource_){let v=1/0;this.triangles_.forEach(function(S,x,T){v=Math.min(v,S.source[0][0],S.source[1][0],S.source[2][0])}),this.triangles_.forEach(S=>{if(Math.max(S.source[0][0],S.source[1][0],S.source[2][0])-v>this.sourceWorldWidth_/2){const x=[[S.source[0][0],S.source[0][1]],[S.source[1][0],S.source[1][1]],[S.source[2][0],S.source[2][1]]];x[0][0]-v>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-v>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-v>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);const T=Math.min(x[0][0],x[1][0],x[2][0]);Math.max(x[0][0],x[1][0],x[2][0])-T<this.sourceWorldWidth_/2&&(S.source=x)}})}l={}}addTriangle_(e,t,n,r,s,o){this.triangles_.push({source:[r,s,o],target:[e,t,n]})}addQuad_(e,t,n,r,s,o,a,l,h){const c=yc([s,o,a,l]),u=this.sourceWorldWidth_?Ue(c)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const w=yc([e,t,n,r]);g=Ue(w)/this.targetWorldWidth_>ru||g}!d&&this.sourceProj_.isGlobal()&&u&&(g=u>ru||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Wt(c,this.maxSourceExtent_))return;let y=0;if(!g&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(y=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),y!=1&&y!=2&&y!=4&&y!=8)return}if(h>0){if(!g){const w=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(w);let b;d?b=(ar(s[0],f)+ar(a[0],f))/2-ar(E[0],f):b=(s[0]+a[0])/2-E[0];const v=(s[1]+a[1])/2-E[1];g=b*b+v*v>this.errorThresholdSquared_}if(g){if(Math.abs(e[0]-n[0])<=Math.abs(e[1]-n[1])){const w=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(w),b=[(r[0]+e[0])/2,(r[1]+e[1])/2],v=this.transformInv_(b);this.addQuad_(e,t,w,b,s,o,E,v,h-1),this.addQuad_(b,w,n,r,v,E,a,l,h-1)}else{const w=[(e[0]+t[0])/2,(e[1]+t[1])/2],E=this.transformInv_(w),b=[(n[0]+r[0])/2,(n[1]+r[1])/2],v=this.transformInv_(b);this.addQuad_(e,w,b,r,s,E,v,l,h-1),this.addQuad_(w,t,n,b,E,o,a,v,h-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}y&11||this.addTriangle_(e,n,r,s,a,l),y&14||this.addTriangle_(e,n,t,s,a,o),y&&(y&13||this.addTriangle_(t,r,e,o,l,s),y&7||this.addTriangle_(t,r,n,o,l,a))}calculateSourceExtent(){const e=Kt();return this.triangles_.forEach(function(t,n,r){const s=t.source;Gr(e,s[0]),Gr(e,s[1]),Gr(e,s[2])}),e}getTriangles(){return this.triangles_}}const xd=o1;let qo;const ur=[];function su(i,e,t,n,r){i.beginPath(),i.moveTo(0,0),i.lineTo(e,t),i.lineTo(n,r),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(e,n)+1,Math.max(t,r)),i.restore()}function Zo(i,e){return Math.abs(i[e*4]-210)>2||Math.abs(i[e*4+3]-.75*255)>2}function a1(){if(qo===void 0){const i=_t(6,6,ur);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",su(i,4,5,4,0),su(i,4,5,0,5);const e=i.getImageData(0,0,3,3).data;qo=Zo(e,0)||Zo(e,4)||Zo(e,8),vo(i),ur.push(i.canvas)}return qo}function ou(i,e,t,n){const r=mh(t,e,i);let s=xc(e,n,t);const o=e.getMetersPerUnit();o!==void 0&&(s*=o);const a=i.getMetersPerUnit();a!==void 0&&(s/=a);const l=i.getExtent();if(!l||pr(l,r)){const h=xc(i,s,r)/s;isFinite(h)&&h>0&&(s/=h)}return s}function Td(i,e,t,n){const r=On(t);let s=ou(i,e,r,n);return(!isFinite(s)||s<=0)&&bf(t,function(o){return s=ou(i,e,o,n),isFinite(s)&&s>0}),s}function l1(i,e,t,n,r,s,o,a,l,h,c,u,f,d){const g=_t(Math.round(t*i),Math.round(t*e),ur);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(t,t);function y(x){return Math.round(x*t)/t}g.globalCompositeOperation="lighter";const w=Kt();l.forEach(function(x,T,I){yf(w,x.extent)});let E;const b=t/n,v=(u?1:1+Math.pow(2,-24))/b;if(!f||l.length!==1||h!==0){if(E=_t(Math.round(Ue(w)*b),Math.round(wt(w)*b),ur),u||(E.imageSmoothingEnabled=!1),r&&d){const x=(r[0]-w[0])*b,T=-(r[3]-w[3])*b,I=Ue(r)*b,A=wt(r)*b;E.rect(x,T,I,A),E.clip()}l.forEach(function(x,T,I){if(x.image.width>0&&x.image.height>0){if(x.clipExtent){E.save();const R=(x.clipExtent[0]-w[0])*b,U=-(x.clipExtent[3]-w[3])*b,V=Ue(x.clipExtent)*b,G=wt(x.clipExtent)*b;E.rect(u?R:Math.round(R),u?U:Math.round(U),u?V:Math.round(R+V)-Math.round(R),u?G:Math.round(U+G)-Math.round(U)),E.clip()}const A=(x.extent[0]-w[0])*b,O=-(x.extent[3]-w[3])*b,j=Ue(x.extent)*b,K=wt(x.extent)*b;E.drawImage(x.image,h,h,x.image.width-2*h,x.image.height-2*h,u?A:Math.round(A),u?O:Math.round(O),u?j:Math.round(A+j)-Math.round(A),u?K:Math.round(O+K)-Math.round(O)),x.clipExtent&&E.restore()}})}const S=Fi(o);return a.getTriangles().forEach(function(x,T,I){const A=x.source,O=x.target;let j=A[0][0],K=A[0][1],R=A[1][0],U=A[1][1],V=A[2][0],G=A[2][1];const J=y((O[0][0]-S[0])/s),H=y(-(O[0][1]-S[1])/s),W=y((O[1][0]-S[0])/s),se=y(-(O[1][1]-S[1])/s),Z=y((O[2][0]-S[0])/s),ie=y(-(O[2][1]-S[1])/s),M=j,q=K;j=0,K=0,R-=M,U-=q,V-=M,G-=q;const $=[[R,U,0,0,W-J],[V,G,0,0,Z-J],[0,0,R,U,se-H],[0,0,V,G,ie-H]],we=Yp($);if(!we)return;if(g.save(),g.beginPath(),a1()||!u){g.moveTo(W,se);const F=4,L=J-W,Q=H-se;for(let he=0;he<F;he++)g.lineTo(W+y((he+1)*L/F),se+y(he*Q/(F-1))),he!=F-1&&g.lineTo(W+y((he+1)*L/F),se+y((he+1)*Q/(F-1)));g.lineTo(Z,ie)}else g.moveTo(W,se),g.lineTo(J,H),g.lineTo(Z,ie);g.clip(),g.transform(we[0],we[2],we[1],we[3],J,H),g.translate(w[0]-M,w[3]-q);let oe;if(E)oe=E.canvas,g.scale(v,-v);else{const F=l[0],L=F.extent;oe=F.image,g.scale(Ue(L)/oe.width,-wt(L)/oe.height)}g.drawImage(oe,0,0),g.restore()}),E&&(vo(E),ur.push(E.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,a.getTriangles().forEach(function(x,T,I){const A=x.target,O=(A[0][0]-S[0])/s,j=-(A[0][1]-S[1])/s,K=(A[1][0]-S[0])/s,R=-(A[1][1]-S[1])/s,U=(A[2][0]-S[0])/s,V=-(A[2][1]-S[1])/s;g.beginPath(),g.moveTo(K,R),g.lineTo(O,j),g.lineTo(U,V),g.closePath(),g.stroke()}),g.restore()),g.canvas}function Co(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Pa(i,e,t,n,r,s,o){o=o??Co();const a=1/(i-e),l=1/(t-n),h=1/(r-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*h,o[11]=0,o[12]=(i+e)*a,o[13]=(n+t)*l,o[14]=(s+r)*h,o[15]=1,o}function au(i,e,t,n,r){return r=r??Co(),r[0]=i[0]*e,r[1]=i[1]*e,r[2]=i[2]*e,r[3]=i[3]*e,r[4]=i[4]*t,r[5]=i[5]*t,r[6]=i[6]*t,r[7]=i[7]*t,r[8]=i[8]*n,r[9]=i[9]*n,r[10]=i[10]*n,r[11]=i[11]*n,r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],r}function h1(i,e,t,n,r){r=r??Co();let s,o,a,l,h,c,u,f,d,g,y,w;return i===r?(r[12]=i[0]*e+i[4]*t+i[8]*n+i[12],r[13]=i[1]*e+i[5]*t+i[9]*n+i[13],r[14]=i[2]*e+i[6]*t+i[10]*n+i[14],r[15]=i[3]*e+i[7]*t+i[11]*n+i[15]):(s=i[0],o=i[1],a=i[2],l=i[3],h=i[4],c=i[5],u=i[6],f=i[7],d=i[8],g=i[9],y=i[10],w=i[11],r[0]=s,r[1]=o,r[2]=a,r[3]=l,r[4]=h,r[5]=c,r[6]=u,r[7]=f,r[8]=d,r[9]=g,r[10]=y,r[11]=w,r[12]=s*e+h*t+d*n+i[12],r[13]=o*e+c*t+g*n+i[13],r[14]=a*e+u*t+y*n+i[14],r[15]=l*e+f*t+w*n+i[15]),r}function c1(i,e,t,n){return n=n??Co(),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i,n[13]=e,n[14]=t,n[15]=1,n}const u1=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,f1=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class d1{constructor(e){this.gl_=e,this.program_=La(e,f1,u1),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,n,r,s,o,a,l,h,c,u,f,d){const g=this.gl_;l===void 0&&(l=r),h===void 0&&(h=s),o===void 0&&(o=t),a===void 0&&(a=n),c===void 0&&(c=o),u===void 0&&(u=a),f===void 0&&(f=g.canvas.width),d===void 0&&(d=g.canvas.height),g.bindTexture(g.TEXTURE_2D,e),g.useProgram(this.program_),g.bindBuffer(g.ARRAY_BUFFER,this.positionBuffer),g.enableVertexAttribArray(this.positionLocation),g.vertexAttribPointer(this.positionLocation,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this.texcoordBuffer),g.enableVertexAttribArray(this.texcoordLocation),g.vertexAttribPointer(this.texcoordLocation,2,g.FLOAT,!1,0,0);let y=Pa(0,f,0,d,-1,1);y=h1(y,l,h,0),y=au(y,c,u,1),g.uniformMatrix4fv(this.matrixLocation,!1,y);let w=c1(r/t,s/n,0);w=au(w,o/t,a/n,1),g.uniformMatrix4fv(this.textureMatrixLocation,!1,w),g.uniform1i(this.textureLocation,0),g.drawArrays(g.TRIANGLES,0,this.positions.length/2)}}function lu(i,e,t){const n=i.createShader(e);if(n===null)throw new Error("Shader compilation failed");if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){const r=i.getShaderInfoLog(n);throw r===null?new Error("Shader info log creation failed"):new Error(r)}return n}function La(i,e,t){const n=i.createProgram(),r=lu(i,i.VERTEX_SHADER,t),s=lu(i,i.FRAGMENT_SHADER,e);if(n===null)throw new Error("Program creation failed");if(i.attachShader(n,r),i.attachShader(n,s),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS))throw i.getProgramInfoLog(n)===null?new Error("Program info log creation failed"):new Error;return n}const g1=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,p1=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,_1=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,m1=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function y1(i,e,t,n){let r;return t&&t.length?r=t.shift():Oh?r=new OffscreenCanvas(i||300,e||300):r=document.createElement("canvas"),i&&(r.width=i),e&&(r.height=e),r.getContext("webgl",n)}function w1(i){const e=i.canvas;e.width=1,e.height=1,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}const hu=[];function b1(i,e,t,n,r,s,o,a,l,h,c,u,f,d){const g=Math.round(n*e),y=Math.round(n*t);i.canvas.width=g,i.canvas.height=y;let w,E;if(E=i.createTexture(),i.bindTexture(i.TEXTURE_2D,E),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),f?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g,y,0,i.RGBA,c,null),w=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,w),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,E,0),w===null)throw new Error("Could not create framebuffer");if(E===null)throw new Error("Could not create texture");if(l.length===0)return{width:g,height:y,framebuffer:w,texture:E};const b=Kt();l.forEach(function(j,K,R){yf(b,j.extent)});let v,S,x;const T=1/r;if(!d||l.length!==1||h!==0){if(v=i.createTexture(),E===null)throw new Error("Could not create texture");S=Math.round(Ue(b)*T),x=Math.round(wt(b)*T);const j=i.getParameter(i.MAX_TEXTURE_SIZE),K=Math.max(S,x),R=K>j?j/K:1,U=Math.round(S*R),V=Math.round(x*R);i.bindTexture(i.TEXTURE_2D,v),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),f?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,U,V,0,i.RGBA,c,null);const G=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,G),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,v,0);const J=new d1(i);l.forEach(function(H,W,se){const Z=(H.extent[0]-b[0])*T*R,ie=-(H.extent[3]-b[3])*T*R,M=Ue(H.extent)*T*R,q=wt(H.extent)*T*R;if(i.bindFramebuffer(i.FRAMEBUFFER,G),i.viewport(0,0,U,V),H.clipExtent){const $=(H.clipExtent[0]-b[0])*T*R,we=-(H.clipExtent[3]-b[3])*T*R,oe=Ue(H.clipExtent)*T*R,F=wt(H.clipExtent)*T*R;i.enable(i.SCISSOR_TEST),i.scissor(f?$:Math.round($),f?we:Math.round(we),f?oe:Math.round($+oe)-Math.round($),f?F:Math.round(we+F)-Math.round(we))}J.drawImage(H.texture,H.width,H.height,h,h,H.width-2*h,H.height-2*h,f?Z:Math.round(Z),f?ie:Math.round(ie),f?M:Math.round(Z+M)-Math.round(Z),f?q:Math.round(ie+q)-Math.round(ie),U,V),i.disable(i.SCISSOR_TEST)}),i.deleteFramebuffer(G)}else v=l[0].texture,S=l[0].width,x=l[0].width;const I=Fi(o),A=Fi(b),O=j=>{const K=(j[0][0]-I[0])/s*n,R=-(j[0][1]-I[1])/s*n,U=(j[1][0]-I[0])/s*n,V=-(j[1][1]-I[1])/s*n,G=(j[2][0]-I[0])/s*n,J=-(j[2][1]-I[1])/s*n;return{u1:U,v1:V,u0:K,v0:R,u2:G,v2:J}};i.bindFramebuffer(i.FRAMEBUFFER,w),i.viewport(0,0,g,y);{const j=[],K=[],R=La(i,m1,_1);i.useProgram(R);const U=i.getUniformLocation(R,"u_texture");i.bindTexture(i.TEXTURE_2D,v),i.uniform1i(U,0),a.getTriangles().forEach(function(Z,ie,M){const q=Z.source,$=Z.target,{u1:we,v1:oe,u0:F,v0:L,u2:Q,v2:he}=O($),ae=(q[0][0]-A[0])/r/S,re=-(q[0][1]-A[1])/r/x,ue=(q[1][0]-A[0])/r/S,de=-(q[1][1]-A[1])/r/x,k=(q[2][0]-A[0])/r/S,X=-(q[2][1]-A[1])/r/x;j.push(we,oe,F,L,Q,he),K.push(ue,de,ae,re,k,X)});const V=Pa(0,g,y,0,-1,1),G=i.getUniformLocation(R,"u_matrix");i.uniformMatrix4fv(G,!1,V);const J=i.getAttribLocation(R,"a_position"),H=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,H),i.bufferData(i.ARRAY_BUFFER,new Float32Array(j),i.STATIC_DRAW),i.vertexAttribPointer(J,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(J);const W=i.getAttribLocation(R,"a_texcoord"),se=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,se),i.bufferData(i.ARRAY_BUFFER,new Float32Array(K),i.STATIC_DRAW),i.vertexAttribPointer(W,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(W),i.drawArrays(i.TRIANGLES,0,j.length/2)}if(u){const j=La(i,p1,g1);i.useProgram(j);const K=Pa(0,g,y,0,-1,1),R=i.getUniformLocation(j,"u_matrix");i.uniformMatrix4fv(R,!1,K);const U=Array.isArray(u)?u:[0,0,0,255],V=i.getUniformLocation(j,"u_val");i.uniform4fv(V,U);const G=i.getAttribLocation(j,"a_position"),J=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,J),i.vertexAttribPointer(G,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(G);const H=a.getTriangles().reduce(function(W,se){const Z=se.target,{u1:ie,v1:M,u0:q,v0:$,u2:we,v2:oe}=O(Z);return W.concat([ie,M,q,$,q,$,we,oe,we,oe,ie,M])},[]);i.bufferData(i.ARRAY_BUFFER,new Float32Array(H),i.STATIC_DRAW),i.drawArrays(i.LINES,0,H.length/2)}return{width:g,height:y,framebuffer:w,texture:E}}class v1 extends Ma{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,n=t.getExtent(),r=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?r?ai(n,r):n:r;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const l=o?ai(s,o):s;if(Hr(l)===0){this.state=Te.EMPTY;return}n&&(a?a=ai(a,n):a=n);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=e.targetProj,u=Td(t,c,l,h);if(!isFinite(u)||u<=0){this.state=Te.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:Sd;if(this.triangulation_=new xd(t,c,l,a,u*f,h,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=Te.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let d=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(d[1]=gt(d[1],a[1],a[3]),d[3]=gt(d[3],a[1],a[3])):d=ai(d,a)),!Hr(d))this.state=Te.EMPTY;else{let g=0,y=0;t.canWrapX()&&(g=Ue(n),y=Math.floor((d[0]-n[0])/g)),ch(d.slice(),t,!0).forEach(E=>{const b=this.sourceTileGrid_.getTileRangeForExtentAndZ(E,this.sourceZ_),v=e.getTileFunction;for(let S=b.minX;S<=b.maxX;S++)for(let x=b.minY;x<=b.maxY;x++){const T=v(this.sourceZ_,S,x,this.pixelRatio_);if(T){const I=y*g;this.sourceTiles_.push({tile:T,offset:I})}}++y}),this.sourceTiles_.length===0&&(this.state=Te.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(S=>{var ie;const x=S.tile;if(!x||x.getState()!==Te.LOADED)return;const T=x.getSize(),I=this.gutter_;let A;const O=qy(x.getData());O?A=O:(t=!0,A=Jy(Js(x.getData())));const j=[T[0]+2*I,T[1]+2*I],K=A instanceof Float32Array,R=j[0]*j[1],U=K?Float32Array:Uint8ClampedArray,V=new U(A.buffer),G=U.BYTES_PER_ELEMENT,J=G*V.length/R,H=V.byteLength/j[1],W=Math.floor(H/G/j[0]),se=this.sourceTileGrid_.getTileCoordExtent(x.tileCoord);se[0]+=S.offset,se[2]+=S.offset;const Z=(ie=this.clipExtent_)==null?void 0:ie.slice();Z&&(Z[0]+=S.offset,Z[2]+=S.offset),e.push({extent:se,clipExtent:Z,data:V,dataType:U,bytesPerPixel:J,pixelSize:j,bandCount:W})}),this.sourceTiles_.length=0,e.length===0){this.state=Te.ERROR,this.changed();return}const n=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(n),s=typeof r=="number"?r:r[0],o=typeof r=="number"?r:r[1],a=s*this.pixelRatio_,l=o*this.pixelRatio_,h=this.targetTileGrid_.getResolution(n),c=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=e[0].bandCount,d=new e[0].dataType(f*a*l),g=y1(a,l,hu,{premultipliedAlpha:!1,antialias:!1});let y;const w=g.RGBA;let E;e[0].dataType==Float32Array?(E=g.FLOAT,g.getExtension("WEBGL_color_buffer_float"),g.getExtension("OES_texture_float"),g.getExtension("EXT_float_blend"),y=g.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(E=g.UNSIGNED_BYTE,y=this.interpolate);const b=4,v=Math.ceil(f/b);for(let S=v-1;S>=0;--S){const x=[];for(let U=0,V=e.length;U<V;++U){const G=e[U],J=G.pixelSize,H=J[0],W=J[1],se=new G.dataType(b*H*W),Z=G.data;let ie=S*b;for(let q=0,$=se.length;q<$;q+=b)se[q]=Z[ie],se[q+1]=Z[ie+1],se[q+2]=Z[ie+2],se[q+3]=Z[ie+3],ie+=f;const M=g.createTexture();g.bindTexture(g.TEXTURE_2D,M),y?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST)),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texImage2D(g.TEXTURE_2D,0,w,H,W,0,w,E,se),x.push({extent:G.extent,clipExtent:G.clipExtent,texture:M,width:H,height:W})}const{framebuffer:T,width:I,height:A}=b1(g,s,o,this.pixelRatio_,c,h,u,this.triangulation_,x,this.gutter_,E,this.renderEdges_,y),O=I,j=A*b,K=new e[0].dataType(O*j);g.bindFramebuffer(g.FRAMEBUFFER,T),g.readPixels(0,0,I,A,g.RGBA,E,K);let R=S*b;for(let U=0,V=K.length;U<V;U+=b){const G=(O-1-(U/j|0))*j+U%j;d[R]=K[G],d[R+1]=K[G+1],d[R+2]=K[G+2],d[R+3]=K[G+3],R+=f}}if(w1(g),hu.push(g.canvas),t){const S=_t(s,o),x=new ImageData(d,s);S.putImageData(x,0,0),this.reprojData_=S.canvas}else this.reprojData_=d;this.reprojSize_=[Math.round(a),Math.round(l)],this.state=Te.LOADED,this.changed()}load(){if(this.state!==Te.IDLE&&this.state!==Te.ERROR)return;this.state=Te.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n!==Te.IDLE&&n!==Te.LOADING)return;e++;const r=je(t,ke.CHANGE,()=>{const s=t.getState();(s==Te.LOADED||s==Te.ERROR||s==Te.EMPTY)&&(it(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==Te.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(it),this.sourcesListenerKeys_=null}}const E1=v1;class S1 extends qh{constructor(e,t,n,r,s,o,a,l,h,c,u,f){super(s,Te.IDLE,f),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const d=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let y=this.sourceTileGrid_.getExtent();const w=g?ai(d,g):d;if(Hr(w)===0){this.state=Te.EMPTY;return}const E=e.getExtent();E&&(y?y=ai(y,E):y=E);const b=r.getResolution(this.wrappedTileCoord_[0]),v=Td(e,n,w,b);if(!isFinite(v)||v<=0){this.state=Te.EMPTY;return}const S=c!==void 0?c:Sd;if(this.triangulation_=new xd(e,n,w,y,v*S,b),this.triangulation_.getTriangles().length===0){this.state=Te.EMPTY;return}this.sourceZ_=t.getZForResolution(v);let x=this.triangulation_.calculateSourceExtent();if(y&&(e.canWrapX()?(x[1]=gt(x[1],y[1],y[3]),x[3]=gt(x[3],y[1],y[3])):x=ai(x,y)),!Hr(x))this.state=Te.EMPTY;else{let T=0,I=0;e.canWrapX()&&(T=Ue(E),I=Math.floor((x[0]-E[0])/T)),ch(x.slice(),e,!0).forEach(O=>{const j=t.getTileRangeForExtentAndZ(O,this.sourceZ_);for(let K=j.minX;K<=j.maxX;K++)for(let R=j.minY;R<=j.maxY;R++){const U=h(this.sourceZ_,K,R,a);if(U){const V=I*T;this.sourceTiles_.push({tile:U,offset:V})}}++I}),this.sourceTiles_.length===0&&(this.state=Te.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{var r;const n=t.tile;if(n&&n.getState()==Te.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=t.offset,s[2]+=t.offset;const o=(r=this.clipExtent_)==null?void 0:r.slice();o&&(o[0]+=t.offset,o[2]+=t.offset),e.push({extent:s,clipExtent:o,image:n.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Te.ERROR;else{const t=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(t),r=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=l1(r,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Te.LOADED}this.changed()}load(){if(this.state==Te.IDLE){this.state=Te.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n==Te.IDLE||n==Te.LOADING){e++;const r=je(t,ke.CHANGE,s=>{const o=t.getState();(o==Te.LOADED||o==Te.ERROR||o==Te.EMPTY)&&(it(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},n,r){t.getState()==Te.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(it),this.sourcesListenerKeys_=null}release(){this.canvas_&&(vo(this.canvas_.getContext("2d")),ur.push(this.canvas_),this.canvas_=null),super.release()}}const Oa=S1;class Rd{constructor(e,t,n,r){this.minX=e,this.maxX=t,this.minY=n,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Xn(i,e,t,n,r){return r!==void 0?(r.minX=i,r.maxX=e,r.minY=t,r.maxY=n,r):new Rd(i,e,t,n)}const Id=Rd;function Qs(i,e,t,n){return n!==void 0?(n[0]=i,n[1]=e,n[2]=t,n):[i,e,t]}function x1(i,e,t){return i+"/"+e+"/"+t}function T1(i){return R1(i[0],i[1],i[2])}function R1(i,e,t){return(e<<i)+t}function I1(i,e){const t=i[0],n=i[1],r=i[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(n,r):!0}function Jo(i,e,t,n){return`${i},${x1(e,t,n)}`}function Qo(i,e,t){if(!(t in i))return i[t]=new Set([e]),!0;const n=i[t],r=n.has(e);return r||n.add(e),!r}function C1(i,e,t){const n=i[t];return n?n.delete(e):!1}function cu(i,e){const t=i.layerStatesArray[i.layerIndex];t.extent&&(e=ai(e,sn(t.extent,i.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(i.viewState.projection).getExtent();r&&(e=ai(e,r))}return e}class A1 extends vd{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Kt(),this.tempTileRange_=new Id(0,0,0,0),this.tempTileCoord_=Qs(0,0,0);const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new r1(n),this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,n,r){const s=this.tileCache_,a=this.getLayer().getSource(),l=Jo(a.getKey(),e,t,n);let h;if(s.containsKey(l))h=s.get(l);else{if(h=a.getTile(e,t,n,r.pixelRatio,r.viewState.projection),!h)return null;s.set(l,h)}return h}getTile(e,t,n,r){const s=this.getOrCreateTile(e,t,n,r);return s||null}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=Tt(t.pixelToCoordinateTransform,e.slice()),s=n.getExtent();if(s&&!pr(s,r))return null;const o=t.viewState,a=n.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(t.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(r,c),f=this.getTile(c,u[1],u[2],t);if(!f||f.getState()!==Te.LOADED)continue;const d=l.getOrigin(c),g=zt(l.getTileSize(c)),y=l.getResolution(c);let w;if(f instanceof Ed||f instanceof Oa)w=f.getImage();else if(f instanceof Ma){if(w=Js(f.getData()),!w)continue}else continue;const E=Math.floor(h*((r[0]-d[0])/y-u[1]*g[0])),b=Math.floor(h*((d[1]-r[1])/y-u[2]*g[1])),v=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(w,E+v,b+v)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const n=t.getRevision();return this.renderedRevision_?this.renderedRevision_!==n&&(this.renderedRevision_=n,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedRevision_=n,!0}enqueueTiles(e,t,n,r,s){const o=e.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=Xe(l);c in e.wantedTiles||(e.wantedTiles[c]={});const u=e.wantedTiles[c],f=a.getMapInternal(),d=Math.max(n-s,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection));for(let g=n;g>=d;--g){const y=h.getTileRangeForExtentAndZ(t,g,this.tempTileRange_),w=h.getResolution(g);for(let E=y.minX;E<=y.maxX;++E)for(let b=y.minY;b<=y.maxY;++b){const v=this.getTile(g,E,b,e);if(!v||!Qo(r,v,g))continue;const x=v.getKey();if(u[x]=!0,v.getState()===Te.IDLE&&!e.tileQueue.isKeyQueued(x)){const T=Qs(g,E,b,this.tempTileCoord_);e.tileQueue.enqueue([v,c,h.getTileCoordCenter(T),w])}}}}findStaleTile_(e,t){const n=this.tileCache_,r=e[0],s=e[1],o=e[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=Jo(a[l],r,s,o);if(n.containsKey(h)){const c=n.get(h);if(c.getState()===Te.LOADED)return c.endTransition(Xe(this)),Qo(t,c,r),!0}}return!1}findAltTiles_(e,t,n,r){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let c=s.minX;c<=s.maxX;++c)for(let u=s.minY;u<=s.maxY;++u){const f=Jo(h,n,c,u);let d=!1;if(a.containsKey(f)){const g=a.get(f);g.getState()===Te.LOADED&&(Qo(r,g,n),d=!0)}d||(o=!1)}return o}renderFrame(e,t){let n=!0;this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],s=e.viewState,o=s.projection,a=s.resolution,l=s.center,h=e.pixelRatio,c=this.getLayer(),u=c.getSource(),f=u.getRevision(),d=u.getTileGridForProjection(o),g=d.getZForResolution(a,u.zDirection),y=d.getResolution(g),w=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==w&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=w):this.renderedSourceKey_=w;let E=e.extent;const b=u.getTilePixelRatio(h);this.prepareContainer(e,t);const v=this.context.canvas.width,S=this.context.canvas.height,x=r.extent&&sn(r.extent);x&&(E=ai(E,sn(r.extent)));const T=y*v/2/b,I=y*S/2/b,A=[l[0]-T,l[1]-I,l[0]+T,l[1]+I],O={};this.renderedTiles.length=0;const j=c.getPreload();if(e.nextExtent){const Z=d.getZForResolution(s.nextResolution,u.zDirection),ie=cu(e,e.nextExtent);this.enqueueTiles(e,ie,Z,O,j)}const K=cu(e,E);if(this.enqueueTiles(e,K,g,O,0),j>0&&setTimeout(()=>{this.enqueueTiles(e,K,g-1,O,j-1)},0),!(g in O))return this.container;const R=Xe(this),U=e.time;for(const Z of O[g]){const ie=Z.getState();if((Z instanceof Oa||Z instanceof E1)&&ie===Te.EMPTY)continue;const M=Z.tileCoord;if(ie===Te.LOADED&&Z.getAlpha(R,U)===1){Z.endTransition(R);continue}if(ie!==Te.IDLE&&(n=!1),ie!==Te.ERROR&&(this.renderComplete=!1),this.findStaleTile_(M,O)){C1(O,Z,g),e.animate=!0;continue}if(this.findAltTiles_(d,M,g+1,O))continue;const we=d.getMinZoom();for(let oe=g-1;oe>=we&&!this.findAltTiles_(d,M,oe,O);--oe);}const V=y/a*h/b,G=this.getRenderContext(e);Ni(this.tempTransform,v/2,S/2,V,V,0,-v/2,-S/2),r.extent&&this.clipUnrotated(G,e,x),u.getInterpolate()||(G.imageSmoothingEnabled=!1),this.preRender(G,e);const J=Object.keys(O).map(Number);J.sort(Oi);let H;const W=[],se=[];for(let Z=J.length-1;Z>=0;--Z){const ie=J[Z],M=u.getTilePixelSize(ie,h,o),$=d.getResolution(ie)/y,we=M[0]*$*V,oe=M[1]*$*V,F=d.getTileCoordForCoordAndZ(Fi(A),ie),L=d.getTileCoordExtent(F),Q=Tt(this.tempTransform,[b*(L[0]-A[0])/y,b*(A[3]-L[3])/y]),he=b*u.getGutterForProjection(o);for(const ae of O[ie]){if(ae.getState()!==Te.LOADED)continue;const re=ae.tileCoord,ue=F[1]-re[1],de=Math.round(Q[0]-(ue-1)*we),k=F[2]-re[2],X=Math.round(Q[1]-(k-1)*oe),Y=Math.round(Q[0]-ue*we),le=Math.round(Q[1]-k*oe),ne=de-Y,z=X-le,te=J.length===1;let be=!1;H=[Y,le,Y+ne,le,Y+ne,le+z,Y,le+z];for(let Se=0,Re=W.length;Se<Re;++Se)if(!te&&ie<se[Se]){const Ae=W[Se];Wt([Y,le,Y+ne,le+z],[Ae[0],Ae[3],Ae[4],Ae[7]])&&(be||(G.save(),be=!0),G.beginPath(),G.moveTo(H[0],H[1]),G.lineTo(H[2],H[3]),G.lineTo(H[4],H[5]),G.lineTo(H[6],H[7]),G.moveTo(Ae[6],Ae[7]),G.lineTo(Ae[4],Ae[5]),G.lineTo(Ae[2],Ae[3]),G.lineTo(Ae[0],Ae[1]),G.clip())}W.push(H),se.push(ie),this.drawTile(ae,e,Y,le,ne,z,he,te),be&&G.restore(),this.renderedTiles.unshift(ae),this.updateUsedTiles(e.usedTiles,u,ae)}}if(this.renderedRevision=f,this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!Kr(this.renderedExtent_,A),this.renderedExtent_=A,this.renderedPixelRatio=h,this.postRender(this.context,e),r.extent&&G.restore(),G.imageSmoothingEnabled=!0,this.renderComplete){const Z=(ie,M)=>{const q=Xe(u),$=M.wantedTiles[q],we=$?Object.keys($).length:0;this.updateCacheSize(we),this.tileCache_.expireCache()};e.postRenderFunctions.push(Z)}return!this.renderComplete&&!n&&(e.animate=!0),this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,n,r,s,o,a,l){let h;if(e instanceof Ma){if(h=Js(e.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(e);if(!h)return;const c=this.getRenderContext(t),u=Xe(this),f=t.layerStatesArray[t.layerIndex],d=f.opacity*(l?e.getAlpha(u,t.time):1),g=d!==c.globalAlpha;g&&(c.save(),c.globalAlpha=d),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,n,r,s,o),g&&c.restore(),d!==f.opacity?t.animate=!0:l&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,n){const r=Xe(t);r in e||(e[r]={}),e[r][n.getKey()]=!0}}const M1=A1;class P1 extends Gy{constructor(e){super(e)}createRenderer(){return new M1(this,{cacheSize:this.getCacheSize()})}}const L1=P1,ea={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class O1 extends yi{constructor(e){super(),this.projection=Yt(e.projection),this.attributions_=uu(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(n,r){t.viewResolver=n,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=uu(e),this.changed()}setState(e){this.state_=e,this.changed()}}function uu(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),e=>i):null}const Cd=O1,$n=[0,0,0],Vi=5;class k1{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Ge(Fp(this.resolutions_,(r,s)=>s-r,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Ge(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=e.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Fi(n)),Ge(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Ge(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:oh,Ge(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,s)=>{const o=new Id(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(n){const a=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):n&&this.calculateTileRanges_(n)}forEachTileCoord(e,t,n){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,o=r.maxX;s<=o;++s)for(let a=r.minY,l=r.maxY;a<=l;++a)n([t,s,a])}forEachTileCoordParentTileRange(e,t,n,r){let s,o,a,l=null,h=e[0]-1;for(this.zoomFactor_===2?(o=e[1],a=e[2]):l=this.getTileCoordExtent(e,r);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),s=Xn(o,o,a,a,n)):s=this.getTileRangeForExtentAndZ(l,h,n),t(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,n){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,o=e[2]*2;return Xn(s,s+1,o,o+1,t)}const r=this.getTileCoordExtent(e,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,n){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],o=e[2];if(t===r)return Xn(s,o,s,o,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,t-r),h=Math.floor(s*l),c=Math.floor(o*l);if(t<r)return Xn(h,h,c,c,n);const u=Math.floor(l*(s+1))-1,f=Math.floor(l*(o+1))-1;return Xn(h,u,c,f,n)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,n)}getTileRangeForExtentAndZ(e,t,n){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,$n);const r=$n[1],s=$n[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,$n);const o=$n[1],a=$n[2];return Xn(r,o,s,a,n)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),n=this.getResolution(e[0]),r=zt(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*n,t[1]-(e[2]+.5)*r[1]*n]}getTileCoordExtent(e,t){const n=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=zt(this.getTileSize(e[0]),this.tmpSize_),o=n[0]+e[1]*s[0]*r,a=n[1]-(e[2]+1)*s[1]*r,l=o+s[0]*r,h=a+s[1]*r;return hn(o,a,l,h,t)}getTileCoordForCoordAndResolution(e,t,n){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,n)}getTileCoordForXYAndResolution_(e,t,n,r,s){const o=this.getZForResolution(n),a=n/this.getResolution(o),l=this.getOrigin(o),h=zt(this.getTileSize(o),this.tmpSize_);let c=a*(e-l[0])/n/h[0],u=a*(l[1]-t)/n/h[1];return r?(c=_s(c,Vi)-1,u=_s(u,Vi)-1):(c=ps(c,Vi),u=ps(u,Vi)),Qs(o,c,u,s)}getTileCoordForXYAndZ_(e,t,n,r,s){const o=this.getOrigin(n),a=this.getResolution(n),l=zt(this.getTileSize(n),this.tmpSize_);let h=(e-o[0])/a/l[0],c=(o[1]-t)/a/l[1];return r?(h=_s(h,Vi)-1,c=_s(c,Vi)-1):(h=ps(h,Vi),c=ps(c,Vi)),Qs(n,h,c,s)}getTileCoordForCoordAndZ(e,t,n){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,n)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const n=nh(this.resolutions_,e,t||0);return gt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Wf(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,n=new Array(t);for(let r=this.minZoom;r<t;++r)n[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=n}}const Ad=k1;function Md(i){let e=i.getDefaultTileGrid();return e||(e=B1(i),i.setDefaultTileGrid(e)),e}function D1(i,e,t){const n=e[0],r=i.getTileCoordCenter(e),s=Zh(t);if(!pr(s,r)){const o=Ue(s),a=Math.ceil((s[0]-r[0])/o);return r[0]+=o*a,i.getTileCoordForCoordAndZ(r,n)}return e}function F1(i,e,t,n){n=n!==void 0?n:"top-left";const r=Pd(i,e,t);return new Ad({extent:i,origin:n_(i,n),resolutions:r,tileSize:t})}function N1(i){const e=i||{},t=e.extent||Yt("EPSG:3857").getExtent(),n={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Pd(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Ad(n)}function Pd(i,e,t,n){e=e!==void 0?e:$p,t=zt(t!==void 0?t:oh);const r=wt(i),s=Ue(i);n=n>0?n:Math.max(s/t[0],r/t[1]);const o=e+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=n/Math.pow(2,l);return a}function B1(i,e,t,n){const r=Zh(i);return F1(r,e,t,n)}function Zh(i){i=Yt(i);let e=i.getExtent();if(!e){const t=180*$r.degrees/i.getMetersPerUnit();e=hn(-t,-t,t,t)}return e}class U1 extends Cd{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&zt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||Xe(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,n,r,s){return We()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Md(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,n){const r=this.getTileGridForProjection(n),s=this.getTilePixelRatio(t),o=zt(r.getTileSize(e),this.tmpSize);return s==1?o:Bm(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){const n=t!==void 0?t:this.getProjection(),r=t!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(e=D1(r,e,n)),I1(e,r)?e:null}clear(){}refresh(){this.clear(),super.refresh()}}class j1 extends Wi{constructor(e,t){super(e),this.tile=t}}const W1=U1,G1=/\{z\}/g,z1=/\{x\}/g,Y1=/\{y\}/g,X1=/\{-y\}/g;function $1(i,e,t,n,r){return i.replace(G1,e.toString()).replace(z1,t.toString()).replace(Y1,n.toString()).replace(X1,function(){if(r===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(r-n).toString()})}function V1(i){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(i);if(t){const n=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=n;s<=r;++s)e.push(i.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){const n=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=n;r++)e.push(i.replace(t[0],r.toString()));return e}return e.push(i),e}function K1(i,e){return function(t,n,r){if(!t)return;let s;const o=t[0];if(e){const a=e.getFullTileRange(o);a&&(s=a.getHeight()-1)}return $1(i,o,t[1],t[2],s)}}function H1(i,e){const t=i.length,n=new Array(t);for(let r=0;r<t;++r)n[r]=K1(i[r],e);return q1(n)}function q1(i){return i.length===1?i[0]:function(e,t,n){if(!e)return;const r=T1(e),s=ar(r,i.length);return i[s](e,t,n)}}class Jh extends W1{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Jh.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,n=Xe(t),r=t.getState();let s;r==Te.LOADING?(this.tileLoadingKeys_[n]=!0,s=ea.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=r==Te.ERROR?ea.TILELOADERROR:r==Te.LOADED?ea.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new j1(s,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=V1(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(H1(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,n){}}const Z1=Jh;class J1 extends Z1{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Q1,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:Ed,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!No(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||No(t,e)))return this.tileGrid;const n=Xe(e);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Md(e)),this.tileGridForProjection[n]}createTile_(e,t,n,r,s,o){const a=[e,t,n],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,r,s):void 0,c=new this.tileClass(a,h!==void 0?Te.IDLE:Te.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(ke.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,n,r,s){const o=this.getProjection();if(!o||!s||No(o,s))return this.getTileInternal(e,t,n,r,o||s);const a=[e,t,n],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(s),u=this.getTileCoordForTileUrlFunction(a,s),f=new Oa(o,h,s,c,a,u,this.getTilePixelRatio(r),this.getGutter(),(d,g,y,w)=>this.getTileInternal(d,g,y,w,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=l,f}getTileInternal(e,t,n,r,s){const o=this.getKey();return this.createTile_(e,t,n,r,s,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const n=Yt(e);if(n){const r=Xe(n);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}}function Q1(i,e){i.getImage().src=e}const ew=J1;class tw extends ew{constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",n=e.tileGrid!==void 0?e.tileGrid:N1({extent:Zh(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const iw=tw,nw='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class rw extends iw{constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[nw];const n=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",r=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const sw=rw,us={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},xs=[us.FILL],on=[us.STROKE],In=[us.BEGIN_PATH],fu=[us.CLOSE_PATH],Le=us;class ow{drawCustom(e,t,n,r,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,n){}drawFeature(e,t,n){}drawGeometryCollection(e,t,n){}drawLineString(e,t,n){}drawMultiLineString(e,t,n){}drawMultiPoint(e,t,n){}drawMultiPolygon(e,t,n){}drawPoint(e,t,n){}drawPolygon(e,t,n){}drawText(e,t,n){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}const Ld=ow;class aw extends Ld{constructor(e,t,n,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(n){return n*t})}appendFlatPointCoordinates(e,t){const n=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)r[0]=e[a],r[1]=e[a+1],pr(n,r)&&(s[o++]=r[0],s[o++]=r[1]);return o}appendFlatLineCoordinates(e,t,n,r,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(t+=r);let c=e[t],u=e[t+1];const f=this.tmpCoordinate_;let d=!0,g,y,w;for(g=t+r;g<n;g+=r)f[0]=e[g],f[1]=e[g+1],w=wa(h,f),w!==y?(d&&(a[l++]=c,a[l++]=u,d=!1),a[l++]=f[0],a[l++]=f[1]):w===xt.INTERSECTING?(a[l++]=f[0],a[l++]=f[1],d=!1):d=!0,c=f[0],u=f[1],y=w;return(s&&d||g===t+r)&&(a[l++]=c,a[l++]=u),l}drawCustomCoordinates_(e,t,n,r,s){for(let o=0,a=n.length;o<a;++o){const l=n[o],h=this.appendFlatLineCoordinates(e,t,l,r,!1,!1);s.push(h),t=l}return t}drawCustom(e,t,n,r,s){this.beginGeometry(e,t,s);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let h,c,u,f,d;switch(o){case"MultiPolygon":h=e.getOrientedFlatCoordinates(),f=[];const g=e.getEndss();d=0;for(let y=0,w=g.length;y<w;++y){const E=[];d=this.drawCustomCoordinates_(h,d,g[y],a,E),f.push(E)}this.instructions.push([Le.CUSTOM,l,f,e,n,Oc,s]),this.hitDetectionInstructions.push([Le.CUSTOM,l,f,e,r||n,Oc,s]);break;case"Polygon":case"MultiLineString":u=[],h=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(h,0,e.getEnds(),a,u),this.instructions.push([Le.CUSTOM,l,u,e,n,Ys,s]),this.hitDetectionInstructions.push([Le.CUSTOM,l,u,e,r||n,Ys,s]);break;case"LineString":case"Circle":h=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([Le.CUSTOM,l,c,e,n,nr,s]),this.hitDetectionInstructions.push([Le.CUSTOM,l,c,e,r||n,nr,s]);break;case"MultiPoint":h=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([Le.CUSTOM,l,c,e,n,nr,s]),this.hitDetectionInstructions.push([Le.CUSTOM,l,c,e,r||n,nr,s]));break;case"Point":h=e.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([Le.CUSTOM,l,c,e,n,void 0,s]),this.hitDetectionInstructions.push([Le.CUSTOM,l,c,e,r||n,void 0,s]);break}this.endGeometry(t)}beginGeometry(e,t,n){this.beginGeometryInstruction1_=[Le.BEGIN_GEOMETRY,t,0,e,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Le.BEGIN_GEOMETRY,t,0,e,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const n=e.length;let r,s,o=-1;for(t=0;t<n;++t)r=e[t],s=r[0],s==Le.END_GEOMETRY?o=t:s==Le.BEGIN_GEOMETRY&&(r[2]=t,Dp(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const n=this.state;if(e){const r=e.getColor();n.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,n.fillStyle=pi(r||Ut)}else n.fillStyle=void 0;if(t){const r=t.getColor();n.strokeStyle=pi(r||Qr);const s=t.getLineCap();n.lineCap=s!==void 0?s:yr;const o=t.getLineDash();n.lineDash=o?o.slice():ki;const a=t.getLineDashOffset();n.lineDashOffset=a||Di;const l=t.getLineJoin();n.lineJoin=l!==void 0?l:wr;const h=t.getWidth();n.lineWidth=h!==void 0?h:ts;const c=t.getMiterLimit();n.miterLimit=c!==void 0?c:Jr,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(e){const t=e.fillStyle,n=[Le.SET_FILL_STYLE,t];return typeof t!="string"&&n.push(e.fillPatternScale),n}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Le.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const n=e.fillStyle;(typeof n!="string"||e.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=n)}updateStrokeStyle(e,t){const n=e.strokeStyle,r=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,h=e.miterLimit;(e.currentStrokeStyle!=n||e.currentLineCap!=r||s!=e.currentLineDash&&!un(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=h)&&(n!==void 0&&t.call(this,e),e.currentStrokeStyle=n,e.currentLineCap=r,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=h)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Le.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=gf(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;lh(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}const fs=aw;class lw extends fs{constructor(e,t,n,r){super(e,t,n,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,n){if(!this.image_||this.maxExtent&&!pr(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,n);const r=e.getFlatCoordinates(),s=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,s);this.instructions.push([Le.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Le.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,n){if(!this.image_)return;this.beginGeometry(e,t,n);const r=e.getFlatCoordinates(),s=[];for(let l=0,h=r.length;l<h;l+=e.getStride())(!this.maxExtent||pr(this.maxExtent,r.slice(l,l+2)))&&s.push(r[l],r[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([Le.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Le.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const n=e.getAnchor(),r=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const hw=lw;class cw extends fs{constructor(e,t,n,r){super(e,t,n,r)}drawFlatCoordinates_(e,t,n,r){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,n,r,!1,!1),a=[Le.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),n}drawLineString(e,t,n){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([Le.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ki,Di],In);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(on),this.endGeometry(t)}drawMultiLineString(e,t,n){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,n),this.hitDetectionInstructions.push([Le.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ki,Di],In);const a=e.getEnds(),l=e.getFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,f=a.length;u<f;++u)c=this.drawFlatCoordinates_(l,c,a[u],h);this.hitDetectionInstructions.push(on),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(on),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(on),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(In)}}const uw=cw;class fw extends fs{constructor(e,t,n,r){super(e,t,n,r)}drawFlatCoordinatess_(e,t,n,r){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=n.length;this.instructions.push(In),this.hitDetectionInstructions.push(In);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,f=this.appendFlatLineCoordinates(e,t,c,r,!0,!a),d=[Le.MOVE_TO_LINE_TO,u,f];this.instructions.push(d),this.hitDetectionInstructions.push(d),a&&(this.instructions.push(fu),this.hitDetectionInstructions.push(fu)),t=c}return o&&(this.instructions.push(xs),this.hitDetectionInstructions.push(xs)),a&&(this.instructions.push(on),this.hitDetectionInstructions.push(on)),t}drawCircle(e,t,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_FILL_STYLE,Ut]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ki,Di]);const a=e.getFlatCoordinates(),l=e.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[Le.CIRCLE,h];this.instructions.push(In,c),this.hitDetectionInstructions.push(In,c),r.fillStyle!==void 0&&(this.instructions.push(xs),this.hitDetectionInstructions.push(xs)),r.strokeStyle!==void 0&&(this.instructions.push(on),this.hitDetectionInstructions.push(on)),this.endGeometry(t)}drawPolygon(e,t,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_FILL_STYLE,Ut]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ki,Di]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),h=e.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(t)}drawMultiPolygon(e,t,n){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,n),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_FILL_STYLE,Ut]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Le.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ki,Di]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),h=e.getStride();let c=0;for(let u=0,f=a.length;u<f;++u)c=this.drawFlatCoordinatess_(l,c,a[u],h);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let n=0,r=t.length;n<r;++n)t[n]=vn(t[n],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const du=fw;function dw(i,e,t,n,r){const s=[];let o=t,a=0,l=e.slice(t,2);for(;a<i&&o+r<n;){const[h,c]=l.slice(-2),u=e[o+r],f=e[o+r+1],d=Math.sqrt((u-h)*(u-h)+(f-c)*(f-c));if(a+=d,a>=i){const g=(i-a+d)/d,y=Zt(h,u,g),w=Zt(c,f,g);l.push(y,w),s.push(l),l=[y,w],a==i&&(o+=r),a=0}else if(a<i)l.push(e[o+r],e[o+r+1]),o+=r;else{const g=d-a,y=Zt(h,u,g/d),w=Zt(c,f,g/d);l.push(y,w),s.push(l),l=[y,w],a=0,o+=r}}return a>0&&s.push(l),s}function gw(i,e,t,n,r){let s=t,o=t,a=0,l=0,h=t,c,u,f,d,g,y,w,E,b,v;for(u=t;u<n;u+=r){const S=e[u],x=e[u+1];g!==void 0&&(b=S-g,v=x-y,d=Math.sqrt(b*b+v*v),w!==void 0&&(l+=f,c=Math.acos((w*b+E*v)/(f*d)),c>i&&(l>a&&(a=l,s=h,o=u),l=0,h=u-r)),f=d,w=b,E=v),g=S,y=x}return l+=d,l>a?[h,u]:[s,o]}const eo={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class pw extends fs{constructor(e,t,n,r){super(e,t,n,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Ut]={fillStyle:Ut},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,n){const r=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!r&&!s)return;const a=this.coordinates;let l=a.length;const h=e.getType();let c=null,u=e.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Wt(this.maxExtent,e.getExtent()))return;let f;if(c=e.getFlatCoordinates(),h=="LineString")f=[c.length];else if(h=="MultiLineString")f=e.getEnds();else if(h=="Polygon")f=e.getEnds().slice(0,1);else if(h=="MultiPolygon"){const w=e.getEndss();f=[];for(let E=0,b=w.length;E<b;++E)f.push(w[E][0])}this.beginGeometry(e,t,n);const d=o.repeat,g=d?void 0:o.textAlign;let y=0;for(let w=0,E=f.length;w<E;++w){let b;d?b=dw(d*this.resolution,c,y,f[w],u):b=[c.slice(y,f[w])];for(let v=0,S=b.length;v<S;++v){const x=b[v];let T=0,I=x.length;if(g==null){const O=gw(o.maxAngle,x,0,x.length,2);T=O[0],I=O[1]}for(let O=T;O<I;O+=u)a.push(x[O],x[O+1]);const A=a.length;y=f[w],this.drawChars_(l,A),l=A}}this.endGeometry(t)}else{let f=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||f.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const b=e.getFlatInteriorPoints();c=[];for(let v=0,S=b.length;v<S;v+=3)o.overflow||f.push(b[v+2]/this.resolution),c.push(b[v],b[v+1]);if(c.length===0)return;u=2;break}const d=this.appendFlatPointCoordinates(c,u);if(d===l)return;if(f&&(d-l)/2!==c.length/u){let b=l/2;f=f.filter((v,S)=>{const x=a[(b+S)*2]===c[S*u]&&a[(b+S)*2+1]===c[S*u+1];return x||--b,x})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,n);let g=o.padding;if(g!=Rn&&(o.scale[0]<0||o.scale[1]<0)){let b=o.padding[0],v=o.padding[1],S=o.padding[2],x=o.padding[3];o.scale[0]<0&&(v=-v,x=-x),o.scale[1]<0&&(b=-b,S=-S),g=[b,v,S,x]}const y=this.pixelRatio;this.instructions.push([Le.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==Rn?Rn:g.map(function(b){return b*y}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const w=1/y,E=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=Ut,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Le.DRAW_IMAGE,l,d,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[w,w],NaN,this.declutterMode_,this.declutterImageWithText_,g,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Ut:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),o.backgroundFill&&(this.state.fillStyle=E,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,n=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||es,justify:t.justify,textBaseline:t.textBaseline||Vs,scale:t.scale});const o=this.fillKey_;n&&(o in this.fillStates||(this.fillStates[o]={fillStyle:n.fillStyle}))}drawChars_(e,t){const n=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=eo[r.textBaseline],c=this.textOffsetY_*l,u=this.text_,f=n?n.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Le.DRAW_CHARS,e,t,h,r.overflow,a,r.maxAngle,l,c,s,f*l,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([Le.DRAW_CHARS,e,t,h,r.overflow,a&&Ut,r.maxAngle,l,c,s,f*l,u,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let n,r,s;if(!e)this.text_="";else{const o=e.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=pi(o.getColor()||Ut)):(r=null,this.textFillState_=r);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const y=a.getLineDash(),w=a.getLineDashOffset(),E=a.getWidth(),b=a.getMiterLimit();s.lineCap=a.getLineCap()||yr,s.lineDash=y?y.slice():ki,s.lineDashOffset=w===void 0?Di:w,s.lineJoin=a.getLineJoin()||wr,s.lineWidth=E===void 0?ts:E,s.miterLimit=b===void 0?Jr:b,s.strokeStyle=pi(a.getColor()||Qr)}n=this.textState_;const l=e.getFont()||Qf;Wm(l);const h=e.getScaleArray();n.overflow=e.getOverflow(),n.font=l,n.maxAngle=e.getMaxAngle(),n.placement=e.getPlacement(),n.textAlign=e.getTextAlign(),n.repeat=e.getRepeat(),n.justify=e.getJustify(),n.textBaseline=e.getTextBaseline()||Vs,n.backgroundFill=e.getBackgroundFill(),n.backgroundStroke=e.getBackgroundStroke(),n.padding=e.getPadding()||Rn,n.scale=h===void 0?[1,1]:h;const c=e.getOffsetX(),u=e.getOffsetY(),f=e.getRotateWithView(),d=e.getKeepUpright(),g=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=f===void 0?!1:f,this.textKeepUpright_=d===void 0?!0:d,this.textRotation_=g===void 0?0:g,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Xe(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Xe(r.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const _w={Circle:du,Default:fs,Image:hw,LineString:uw,Polygon:du,Text:pw};class mw{constructor(e,t,n,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=n,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const n=this.buildersByZIndex_[t];for(const r in n){const s=n[r].finish();e[t][r]=s}}return e}getBuilder(e,t){const n=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[n];r===void 0&&(r={},this.buildersByZIndex_[n]=r);let s=r[t];if(s===void 0){const o=_w[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=s}return s}}const yw=mw;function ww(i,e,t,n,r,s,o,a,l,h,c,u,f=!0){let d=i[e],g=i[e+1],y=0,w=0,E=0,b=0;function v(){y=d,w=g,e+=n,d=i[e],g=i[e+1],b+=E,E=Math.sqrt((d-y)*(d-y)+(g-w)*(g-w))}do v();while(e<t-n&&b+E<s);let S=E===0?0:(s-b)/E;const x=Zt(y,d,S),T=Zt(w,g,S),I=e-n,A=b,O=s+a*l(h,r,c);for(;e<t-n&&b+E<O;)v();S=E===0?0:(O-b)/E;const j=Zt(y,d,S),K=Zt(w,g,S);let R=!1;if(f)if(u){const H=[x,T,j,K];Of(H,0,4,2,u,H,H),R=H[0]>H[2]}else R=x>j;const U=Math.PI,V=[],G=I+n===e;e=I,E=0,b=A,d=i[e],g=i[e+1];let J;if(G){v(),J=Math.atan2(g-w,d-y),R&&(J+=J>0?-U:U);const H=(j+x)/2,W=(K+T)/2;return V[0]=[H,W,(O-s)/2,J,r],V}r=r.replace(/\n/g," ");for(let H=0,W=r.length;H<W;){v();let se=Math.atan2(g-w,d-y);if(R&&(se+=se>0?-U:U),J!==void 0){let we=se-J;if(we+=we>U?-2*U:we<-U?2*U:0,Math.abs(we)>o)return null}J=se;const Z=H;let ie=0;for(;H<W;++H){const we=R?W-H-1:H,oe=a*l(h,r[we],c);if(e+n<t&&b+E<s+ie+oe/2)break;ie+=oe}if(H===Z)continue;const M=R?r.substring(W-Z,W-H):r.substring(Z,H);S=E===0?0:(s+ie/2-b)/E;const q=Zt(y,d,S),$=Zt(w,g,S);V.push([q,$,ie/2,se,M]),s+=ie}return V}function bw(i,e,t,n){let r=i[e],s=i[e+1],o=0;for(let a=e+n;a<t;a+=n){const l=i[a],h=i[a+1];o+=Math.sqrt((l-r)*(l-r)+(h-s)*(h-s)),r=l,s=h}return o}const Vn=Kt(),Ki=[],bi=[],vi=[],Hi=[];function gu(i){return i[3].declutterBox}const pu=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function ta(i,e){return e==="start"?e=pu.test(i)?"right":"left":e==="end"&&(e=pu.test(i)?"left":"right"),eo[e]}function vw(i,e,t){return t>0&&i.push(`
`,""),i.push(e,""),i}class Ew{constructor(e,t,n,r,s){this.overlaps=n,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=li(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new bd:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,n,r){const s=e+t+n+r;if(this.labels_[s])return this.labels_[s];const o=r?this.strokeStates[r]:null,a=n?this.fillStates[n]:null,l=this.textStates[t],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?eo[l.justify]:ta(Array.isArray(e)?e[0]:e,l.textAlign||es),f=r&&o.lineWidth?o.lineWidth:0,d=Array.isArray(e)?e:String(e).split(`
`).reduce(vw,[]),{width:g,height:y,widths:w,heights:E,lineWidths:b}=zm(l,d),v=g+f,S=[],x=(v+2)*c[0],T=(y+f)*c[1],I={width:x<0?Math.floor(x):Math.ceil(x),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:S};(c[0]!=1||c[1]!=1)&&S.push("scale",c),r&&(S.push("strokeStyle",o.strokeStyle),S.push("lineWidth",f),S.push("lineCap",o.lineCap),S.push("lineJoin",o.lineJoin),S.push("miterLimit",o.miterLimit),S.push("setLineDash",[o.lineDash]),S.push("lineDashOffset",o.lineDashOffset)),n&&S.push("fillStyle",a.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");const A=.5-u;let O=u*v+A*f;const j=[],K=[];let R=0,U=0,V=0,G=0,J;for(let H=0,W=d.length;H<W;H+=2){const se=d[H];if(se===`
`){U+=R,R=0,O=u*v+A*f,++G;continue}const Z=d[H+1]||l.font;Z!==J&&(r&&j.push("font",Z),n&&K.push("font",Z),J=Z),R=Math.max(R,E[V]);const ie=[se,O+A*w[V]+u*(w[V]-b[G]),.5*(f+R)+U];O+=w[V],r&&j.push("strokeText",ie),n&&K.push("fillText",ie),++V}return Array.prototype.push.apply(S,j),Array.prototype.push.apply(S,K),this.labels_[s]=I,I}replayTextBackground_(e,t,n,r,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,n),e.lineTo.apply(e,r),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,n,r,s,o,a,l,h,c,u,f,d,g,y,w){a*=f[0],l*=f[1];let E=n-a,b=r-l;const v=s+h>e?e-h:s,S=o+c>t?t-c:o,x=g[3]+v*f[0]+g[1],T=g[0]+S*f[1]+g[2],I=E-g[3],A=b-g[0];(y||u!==0)&&(Ki[0]=I,Hi[0]=I,Ki[1]=A,bi[1]=A,bi[0]=I+x,vi[0]=bi[0],vi[1]=A+T,Hi[1]=vi[1]);let O;return u!==0?(O=Ni(li(),n,r,1,1,u,-n,-r),Tt(O,Ki),Tt(O,bi),Tt(O,vi),Tt(O,Hi),hn(Math.min(Ki[0],bi[0],vi[0],Hi[0]),Math.min(Ki[1],bi[1],vi[1],Hi[1]),Math.max(Ki[0],bi[0],vi[0],Hi[0]),Math.max(Ki[1],bi[1],vi[1],Hi[1]),Vn)):hn(Math.min(I,I+x),Math.min(A,A+T),Math.max(I,I+x),Math.max(A,A+T),Vn),d&&(E=Math.round(E),b=Math.round(b)),{drawImageX:E,drawImageY:b,drawImageW:v,drawImageH:S,originX:h,originY:c,declutterBox:{minX:Vn[0],minY:Vn[1],maxX:Vn[2],maxY:Vn[3],value:w},canvasTransform:O,scale:f}}replayImageOrLabel_(e,t,n,r,s,o,a){const l=!!(o||a),h=r.declutterBox,c=a?a[2]*r.scale[0]/2:0;return h.minX-c<=t[0]&&h.maxX+c>=0&&h.minY-c<=t[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(e,Ki,bi,vi,Hi,o,a),Ym(e,r.canvasTransform,s,n,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const n=Tt(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(n[0]%r,n[1]%r),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,n,r){const s=this.textStates[t],o=this.createLabel(e,t,r,n),a=this.strokeStates[n],l=this.pixelRatio,h=ta(Array.isArray(e)?e[0]:e,s.textAlign||es),c=eo[s.textBaseline||Vs],u=a&&a.lineWidth?a.lineWidth:0,f=o.width/l-2*s.scale[0],d=h*f+2*(.5-h)*u,g=c*o.height/l+2*(.5-c)*u;return{label:o,anchorX:d,anchorY:g}}execute_(e,t,n,r,s,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&un(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=ln(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),W_(this.renderedTransform_,n));let u=0;const f=r.length;let d=0,g,y,w,E,b,v,S,x,T,I,A,O,j,K=0,R=0,U=null,V=null;const G=this.coordinateCache_,J=this.viewRotation_,H=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,W={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:J},se=this.instructions!=r||this.overlaps?0:200;let Z,ie,M,q;for(;u<f;){const $=r[u];switch($[0]){case Le.BEGIN_GEOMETRY:Z=$[1],q=$[3],Z.getGeometry()?a!==void 0&&!Wt(a,q.getExtent())?u=$[2]+1:++u:u=$[2],h&&(h.zIndex=$[4]);break;case Le.BEGIN_PATH:K>se&&(this.fill_(e),K=0),R>se&&(e.stroke(),R=0),!K&&!R&&(e.beginPath(),b=NaN,v=NaN),++u;break;case Le.CIRCLE:d=$[1];const oe=c[d],F=c[d+1],L=c[d+2],Q=c[d+3],he=L-oe,ae=Q-F,re=Math.sqrt(he*he+ae*ae);e.moveTo(oe+re,F),e.arc(oe,F,re,0,2*Math.PI,!0),++u;break;case Le.CLOSE_PATH:e.closePath(),++u;break;case Le.CUSTOM:d=$[1],g=$[2];const ue=$[3],de=$[4],k=$[5];W.geometry=ue,W.feature=Z,u in G||(G[u]=[]);const X=G[u];k?k(c,d,g,2,X):(X[0]=c[d],X[1]=c[d+1],X.length=2),h&&(h.zIndex=$[6]),de(X,W),++u;break;case Le.DRAW_IMAGE:d=$[1],g=$[2],T=$[3],y=$[4],w=$[5];let Y=$[6];const le=$[7],ne=$[8],z=$[9],te=$[10];let be=$[11];const Se=$[12];let Re=$[13];E=$[14]||"declutter";const Ae=$[15];if(!T&&$.length>=20){I=$[19],A=$[20],O=$[21],j=$[22];const Ie=this.drawLabelWithPointPlacement_(I,A,O,j);T=Ie.label,$[3]=T;const $e=$[23];y=(Ie.anchorX-$e)*this.pixelRatio,$[4]=y;const Je=$[24];w=(Ie.anchorY-Je)*this.pixelRatio,$[5]=w,Y=T.height,$[6]=Y,Re=T.width,$[13]=Re}let _;$.length>25&&(_=$[25]);let p,m,P;$.length>17?(p=$[16],m=$[17],P=$[18]):(p=Rn,m=!1,P=!1),te&&H?be+=J:!te&&!H&&(be-=J);let D=0;for(;d<g;d+=2){if(_&&_[D++]<Re/this.pixelRatio)continue;const Ie=this.calculateImageOrLabelDimensions_(T.width,T.height,c[d],c[d+1],Re,Y,y,w,ne,z,be,Se,s,p,m||P,Z),$e=[e,t,T,Ie,le,m?U:null,P?V:null];if(l){let Je,He,ot;if(Ae){const nt=g-d;if(!Ae[nt]){Ae[nt]={args:$e,declutterMode:E};continue}const Et=Ae[nt];Je=Et.args,He=Et.declutterMode,delete Ae[nt],ot=gu(Je)}let Rt,vt;if(Je&&(He!=="declutter"||!l.collides(ot))&&(Rt=!0),(E!=="declutter"||!l.collides(Ie.declutterBox))&&(vt=!0),He==="declutter"&&E==="declutter"){const nt=Rt&&vt;Rt=nt,vt=nt}Rt&&(He!=="none"&&l.insert(ot),this.replayImageOrLabel_.apply(this,Je)),vt&&(E!=="none"&&l.insert(Ie.declutterBox),this.replayImageOrLabel_.apply(this,$e))}else this.replayImageOrLabel_.apply(this,$e)}++u;break;case Le.DRAW_CHARS:const C=$[1],N=$[2],ee=$[3],me=$[4];j=$[5];const fe=$[6],ve=$[7],xe=$[8];O=$[9];const Me=$[10];I=$[11],A=$[12];const rt=[$[13],$[13]];E=$[14]||"declutter";const Lt=$[15],ze=this.textStates[A],pt=ze.font,et=[ze.scale[0]*ve,ze.scale[1]*ve];let tt;pt in this.widths_?tt=this.widths_[pt]:(tt={},this.widths_[pt]=tt);const st=bw(c,C,N,2),mt=Math.abs(et[0])*Xc(pt,I,tt);if(me||mt<=st){const Ie=this.textStates[A].textAlign,$e=(st-mt)*ta(I,Ie),Je=ww(c,C,N,2,I,$e,fe,Math.abs(et[0]),Xc,pt,tt,H?0:this.viewRotation_,Lt);e:if(Je){const He=[];let ot,Rt,vt,nt,Et;if(O)for(ot=0,Rt=Je.length;ot<Rt;++ot){Et=Je[ot],vt=Et[4],nt=this.createLabel(vt,A,"",O),y=Et[2]+(et[0]<0?-Me:Me),w=ee*nt.height+(.5-ee)*2*Me*et[1]/et[0]-xe;const wi=this.calculateImageOrLabelDimensions_(nt.width,nt.height,Et[0],Et[1],nt.width,nt.height,y,w,0,0,Et[3],rt,!1,Rn,!1,Z);if(l&&E==="declutter"&&l.collides(wi.declutterBox))break e;He.push([e,t,nt,wi,1,null,null])}if(j)for(ot=0,Rt=Je.length;ot<Rt;++ot){Et=Je[ot],vt=Et[4],nt=this.createLabel(vt,A,j,""),y=Et[2],w=ee*nt.height-xe;const wi=this.calculateImageOrLabelDimensions_(nt.width,nt.height,Et[0],Et[1],nt.width,nt.height,y,w,0,0,Et[3],rt,!1,Rn,!1,Z);if(l&&E==="declutter"&&l.collides(wi.declutterBox))break e;He.push([e,t,nt,wi,1,null,null])}l&&E!=="none"&&l.load(He.map(gu));for(let wi=0,Cp=He.length;wi<Cp;++wi)this.replayImageOrLabel_.apply(this,He[wi])}}++u;break;case Le.END_GEOMETRY:if(o!==void 0){Z=$[1];const Ie=o(Z,q,E);if(Ie)return Ie}++u;break;case Le.FILL:se?K++:this.fill_(e),++u;break;case Le.MOVE_TO_LINE_TO:for(d=$[1],g=$[2],ie=c[d],M=c[d+1],e.moveTo(ie,M),b=ie+.5|0,v=M+.5|0,d+=2;d<g;d+=2)ie=c[d],M=c[d+1],S=ie+.5|0,x=M+.5|0,(d==g-2||S!==b||x!==v)&&(e.lineTo(ie,M),b=S,v=x);++u;break;case Le.SET_FILL_STYLE:U=$,this.alignAndScaleFill_=$[2],K&&(this.fill_(e),K=0,R&&(e.stroke(),R=0)),e.fillStyle=$[1],++u;break;case Le.SET_STROKE_STYLE:V=$,R&&(e.stroke(),R=0),this.setStrokeStyle_(e,$),++u;break;case Le.STROKE:se?R++:e.stroke(),++u;break;default:++u;break}}K&&this.fill_(e),R&&e.stroke()}execute(e,t,n,r,s,o){this.viewRotation_=r,this.execute_(e,t,n,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,n,r,s){return this.viewRotation_=n,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,r,s)}}const Sw=Ew,rr=["Polygon","Circle","LineString","Image","Text","Default"],Od=["Image","Text"],xw=rr.filter(i=>!Od.includes(i));class Tw{constructor(e,t,n,r,s,o,a){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=n,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=li(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,a)}clip(e,t){const n=this.getClipCoords(t);e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(n[2],n[3]),e.lineTo(n[4],n[5]),e.lineTo(n[6],n[7]),e.clip()}createExecutors_(e,t){for(const n in e){let r=this.executorsByZIndex_[n];r===void 0&&(r={},this.executorsByZIndex_[n]=r);const s=e[n];for(const o in s){const a=s[o];r[o]=new Sw(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const n=this.executorsByZIndex_[t];for(let r=0,s=e.length;r<s;++r)if(e[r]in n)return!0}return!1}forEachFeatureAtCoordinate(e,t,n,r,s,o){r=Math.round(r);const a=r*2+1,l=Ni(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-n,-e[0],-e[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=_t(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let u;this.renderBuffer_!==void 0&&(u=Kt(),Gr(u,e),lh(u,t*(this.renderBuffer_+r),u));const f=Rw(r);let d;function g(x,T,I){const A=c.getImageData(0,0,a,a).data;for(let O=0,j=f.length;O<j;O++)if(A[f[O]]>0){if(!o||I==="none"||d!=="Image"&&d!=="Text"||o.includes(x)){const K=(f[O]-3)/4,R=r-K%a,U=r-(K/a|0),V=s(x,T,R*R+U*U);if(V)return V}c.clearRect(0,0,a,a);break}}const y=Object.keys(this.executorsByZIndex_).map(Number);y.sort(Oi);let w,E,b,v,S;for(w=y.length-1;w>=0;--w){const x=y[w].toString();for(b=this.executorsByZIndex_[x],E=rr.length-1;E>=0;--E)if(d=rr[E],v=b[d],v!==void 0&&(S=v.executeHitDetection(c,l,n,g,u),S))return S}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const n=t[0],r=t[1],s=t[2],o=t[3],a=[n,r,n,o,s,o,s,r];return ln(a,0,8,2,e,a),a}isEmpty(){return gr(this.executorsByZIndex_)}execute(e,t,n,r,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?kp:Oi),o=o||rr;const h=rr.length;for(let c=0,u=l.length;c<u;++c){const f=l[c].toString(),d=this.executorsByZIndex_[f];for(let g=0,y=o.length;g<y;++g){const w=o[g],E=d[w];if(E!==void 0){const b=a===null?void 0:E.getZIndexContext(),v=b?b.getContext():e,S=this.maxExtent_&&w!=="Image"&&w!=="Text";if(S&&(v.save(),this.clip(v,n)),!b||w==="Text"||w==="Image"?E.execute(v,t,n,r,s,a):b.pushFunction(x=>E.execute(x,t,n,r,s,a)),S&&v.restore(),b){b.offset();const x=l[c]*h+g;this.deferredZIndexContexts_[x]||(this.deferredZIndexContexts_[x]=[]),this.deferredZIndexContexts_[x].push(b)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Oi);for(let n=0,r=t.length;n<r;++n)e[t[n]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),e[t[n]].length=0}}const ia={};function Rw(i){if(ia[i]!==void 0)return ia[i];const e=i*2+1,t=i*i,n=new Array(t+1);for(let s=0;s<=i;++s)for(let o=0;o<=i;++o){const a=s*s+o*o;if(a>t)break;let l=n[a];l||(l=[],n[a]=l),l.push(((i+s)*e+(i+o))*4+3),s>0&&l.push(((i-s)*e+(i+o))*4+3),o>0&&(l.push(((i+s)*e+(i-o))*4+3),s>0&&l.push(((i-s)*e+(i-o))*4+3))}const r=[];for(let s=0,o=n.length;s<o;++s)n[s]&&r.push(...n[s]);return ia[i]=r,r}const Iw=Tw;class Cw extends Ld{constructor(e,t,n,r,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=n,this.transform_=r,this.transformRotation_=r?sh(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=li()}drawImages_(e,t,n,r){if(!this.image_)return;const s=ln(e,t,n,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=s.length;c<u;c+=2){const f=s[c]-this.imageAnchorX_,d=s[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=f+this.imageAnchorX_,y=d+this.imageAnchorY_;Ni(a,g,y,1,1,h,-g,-y),o.save(),o.transform.apply(o,a),o.translate(g,y),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,d,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,n,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=ln(e,t,n,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<n;t+=r){const l=s[t]+this.textOffsetX_,h=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(e,t,n,r,s){const o=this.context_,a=ln(e,t,n,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),n}drawRings_(e,t,n,r){for(let s=0,o=n.length;s<o;++s)t=this.moveToLineTo_(e,t,n[s],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Wt(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=q_(e,this.transform_,this.pixelCoordinates_),n=t[2]-t[0],r=t[3]-t[1],s=Math.sqrt(n*n+r*r),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const n=t.getGeometryFunction()(e);n&&(this.setStyle(t),this.drawGeometry(n))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let n=0,r=t.length;n<r;++n)this.drawGeometry(t[n])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),n=e.getStride();this.image_&&this.drawImages_(t,0,t.length,n),this.text_!==""&&this.drawText_(t,0,t.length,n)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Wt(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(n,0,n.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(Wt(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,r=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();n.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(r,s,o[l],a,!1);n.stroke()}if(this.text_!==""){const n=e.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Wt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Wt(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,n=e.getOrientedFlatCoordinates();let r=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];r=this.drawRings_(n,r,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,n=this.contextFillState_;n?n.fillStyle!=e.fillStyle&&(n.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=e.lineCap&&(n.lineCap=e.lineCap,t.lineCap=e.lineCap),un(n.lineDash,e.lineDash)||t.setLineDash(n.lineDash=e.lineDash),n.lineDashOffset!=e.lineDashOffset&&(n.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),n.lineJoin!=e.lineJoin&&(n.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),n.lineWidth!=e.lineWidth&&(n.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),n.miterLimit!=e.miterLimit&&(n.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),n.strokeStyle!=e.strokeStyle&&(n.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,n=this.contextTextState_,r=e.textAlign?e.textAlign:es;n?(n.font!=e.font&&(n.font=e.font,t.font=e.font),n.textAlign!=r&&(n.textAlign=r,t.textAlign=r),n.textBaseline!=e.textBaseline&&(n.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const n=e.getColor();this.fillState_={fillStyle:pi(n||Ut)}}if(!t)this.strokeState_=null;else{const n=t.getColor(),r=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),h=t.getMiterLimit(),c=s||ki;this.strokeState_={lineCap:r!==void 0?r:yr,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(o||Di)*this.pixelRatio_,lineJoin:a!==void 0?a:wr,lineWidth:(l!==void 0?l:ts)*this.pixelRatio_,miterLimit:h!==void 0?h:Jr,strokeStyle:pi(n||Qr)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const n=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*n,this.imageAnchorY_=r[1]*n,this.imageHeight_=t[1]*n,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/n,o[1]*this.pixelRatio_/n],this.imageWidth_=t[0]*n}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const d=t.getColor();this.textFillState_={fillStyle:pi(d||Ut)}}const n=e.getStroke();if(!n)this.textStrokeState_=null;else{const d=n.getColor(),g=n.getLineCap(),y=n.getLineDash(),w=n.getLineDashOffset(),E=n.getLineJoin(),b=n.getWidth(),v=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:yr,lineDash:y||ki,lineDashOffset:w||Di,lineJoin:E!==void 0?E:wr,lineWidth:b!==void 0?b:ts,miterLimit:v!==void 0?v:Jr,strokeStyle:pi(d||Qr)}}const r=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),h=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),f=e.getTextBaseline();this.textState_={font:r!==void 0?r:Qf,textAlign:u!==void 0?u:es,textBaseline:f!==void 0?f:Vs},this.text_=c!==void 0?Array.isArray(c)?c.reduce((d,g,y)=>d+=y%2?" ":g,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Aw=Cw,di=.5;function Mw(i,e,t,n,r,s,o,a,l){const h=l?yh(r):r,c=i[0]*di,u=i[1]*di,f=_t(c,u);f.imageSmoothingEnabled=!1;const d=f.canvas,g=new Aw(f,di,r,null,o,a,l?wo(L_(),l):null),y=t.length,w=Math.floor((256*256*256-1)/y),E={};for(let v=1;v<=y;++v){const S=t[v-1],x=S.getStyleFunction()||n;if(!x)continue;let T=x(S,s);if(!T)continue;Array.isArray(T)||(T=[T]);const A=(v*w).toString(16).padStart(7,"#00000");for(let O=0,j=T.length;O<j;++O){const K=T[O],R=K.getGeometryFunction()(S);if(!R||!Wt(h,R.getExtent()))continue;const U=K.clone(),V=U.getFill();V&&V.setColor(A);const G=U.getStroke();G&&(G.setColor(A),G.setLineDash(null)),U.setText(void 0);const J=K.getImage();if(J){const Z=J.getImageSize();if(!Z)continue;const ie=_t(Z[0],Z[1],void 0,{alpha:!1}),M=ie.canvas;ie.fillStyle=A,ie.fillRect(0,0,M.width,M.height),U.setImage(new xo({img:M,anchor:J.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:J.getOrigin(),opacity:1,size:J.getSize(),scale:J.getScale(),rotation:J.getRotation(),rotateWithView:J.getRotateWithView()}))}const H=U.getZIndex()||0;let W=E[H];W||(W={},E[H]=W,W.Polygon=[],W.Circle=[],W.LineString=[],W.Point=[]);const se=R.getType();if(se==="GeometryCollection"){const Z=R.getGeometriesArrayRecursive();for(let ie=0,M=Z.length;ie<M;++ie){const q=Z[ie];W[q.getType().replace("Multi","")].push(q,U)}}else W[se.replace("Multi","")].push(R,U)}}const b=Object.keys(E).map(Number).sort(Oi);for(let v=0,S=b.length;v<S;++v){const x=E[b[v]];for(const T in x){const I=x[T];for(let A=0,O=I.length;A<O;A+=2){g.setStyle(I[A+1]);for(let j=0,K=e.length;j<K;++j)g.setTransform(e[j]),g.drawGeometry(I[A])}}}return f.getImageData(0,0,d.width,d.height)}function Pw(i,e,t){const n=[];if(t){const r=Math.floor(Math.round(i[0])*di),s=Math.floor(Math.round(i[1])*di),o=(gt(r,0,t.width-1)+gt(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),u=Math.floor((256*256*256-1)/e.length);c&&c%u===0&&n.push(e[c/u-1])}return n}const Lw=.5,kd={Point:jw,LineString:Nw,Polygon:Gw,MultiPoint:Ww,MultiLineString:Bw,MultiPolygon:Uw,GeometryCollection:Fw,Circle:kw};function Ow(i,e){return parseInt(Xe(i),10)-parseInt(Xe(e),10)}function _u(i,e){const t=Dd(i,e);return t*t}function Dd(i,e){return Lw*i/e}function kw(i,e,t,n,r){const s=t.getFill(),o=t.getStroke();if(s||o){const l=i.getBuilder(t.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(e,n,r)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n)}}function mu(i,e,t,n,r,s,o,a){const l=[],h=t.getImage();if(h){let f=!0;const d=h.getImageState();d==Ne.LOADED||d==Ne.ERROR?f=!1:d==Ne.IDLE&&h.load(),f&&l.push(h.ready())}const c=t.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>r(null)),Dw(i,e,t,n,s,o,a),u}function Dw(i,e,t,n,r,s,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(n,r);if(t.getRenderer())Fd(i,l,t,e,o);else{const c=kd[l.getType()];c(i,l,t,e,o,s)}}function Fd(i,e,t,n,r){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)Fd(i,o[a],t,n,r);return}i.getBuilder(t.getZIndex(),"Default").drawCustom(e,n,t.getRenderer(),t.getHitDetectionRenderer(),r)}function Fw(i,e,t,n,r,s){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=kd[o[a].getType()];h(i,o[a],t,n,r,s)}}function Nw(i,e,t,n,r){const s=t.getStroke();if(s){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,n,r)}const o=t.getText();if(o&&o.getText()){const a=i.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n,r)}}function Bw(i,e,t,n,r){const s=t.getStroke();if(s){const a=i.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,n,r)}const o=t.getText();if(o&&o.getText()){const a=i.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,n,r)}}function Uw(i,e,t,n,r){const s=t.getFill(),o=t.getStroke();if(o||s){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,n,r)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n,r)}}function jw(i,e,t,n,r,s){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),h=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=Ne.LOADED)return;const c=i.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(e,n,r)}if(l){const c=i.getBuilder(t.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(e,n,r)}}function Ww(i,e,t,n,r,s){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),h=l&&l.getText(),c=s&&a&&h?{}:void 0;if(a){if(o.getImageState()!=Ne.LOADED)return;const u=i.getBuilder(t.getZIndex(),"Image");u.setImageStyle(o,c),u.drawMultiPoint(e,n,r)}if(h){const u=i.getBuilder(t.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(e,n,r)}}function Gw(i,e,t,n,r){const s=t.getFill(),o=t.getStroke();if(s||o){const l=i.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,n,r)}const a=t.getText();if(a&&a.getText()){const l=i.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,n,r)}}class zw extends vd{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Kt(),this.wrappedRenderedExtent_=Kt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,n){const r=t.extent,s=t.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,c=l.getExtent(),u=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),d=t.pixelRatio,g=t.viewHints,y=!(g[Dt.ANIMATING]||g[Dt.INTERACTING]),w=this.context,E=Math.round(Ue(r)/a*d),b=Math.round(wt(r)/a*d),v=u.getWrapX()&&l.canWrapX(),S=v?Ue(c):null,x=v?Math.ceil((r[2]-c[2])/S)+1:1;let T=v?Math.floor((r[0]-c[0])/S):0;do{let I=this.getRenderTransform(o,a,0,d,E,b,T*S);t.declutter&&(I=I.slice(0)),e.execute(w,[w.canvas.width,w.canvas.height],I,h,y,n===void 0?rr:n?Od:xw,n?f&&t.declutter[f]:void 0)}while(++T<x)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=_t(this.context.canvas.width,this.context.canvas.height,nu))}resetDrawContext_(){if(this.opacity_!==1){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,vo(this.context),nu.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex];this.opacity_=n.opacity;const r=e.viewState;this.prepareContainer(e,t);const s=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Jt.PRERENDER)||this.getLayer().hasListener(Jt.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(s,e),r.projection,this.clipped_=!1,a&&n.extent&&this.clipping){const l=sn(n.extent);a=Wt(l,e.extent),this.clipped_=a&&!ir(l,e.extent),this.clipped_&&this.clipUnrotated(s,e,l)}return a&&this.renderWorlds(o,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&s.restore(),this.postRender(s,e),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),r=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*di,f=n[1]*di;c.push(this.getRenderTransform(r,s,o,di,u,f,0).slice());const d=h.getSource(),g=a.getExtent();if(d.getWrapX()&&a.canWrapX()&&!ir(g,l)){let y=l[0];const w=Ue(g);let E=0,b;for(;y<g[0];)--E,b=w*E,c.push(this.getRenderTransform(r,s,o,di,u,f,b).slice()),y+=w;for(E=0,y=l[2];y>g[2];)++E,b=w*E,c.push(this.getRenderTransform(r,s,o,di,u,f,b).slice()),y-=w}this.hitDetectionImageData_=Mw(n,c,this.renderedFeatures_,h.getStyleFunction(),l,s,o,_u(s,this.renderedPixelRatio_),null)}t(Pw(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,n,r,s){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),h={},c=function(f,d,g){const y=Xe(f),w=h[y];if(w){if(w!==!0&&g<w.distanceSq){if(g===0)return h[y]=!0,s.splice(s.lastIndexOf(w),1),r(f,l,d);w.geometry=d,w.distanceSq=g}}else{if(g===0)return h[y]=!0,r(f,l,d);s.push(h[y]={feature:f,layer:l,geometry:d,distanceSq:g,callback:r})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,o,a,n,c,u?t.declutter[u].all().map(f=>f.value):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),n=t.getSource();if(!n)return!1;const r=e.viewHints[Dt.ANIMATING],s=e.viewHints[Dt.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,h=e.viewState,c=h.projection,u=h.resolution,f=e.pixelRatio,d=t.getRevision(),g=t.getRenderBuffer();let y=t.getRenderOrder();y===void 0&&(y=Ow);const w=h.center.slice(),E=lh(l,g*u),b=E.slice(),v=[E.slice()],S=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!ir(S,e.extent)){const V=Ue(S),G=Math.max(Ue(E)/2,V);E[0]=S[0]-G,E[2]=S[2]+G,Ef(w,c);const J=vf(v[0],c);J[0]<S[0]&&J[2]<S[2]?v.push([J[0]+V,J[1],J[2]+V,J[3]]):J[0]>S[0]&&J[2]>S[2]&&v.push([J[0]-V,J[1],J[2]-V,J[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==d&&this.renderedRenderOrder_==y&&this.renderedFrameDeclutter_===!!e.declutter&&ir(this.wrappedRenderedExtent_,E))return un(this.renderedExtent_,b)||(this.hitDetectionImageData_=null,this.renderedExtent_=b),this.renderedCenter_=w,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const x=new yw(Dd(u,f),E,u,f);let T;for(let V=0,G=v.length;V<G;++V)n.loadFeatures(v[V],u,c);const I=_u(u,f);let A=!0;const O=(V,G)=>{let J;const H=V.getStyleFunction()||t.getStyleFunction();if(H&&(J=H(V,u)),J){const W=this.renderFeature(V,I,J,x,T,this.getLayer().getDeclutter(),G);A=A&&!W}},j=yh(E),K=n.getFeaturesInExtent(j);y&&K.sort(y);for(let V=0,G=K.length;V<G;++V)O(K[V],V);this.renderedFeatures_=K,this.ready=A;const R=x.finish(),U=new Iw(E,u,f,n.getOverlaps(),R,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=d,this.renderedRenderOrder_=y,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=b,this.wrappedRenderedExtent_=E,this.renderedCenter_=w,this.renderedProjection_=c,this.renderedPixelRatio_=f,this.replayGroup_=U,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,n,r,s,o,a){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=mu(r,e,n[h],t,this.boundHandleStyleImageChange_,s,o,a)||l;else l=mu(r,e,n,t,this.boundHandleStyleImageChange_,s,o,a);return l}}const Yw=zw;class Xw extends fd{constructor(e){super(e)}createRenderer(){return new Yw(this)}}const $w=Xw;class Vw{constructor(e){this.rbush_=new zf(e),this.items_={}}insert(e,t){const n={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(n),this.items_[Xe(t)]=n}load(e,t){const n=new Array(t.length);for(let r=0,s=t.length;r<s;r++){const o=e[r],a=t[r],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};n[r]=l,this.items_[Xe(a)]=l}this.rbush_.load(n)}remove(e){const t=Xe(e),n=this.items_[t];return delete this.items_[t],this.rbush_.remove(n)!==null}update(e,t){const n=this.items_[Xe(t)],r=[n.minX,n.minY,n.maxX,n.maxY];Kr(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(r){return r.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let n;for(let r=0,s=e.length;r<s;r++)if(n=t(e[r]),n)return n;return n}isEmpty(){return gr(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return hn(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const yu=Vw;class Qh extends yi{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new Qh(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const n=this.getStyle();return n&&e.setStyle(n),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(it(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=je(e,ke.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?Kw(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Kw(i){if(typeof i=="function")return i;let e;return Array.isArray(i)?e=i:(Ge(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[i]),function(){return e}}const Nd=Qh;function wu(i,e,t,n,r,s,o){let a,l;const h=(t-e)/n;if(h===1)a=e;else if(h===2)a=e,l=r;else if(h!==0){let c=i[e],u=i[e+1],f=0;const d=[0];for(let w=e+n;w<t;w+=n){const E=i[w],b=i[w+1];f+=Math.sqrt((E-c)*(E-c)+(b-u)*(b-u)),d.push(f),c=E,u=b}const g=r*f,y=Op(d,g);y<0?(l=(g-d[-y-2])/(d[-y-1]-d[-y-2]),a=e+(-y-2)*n):a=e+y*n}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?i[a+c]:Zt(i[a+c],i[a+n+c],l);return s}function Hw(i,e,t,n){const r=[];let s=Kt();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=hh(i,e,l[0],n),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return r}const bu=li();class br{constructor(e,t,n,r,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?mf(this.flatCoordinates_):hh(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=On(this.getExtent());this.flatInteriorPoints_=Rh(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=cm(this.flatCoordinates_,this.ends_),t=Hw(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=sm(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=wu(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const n=this.ends_;for(let r=0,s=n.length;r<s;++r){const o=n[r],a=wu(e,t,o,2,.5);rh(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=Yt(e);const t=e.getExtent(),n=e.getWorldExtent();if(t&&n){const r=wt(n)/wt(t);Ni(bu,n[0],n[3],r,-r,0,0,0),ln(this.flatCoordinates_,0,this.flatCoordinates_.length,2,bu,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new br(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=uf((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const n=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":n.length=Sh(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,n,0),r=[n.length];break;case"MultiLineString":r=[],n.length=tm(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,n,0,r);break;case"Polygon":r=[],n.length=Nf(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),n,0,r);break}return r&&(this.simplifiedGeometry_=new br(this.type_,n,r,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}br.prototype.getFlatCoordinates=br.prototype.getOrientedFlatCoordinates;const Kn=br,Ht={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function qw(i,e){return[[-1/0,-1/0,1/0,1/0]]}let Zw=!1;function Jw(i,e,t,n,r,s,o){const a=new XMLHttpRequest;a.open("GET",typeof i=="function"?i(t,n,r):i,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=Zw,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=e.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?s(e.readFeatures(c,{extent:t,featureProjection:r}),e.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function vu(i,e){return function(t,n,r,s,o){const a=this;Jw(i,e,t,n,r,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||dr)}}class qi extends Wi{constructor(e,t,n){super(e),this.feature=t,this.features=n}}class Qw extends Cd{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=dr,this.format_=e.format||null,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Ge(this.format_,"`format` must be set when `url` is set"),this.loader_=vu(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:qw;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new yu:null,this.loadedExtentsRtree_=new yu,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,r;Array.isArray(e.features)?r=e.features:e.features&&(n=e.features,r=n.getArray()),!t&&n===void 0&&(n=new gi(r)),r!==void 0&&this.addFeaturesInternal(r),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Xe(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const n=e.getGeometry();if(n){const r=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new qi(Ht.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Kn||(this.featureChangeKeys_[e]=[je(t,ke.CHANGE,this.handleFeatureChange_,this),je(t,fr.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let n=!0;if(t.getId()!==void 0){const r=String(t.getId());if(!(r in this.idIndex_))this.idIndex_[r]=t;else if(t instanceof Kn){const s=this.idIndex_[r];s instanceof Kn?Array.isArray(s)?s.push(t):this.idIndex_[r]=[s,t]:n=!1}else n=!1}return n&&(Ge(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),n}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],n=[],r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s],l=Xe(a);this.addToIndex_(l,a)&&n.push(a)}for(let s=0,o=n.length;s<o;s++){const a=n[s],l=Xe(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();t.push(c),r.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(Ht.ADDFEATURE))for(let s=0,o=n.length;s<o;s++)this.dispatchEvent(new qi(Ht.ADDFEATURE,n[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ht.ADDFEATURE,function(n){t||(t=!0,e.push(n.feature),t=!1)}),this.addEventListener(Ht.REMOVEFEATURE,function(n){t||(t=!0,e.remove(n.feature),t=!1)}),e.addEventListener(Bt.ADD,n=>{t||(t=!0,this.addFeature(n.element),t=!1)}),e.addEventListener(Bt.REMOVE,n=>{t||(t=!0,this.removeFeature(n.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(it);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new qi(Ht.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const n=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(n,function(r){const s=r.getGeometry();if(s instanceof Kn||s.intersectsCoordinate(e))return t(r)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(n){const r=n.getGeometry();if(r instanceof Kn||r.intersectsExtent(e)){const s=t(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),gr(this.nullGeometryFeatures_)||rh(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(n){t.push(n)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=ch(e,t);return[].concat(...r.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const n=e[0],r=e[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Xr,this.featuresRtree_.forEachInExtent(l,function(h){if(t(h)){const c=h.getGeometry(),u=a;if(a=c instanceof Kn?0:c.closestPointXY(n,r,o,a),a<u){s=h;const f=Math.sqrt(a);l[0]=n-f,l[1]=r-f,l[2]=n+f,l[3]=r+f}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,n=Xe(t),r=t.getGeometry();if(!r)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[n]=t);else{const o=r.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const s=t.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[n]=t;this.changed(),this.dispatchEvent(new qi(Ht.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Xe(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&gr(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,n){const r=this.loadedExtentsRtree_,s=this.strategy_(e,t,n);for(let o=0,a=s.length;o<a;++o){const l=s[o];r.forEachInExtent(l,function(c){return ir(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new qi(Ht.FEATURESLOADSTART)),this.loader_.call(this,l,t,n,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new qi(Ht.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new qi(Ht.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,n=t.forEachInExtent(e,function(r){if(Kr(r.extent,e))return r});n&&t.remove(n)}removeFeatures(e){let t=!1;for(let n=0,r=e.length;n<r;++n)t=this.removeFeatureInternal(e[n])||t;t&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Xe(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const n=this.featureChangeKeys_[t];n==null||n.forEach(it),delete this.featureChangeKeys_[t];const r=e.getId();if(r!==void 0){const s=r.toString(),o=this.idIndex_[s];o===e?delete this.idIndex_[s]:Array.isArray(o)&&(o.splice(o.indexOf(e),1),o.length===1&&(this.idIndex_[s]=o[0]))}return delete this.uidIndex_[t],this.hasListener(Ht.REMOVEFEATURE)&&this.dispatchEvent(new qi(Ht.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){Ge(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(vu(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}}const eb=Qw;var ec=Object.defineProperty,tb=Object.getOwnPropertyDescriptor,ib=Object.getOwnPropertyNames,nb=Object.prototype.hasOwnProperty,At=(i,e)=>()=>(i&&(e=i(i=0)),e),Ee=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),Fn=(i,e)=>{for(var t in e)ec(i,t,{get:e[t],enumerable:!0})},rb=(i,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ib(e))!nb.call(i,r)&&r!==t&&ec(i,r,{get:()=>e[r],enumerable:!(n=tb(e,r))||n.enumerable});return i},Qe=i=>rb(ec({},"__esModule",{value:!0}),i),ge=At(()=>{}),Ve={};Fn(Ve,{_debugEnd:()=>fl,_debugProcess:()=>ul,_events:()=>Il,_eventsCount:()=>Cl,_exiting:()=>Za,_fatalExceptions:()=>ll,_getActiveHandles:()=>Yd,_getActiveRequests:()=>zd,_kill:()=>el,_linkedBinding:()=>Wd,_maxListeners:()=>Rl,_preload_modules:()=>xl,_rawDebug:()=>Ka,_startProfilerIdleNotifier:()=>dl,_stopProfilerIdleNotifier:()=>gl,_tickCallback:()=>cl,abort:()=>yl,addListener:()=>Al,allowedNodeEnvironmentFlags:()=>ol,arch:()=>Da,argv:()=>Ba,argv0:()=>Sl,assert:()=>Xd,binding:()=>za,chdir:()=>$a,config:()=>Ja,cpuUsage:()=>Ur,cwd:()=>Xa,debugPort:()=>El,default:()=>ic,dlopen:()=>Gd,domain:()=>qa,emit:()=>kl,emitWarning:()=>Ga,env:()=>Na,execArgv:()=>Ua,execPath:()=>vl,exit:()=>rl,features:()=>al,hasUncaughtExceptionCaptureCallback:()=>$d,hrtime:()=>Ps,kill:()=>nl,listeners:()=>Kd,memoryUsage:()=>il,moduleLoadList:()=>Ha,nextTick:()=>Ud,off:()=>Pl,on:()=>Ti,once:()=>Ml,openStdin:()=>sl,pid:()=>wl,platform:()=>Fa,ppid:()=>bl,prependListener:()=>Dl,prependOnceListener:()=>Fl,reallyExit:()=>Qa,release:()=>Va,removeAllListeners:()=>Ol,removeListener:()=>Ll,resourceUsage:()=>tl,setSourceMapsEnabled:()=>Tl,setUncaughtExceptionCaptureCallback:()=>hl,stderr:()=>_l,stdin:()=>ml,stdout:()=>pl,title:()=>ka,umask:()=>Ya,uptime:()=>Vd,version:()=>ja,versions:()=>Wa});function tc(i){throw new Error("Node.js process "+i+" is not supported by JSPM core outside of Node.js")}function sb(){!Mn||!Cn||(Mn=!1,Cn.length?_i=Cn.concat(_i):zr=-1,_i.length&&Bd())}function Bd(){if(!Mn){var i=setTimeout(sb,0);Mn=!0;for(var e=_i.length;e;){for(Cn=_i,_i=[];++zr<e;)Cn&&Cn[zr].run();zr=-1,e=_i.length}Cn=null,Mn=!1,clearTimeout(i)}}function Ud(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];_i.push(new jd(i,e)),_i.length===1&&!Mn&&setTimeout(Bd,0)}function jd(i,e){this.fun=i,this.array=e}function Ot(){}function Wd(i){tc("_linkedBinding")}function Gd(i){tc("dlopen")}function zd(){return[]}function Yd(){return[]}function Xd(i,e){if(!i)throw new Error(e||"assertion error")}function $d(){return!1}function Vd(){return Mi.now()/1e3}function Ps(i){var e=Math.floor((Date.now()-Mi.now())*.001),t=Mi.now()*.001,n=Math.floor(t)+e,r=Math.floor(t%1*1e9);return i&&(n=n-i[0],r=r-i[1],r<0&&(n--,r+=Ls)),[n,r]}function Ti(){return ic}function Kd(i){return[]}var _i,Mn,Cn,zr,ka,Da,Fa,Na,Ba,Ua,ja,Wa,Ga,za,Ya,Xa,$a,Va,Ka,Ha,qa,Za,Ja,Qa,el,Ur,tl,il,nl,rl,sl,ol,al,ll,hl,cl,ul,fl,dl,gl,pl,_l,ml,yl,wl,bl,vl,El,Sl,xl,Tl,Mi,na,Ls,Rl,Il,Cl,Al,Ml,Pl,Ll,Ol,kl,Dl,Fl,ic,ob=At(()=>{ge(),_e(),pe(),_i=[],Mn=!1,zr=-1,jd.prototype.run=function(){this.fun.apply(null,this.array)},ka="browser",Da="x64",Fa="browser",Na={PATH:"/usr/bin",LANG:navigator.language+".UTF-8",PWD:"/",HOME:"/home",TMP:"/tmp"},Ba=["/usr/bin/node"],Ua=[],ja="v16.8.0",Wa={},Ga=function(i,e){console.warn((e?e+": ":"")+i)},za=function(i){tc("binding")},Ya=function(i){return 0},Xa=function(){return"/"},$a=function(i){},Va={name:"node",sourceUrl:"",headersUrl:"",libUrl:""},Ka=Ot,Ha=[],qa={},Za=!1,Ja={},Qa=Ot,el=Ot,Ur=function(){return{}},tl=Ur,il=Ur,nl=Ot,rl=Ot,sl=Ot,ol={},al={inspector:!1,debug:!1,uv:!1,ipv6:!1,tls_alpn:!1,tls_sni:!1,tls_ocsp:!1,tls:!1,cached_builtins:!0},ll=Ot,hl=Ot,cl=Ot,ul=Ot,fl=Ot,dl=Ot,gl=Ot,pl=void 0,_l=void 0,ml=void 0,yl=Ot,wl=2,bl=1,vl="/bin/usr/node",El=9229,Sl="node",xl=[],Tl=Ot,Mi={now:typeof performance<"u"?performance.now.bind(performance):void 0,timing:typeof performance<"u"?performance.timing:void 0},Mi.now===void 0&&(na=Date.now(),Mi.timing&&Mi.timing.navigationStart&&(na=Mi.timing.navigationStart),Mi.now=()=>Date.now()-na),Ls=1e9,Ps.bigint=function(i){var e=Ps(i);return typeof BigInt>"u"?e[0]*Ls+e[1]:BigInt(e[0]*Ls)+BigInt(e[1])},Rl=10,Il={},Cl=0,Al=Ti,Ml=Ti,Pl=Ti,Ll=Ti,Ol=Ti,kl=Ot,Dl=Ti,Fl=Ti,ic={version:ja,versions:Wa,arch:Da,platform:Fa,release:Va,_rawDebug:Ka,moduleLoadList:Ha,binding:za,_linkedBinding:Wd,_events:Il,_eventsCount:Cl,_maxListeners:Rl,on:Ti,addListener:Al,once:Ml,off:Pl,removeListener:Ll,removeAllListeners:Ol,emit:kl,prependListener:Dl,prependOnceListener:Fl,listeners:Kd,domain:qa,_exiting:Za,config:Ja,dlopen:Gd,uptime:Vd,_getActiveRequests:zd,_getActiveHandles:Yd,reallyExit:Qa,_kill:el,cpuUsage:Ur,resourceUsage:tl,memoryUsage:il,kill:nl,exit:rl,openStdin:sl,allowedNodeEnvironmentFlags:ol,assert:Xd,features:al,_fatalExceptions:ll,setUncaughtExceptionCaptureCallback:hl,hasUncaughtExceptionCaptureCallback:$d,emitWarning:Ga,nextTick:Ud,_tickCallback:cl,_debugProcess:ul,_debugEnd:fl,_startProfilerIdleNotifier:dl,_stopProfilerIdleNotifier:gl,stdout:pl,stdin:ml,stderr:_l,abort:yl,umask:Ya,chdir:$a,cwd:Xa,env:Na,title:ka,argv:Ba,execArgv:Ua,pid:wl,ppid:bl,execPath:vl,debugPort:El,hrtime:Ps,argv0:Sl,_preload_modules:xl,setSourceMapsEnabled:Tl}}),pe=At(()=>{ob()}),Mt={};Fn(Mt,{Buffer:()=>to,INSPECT_MAX_BYTES:()=>Hd,default:()=>Ri,kMaxLength:()=>qd});function ab(){if(Nl)return er;Nl=!0,er.byteLength=a,er.toByteArray=h,er.fromByteArray=f;for(var i=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=0,s=n.length;r<s;++r)i[r]=n[r],e[n.charCodeAt(r)]=r;e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63;function o(d){var g=d.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var y=d.indexOf("=");y===-1&&(y=g);var w=y===g?0:4-y%4;return[y,w]}function a(d){var g=o(d),y=g[0],w=g[1];return(y+w)*3/4-w}function l(d,g,y){return(g+y)*3/4-y}function h(d){var g,y=o(d),w=y[0],E=y[1],b=new t(l(d,w,E)),v=0,S=E>0?w-4:w,x;for(x=0;x<S;x+=4)g=e[d.charCodeAt(x)]<<18|e[d.charCodeAt(x+1)]<<12|e[d.charCodeAt(x+2)]<<6|e[d.charCodeAt(x+3)],b[v++]=g>>16&255,b[v++]=g>>8&255,b[v++]=g&255;return E===2&&(g=e[d.charCodeAt(x)]<<2|e[d.charCodeAt(x+1)]>>4,b[v++]=g&255),E===1&&(g=e[d.charCodeAt(x)]<<10|e[d.charCodeAt(x+1)]<<4|e[d.charCodeAt(x+2)]>>2,b[v++]=g>>8&255,b[v++]=g&255),b}function c(d){return i[d>>18&63]+i[d>>12&63]+i[d>>6&63]+i[d&63]}function u(d,g,y){for(var w,E=[],b=g;b<y;b+=3)w=(d[b]<<16&16711680)+(d[b+1]<<8&65280)+(d[b+2]&255),E.push(c(w));return E.join("")}function f(d){for(var g,y=d.length,w=y%3,E=[],b=16383,v=0,S=y-w;v<S;v+=b)E.push(u(d,v,v+b>S?S:v+b));return w===1?(g=d[y-1],E.push(i[g>>2]+i[g<<4&63]+"==")):w===2&&(g=(d[y-2]<<8)+d[y-1],E.push(i[g>>10]+i[g>>4&63]+i[g<<2&63]+"=")),E.join("")}return er}function lb(){return Bl?jr:(Bl=!0,jr.read=function(i,e,t,n,r){var s,o,a=r*8-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=t?r-1:0,f=t?-1:1,d=i[e+u];for(u+=f,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=s*256+i[e+u],u+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=o*256+i[e+u],u+=f,c-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-h}return(d?-1:1)*o*Math.pow(2,s-n)},jr.write=function(i,e,t,n,r,s){var o,a,l,h=s*8-r-1,c=(1<<h)-1,u=c>>1,f=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,g=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+u>=1?e+=f/l:e+=f*Math.pow(2,1-u),e*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*l-1)*Math.pow(2,r),o=o+u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;i[t+d]=a&255,d+=g,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;i[t+d]=o&255,d+=g,o/=256,h-=8);i[t+d-g]|=y*128},jr)}function hb(){if(Ul)return Qi;Ul=!0;let i=ab(),e=lb(),t=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;Qi.Buffer=o,Qi.SlowBuffer=E,Qi.INSPECT_MAX_BYTES=50;let n=2147483647;Qi.kMaxLength=n,o.TYPED_ARRAY_SUPPORT=r(),!o.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function r(){try{let _=new Uint8Array(1),p={foo:function(){return 42}};return Object.setPrototypeOf(p,Uint8Array.prototype),Object.setPrototypeOf(_,p),_.foo()===42}catch{return!1}}Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}});function s(_){if(_>n)throw new RangeError('The value "'+_+'" is invalid for option "size"');let p=new Uint8Array(_);return Object.setPrototypeOf(p,o.prototype),p}function o(_,p,m){if(typeof _=="number"){if(typeof p=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return c(_)}return a(_,p,m)}o.poolSize=8192;function a(_,p,m){if(typeof _=="string")return u(_,p);if(ArrayBuffer.isView(_))return d(_);if(_==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _);if(te(_,ArrayBuffer)||_&&te(_.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(te(_,SharedArrayBuffer)||_&&te(_.buffer,SharedArrayBuffer)))return g(_,p,m);if(typeof _=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let P=_.valueOf&&_.valueOf();if(P!=null&&P!==_)return o.from(P,p,m);let D=y(_);if(D)return D;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof _[Symbol.toPrimitive]=="function")return o.from(_[Symbol.toPrimitive]("string"),p,m);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof _)}o.from=function(_,p,m){return a(_,p,m)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array);function l(_){if(typeof _!="number")throw new TypeError('"size" argument must be of type number');if(_<0)throw new RangeError('The value "'+_+'" is invalid for option "size"')}function h(_,p,m){return l(_),_<=0?s(_):p!==void 0?typeof m=="string"?s(_).fill(p,m):s(_).fill(p):s(_)}o.alloc=function(_,p,m){return h(_,p,m)};function c(_){return l(_),s(_<0?0:w(_)|0)}o.allocUnsafe=function(_){return c(_)},o.allocUnsafeSlow=function(_){return c(_)};function u(_,p){if((typeof p!="string"||p==="")&&(p="utf8"),!o.isEncoding(p))throw new TypeError("Unknown encoding: "+p);let m=b(_,p)|0,P=s(m),D=P.write(_,p);return D!==m&&(P=P.slice(0,D)),P}function f(_){let p=_.length<0?0:w(_.length)|0,m=s(p);for(let P=0;P<p;P+=1)m[P]=_[P]&255;return m}function d(_){if(te(_,Uint8Array)){let p=new Uint8Array(_);return g(p.buffer,p.byteOffset,p.byteLength)}return f(_)}function g(_,p,m){if(p<0||_.byteLength<p)throw new RangeError('"offset" is outside of buffer bounds');if(_.byteLength<p+(m||0))throw new RangeError('"length" is outside of buffer bounds');let P;return p===void 0&&m===void 0?P=new Uint8Array(_):m===void 0?P=new Uint8Array(_,p):P=new Uint8Array(_,p,m),Object.setPrototypeOf(P,o.prototype),P}function y(_){if(o.isBuffer(_)){let p=w(_.length)|0,m=s(p);return m.length===0||_.copy(m,0,0,p),m}if(_.length!==void 0)return typeof _.length!="number"||be(_.length)?s(0):f(_);if(_.type==="Buffer"&&Array.isArray(_.data))return f(_.data)}function w(_){if(_>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return _|0}function E(_){return+_!=_&&(_=0),o.alloc(+_)}o.isBuffer=function(_){return _!=null&&_._isBuffer===!0&&_!==o.prototype},o.compare=function(_,p){if(te(_,Uint8Array)&&(_=o.from(_,_.offset,_.byteLength)),te(p,Uint8Array)&&(p=o.from(p,p.offset,p.byteLength)),!o.isBuffer(_)||!o.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(_===p)return 0;let m=_.length,P=p.length;for(let D=0,C=Math.min(m,P);D<C;++D)if(_[D]!==p[D]){m=_[D],P=p[D];break}return m<P?-1:P<m?1:0},o.isEncoding=function(_){switch(String(_).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(_,p){if(!Array.isArray(_))throw new TypeError('"list" argument must be an Array of Buffers');if(_.length===0)return o.alloc(0);let m;if(p===void 0)for(p=0,m=0;m<_.length;++m)p+=_[m].length;let P=o.allocUnsafe(p),D=0;for(m=0;m<_.length;++m){let C=_[m];if(te(C,Uint8Array))D+C.length>P.length?(o.isBuffer(C)||(C=o.from(C)),C.copy(P,D)):Uint8Array.prototype.set.call(P,C,D);else if(o.isBuffer(C))C.copy(P,D);else throw new TypeError('"list" argument must be an Array of Buffers');D+=C.length}return P};function b(_,p){if(o.isBuffer(_))return _.length;if(ArrayBuffer.isView(_)||te(_,ArrayBuffer))return _.byteLength;if(typeof _!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof _);let m=_.length,P=arguments.length>2&&arguments[2]===!0;if(!P&&m===0)return 0;let D=!1;for(;;)switch(p){case"ascii":case"latin1":case"binary":return m;case"utf8":case"utf-8":return X(_).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m*2;case"hex":return m>>>1;case"base64":return ne(_).length;default:if(D)return P?-1:X(_).length;p=(""+p).toLowerCase(),D=!0}}o.byteLength=b;function v(_,p,m){let P=!1;if((p===void 0||p<0)&&(p=0),p>this.length||((m===void 0||m>this.length)&&(m=this.length),m<=0)||(m>>>=0,p>>>=0,m<=p))return"";for(_||(_="utf8");;)switch(_){case"hex":return W(this,p,m);case"utf8":case"utf-8":return U(this,p,m);case"ascii":return J(this,p,m);case"latin1":case"binary":return H(this,p,m);case"base64":return R(this,p,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return se(this,p,m);default:if(P)throw new TypeError("Unknown encoding: "+_);_=(_+"").toLowerCase(),P=!0}}o.prototype._isBuffer=!0;function S(_,p,m){let P=_[p];_[p]=_[m],_[m]=P}o.prototype.swap16=function(){let _=this.length;if(_%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<_;p+=2)S(this,p,p+1);return this},o.prototype.swap32=function(){let _=this.length;if(_%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<_;p+=4)S(this,p,p+3),S(this,p+1,p+2);return this},o.prototype.swap64=function(){let _=this.length;if(_%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<_;p+=8)S(this,p,p+7),S(this,p+1,p+6),S(this,p+2,p+5),S(this,p+3,p+4);return this},o.prototype.toString=function(){let _=this.length;return _===0?"":arguments.length===0?U(this,0,_):v.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(_){if(!o.isBuffer(_))throw new TypeError("Argument must be a Buffer");return this===_?!0:o.compare(this,_)===0},o.prototype.inspect=function(){let _="",p=Qi.INSPECT_MAX_BYTES;return _=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(_+=" ... "),"<Buffer "+_+">"},t&&(o.prototype[t]=o.prototype.inspect),o.prototype.compare=function(_,p,m,P,D){if(te(_,Uint8Array)&&(_=o.from(_,_.offset,_.byteLength)),!o.isBuffer(_))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof _);if(p===void 0&&(p=0),m===void 0&&(m=_?_.length:0),P===void 0&&(P=0),D===void 0&&(D=this.length),p<0||m>_.length||P<0||D>this.length)throw new RangeError("out of range index");if(P>=D&&p>=m)return 0;if(P>=D)return-1;if(p>=m)return 1;if(p>>>=0,m>>>=0,P>>>=0,D>>>=0,this===_)return 0;let C=D-P,N=m-p,ee=Math.min(C,N),me=this.slice(P,D),fe=_.slice(p,m);for(let ve=0;ve<ee;++ve)if(me[ve]!==fe[ve]){C=me[ve],N=fe[ve];break}return C<N?-1:N<C?1:0};function x(_,p,m,P,D){if(_.length===0)return-1;if(typeof m=="string"?(P=m,m=0):m>2147483647?m=2147483647:m<-2147483648&&(m=-2147483648),m=+m,be(m)&&(m=D?0:_.length-1),m<0&&(m=_.length+m),m>=_.length){if(D)return-1;m=_.length-1}else if(m<0)if(D)m=0;else return-1;if(typeof p=="string"&&(p=o.from(p,P)),o.isBuffer(p))return p.length===0?-1:T(_,p,m,P,D);if(typeof p=="number")return p=p&255,typeof Uint8Array.prototype.indexOf=="function"?D?Uint8Array.prototype.indexOf.call(_,p,m):Uint8Array.prototype.lastIndexOf.call(_,p,m):T(_,[p],m,P,D);throw new TypeError("val must be string, number or Buffer")}function T(_,p,m,P,D){let C=1,N=_.length,ee=p.length;if(P!==void 0&&(P=String(P).toLowerCase(),P==="ucs2"||P==="ucs-2"||P==="utf16le"||P==="utf-16le")){if(_.length<2||p.length<2)return-1;C=2,N/=2,ee/=2,m/=2}function me(ve,xe){return C===1?ve[xe]:ve.readUInt16BE(xe*C)}let fe;if(D){let ve=-1;for(fe=m;fe<N;fe++)if(me(_,fe)===me(p,ve===-1?0:fe-ve)){if(ve===-1&&(ve=fe),fe-ve+1===ee)return ve*C}else ve!==-1&&(fe-=fe-ve),ve=-1}else for(m+ee>N&&(m=N-ee),fe=m;fe>=0;fe--){let ve=!0;for(let xe=0;xe<ee;xe++)if(me(_,fe+xe)!==me(p,xe)){ve=!1;break}if(ve)return fe}return-1}o.prototype.includes=function(_,p,m){return this.indexOf(_,p,m)!==-1},o.prototype.indexOf=function(_,p,m){return x(this,_,p,m,!0)},o.prototype.lastIndexOf=function(_,p,m){return x(this,_,p,m,!1)};function I(_,p,m,P){m=Number(m)||0;let D=_.length-m;P?(P=Number(P),P>D&&(P=D)):P=D;let C=p.length;P>C/2&&(P=C/2);let N;for(N=0;N<P;++N){let ee=parseInt(p.substr(N*2,2),16);if(be(ee))return N;_[m+N]=ee}return N}function A(_,p,m,P){return z(X(p,_.length-m),_,m,P)}function O(_,p,m,P){return z(Y(p),_,m,P)}function j(_,p,m,P){return z(ne(p),_,m,P)}function K(_,p,m,P){return z(le(p,_.length-m),_,m,P)}o.prototype.write=function(_,p,m,P){if(p===void 0)P="utf8",m=this.length,p=0;else if(m===void 0&&typeof p=="string")P=p,m=this.length,p=0;else if(isFinite(p))p=p>>>0,isFinite(m)?(m=m>>>0,P===void 0&&(P="utf8")):(P=m,m=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let D=this.length-p;if((m===void 0||m>D)&&(m=D),_.length>0&&(m<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");P||(P="utf8");let C=!1;for(;;)switch(P){case"hex":return I(this,_,p,m);case"utf8":case"utf-8":return A(this,_,p,m);case"ascii":case"latin1":case"binary":return O(this,_,p,m);case"base64":return j(this,_,p,m);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K(this,_,p,m);default:if(C)throw new TypeError("Unknown encoding: "+P);P=(""+P).toLowerCase(),C=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function R(_,p,m){return p===0&&m===_.length?i.fromByteArray(_):i.fromByteArray(_.slice(p,m))}function U(_,p,m){m=Math.min(_.length,m);let P=[],D=p;for(;D<m;){let C=_[D],N=null,ee=C>239?4:C>223?3:C>191?2:1;if(D+ee<=m){let me,fe,ve,xe;switch(ee){case 1:C<128&&(N=C);break;case 2:me=_[D+1],(me&192)===128&&(xe=(C&31)<<6|me&63,xe>127&&(N=xe));break;case 3:me=_[D+1],fe=_[D+2],(me&192)===128&&(fe&192)===128&&(xe=(C&15)<<12|(me&63)<<6|fe&63,xe>2047&&(xe<55296||xe>57343)&&(N=xe));break;case 4:me=_[D+1],fe=_[D+2],ve=_[D+3],(me&192)===128&&(fe&192)===128&&(ve&192)===128&&(xe=(C&15)<<18|(me&63)<<12|(fe&63)<<6|ve&63,xe>65535&&xe<1114112&&(N=xe))}}N===null?(N=65533,ee=1):N>65535&&(N-=65536,P.push(N>>>10&1023|55296),N=56320|N&1023),P.push(N),D+=ee}return G(P)}let V=4096;function G(_){let p=_.length;if(p<=V)return String.fromCharCode.apply(String,_);let m="",P=0;for(;P<p;)m+=String.fromCharCode.apply(String,_.slice(P,P+=V));return m}function J(_,p,m){let P="";m=Math.min(_.length,m);for(let D=p;D<m;++D)P+=String.fromCharCode(_[D]&127);return P}function H(_,p,m){let P="";m=Math.min(_.length,m);for(let D=p;D<m;++D)P+=String.fromCharCode(_[D]);return P}function W(_,p,m){let P=_.length;(!p||p<0)&&(p=0),(!m||m<0||m>P)&&(m=P);let D="";for(let C=p;C<m;++C)D+=Se[_[C]];return D}function se(_,p,m){let P=_.slice(p,m),D="";for(let C=0;C<P.length-1;C+=2)D+=String.fromCharCode(P[C]+P[C+1]*256);return D}o.prototype.slice=function(_,p){let m=this.length;_=~~_,p=p===void 0?m:~~p,_<0?(_+=m,_<0&&(_=0)):_>m&&(_=m),p<0?(p+=m,p<0&&(p=0)):p>m&&(p=m),p<_&&(p=_);let P=this.subarray(_,p);return Object.setPrototypeOf(P,o.prototype),P};function Z(_,p,m){if(_%1!==0||_<0)throw new RangeError("offset is not uint");if(_+p>m)throw new RangeError("Trying to access beyond buffer length")}o.prototype.readUintLE=o.prototype.readUIntLE=function(_,p,m){_=_>>>0,p=p>>>0,m||Z(_,p,this.length);let P=this[_],D=1,C=0;for(;++C<p&&(D*=256);)P+=this[_+C]*D;return P},o.prototype.readUintBE=o.prototype.readUIntBE=function(_,p,m){_=_>>>0,p=p>>>0,m||Z(_,p,this.length);let P=this[_+--p],D=1;for(;p>0&&(D*=256);)P+=this[_+--p]*D;return P},o.prototype.readUint8=o.prototype.readUInt8=function(_,p){return _=_>>>0,p||Z(_,1,this.length),this[_]},o.prototype.readUint16LE=o.prototype.readUInt16LE=function(_,p){return _=_>>>0,p||Z(_,2,this.length),this[_]|this[_+1]<<8},o.prototype.readUint16BE=o.prototype.readUInt16BE=function(_,p){return _=_>>>0,p||Z(_,2,this.length),this[_]<<8|this[_+1]},o.prototype.readUint32LE=o.prototype.readUInt32LE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),(this[_]|this[_+1]<<8|this[_+2]<<16)+this[_+3]*16777216},o.prototype.readUint32BE=o.prototype.readUInt32BE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),this[_]*16777216+(this[_+1]<<16|this[_+2]<<8|this[_+3])},o.prototype.readBigUInt64LE=Re(function(_){_=_>>>0,re(_,"offset");let p=this[_],m=this[_+7];(p===void 0||m===void 0)&&ue(_,this.length-8);let P=p+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24,D=this[++_]+this[++_]*2**8+this[++_]*2**16+m*2**24;return BigInt(P)+(BigInt(D)<<BigInt(32))}),o.prototype.readBigUInt64BE=Re(function(_){_=_>>>0,re(_,"offset");let p=this[_],m=this[_+7];(p===void 0||m===void 0)&&ue(_,this.length-8);let P=p*2**24+this[++_]*2**16+this[++_]*2**8+this[++_],D=this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+m;return(BigInt(P)<<BigInt(32))+BigInt(D)}),o.prototype.readIntLE=function(_,p,m){_=_>>>0,p=p>>>0,m||Z(_,p,this.length);let P=this[_],D=1,C=0;for(;++C<p&&(D*=256);)P+=this[_+C]*D;return D*=128,P>=D&&(P-=Math.pow(2,8*p)),P},o.prototype.readIntBE=function(_,p,m){_=_>>>0,p=p>>>0,m||Z(_,p,this.length);let P=p,D=1,C=this[_+--P];for(;P>0&&(D*=256);)C+=this[_+--P]*D;return D*=128,C>=D&&(C-=Math.pow(2,8*p)),C},o.prototype.readInt8=function(_,p){return _=_>>>0,p||Z(_,1,this.length),this[_]&128?(255-this[_]+1)*-1:this[_]},o.prototype.readInt16LE=function(_,p){_=_>>>0,p||Z(_,2,this.length);let m=this[_]|this[_+1]<<8;return m&32768?m|4294901760:m},o.prototype.readInt16BE=function(_,p){_=_>>>0,p||Z(_,2,this.length);let m=this[_+1]|this[_]<<8;return m&32768?m|4294901760:m},o.prototype.readInt32LE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),this[_]|this[_+1]<<8|this[_+2]<<16|this[_+3]<<24},o.prototype.readInt32BE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),this[_]<<24|this[_+1]<<16|this[_+2]<<8|this[_+3]},o.prototype.readBigInt64LE=Re(function(_){_=_>>>0,re(_,"offset");let p=this[_],m=this[_+7];(p===void 0||m===void 0)&&ue(_,this.length-8);let P=this[_+4]+this[_+5]*2**8+this[_+6]*2**16+(m<<24);return(BigInt(P)<<BigInt(32))+BigInt(p+this[++_]*2**8+this[++_]*2**16+this[++_]*2**24)}),o.prototype.readBigInt64BE=Re(function(_){_=_>>>0,re(_,"offset");let p=this[_],m=this[_+7];(p===void 0||m===void 0)&&ue(_,this.length-8);let P=(p<<24)+this[++_]*2**16+this[++_]*2**8+this[++_];return(BigInt(P)<<BigInt(32))+BigInt(this[++_]*2**24+this[++_]*2**16+this[++_]*2**8+m)}),o.prototype.readFloatLE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),e.read(this,_,!0,23,4)},o.prototype.readFloatBE=function(_,p){return _=_>>>0,p||Z(_,4,this.length),e.read(this,_,!1,23,4)},o.prototype.readDoubleLE=function(_,p){return _=_>>>0,p||Z(_,8,this.length),e.read(this,_,!0,52,8)},o.prototype.readDoubleBE=function(_,p){return _=_>>>0,p||Z(_,8,this.length),e.read(this,_,!1,52,8)};function ie(_,p,m,P,D,C){if(!o.isBuffer(_))throw new TypeError('"buffer" argument must be a Buffer instance');if(p>D||p<C)throw new RangeError('"value" argument is out of bounds');if(m+P>_.length)throw new RangeError("Index out of range")}o.prototype.writeUintLE=o.prototype.writeUIntLE=function(_,p,m,P){if(_=+_,p=p>>>0,m=m>>>0,!P){let N=Math.pow(2,8*m)-1;ie(this,_,p,m,N,0)}let D=1,C=0;for(this[p]=_&255;++C<m&&(D*=256);)this[p+C]=_/D&255;return p+m},o.prototype.writeUintBE=o.prototype.writeUIntBE=function(_,p,m,P){if(_=+_,p=p>>>0,m=m>>>0,!P){let N=Math.pow(2,8*m)-1;ie(this,_,p,m,N,0)}let D=m-1,C=1;for(this[p+D]=_&255;--D>=0&&(C*=256);)this[p+D]=_/C&255;return p+m},o.prototype.writeUint8=o.prototype.writeUInt8=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,1,255,0),this[p]=_&255,p+1},o.prototype.writeUint16LE=o.prototype.writeUInt16LE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,2,65535,0),this[p]=_&255,this[p+1]=_>>>8,p+2},o.prototype.writeUint16BE=o.prototype.writeUInt16BE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,2,65535,0),this[p]=_>>>8,this[p+1]=_&255,p+2},o.prototype.writeUint32LE=o.prototype.writeUInt32LE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,4,4294967295,0),this[p+3]=_>>>24,this[p+2]=_>>>16,this[p+1]=_>>>8,this[p]=_&255,p+4},o.prototype.writeUint32BE=o.prototype.writeUInt32BE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,4,4294967295,0),this[p]=_>>>24,this[p+1]=_>>>16,this[p+2]=_>>>8,this[p+3]=_&255,p+4};function M(_,p,m,P,D){ae(p,P,D,_,m,7);let C=Number(p&BigInt(4294967295));_[m++]=C,C=C>>8,_[m++]=C,C=C>>8,_[m++]=C,C=C>>8,_[m++]=C;let N=Number(p>>BigInt(32)&BigInt(4294967295));return _[m++]=N,N=N>>8,_[m++]=N,N=N>>8,_[m++]=N,N=N>>8,_[m++]=N,m}function q(_,p,m,P,D){ae(p,P,D,_,m,7);let C=Number(p&BigInt(4294967295));_[m+7]=C,C=C>>8,_[m+6]=C,C=C>>8,_[m+5]=C,C=C>>8,_[m+4]=C;let N=Number(p>>BigInt(32)&BigInt(4294967295));return _[m+3]=N,N=N>>8,_[m+2]=N,N=N>>8,_[m+1]=N,N=N>>8,_[m]=N,m+8}o.prototype.writeBigUInt64LE=Re(function(_,p=0){return M(this,_,p,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeBigUInt64BE=Re(function(_,p=0){return q(this,_,p,BigInt(0),BigInt("0xffffffffffffffff"))}),o.prototype.writeIntLE=function(_,p,m,P){if(_=+_,p=p>>>0,!P){let ee=Math.pow(2,8*m-1);ie(this,_,p,m,ee-1,-ee)}let D=0,C=1,N=0;for(this[p]=_&255;++D<m&&(C*=256);)_<0&&N===0&&this[p+D-1]!==0&&(N=1),this[p+D]=(_/C>>0)-N&255;return p+m},o.prototype.writeIntBE=function(_,p,m,P){if(_=+_,p=p>>>0,!P){let ee=Math.pow(2,8*m-1);ie(this,_,p,m,ee-1,-ee)}let D=m-1,C=1,N=0;for(this[p+D]=_&255;--D>=0&&(C*=256);)_<0&&N===0&&this[p+D+1]!==0&&(N=1),this[p+D]=(_/C>>0)-N&255;return p+m},o.prototype.writeInt8=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,1,127,-128),_<0&&(_=255+_+1),this[p]=_&255,p+1},o.prototype.writeInt16LE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,2,32767,-32768),this[p]=_&255,this[p+1]=_>>>8,p+2},o.prototype.writeInt16BE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,2,32767,-32768),this[p]=_>>>8,this[p+1]=_&255,p+2},o.prototype.writeInt32LE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,4,2147483647,-2147483648),this[p]=_&255,this[p+1]=_>>>8,this[p+2]=_>>>16,this[p+3]=_>>>24,p+4},o.prototype.writeInt32BE=function(_,p,m){return _=+_,p=p>>>0,m||ie(this,_,p,4,2147483647,-2147483648),_<0&&(_=4294967295+_+1),this[p]=_>>>24,this[p+1]=_>>>16,this[p+2]=_>>>8,this[p+3]=_&255,p+4},o.prototype.writeBigInt64LE=Re(function(_,p=0){return M(this,_,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),o.prototype.writeBigInt64BE=Re(function(_,p=0){return q(this,_,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function $(_,p,m,P,D,C){if(m+P>_.length)throw new RangeError("Index out of range");if(m<0)throw new RangeError("Index out of range")}function we(_,p,m,P,D){return p=+p,m=m>>>0,D||$(_,p,m,4),e.write(_,p,m,P,23,4),m+4}o.prototype.writeFloatLE=function(_,p,m){return we(this,_,p,!0,m)},o.prototype.writeFloatBE=function(_,p,m){return we(this,_,p,!1,m)};function oe(_,p,m,P,D){return p=+p,m=m>>>0,D||$(_,p,m,8),e.write(_,p,m,P,52,8),m+8}o.prototype.writeDoubleLE=function(_,p,m){return oe(this,_,p,!0,m)},o.prototype.writeDoubleBE=function(_,p,m){return oe(this,_,p,!1,m)},o.prototype.copy=function(_,p,m,P){if(!o.isBuffer(_))throw new TypeError("argument should be a Buffer");if(m||(m=0),!P&&P!==0&&(P=this.length),p>=_.length&&(p=_.length),p||(p=0),P>0&&P<m&&(P=m),P===m||_.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(m<0||m>=this.length)throw new RangeError("Index out of range");if(P<0)throw new RangeError("sourceEnd out of bounds");P>this.length&&(P=this.length),_.length-p<P-m&&(P=_.length-p+m);let D=P-m;return this===_&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(p,m,P):Uint8Array.prototype.set.call(_,this.subarray(m,P),p),D},o.prototype.fill=function(_,p,m,P){if(typeof _=="string"){if(typeof p=="string"?(P=p,p=0,m=this.length):typeof m=="string"&&(P=m,m=this.length),P!==void 0&&typeof P!="string")throw new TypeError("encoding must be a string");if(typeof P=="string"&&!o.isEncoding(P))throw new TypeError("Unknown encoding: "+P);if(_.length===1){let C=_.charCodeAt(0);(P==="utf8"&&C<128||P==="latin1")&&(_=C)}}else typeof _=="number"?_=_&255:typeof _=="boolean"&&(_=Number(_));if(p<0||this.length<p||this.length<m)throw new RangeError("Out of range index");if(m<=p)return this;p=p>>>0,m=m===void 0?this.length:m>>>0,_||(_=0);let D;if(typeof _=="number")for(D=p;D<m;++D)this[D]=_;else{let C=o.isBuffer(_)?_:o.from(_,P),N=C.length;if(N===0)throw new TypeError('The value "'+_+'" is invalid for argument "value"');for(D=0;D<m-p;++D)this[D+p]=C[D%N]}return this};let F={};function L(_,p,m){F[_]=class extends m{constructor(){super(),Object.defineProperty(this,"message",{value:p.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${_}]`,this.stack,delete this.name}get code(){return _}set code(P){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:P,writable:!0})}toString(){return`${this.name} [${_}]: ${this.message}`}}}L("ERR_BUFFER_OUT_OF_BOUNDS",function(_){return _?`${_} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),L("ERR_INVALID_ARG_TYPE",function(_,p){return`The "${_}" argument must be of type number. Received type ${typeof p}`},TypeError),L("ERR_OUT_OF_RANGE",function(_,p,m){let P=`The value of "${_}" is out of range.`,D=m;return Number.isInteger(m)&&Math.abs(m)>2**32?D=Q(String(m)):typeof m=="bigint"&&(D=String(m),(m>BigInt(2)**BigInt(32)||m<-(BigInt(2)**BigInt(32)))&&(D=Q(D)),D+="n"),P+=` It must be ${p}. Received ${D}`,P},RangeError);function Q(_){let p="",m=_.length,P=_[0]==="-"?1:0;for(;m>=P+4;m-=3)p=`_${_.slice(m-3,m)}${p}`;return`${_.slice(0,m)}${p}`}function he(_,p,m){re(p,"offset"),(_[p]===void 0||_[p+m]===void 0)&&ue(p,_.length-(m+1))}function ae(_,p,m,P,D,C){if(_>m||_<p){let N=typeof p=="bigint"?"n":"",ee;throw C>3?p===0||p===BigInt(0)?ee=`>= 0${N} and < 2${N} ** ${(C+1)*8}${N}`:ee=`>= -(2${N} ** ${(C+1)*8-1}${N}) and < 2 ** ${(C+1)*8-1}${N}`:ee=`>= ${p}${N} and <= ${m}${N}`,new F.ERR_OUT_OF_RANGE("value",ee,_)}he(P,D,C)}function re(_,p){if(typeof _!="number")throw new F.ERR_INVALID_ARG_TYPE(p,"number",_)}function ue(_,p,m){throw Math.floor(_)!==_?(re(_,m),new F.ERR_OUT_OF_RANGE(m||"offset","an integer",_)):p<0?new F.ERR_BUFFER_OUT_OF_BOUNDS:new F.ERR_OUT_OF_RANGE(m||"offset",`>= ${m?1:0} and <= ${p}`,_)}let de=/[^+/0-9A-Za-z-_]/g;function k(_){if(_=_.split("=")[0],_=_.trim().replace(de,""),_.length<2)return"";for(;_.length%4!==0;)_=_+"=";return _}function X(_,p){p=p||1/0;let m,P=_.length,D=null,C=[];for(let N=0;N<P;++N){if(m=_.charCodeAt(N),m>55295&&m<57344){if(!D){if(m>56319){(p-=3)>-1&&C.push(239,191,189);continue}else if(N+1===P){(p-=3)>-1&&C.push(239,191,189);continue}D=m;continue}if(m<56320){(p-=3)>-1&&C.push(239,191,189),D=m;continue}m=(D-55296<<10|m-56320)+65536}else D&&(p-=3)>-1&&C.push(239,191,189);if(D=null,m<128){if((p-=1)<0)break;C.push(m)}else if(m<2048){if((p-=2)<0)break;C.push(m>>6|192,m&63|128)}else if(m<65536){if((p-=3)<0)break;C.push(m>>12|224,m>>6&63|128,m&63|128)}else if(m<1114112){if((p-=4)<0)break;C.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else throw new Error("Invalid code point")}return C}function Y(_){let p=[];for(let m=0;m<_.length;++m)p.push(_.charCodeAt(m)&255);return p}function le(_,p){let m,P,D,C=[];for(let N=0;N<_.length&&!((p-=2)<0);++N)m=_.charCodeAt(N),P=m>>8,D=m%256,C.push(D),C.push(P);return C}function ne(_){return i.toByteArray(k(_))}function z(_,p,m,P){let D;for(D=0;D<P&&!(D+m>=p.length||D>=_.length);++D)p[D+m]=_[D];return D}function te(_,p){return _ instanceof p||_!=null&&_.constructor!=null&&_.constructor.name!=null&&_.constructor.name===p.name}function be(_){return _!==_}let Se=function(){let _="0123456789abcdef",p=new Array(256);for(let m=0;m<16;++m){let P=m*16;for(let D=0;D<16;++D)p[P+D]=_[m]+_[D]}return p}();function Re(_){return typeof BigInt>"u"?Ae:_}function Ae(){throw new Error("BigInt not supported")}return Qi}var er,Nl,jr,Bl,Qi,Ul,Ri,to,Hd,qd,Pt=At(()=>{ge(),_e(),pe(),er={},Nl=!1,jr={},Bl=!1,Qi={},Ul=!1,Ri=hb(),Ri.Buffer,Ri.SlowBuffer,Ri.INSPECT_MAX_BYTES,Ri.kMaxLength,to=Ri.Buffer,Hd=Ri.INSPECT_MAX_BYTES,qd=Ri.kMaxLength}),_e=At(()=>{Pt()}),cb=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=class{constructor(t){this.aliasToTopic={},this.max=t}put(t,n){return n===0||n>this.max?!1:(this.aliasToTopic[n]=t,this.length=Object.keys(this.aliasToTopic).length,!0)}getTopicByAlias(t){return this.aliasToTopic[t]}clear(){this.aliasToTopic={}}};i.default=e}),bt=Ee((i,e)=>{ge(),_e(),pe(),e.exports={ArrayIsArray(t){return Array.isArray(t)},ArrayPrototypeIncludes(t,n){return t.includes(n)},ArrayPrototypeIndexOf(t,n){return t.indexOf(n)},ArrayPrototypeJoin(t,n){return t.join(n)},ArrayPrototypeMap(t,n){return t.map(n)},ArrayPrototypePop(t,n){return t.pop(n)},ArrayPrototypePush(t,n){return t.push(n)},ArrayPrototypeSlice(t,n,r){return t.slice(n,r)},Error,FunctionPrototypeCall(t,n,...r){return t.call(n,...r)},FunctionPrototypeSymbolHasInstance(t,n){return Function.prototype[Symbol.hasInstance].call(t,n)},MathFloor:Math.floor,Number,NumberIsInteger:Number.isInteger,NumberIsNaN:Number.isNaN,NumberMAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,NumberMIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,NumberParseInt:Number.parseInt,ObjectDefineProperties(t,n){return Object.defineProperties(t,n)},ObjectDefineProperty(t,n,r){return Object.defineProperty(t,n,r)},ObjectGetOwnPropertyDescriptor(t,n){return Object.getOwnPropertyDescriptor(t,n)},ObjectKeys(t){return Object.keys(t)},ObjectSetPrototypeOf(t,n){return Object.setPrototypeOf(t,n)},Promise,PromisePrototypeCatch(t,n){return t.catch(n)},PromisePrototypeThen(t,n,r){return t.then(n,r)},PromiseReject(t){return Promise.reject(t)},ReflectApply:Reflect.apply,RegExpPrototypeTest(t,n){return t.test(n)},SafeSet:Set,String,StringPrototypeSlice(t,n,r){return t.slice(n,r)},StringPrototypeToLowerCase(t){return t.toLowerCase()},StringPrototypeToUpperCase(t){return t.toUpperCase()},StringPrototypeTrim(t){return t.trim()},Symbol,SymbolFor:Symbol.for,SymbolAsyncIterator:Symbol.asyncIterator,SymbolHasInstance:Symbol.hasInstance,SymbolIterator:Symbol.iterator,TypedArrayPrototypeSet(t,n,r){return t.set(n,r)},Uint8Array}}),Bi=Ee((i,e)=>{ge(),_e(),pe();var t=(Pt(),Qe(Mt)),n=Object.getPrototypeOf(async function(){}).constructor,r=globalThis.Blob||t.Blob,s=typeof r<"u"?function(a){return a instanceof r}:function(a){return!1},o=class extends Error{constructor(a){if(!Array.isArray(a))throw new TypeError(`Expected input to be an Array, got ${typeof a}`);let l="";for(let h=0;h<a.length;h++)l+=`    ${a[h].stack}
`;super(l),this.name="AggregateError",this.errors=a}};e.exports={AggregateError:o,kEmptyObject:Object.freeze({}),once(a){let l=!1;return function(...h){l||(l=!0,a.apply(this,h))}},createDeferredPromise:function(){let a,l;return{promise:new Promise((h,c)=>{a=h,l=c}),resolve:a,reject:l}},promisify(a){return new Promise((l,h)=>{a((c,...u)=>c?h(c):l(...u))})},debuglog(){return function(){}},format(a,...l){return a.replace(/%([sdifj])/g,function(...[h,c]){let u=l.shift();return c==="f"?u.toFixed(6):c==="j"?JSON.stringify(u):c==="s"&&typeof u=="object"?`${u.constructor!==Object?u.constructor.name:""} {}`.trim():u.toString()})},inspect(a){switch(typeof a){case"string":if(a.includes("'"))if(a.includes('"')){if(!a.includes("`")&&!a.includes("${"))return`\`${a}\``}else return`"${a}"`;return`'${a}'`;case"number":return isNaN(a)?"NaN":Object.is(a,-0)?String(a):a;case"bigint":return`${String(a)}n`;case"boolean":case"undefined":return String(a);case"object":return"{}"}},types:{isAsyncFunction(a){return a instanceof n},isArrayBufferView(a){return ArrayBuffer.isView(a)}},isBlob:s},e.exports.promisify.custom=Symbol.for("nodejs.util.promisify.custom")}),nc=Ee((i,e)=>{ge(),_e(),pe();var{AbortController:t,AbortSignal:n}=typeof self<"u"?self:typeof window<"u"?window:void 0;e.exports=t,e.exports.AbortSignal=n,e.exports.default=t}),Xt=Ee((i,e)=>{ge(),_e(),pe();var{format:t,inspect:n,AggregateError:r}=Bi(),s=globalThis.AggregateError||r,o=Symbol("kIsNodeError"),a=["string","function","number","object","Function","Object","boolean","bigint","symbol"],l=/^([A-Z][a-z0-9]*)+$/,h="__node_internal_",c={};function u(b,v){if(!b)throw new c.ERR_INTERNAL_ASSERTION(v)}function f(b){let v="",S=b.length,x=b[0]==="-"?1:0;for(;S>=x+4;S-=3)v=`_${b.slice(S-3,S)}${v}`;return`${b.slice(0,S)}${v}`}function d(b,v,S){if(typeof v=="function")return u(v.length<=S.length,`Code: ${b}; The provided arguments length (${S.length}) does not match the required ones (${v.length}).`),v(...S);let x=(v.match(/%[dfijoOs]/g)||[]).length;return u(x===S.length,`Code: ${b}; The provided arguments length (${S.length}) does not match the required ones (${x}).`),S.length===0?v:t(v,...S)}function g(b,v,S){S||(S=Error);class x extends S{constructor(...I){super(d(b,v,I))}toString(){return`${this.name} [${b}]: ${this.message}`}}Object.defineProperties(x.prototype,{name:{value:S.name,writable:!0,enumerable:!1,configurable:!0},toString:{value(){return`${this.name} [${b}]: ${this.message}`},writable:!0,enumerable:!1,configurable:!0}}),x.prototype.code=b,x.prototype[o]=!0,c[b]=x}function y(b){let v=h+b.name;return Object.defineProperty(b,"name",{value:v}),b}function w(b,v){if(b&&v&&b!==v){if(Array.isArray(v.errors))return v.errors.push(b),v;let S=new s([v,b],v.message);return S.code=v.code,S}return b||v}var E=class extends Error{constructor(b="The operation was aborted",v=void 0){if(v!==void 0&&typeof v!="object")throw new c.ERR_INVALID_ARG_TYPE("options","Object",v);super(b,v),this.code="ABORT_ERR",this.name="AbortError"}};g("ERR_ASSERTION","%s",Error),g("ERR_INVALID_ARG_TYPE",(b,v,S)=>{u(typeof b=="string","'name' must be a string"),Array.isArray(v)||(v=[v]);let x="The ";b.endsWith(" argument")?x+=`${b} `:x+=`"${b}" ${b.includes(".")?"property":"argument"} `,x+="must be ";let T=[],I=[],A=[];for(let j of v)u(typeof j=="string","All expected entries have to be of type string"),a.includes(j)?T.push(j.toLowerCase()):l.test(j)?I.push(j):(u(j!=="object",'The value "object" should be written as "Object"'),A.push(j));if(I.length>0){let j=T.indexOf("object");j!==-1&&(T.splice(T,j,1),I.push("Object"))}if(T.length>0){switch(T.length){case 1:x+=`of type ${T[0]}`;break;case 2:x+=`one of type ${T[0]} or ${T[1]}`;break;default:{let j=T.pop();x+=`one of type ${T.join(", ")}, or ${j}`}}(I.length>0||A.length>0)&&(x+=" or ")}if(I.length>0){switch(I.length){case 1:x+=`an instance of ${I[0]}`;break;case 2:x+=`an instance of ${I[0]} or ${I[1]}`;break;default:{let j=I.pop();x+=`an instance of ${I.join(", ")}, or ${j}`}}A.length>0&&(x+=" or ")}switch(A.length){case 0:break;case 1:A[0].toLowerCase()!==A[0]&&(x+="an "),x+=`${A[0]}`;break;case 2:x+=`one of ${A[0]} or ${A[1]}`;break;default:{let j=A.pop();x+=`one of ${A.join(", ")}, or ${j}`}}if(S==null)x+=`. Received ${S}`;else if(typeof S=="function"&&S.name)x+=`. Received function ${S.name}`;else if(typeof S=="object"){var O;if((O=S.constructor)!==null&&O!==void 0&&O.name)x+=`. Received an instance of ${S.constructor.name}`;else{let j=n(S,{depth:-1});x+=`. Received ${j}`}}else{let j=n(S,{colors:!1});j.length>25&&(j=`${j.slice(0,25)}...`),x+=`. Received type ${typeof S} (${j})`}return x},TypeError),g("ERR_INVALID_ARG_VALUE",(b,v,S="is invalid")=>{let x=n(v);return x.length>128&&(x=x.slice(0,128)+"..."),`The ${b.includes(".")?"property":"argument"} '${b}' ${S}. Received ${x}`},TypeError),g("ERR_INVALID_RETURN_VALUE",(b,v,S)=>{var x;let T=S!=null&&(x=S.constructor)!==null&&x!==void 0&&x.name?`instance of ${S.constructor.name}`:`type ${typeof S}`;return`Expected ${b} to be returned from the "${v}" function but got ${T}.`},TypeError),g("ERR_MISSING_ARGS",(...b)=>{u(b.length>0,"At least one arg needs to be specified");let v,S=b.length;switch(b=(Array.isArray(b)?b:[b]).map(x=>`"${x}"`).join(" or "),S){case 1:v+=`The ${b[0]} argument`;break;case 2:v+=`The ${b[0]} and ${b[1]} arguments`;break;default:{let x=b.pop();v+=`The ${b.join(", ")}, and ${x} arguments`}break}return`${v} must be specified`},TypeError),g("ERR_OUT_OF_RANGE",(b,v,S)=>{u(v,'Missing "range" argument');let x;return Number.isInteger(S)&&Math.abs(S)>2**32?x=f(String(S)):typeof S=="bigint"?(x=String(S),(S>2n**32n||S<-(2n**32n))&&(x=f(x)),x+="n"):x=n(S),`The value of "${b}" is out of range. It must be ${v}. Received ${x}`},RangeError),g("ERR_MULTIPLE_CALLBACK","Callback called multiple times",Error),g("ERR_METHOD_NOT_IMPLEMENTED","The %s method is not implemented",Error),g("ERR_STREAM_ALREADY_FINISHED","Cannot call %s after a stream was finished",Error),g("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable",Error),g("ERR_STREAM_DESTROYED","Cannot call %s after a stream was destroyed",Error),g("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),g("ERR_STREAM_PREMATURE_CLOSE","Premature close",Error),g("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF",Error),g("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event",Error),g("ERR_STREAM_WRITE_AFTER_END","write after end",Error),g("ERR_UNKNOWN_ENCODING","Unknown encoding: %s",TypeError),e.exports={AbortError:E,aggregateTwoErrors:y(w),hideStackFrames:y,codes:c}}),Ao=Ee((i,e)=>{ge(),_e(),pe();var{ArrayIsArray:t,ArrayPrototypeIncludes:n,ArrayPrototypeJoin:r,ArrayPrototypeMap:s,NumberIsInteger:o,NumberIsNaN:a,NumberMAX_SAFE_INTEGER:l,NumberMIN_SAFE_INTEGER:h,NumberParseInt:c,ObjectPrototypeHasOwnProperty:u,RegExpPrototypeExec:f,String:d,StringPrototypeToUpperCase:g,StringPrototypeTrim:y}=bt(),{hideStackFrames:w,codes:{ERR_SOCKET_BAD_PORT:E,ERR_INVALID_ARG_TYPE:b,ERR_INVALID_ARG_VALUE:v,ERR_OUT_OF_RANGE:S,ERR_UNKNOWN_SIGNAL:x}}=Xt(),{normalizeEncoding:T}=Bi(),{isAsyncFunction:I,isArrayBufferView:A}=Bi().types,O={};function j(z){return z===(z|0)}function K(z){return z===z>>>0}var R=/^[0-7]+$/,U="must be a 32-bit unsigned integer or an octal string";function V(z,te,be){if(typeof z>"u"&&(z=be),typeof z=="string"){if(f(R,z)===null)throw new v(te,z,U);z=c(z,8)}return H(z,te),z}var G=w((z,te,be=h,Se=l)=>{if(typeof z!="number")throw new b(te,"number",z);if(!o(z))throw new S(te,"an integer",z);if(z<be||z>Se)throw new S(te,`>= ${be} && <= ${Se}`,z)}),J=w((z,te,be=-2147483648,Se=2147483647)=>{if(typeof z!="number")throw new b(te,"number",z);if(!o(z))throw new S(te,"an integer",z);if(z<be||z>Se)throw new S(te,`>= ${be} && <= ${Se}`,z)}),H=w((z,te,be=!1)=>{if(typeof z!="number")throw new b(te,"number",z);if(!o(z))throw new S(te,"an integer",z);let Se=be?1:0,Re=4294967295;if(z<Se||z>Re)throw new S(te,`>= ${Se} && <= ${Re}`,z)});function W(z,te){if(typeof z!="string")throw new b(te,"string",z)}function se(z,te,be=void 0,Se){if(typeof z!="number")throw new b(te,"number",z);if(be!=null&&z<be||Se!=null&&z>Se||(be!=null||Se!=null)&&a(z))throw new S(te,`${be!=null?`>= ${be}`:""}${be!=null&&Se!=null?" && ":""}${Se!=null?`<= ${Se}`:""}`,z)}var Z=w((z,te,be)=>{if(!n(be,z)){let Se="must be one of: "+r(s(be,Re=>typeof Re=="string"?`'${Re}'`:d(Re)),", ");throw new v(te,z,Se)}});function ie(z,te){if(typeof z!="boolean")throw new b(te,"boolean",z)}function M(z,te,be){return z==null||!u(z,te)?be:z[te]}var q=w((z,te,be=null)=>{let Se=M(be,"allowArray",!1),Re=M(be,"allowFunction",!1);if(!M(be,"nullable",!1)&&z===null||!Se&&t(z)||typeof z!="object"&&(!Re||typeof z!="function"))throw new b(te,"Object",z)}),$=w((z,te)=>{if(z!=null&&typeof z!="object"&&typeof z!="function")throw new b(te,"a dictionary",z)}),we=w((z,te,be=0)=>{if(!t(z))throw new b(te,"Array",z);if(z.length<be){let Se=`must be longer than ${be}`;throw new v(te,z,Se)}});function oe(z,te){we(z,te);for(let be=0;be<z.length;be++)W(z[be],`${te}[${be}]`)}function F(z,te){we(z,te);for(let be=0;be<z.length;be++)ie(z[be],`${te}[${be}]`)}function L(z,te="signal"){if(W(z,te),O[z]===void 0)throw O[g(z)]!==void 0?new x(z+" (signals must use all capital letters)"):new x(z)}var Q=w((z,te="buffer")=>{if(!A(z))throw new b(te,["Buffer","TypedArray","DataView"],z)});function he(z,te){let be=T(te),Se=z.length;if(be==="hex"&&Se%2!==0)throw new v("encoding",te,`is invalid for data of length ${Se}`)}function ae(z,te="Port",be=!0){if(typeof z!="number"&&typeof z!="string"||typeof z=="string"&&y(z).length===0||+z!==+z>>>0||z>65535||z===0&&!be)throw new E(te,z,be);return z|0}var re=w((z,te)=>{if(z!==void 0&&(z===null||typeof z!="object"||!("aborted"in z)))throw new b(te,"AbortSignal",z)}),ue=w((z,te)=>{if(typeof z!="function")throw new b(te,"Function",z)}),de=w((z,te)=>{if(typeof z!="function"||I(z))throw new b(te,"Function",z)}),k=w((z,te)=>{if(z!==void 0)throw new b(te,"undefined",z)});function X(z,te,be){if(!n(be,z))throw new b(te,`('${r(be,"|")}')`,z)}var Y=/^(?:<[^>]*>)(?:\s*;\s*[^;"\s]+(?:=(")?[^;"\s]*\1)?)*$/;function le(z,te){if(typeof z>"u"||!f(Y,z))throw new v(te,z,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}function ne(z){if(typeof z=="string")return le(z,"hints"),z;if(t(z)){let te=z.length,be="";if(te===0)return be;for(let Se=0;Se<te;Se++){let Re=z[Se];le(Re,"hints"),be+=Re,Se!==te-1&&(be+=", ")}return be}throw new v("hints",z,'must be an array or string of format "</styles.css>; rel=preload; as=style"')}e.exports={isInt32:j,isUint32:K,parseFileMode:V,validateArray:we,validateStringArray:oe,validateBooleanArray:F,validateBoolean:ie,validateBuffer:Q,validateDictionary:$,validateEncoding:he,validateFunction:ue,validateInt32:J,validateInteger:G,validateNumber:se,validateObject:q,validateOneOf:Z,validatePlainFunction:de,validatePort:ae,validateSignalName:L,validateString:W,validateUint32:H,validateUndefined:k,validateUnion:X,validateAbortSignal:re,validateLinkHeaderValue:ne}}),Nn=Ee((i,e)=>{ge(),_e(),pe();var t=e.exports={},n,r;function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?n=setTimeout:n=s}catch{n=s}try{typeof clearTimeout=="function"?r=clearTimeout:r=o}catch{r=o}})();function a(E){if(n===setTimeout)return setTimeout(E,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(E,0);try{return n(E,0)}catch{try{return n.call(null,E,0)}catch{return n.call(this,E,0)}}}function l(E){if(r===clearTimeout)return clearTimeout(E);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(E);try{return r(E)}catch{try{return r.call(null,E)}catch{return r.call(this,E)}}}var h=[],c=!1,u,f=-1;function d(){!c||!u||(c=!1,u.length?h=u.concat(h):f=-1,h.length&&g())}function g(){if(!c){var E=a(d);c=!0;for(var b=h.length;b;){for(u=h,h=[];++f<b;)u&&u[f].run();f=-1,b=h.length}u=null,c=!1,l(E)}}t.nextTick=function(E){var b=new Array(arguments.length-1);if(arguments.length>1)for(var v=1;v<arguments.length;v++)b[v-1]=arguments[v];h.push(new y(E,b)),h.length===1&&!c&&a(g)};function y(E,b){this.fun=E,this.array=b}y.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={};function w(){}t.on=w,t.addListener=w,t.once=w,t.off=w,t.removeListener=w,t.removeAllListeners=w,t.emit=w,t.prependListener=w,t.prependOnceListener=w,t.listeners=function(E){return[]},t.binding=function(E){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(E){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}}),zi=Ee((i,e)=>{ge(),_e(),pe();var{Symbol:t,SymbolAsyncIterator:n,SymbolIterator:r,SymbolFor:s}=bt(),o=t("kDestroyed"),a=t("kIsErrored"),l=t("kIsReadable"),h=t("kIsDisturbed"),c=s("nodejs.webstream.isClosedPromise"),u=s("nodejs.webstream.controllerErrorFunction");function f(M,q=!1){var $;return!!(M&&typeof M.pipe=="function"&&typeof M.on=="function"&&(!q||typeof M.pause=="function"&&typeof M.resume=="function")&&(!M._writableState||(($=M._readableState)===null||$===void 0?void 0:$.readable)!==!1)&&(!M._writableState||M._readableState))}function d(M){var q;return!!(M&&typeof M.write=="function"&&typeof M.on=="function"&&(!M._readableState||((q=M._writableState)===null||q===void 0?void 0:q.writable)!==!1))}function g(M){return!!(M&&typeof M.pipe=="function"&&M._readableState&&typeof M.on=="function"&&typeof M.write=="function")}function y(M){return M&&(M._readableState||M._writableState||typeof M.write=="function"&&typeof M.on=="function"||typeof M.pipe=="function"&&typeof M.on=="function")}function w(M){return!!(M&&!y(M)&&typeof M.pipeThrough=="function"&&typeof M.getReader=="function"&&typeof M.cancel=="function")}function E(M){return!!(M&&!y(M)&&typeof M.getWriter=="function"&&typeof M.abort=="function")}function b(M){return!!(M&&!y(M)&&typeof M.readable=="object"&&typeof M.writable=="object")}function v(M){return w(M)||E(M)||b(M)}function S(M,q){return M==null?!1:q===!0?typeof M[n]=="function":q===!1?typeof M[r]=="function":typeof M[n]=="function"||typeof M[r]=="function"}function x(M){if(!y(M))return null;let q=M._writableState,$=M._readableState,we=q||$;return!!(M.destroyed||M[o]||we!=null&&we.destroyed)}function T(M){if(!d(M))return null;if(M.writableEnded===!0)return!0;let q=M._writableState;return q!=null&&q.errored?!1:typeof(q==null?void 0:q.ended)!="boolean"?null:q.ended}function I(M,q){if(!d(M))return null;if(M.writableFinished===!0)return!0;let $=M._writableState;return $!=null&&$.errored?!1:typeof($==null?void 0:$.finished)!="boolean"?null:!!($.finished||q===!1&&$.ended===!0&&$.length===0)}function A(M){if(!f(M))return null;if(M.readableEnded===!0)return!0;let q=M._readableState;return!q||q.errored?!1:typeof(q==null?void 0:q.ended)!="boolean"?null:q.ended}function O(M,q){if(!f(M))return null;let $=M._readableState;return $!=null&&$.errored?!1:typeof($==null?void 0:$.endEmitted)!="boolean"?null:!!($.endEmitted||q===!1&&$.ended===!0&&$.length===0)}function j(M){return M&&M[l]!=null?M[l]:typeof(M==null?void 0:M.readable)!="boolean"?null:x(M)?!1:f(M)&&M.readable&&!O(M)}function K(M){return typeof(M==null?void 0:M.writable)!="boolean"?null:x(M)?!1:d(M)&&M.writable&&!T(M)}function R(M,q){return y(M)?x(M)?!0:!((q==null?void 0:q.readable)!==!1&&j(M)||(q==null?void 0:q.writable)!==!1&&K(M)):null}function U(M){var q,$;return y(M)?M.writableErrored?M.writableErrored:(q=($=M._writableState)===null||$===void 0?void 0:$.errored)!==null&&q!==void 0?q:null:null}function V(M){var q,$;return y(M)?M.readableErrored?M.readableErrored:(q=($=M._readableState)===null||$===void 0?void 0:$.errored)!==null&&q!==void 0?q:null:null}function G(M){if(!y(M))return null;if(typeof M.closed=="boolean")return M.closed;let q=M._writableState,$=M._readableState;return typeof(q==null?void 0:q.closed)=="boolean"||typeof($==null?void 0:$.closed)=="boolean"?(q==null?void 0:q.closed)||($==null?void 0:$.closed):typeof M._closed=="boolean"&&J(M)?M._closed:null}function J(M){return typeof M._closed=="boolean"&&typeof M._defaultKeepAlive=="boolean"&&typeof M._removedConnection=="boolean"&&typeof M._removedContLen=="boolean"}function H(M){return typeof M._sent100=="boolean"&&J(M)}function W(M){var q;return typeof M._consuming=="boolean"&&typeof M._dumped=="boolean"&&((q=M.req)===null||q===void 0?void 0:q.upgradeOrConnect)===void 0}function se(M){if(!y(M))return null;let q=M._writableState,$=M._readableState,we=q||$;return!we&&H(M)||!!(we&&we.autoDestroy&&we.emitClose&&we.closed===!1)}function Z(M){var q;return!!(M&&((q=M[h])!==null&&q!==void 0?q:M.readableDidRead||M.readableAborted))}function ie(M){var q,$,we,oe,F,L,Q,he,ae,re;return!!(M&&((q=($=(we=(oe=(F=(L=M[a])!==null&&L!==void 0?L:M.readableErrored)!==null&&F!==void 0?F:M.writableErrored)!==null&&oe!==void 0?oe:(Q=M._readableState)===null||Q===void 0?void 0:Q.errorEmitted)!==null&&we!==void 0?we:(he=M._writableState)===null||he===void 0?void 0:he.errorEmitted)!==null&&$!==void 0?$:(ae=M._readableState)===null||ae===void 0?void 0:ae.errored)!==null&&q!==void 0?q:!((re=M._writableState)===null||re===void 0)&&re.errored))}e.exports={kDestroyed:o,isDisturbed:Z,kIsDisturbed:h,isErrored:ie,kIsErrored:a,isReadable:j,kIsReadable:l,kIsClosedPromise:c,kControllerErrorFunction:u,isClosed:G,isDestroyed:x,isDuplexNodeStream:g,isFinished:R,isIterable:S,isReadableNodeStream:f,isReadableStream:w,isReadableEnded:A,isReadableFinished:O,isReadableErrored:V,isNodeStream:y,isWebStream:v,isWritable:K,isWritableNodeStream:d,isWritableStream:E,isWritableEnded:T,isWritableFinished:I,isWritableErrored:U,isServerRequest:W,isServerResponse:H,willEmitClose:se,isTransformStream:b}}),fn=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{AbortError:n,codes:r}=Xt(),{ERR_INVALID_ARG_TYPE:s,ERR_STREAM_PREMATURE_CLOSE:o}=r,{kEmptyObject:a,once:l}=Bi(),{validateAbortSignal:h,validateFunction:c,validateObject:u,validateBoolean:f}=Ao(),{Promise:d,PromisePrototypeThen:g}=bt(),{isClosed:y,isReadable:w,isReadableNodeStream:E,isReadableStream:b,isReadableFinished:v,isReadableErrored:S,isWritable:x,isWritableNodeStream:T,isWritableStream:I,isWritableFinished:A,isWritableErrored:O,isNodeStream:j,willEmitClose:K,kIsClosedPromise:R}=zi();function U(W){return W.setHeader&&typeof W.abort=="function"}var V=()=>{};function G(W,se,Z){var ie,M;if(arguments.length===2?(Z=se,se=a):se==null?se=a:u(se,"options"),c(Z,"callback"),h(se.signal,"options.signal"),Z=l(Z),b(W)||I(W))return J(W,se,Z);if(!j(W))throw new s("stream",["ReadableStream","WritableStream","Stream"],W);let q=(ie=se.readable)!==null&&ie!==void 0?ie:E(W),$=(M=se.writable)!==null&&M!==void 0?M:T(W),we=W._writableState,oe=W._readableState,F=()=>{W.writable||he()},L=K(W)&&E(W)===q&&T(W)===$,Q=A(W,!1),he=()=>{Q=!0,W.destroyed&&(L=!1),!(L&&(!W.readable||q))&&(!q||ae)&&Z.call(W)},ae=v(W,!1),re=()=>{ae=!0,W.destroyed&&(L=!1),!(L&&(!W.writable||$))&&(!$||Q)&&Z.call(W)},ue=ne=>{Z.call(W,ne)},de=y(W),k=()=>{de=!0;let ne=O(W)||S(W);if(ne&&typeof ne!="boolean")return Z.call(W,ne);if(q&&!ae&&E(W,!0)&&!v(W,!1))return Z.call(W,new o);if($&&!Q&&!A(W,!1))return Z.call(W,new o);Z.call(W)},X=()=>{de=!0;let ne=O(W)||S(W);if(ne&&typeof ne!="boolean")return Z.call(W,ne);Z.call(W)},Y=()=>{W.req.on("finish",he)};U(W)?(W.on("complete",he),L||W.on("abort",k),W.req?Y():W.on("request",Y)):$&&!we&&(W.on("end",F),W.on("close",F)),!L&&typeof W.aborted=="boolean"&&W.on("aborted",k),W.on("end",re),W.on("finish",he),se.error!==!1&&W.on("error",ue),W.on("close",k),de?t.nextTick(k):we!=null&&we.errorEmitted||oe!=null&&oe.errorEmitted?L||t.nextTick(X):(!q&&(!L||w(W))&&(Q||x(W)===!1)||!$&&(!L||x(W))&&(ae||w(W)===!1)||oe&&W.req&&W.aborted)&&t.nextTick(X);let le=()=>{Z=V,W.removeListener("aborted",k),W.removeListener("complete",he),W.removeListener("abort",k),W.removeListener("request",Y),W.req&&W.req.removeListener("finish",he),W.removeListener("end",F),W.removeListener("close",F),W.removeListener("finish",he),W.removeListener("end",re),W.removeListener("error",ue),W.removeListener("close",k)};if(se.signal&&!de){let ne=()=>{let z=Z;le(),z.call(W,new n(void 0,{cause:se.signal.reason}))};if(se.signal.aborted)t.nextTick(ne);else{let z=Z;Z=l((...te)=>{se.signal.removeEventListener("abort",ne),z.apply(W,te)}),se.signal.addEventListener("abort",ne)}}return le}function J(W,se,Z){let ie=!1,M=V;if(se.signal)if(M=()=>{ie=!0,Z.call(W,new n(void 0,{cause:se.signal.reason}))},se.signal.aborted)t.nextTick(M);else{let $=Z;Z=l((...we)=>{se.signal.removeEventListener("abort",M),$.apply(W,we)}),se.signal.addEventListener("abort",M)}let q=(...$)=>{ie||t.nextTick(()=>Z.apply(W,$))};return g(W[R].promise,q,q),V}function H(W,se){var Z;let ie=!1;return se===null&&(se=a),(Z=se)!==null&&Z!==void 0&&Z.cleanup&&(f(se.cleanup,"cleanup"),ie=se.cleanup),new d((M,q)=>{let $=G(W,se,we=>{ie&&$(),we?q(we):M()})})}e.exports=G,e.exports.finished=H}),Er=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{aggregateTwoErrors:n,codes:{ERR_MULTIPLE_CALLBACK:r},AbortError:s}=Xt(),{Symbol:o}=bt(),{kDestroyed:a,isDestroyed:l,isFinished:h,isServerRequest:c}=zi(),u=o("kDestroy"),f=o("kConstruct");function d(R,U,V){R&&(R.stack,U&&!U.errored&&(U.errored=R),V&&!V.errored&&(V.errored=R))}function g(R,U){let V=this._readableState,G=this._writableState,J=G||V;return G!=null&&G.destroyed||V!=null&&V.destroyed?(typeof U=="function"&&U(),this):(d(R,G,V),G&&(G.destroyed=!0),V&&(V.destroyed=!0),J.constructed?y(this,R,U):this.once(u,function(H){y(this,n(H,R),U)}),this)}function y(R,U,V){let G=!1;function J(H){if(G)return;G=!0;let W=R._readableState,se=R._writableState;d(H,se,W),se&&(se.closed=!0),W&&(W.closed=!0),typeof V=="function"&&V(H),H?t.nextTick(w,R,H):t.nextTick(E,R)}try{R._destroy(U||null,J)}catch(H){J(H)}}function w(R,U){b(R,U),E(R)}function E(R){let U=R._readableState,V=R._writableState;V&&(V.closeEmitted=!0),U&&(U.closeEmitted=!0),(V!=null&&V.emitClose||U!=null&&U.emitClose)&&R.emit("close")}function b(R,U){let V=R._readableState,G=R._writableState;G!=null&&G.errorEmitted||V!=null&&V.errorEmitted||(G&&(G.errorEmitted=!0),V&&(V.errorEmitted=!0),R.emit("error",U))}function v(){let R=this._readableState,U=this._writableState;R&&(R.constructed=!0,R.closed=!1,R.closeEmitted=!1,R.destroyed=!1,R.errored=null,R.errorEmitted=!1,R.reading=!1,R.ended=R.readable===!1,R.endEmitted=R.readable===!1),U&&(U.constructed=!0,U.destroyed=!1,U.closed=!1,U.closeEmitted=!1,U.errored=null,U.errorEmitted=!1,U.finalCalled=!1,U.prefinished=!1,U.ended=U.writable===!1,U.ending=U.writable===!1,U.finished=U.writable===!1)}function S(R,U,V){let G=R._readableState,J=R._writableState;if(J!=null&&J.destroyed||G!=null&&G.destroyed)return this;G!=null&&G.autoDestroy||J!=null&&J.autoDestroy?R.destroy(U):U&&(U.stack,J&&!J.errored&&(J.errored=U),G&&!G.errored&&(G.errored=U),V?t.nextTick(b,R,U):b(R,U))}function x(R,U){if(typeof R._construct!="function")return;let V=R._readableState,G=R._writableState;V&&(V.constructed=!1),G&&(G.constructed=!1),R.once(f,U),!(R.listenerCount(f)>1)&&t.nextTick(T,R)}function T(R){let U=!1;function V(G){if(U){S(R,G??new r);return}U=!0;let J=R._readableState,H=R._writableState,W=H||J;J&&(J.constructed=!0),H&&(H.constructed=!0),W.destroyed?R.emit(u,G):G?S(R,G,!0):t.nextTick(I,R)}try{R._construct(G=>{t.nextTick(V,G)})}catch(G){t.nextTick(V,G)}}function I(R){R.emit(f)}function A(R){return(R==null?void 0:R.setHeader)&&typeof R.abort=="function"}function O(R){R.emit("close")}function j(R,U){R.emit("error",U),t.nextTick(O,R)}function K(R,U){!R||l(R)||(!U&&!h(R)&&(U=new s),c(R)?(R.socket=null,R.destroy(U)):A(R)?R.abort():A(R.req)?R.req.abort():typeof R.destroy=="function"?R.destroy(U):typeof R.close=="function"?R.close():U?t.nextTick(j,R,U):t.nextTick(O,R),R.destroyed||(R[a]=!0))}e.exports={construct:x,destroyer:K,destroy:g,undestroy:v,errorOrDestroy:S}});function Ze(){Ze.init.call(this)}function Os(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}function Zd(i){return i._maxListeners===void 0?Ze.defaultMaxListeners:i._maxListeners}function Eu(i,e,t,n){var r,s,o,a;if(Os(t),(s=i._events)===void 0?(s=i._events=Object.create(null),i._eventsCount=0):(s.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),s=i._events),o=s[e]),o===void 0)o=s[e]=t,++i._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),(r=Zd(i))>0&&o.length>r&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=i,l.type=e,l.count=o.length,a=l,console&&console.warn&&console.warn(a)}return i}function ub(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Su(i,e,t){var n={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},r=ub.bind(n);return r.listener=t,n.wrapFn=r,r}function xu(i,e,t){var n=i._events;if(n===void 0)return[];var r=n[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?function(s){for(var o=new Array(s.length),a=0;a<o.length;++a)o[a]=s[a].listener||s[a];return o}(r):Jd(r,r.length)}function Tu(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}function Jd(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i[n];return t}var Ru,Iu,pn,ra,sa,oa,Vt,Cu=At(()=>{ge(),_e(),pe(),pn=typeof Reflect=="object"?Reflect:null,ra=pn&&typeof pn.apply=="function"?pn.apply:function(i,e,t){return Function.prototype.apply.call(i,e,t)},Iu=pn&&typeof pn.ownKeys=="function"?pn.ownKeys:Object.getOwnPropertySymbols?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:function(i){return Object.getOwnPropertyNames(i)},sa=Number.isNaN||function(i){return i!=i},Ru=Ze,Ze.EventEmitter=Ze,Ze.prototype._events=void 0,Ze.prototype._eventsCount=0,Ze.prototype._maxListeners=void 0,oa=10,Object.defineProperty(Ze,"defaultMaxListeners",{enumerable:!0,get:function(){return oa},set:function(i){if(typeof i!="number"||i<0||sa(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");oa=i}}),Ze.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ze.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||sa(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this},Ze.prototype.getMaxListeners=function(){return Zd(this)},Ze.prototype.emit=function(i){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var n=i==="error",r=this._events;if(r!==void 0)n=n&&r.error===void 0;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=r[i];if(a===void 0)return!1;if(typeof a=="function")ra(a,this,e);else{var l=a.length,h=Jd(a,l);for(t=0;t<l;++t)ra(h[t],this,e)}return!0},Ze.prototype.addListener=function(i,e){return Eu(this,i,e,!1)},Ze.prototype.on=Ze.prototype.addListener,Ze.prototype.prependListener=function(i,e){return Eu(this,i,e,!0)},Ze.prototype.once=function(i,e){return Os(e),this.on(i,Su(this,i,e)),this},Ze.prototype.prependOnceListener=function(i,e){return Os(e),this.prependListener(i,Su(this,i,e)),this},Ze.prototype.removeListener=function(i,e){var t,n,r,s,o;if(Os(e),(n=this._events)===void 0)return this;if((t=n[i])===void 0)return this;if(t===e||t.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete n[i],n.removeListener&&this.emit("removeListener",i,t.listener||e));else if(typeof t!="function"){for(r=-1,s=t.length-1;s>=0;s--)if(t[s]===e||t[s].listener===e){o=t[s].listener,r=s;break}if(r<0)return this;r===0?t.shift():function(a,l){for(;l+1<a.length;l++)a[l]=a[l+1];a.pop()}(t,r),t.length===1&&(n[i]=t[0]),n.removeListener!==void 0&&this.emit("removeListener",i,o||e)}return this},Ze.prototype.off=Ze.prototype.removeListener,Ze.prototype.removeAllListeners=function(i){var e,t,n;if((t=this._events)===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[i]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete t[i]),this;if(arguments.length===0){var r,s=Object.keys(t);for(n=0;n<s.length;++n)(r=s[n])!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(e=t[i])=="function")this.removeListener(i,e);else if(e!==void 0)for(n=e.length-1;n>=0;n--)this.removeListener(i,e[n]);return this},Ze.prototype.listeners=function(i){return xu(this,i,!0)},Ze.prototype.rawListeners=function(i){return xu(this,i,!1)},Ze.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):Tu.call(i,e)},Ze.prototype.listenerCount=Tu,Ze.prototype.eventNames=function(){return this._eventsCount>0?Iu(this._events):[]},Vt=Ru,Vt.EventEmitter,Vt.defaultMaxListeners,Vt.init,Vt.listenerCount,Vt.EventEmitter,Vt.defaultMaxListeners,Vt.init,Vt.listenerCount}),Bn={};Fn(Bn,{EventEmitter:()=>Qd,default:()=>Vt,defaultMaxListeners:()=>eg,init:()=>tg,listenerCount:()=>ig,on:()=>ng,once:()=>rg});var Qd,eg,tg,ig,ng,rg,Sr=At(()=>{ge(),_e(),pe(),Cu(),Cu(),Vt.once=function(i,e){return new Promise((t,n)=>{function r(...o){s!==void 0&&i.removeListener("error",s),t(o)}let s;e!=="error"&&(s=o=>{i.removeListener(name,r),n(o)},i.once("error",s)),i.once(e,r)})},Vt.on=function(i,e){let t=[],n=[],r=null,s=!1,o={async next(){let h=t.shift();if(h)return createIterResult(h,!1);if(r){let c=Promise.reject(r);return r=null,c}return s?createIterResult(void 0,!0):new Promise((c,u)=>n.push({resolve:c,reject:u}))},async return(){i.removeListener(e,a),i.removeListener("error",l),s=!0;for(let h of n)h.resolve(createIterResult(void 0,!0));return createIterResult(void 0,!0)},throw(h){r=h,i.removeListener(e,a),i.removeListener("error",l)},[Symbol.asyncIterator](){return this}};return i.on(e,a),i.on("error",l),o;function a(...h){let c=n.shift();c?c.resolve(createIterResult(h,!1)):t.push(h)}function l(h){s=!0;let c=n.shift();c?c.reject(h):r=h,o.return()}},{EventEmitter:Qd,defaultMaxListeners:eg,init:tg,listenerCount:ig,on:ng,once:rg}=Vt}),rc=Ee((i,e)=>{ge(),_e(),pe();var{ArrayIsArray:t,ObjectSetPrototypeOf:n}=bt(),{EventEmitter:r}=(Sr(),Qe(Bn));function s(a){r.call(this,a)}n(s.prototype,r.prototype),n(s,r),s.prototype.pipe=function(a,l){let h=this;function c(E){a.writable&&a.write(E)===!1&&h.pause&&h.pause()}h.on("data",c);function u(){h.readable&&h.resume&&h.resume()}a.on("drain",u),!a._isStdio&&(!l||l.end!==!1)&&(h.on("end",d),h.on("close",g));let f=!1;function d(){f||(f=!0,a.end())}function g(){f||(f=!0,typeof a.destroy=="function"&&a.destroy())}function y(E){w(),r.listenerCount(this,"error")===0&&this.emit("error",E)}o(h,"error",y),o(a,"error",y);function w(){h.removeListener("data",c),a.removeListener("drain",u),h.removeListener("end",d),h.removeListener("close",g),h.removeListener("error",y),a.removeListener("error",y),h.removeListener("end",w),h.removeListener("close",w),a.removeListener("close",w)}return h.on("end",w),h.on("close",w),a.on("close",w),a.emit("pipe",h),a};function o(a,l,h){if(typeof a.prependListener=="function")return a.prependListener(l,h);!a._events||!a._events[l]?a.on(l,h):t(a._events[l])?a._events[l].unshift(h):a._events[l]=[h,a._events[l]]}e.exports={Stream:s,prependListener:o}}),Mo=Ee((i,e)=>{ge(),_e(),pe();var{AbortError:t,codes:n}=Xt(),{isNodeStream:r,isWebStream:s,kControllerErrorFunction:o}=zi(),a=fn(),{ERR_INVALID_ARG_TYPE:l}=n,h=(c,u)=>{if(typeof c!="object"||!("aborted"in c))throw new l(u,"AbortSignal",c)};e.exports.addAbortSignal=function(c,u){if(h(c,"signal"),!r(u)&&!s(u))throw new l("stream",["ReadableStream","WritableStream","Stream"],u);return e.exports.addAbortSignalNoValidate(c,u)},e.exports.addAbortSignalNoValidate=function(c,u){if(typeof c!="object"||!("aborted"in c))return u;let f=r(u)?()=>{u.destroy(new t(void 0,{cause:c.reason}))}:()=>{u[o](new t(void 0,{cause:c.reason}))};return c.aborted?f():(c.addEventListener("abort",f),a(u,()=>c.removeEventListener("abort",f))),u}}),fb=Ee((i,e)=>{ge(),_e(),pe();var{StringPrototypeSlice:t,SymbolIterator:n,TypedArrayPrototypeSet:r,Uint8Array:s}=bt(),{Buffer:o}=(Pt(),Qe(Mt)),{inspect:a}=Bi();e.exports=class{constructor(){this.head=null,this.tail=null,this.length=0}push(l){let h={data:l,next:null};this.length>0?this.tail.next=h:this.head=h,this.tail=h,++this.length}unshift(l){let h={data:l,next:this.head};this.length===0&&(this.tail=h),this.head=h,++this.length}shift(){if(this.length===0)return;let l=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,l}clear(){this.head=this.tail=null,this.length=0}join(l){if(this.length===0)return"";let h=this.head,c=""+h.data;for(;(h=h.next)!==null;)c+=l+h.data;return c}concat(l){if(this.length===0)return o.alloc(0);let h=o.allocUnsafe(l>>>0),c=this.head,u=0;for(;c;)r(h,c.data,u),u+=c.data.length,c=c.next;return h}consume(l,h){let c=this.head.data;if(l<c.length){let u=c.slice(0,l);return this.head.data=c.slice(l),u}return l===c.length?this.shift():h?this._getString(l):this._getBuffer(l)}first(){return this.head.data}*[n](){for(let l=this.head;l;l=l.next)yield l.data}_getString(l){let h="",c=this.head,u=0;do{let f=c.data;if(l>f.length)h+=f,l-=f.length;else{l===f.length?(h+=f,++u,c.next?this.head=c.next:this.head=this.tail=null):(h+=t(f,0,l),this.head=c,c.data=t(f,l));break}++u}while((c=c.next)!==null);return this.length-=u,h}_getBuffer(l){let h=o.allocUnsafe(l),c=l,u=this.head,f=0;do{let d=u.data;if(l>d.length)r(h,d,c-l),l-=d.length;else{l===d.length?(r(h,d,c-l),++f,u.next?this.head=u.next:this.head=this.tail=null):(r(h,new s(d.buffer,d.byteOffset,l),c-l),this.head=u,u.data=d.slice(l));break}++f}while((u=u.next)!==null);return this.length-=f,h}[Symbol.for("nodejs.util.inspect.custom")](l,h){return a(this,{...h,depth:0,customInspect:!1})}}}),sc=Ee((i,e)=>{ge(),_e(),pe();var{MathFloor:t,NumberIsInteger:n}=bt(),{ERR_INVALID_ARG_VALUE:r}=Xt().codes;function s(l,h,c){return l.highWaterMark!=null?l.highWaterMark:h?l[c]:null}function o(l){return l?16:16*1024}function a(l,h,c,u){let f=s(h,u,c);if(f!=null){if(!n(f)||f<0){let d=u?`options.${c}`:"options.highWaterMark";throw new r(d,f)}return t(f)}return o(l.objectMode)}e.exports={getHighWaterMark:a,getDefaultHighWaterMark:o}});function Au(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=i.indexOf("=");return t===-1&&(t=e),[t,t===e?0:4-t%4]}function db(i,e,t){for(var n,r,s=[],o=e;o<t;o+=3)n=(i[o]<<16&16711680)+(i[o+1]<<8&65280)+(255&i[o+2]),s.push(si[(r=n)>>18&63]+si[r>>12&63]+si[r>>6&63]+si[63&r]);return s.join("")}function Pi(i){if(i>2147483647)throw new RangeError('The value "'+i+'" is invalid for option "size"');var e=new Uint8Array(i);return Object.setPrototypeOf(e,ye.prototype),e}function ye(i,e,t){if(typeof i=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return jl(i)}return sg(i,e,t)}function sg(i,e,t){if(typeof i=="string")return function(s,o){if(typeof o=="string"&&o!==""||(o="utf8"),!ye.isEncoding(o))throw new TypeError("Unknown encoding: "+o);var a=0|ag(s,o),l=Pi(a),h=l.write(s,o);return h!==a&&(l=l.slice(0,h)),l}(i,e);if(ArrayBuffer.isView(i))return aa(i);if(i==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i);if(Li(i,ArrayBuffer)||i&&Li(i.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(Li(i,SharedArrayBuffer)||i&&Li(i.buffer,SharedArrayBuffer)))return gb(i,e,t);if(typeof i=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var n=i.valueOf&&i.valueOf();if(n!=null&&n!==i)return ye.from(n,e,t);var r=function(s){if(ye.isBuffer(s)){var o=0|oc(s.length),a=Pi(o);return a.length===0||s.copy(a,0,0,o),a}if(s.length!==void 0)return typeof s.length!="number"||ac(s.length)?Pi(0):aa(s);if(s.type==="Buffer"&&Array.isArray(s.data))return aa(s.data)}(i);if(r)return r;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof i[Symbol.toPrimitive]=="function")return ye.from(i[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof i)}function og(i){if(typeof i!="number")throw new TypeError('"size" argument must be of type number');if(i<0)throw new RangeError('The value "'+i+'" is invalid for option "size"')}function jl(i){return og(i),Pi(i<0?0:0|oc(i))}function aa(i){for(var e=i.length<0?0:0|oc(i.length),t=Pi(e),n=0;n<e;n+=1)t[n]=255&i[n];return t}function gb(i,e,t){if(e<0||i.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(i.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=e===void 0&&t===void 0?new Uint8Array(i):t===void 0?new Uint8Array(i,e):new Uint8Array(i,e,t),Object.setPrototypeOf(n,ye.prototype),n}function oc(i){if(i>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|i}function ag(i,e){if(ye.isBuffer(i))return i.length;if(ArrayBuffer.isView(i)||Li(i,ArrayBuffer))return i.byteLength;if(typeof i!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof i);var t=i.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Wl(i).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*t;case"hex":return t>>>1;case"base64":return ug(i).length;default:if(r)return n?-1:Wl(i).length;e=(""+e).toLowerCase(),r=!0}}function pb(i,e,t){var n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0)<=(e>>>=0))return"";for(i||(i="utf8");;)switch(i){case"hex":return xb(this,e,t);case"utf8":case"utf-8":return hg(this,e,t);case"ascii":return Eb(this,e,t);case"latin1":case"binary":return Sb(this,e,t);case"base64":return vb(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Tb(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+i);i=(i+"").toLowerCase(),n=!0}}function _n(i,e,t){var n=i[e];i[e]=i[t],i[t]=n}function Mu(i,e,t,n,r){if(i.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),ac(t=+t)&&(t=r?0:i.length-1),t<0&&(t=i.length+t),t>=i.length){if(r)return-1;t=i.length-1}else if(t<0){if(!r)return-1;t=0}if(typeof e=="string"&&(e=ye.from(e,n)),ye.isBuffer(e))return e.length===0?-1:Pu(i,e,t,n,r);if(typeof e=="number")return e&=255,typeof Uint8Array.prototype.indexOf=="function"?r?Uint8Array.prototype.indexOf.call(i,e,t):Uint8Array.prototype.lastIndexOf.call(i,e,t):Pu(i,[e],t,n,r);throw new TypeError("val must be string, number or Buffer")}function Pu(i,e,t,n,r){var s,o=1,a=i.length,l=e.length;if(n!==void 0&&((n=String(n).toLowerCase())==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(i.length<2||e.length<2)return-1;o=2,a/=2,l/=2,t/=2}function h(d,g){return o===1?d[g]:d.readUInt16BE(g*o)}if(r){var c=-1;for(s=t;s<a;s++)if(h(i,s)===h(e,c===-1?0:s-c)){if(c===-1&&(c=s),s-c+1===l)return c*o}else c!==-1&&(s-=s-c),c=-1}else for(t+l>a&&(t=a-l),s=t;s>=0;s--){for(var u=!0,f=0;f<l;f++)if(h(i,s+f)!==h(e,f)){u=!1;break}if(u)return s}return-1}function _b(i,e,t,n){t=Number(t)||0;var r=i.length-t;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(ac(a))return o;i[t+o]=a}return o}function mb(i,e,t,n){return Po(Wl(e,i.length-t),i,t,n)}function lg(i,e,t,n){return Po(function(r){for(var s=[],o=0;o<r.length;++o)s.push(255&r.charCodeAt(o));return s}(e),i,t,n)}function yb(i,e,t,n){return lg(i,e,t,n)}function wb(i,e,t,n){return Po(ug(e),i,t,n)}function bb(i,e,t,n){return Po(function(r,s){for(var o,a,l,h=[],c=0;c<r.length&&!((s-=2)<0);++c)o=r.charCodeAt(c),a=o>>8,l=o%256,h.push(l),h.push(a);return h}(e,i.length-t),i,t,n)}function vb(i,e,t){return e===0&&t===i.length?io.fromByteArray(i):io.fromByteArray(i.slice(e,t))}function hg(i,e,t){t=Math.min(i.length,t);for(var n=[],r=e;r<t;){var s,o,a,l,h=i[r],c=null,u=h>239?4:h>223?3:h>191?2:1;if(r+u<=t)switch(u){case 1:h<128&&(c=h);break;case 2:(192&(s=i[r+1]))==128&&(l=(31&h)<<6|63&s)>127&&(c=l);break;case 3:s=i[r+1],o=i[r+2],(192&s)==128&&(192&o)==128&&(l=(15&h)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=i[r+1],o=i[r+2],a=i[r+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(l=(15&h)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(c=l)}c===null?(c=65533,u=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),r+=u}return function(f){var d=f.length;if(d<=4096)return String.fromCharCode.apply(String,f);for(var g="",y=0;y<d;)g+=String.fromCharCode.apply(String,f.slice(y,y+=4096));return g}(n)}function Eb(i,e,t){var n="";t=Math.min(i.length,t);for(var r=e;r<t;++r)n+=String.fromCharCode(127&i[r]);return n}function Sb(i,e,t){var n="";t=Math.min(i.length,t);for(var r=e;r<t;++r)n+=String.fromCharCode(i[r]);return n}function xb(i,e,t){var n=i.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);for(var r="",s=e;s<t;++s)r+=dg[i[s]];return r}function Tb(i,e,t){for(var n=i.slice(e,t),r="",s=0;s<n.length;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function St(i,e,t){if(i%1!=0||i<0)throw new RangeError("offset is not uint");if(i+e>t)throw new RangeError("Trying to access beyond buffer length")}function Nt(i,e,t,n,r,s){if(!ye.isBuffer(i))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>i.length)throw new RangeError("Index out of range")}function cg(i,e,t,n,r,s){if(t+n>i.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function Lu(i,e,t,n,r){return e=+e,t>>>=0,r||cg(i,0,t,4),Sn.write(i,e,t,n,23,4),t+4}function Ou(i,e,t,n,r){return e=+e,t>>>=0,r||cg(i,0,t,8),Sn.write(i,e,t,n,52,8),t+8}function Wl(i,e){var t;e=e||1/0;for(var n=i.length,r=null,s=[],o=0;o<n;++o){if((t=i.charCodeAt(o))>55295&&t<57344){if(!r){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),r=t;continue}t=65536+(r-55296<<10|t-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,63&t|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,63&t|128)}else{if(!(t<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}}return s}function ug(i){return io.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(fg,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(i))}function Po(i,e,t,n){for(var r=0;r<n&&!(r+t>=e.length||r>=i.length);++r)e[r+t]=i[r];return r}function Li(i,e){return i instanceof e||i!=null&&i.constructor!=null&&i.constructor.name!=null&&i.constructor.name===e.name}function ac(i){return i!=i}function ku(i,e){for(var t in i)e[t]=i[t]}function mn(i,e,t){return ni(i,e,t)}function Ar(i){var e;switch(this.encoding=function(t){var n=function(r){if(!r)return"utf8";for(var s;;)switch(r){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return r;default:if(s)return;r=(""+r).toLowerCase(),s=!0}}(t);if(typeof n!="string"&&(no.isEncoding===Gl||!Gl(t)))throw new Error("Unknown encoding: "+t);return n||t}(i),this.encoding){case"utf16le":this.text=Ib,this.end=Cb,e=4;break;case"utf8":this.fillLast=Rb,e=4;break;case"base64":this.text=Ab,this.end=Mb,e=3;break;default:return this.write=Pb,this.end=Lb,void 0}this.lastNeed=0,this.lastTotal=0,this.lastChar=no.allocUnsafe(e)}function la(i){return i<=127?0:i>>5==6?2:i>>4==14?3:i>>3==30?4:i>>6==2?-1:-2}function Rb(i){var e=this.lastTotal-this.lastNeed,t=function(n,r,s){if((192&r[0])!=128)return n.lastNeed=0,"";if(n.lastNeed>1&&r.length>1){if((192&r[1])!=128)return n.lastNeed=1,"";if(n.lastNeed>2&&r.length>2&&(192&r[2])!=128)return n.lastNeed=2,""}}(this,i);return t!==void 0?t:this.lastNeed<=i.length?(i.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(i.copy(this.lastChar,e,0,i.length),this.lastNeed-=i.length,void 0)}function Ib(i,e){if((i.length-e)%2==0){var t=i.toString("utf16le",e);if(t){var n=t.charCodeAt(t.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=i[i.length-2],this.lastChar[1]=i[i.length-1],t.slice(0,-1)}return t}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=i[i.length-1],i.toString("utf16le",e,i.length-1)}function Cb(i){var e=i&&i.length?this.write(i):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function Ab(i,e){var t=(i.length-e)%3;return t===0?i.toString("base64",e):(this.lastNeed=3-t,this.lastTotal=3,t===1?this.lastChar[0]=i[i.length-1]:(this.lastChar[0]=i[i.length-2],this.lastChar[1]=i[i.length-1]),i.toString("base64",e,i.length-t))}function Mb(i){var e=i&&i.length?this.write(i):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function Pb(i){return i.toString(this.encoding)}function Lb(i){return i&&i.length?this.write(i):""}var Du,si,$t,Fu,Ts,yn,Nu,Bu,ci,io,Sn,ha,fg,dg,Mr,Pr,ni,Uu,sr,no,Gl,ju=At(()=>{for(ge(),_e(),pe(),Du={byteLength:function(i){var e=Au(i),t=e[0],n=e[1];return 3*(t+n)/4-n},toByteArray:function(i){var e,t,n=Au(i),r=n[0],s=n[1],o=new Fu(function(h,c,u){return 3*(c+u)/4-u}(0,r,s)),a=0,l=s>0?r-4:r;for(t=0;t<l;t+=4)e=$t[i.charCodeAt(t)]<<18|$t[i.charCodeAt(t+1)]<<12|$t[i.charCodeAt(t+2)]<<6|$t[i.charCodeAt(t+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=255&e;return s===2&&(e=$t[i.charCodeAt(t)]<<2|$t[i.charCodeAt(t+1)]>>4,o[a++]=255&e),s===1&&(e=$t[i.charCodeAt(t)]<<10|$t[i.charCodeAt(t+1)]<<4|$t[i.charCodeAt(t+2)]>>2,o[a++]=e>>8&255,o[a++]=255&e),o},fromByteArray:function(i){for(var e,t=i.length,n=t%3,r=[],s=0,o=t-n;s<o;s+=16383)r.push(db(i,s,s+16383>o?o:s+16383));return n===1?(e=i[t-1],r.push(si[e>>2]+si[e<<4&63]+"==")):n===2&&(e=(i[t-2]<<8)+i[t-1],r.push(si[e>>10]+si[e>>4&63]+si[e<<2&63]+"=")),r.join("")}},si=[],$t=[],Fu=typeof Uint8Array<"u"?Uint8Array:Array,Ts="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yn=0,Nu=Ts.length;yn<Nu;++yn)si[yn]=Ts[yn],$t[Ts.charCodeAt(yn)]=yn;$t["-".charCodeAt(0)]=62,$t["_".charCodeAt(0)]=63,Bu={read:function(i,e,t,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,h=l>>1,c=-7,u=t?r-1:0,f=t?-1:1,d=i[e+u];for(u+=f,s=d&(1<<-c)-1,d>>=-c,c+=a;c>0;s=256*s+i[e+u],u+=f,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=n;c>0;o=256*o+i[e+u],u+=f,c-=8);if(s===0)s=1-h;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=h}return(d?-1:1)*o*Math.pow(2,s-n)},write:function(i,e,t,n,r,s){var o,a,l,h=8*s-r-1,c=(1<<h)-1,u=c>>1,f=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,g=n?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+u>=1?f/l:f*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*l-1)*Math.pow(2,r),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;i[t+d]=255&a,d+=g,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;i[t+d]=255&o,d+=g,o/=256,h-=8);i[t+d-g]|=128*y}},ci={},io=Du,Sn=Bu,ha=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null,ci.Buffer=ye,ci.SlowBuffer=function(i){return+i!=i&&(i=0),ye.alloc(+i)},ci.INSPECT_MAX_BYTES=50,ci.kMaxLength=2147483647,ye.TYPED_ARRAY_SUPPORT=function(){try{var i=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(i,e),i.foo()===42}catch{return!1}}(),ye.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(ye.prototype,"parent",{enumerable:!0,get:function(){if(ye.isBuffer(this))return this.buffer}}),Object.defineProperty(ye.prototype,"offset",{enumerable:!0,get:function(){if(ye.isBuffer(this))return this.byteOffset}}),ye.poolSize=8192,ye.from=function(i,e,t){return sg(i,e,t)},Object.setPrototypeOf(ye.prototype,Uint8Array.prototype),Object.setPrototypeOf(ye,Uint8Array),ye.alloc=function(i,e,t){return function(n,r,s){return og(n),n<=0?Pi(n):r!==void 0?typeof s=="string"?Pi(n).fill(r,s):Pi(n).fill(r):Pi(n)}(i,e,t)},ye.allocUnsafe=function(i){return jl(i)},ye.allocUnsafeSlow=function(i){return jl(i)},ye.isBuffer=function(i){return i!=null&&i._isBuffer===!0&&i!==ye.prototype},ye.compare=function(i,e){if(Li(i,Uint8Array)&&(i=ye.from(i,i.offset,i.byteLength)),Li(e,Uint8Array)&&(e=ye.from(e,e.offset,e.byteLength)),!ye.isBuffer(i)||!ye.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(i===e)return 0;for(var t=i.length,n=e.length,r=0,s=Math.min(t,n);r<s;++r)if(i[r]!==e[r]){t=i[r],n=e[r];break}return t<n?-1:n<t?1:0},ye.isEncoding=function(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ye.concat=function(i,e){if(!Array.isArray(i))throw new TypeError('"list" argument must be an Array of Buffers');if(i.length===0)return ye.alloc(0);var t;if(e===void 0)for(e=0,t=0;t<i.length;++t)e+=i[t].length;var n=ye.allocUnsafe(e),r=0;for(t=0;t<i.length;++t){var s=i[t];if(Li(s,Uint8Array)&&(s=ye.from(s)),!ye.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,r),r+=s.length}return n},ye.byteLength=ag,ye.prototype._isBuffer=!0,ye.prototype.swap16=function(){var i=this.length;if(i%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<i;e+=2)_n(this,e,e+1);return this},ye.prototype.swap32=function(){var i=this.length;if(i%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<i;e+=4)_n(this,e,e+3),_n(this,e+1,e+2);return this},ye.prototype.swap64=function(){var i=this.length;if(i%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<i;e+=8)_n(this,e,e+7),_n(this,e+1,e+6),_n(this,e+2,e+5),_n(this,e+3,e+4);return this},ye.prototype.toString=function(){var i=this.length;return i===0?"":arguments.length===0?hg(this,0,i):pb.apply(this,arguments)},ye.prototype.toLocaleString=ye.prototype.toString,ye.prototype.equals=function(i){if(!ye.isBuffer(i))throw new TypeError("Argument must be a Buffer");return this===i||ye.compare(this,i)===0},ye.prototype.inspect=function(){var i="",e=ci.INSPECT_MAX_BYTES;return i=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(i+=" ... "),"<Buffer "+i+">"},ha&&(ye.prototype[ha]=ye.prototype.inspect),ye.prototype.compare=function(i,e,t,n,r){if(Li(i,Uint8Array)&&(i=ye.from(i,i.offset,i.byteLength)),!ye.isBuffer(i))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof i);if(e===void 0&&(e=0),t===void 0&&(t=i?i.length:0),n===void 0&&(n=0),r===void 0&&(r=this.length),e<0||t>i.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=t)return 0;if(n>=r)return-1;if(e>=t)return 1;if(this===i)return 0;for(var s=(r>>>=0)-(n>>>=0),o=(t>>>=0)-(e>>>=0),a=Math.min(s,o),l=this.slice(n,r),h=i.slice(e,t),c=0;c<a;++c)if(l[c]!==h[c]){s=l[c],o=h[c];break}return s<o?-1:o<s?1:0},ye.prototype.includes=function(i,e,t){return this.indexOf(i,e,t)!==-1},ye.prototype.indexOf=function(i,e,t){return Mu(this,i,e,t,!0)},ye.prototype.lastIndexOf=function(i,e,t){return Mu(this,i,e,t,!1)},ye.prototype.write=function(i,e,t,n){if(e===void 0)n="utf8",t=this.length,e=0;else if(t===void 0&&typeof e=="string")n=e,t=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(t)?(t>>>=0,n===void 0&&(n="utf8")):(n=t,t=void 0)}var r=this.length-e;if((t===void 0||t>r)&&(t=r),i.length>0&&(t<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return _b(this,i,e,t);case"utf8":case"utf-8":return mb(this,i,e,t);case"ascii":return lg(this,i,e,t);case"latin1":case"binary":return yb(this,i,e,t);case"base64":return wb(this,i,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bb(this,i,e,t);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},ye.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},ye.prototype.slice=function(i,e){var t=this.length;(i=~~i)<0?(i+=t)<0&&(i=0):i>t&&(i=t),(e=e===void 0?t:~~e)<0?(e+=t)<0&&(e=0):e>t&&(e=t),e<i&&(e=i);var n=this.subarray(i,e);return Object.setPrototypeOf(n,ye.prototype),n},ye.prototype.readUIntLE=function(i,e,t){i>>>=0,e>>>=0,t||St(i,e,this.length);for(var n=this[i],r=1,s=0;++s<e&&(r*=256);)n+=this[i+s]*r;return n},ye.prototype.readUIntBE=function(i,e,t){i>>>=0,e>>>=0,t||St(i,e,this.length);for(var n=this[i+--e],r=1;e>0&&(r*=256);)n+=this[i+--e]*r;return n},ye.prototype.readUInt8=function(i,e){return i>>>=0,e||St(i,1,this.length),this[i]},ye.prototype.readUInt16LE=function(i,e){return i>>>=0,e||St(i,2,this.length),this[i]|this[i+1]<<8},ye.prototype.readUInt16BE=function(i,e){return i>>>=0,e||St(i,2,this.length),this[i]<<8|this[i+1]},ye.prototype.readUInt32LE=function(i,e){return i>>>=0,e||St(i,4,this.length),(this[i]|this[i+1]<<8|this[i+2]<<16)+16777216*this[i+3]},ye.prototype.readUInt32BE=function(i,e){return i>>>=0,e||St(i,4,this.length),16777216*this[i]+(this[i+1]<<16|this[i+2]<<8|this[i+3])},ye.prototype.readIntLE=function(i,e,t){i>>>=0,e>>>=0,t||St(i,e,this.length);for(var n=this[i],r=1,s=0;++s<e&&(r*=256);)n+=this[i+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},ye.prototype.readIntBE=function(i,e,t){i>>>=0,e>>>=0,t||St(i,e,this.length);for(var n=e,r=1,s=this[i+--n];n>0&&(r*=256);)s+=this[i+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},ye.prototype.readInt8=function(i,e){return i>>>=0,e||St(i,1,this.length),128&this[i]?-1*(255-this[i]+1):this[i]},ye.prototype.readInt16LE=function(i,e){i>>>=0,e||St(i,2,this.length);var t=this[i]|this[i+1]<<8;return 32768&t?4294901760|t:t},ye.prototype.readInt16BE=function(i,e){i>>>=0,e||St(i,2,this.length);var t=this[i+1]|this[i]<<8;return 32768&t?4294901760|t:t},ye.prototype.readInt32LE=function(i,e){return i>>>=0,e||St(i,4,this.length),this[i]|this[i+1]<<8|this[i+2]<<16|this[i+3]<<24},ye.prototype.readInt32BE=function(i,e){return i>>>=0,e||St(i,4,this.length),this[i]<<24|this[i+1]<<16|this[i+2]<<8|this[i+3]},ye.prototype.readFloatLE=function(i,e){return i>>>=0,e||St(i,4,this.length),Sn.read(this,i,!0,23,4)},ye.prototype.readFloatBE=function(i,e){return i>>>=0,e||St(i,4,this.length),Sn.read(this,i,!1,23,4)},ye.prototype.readDoubleLE=function(i,e){return i>>>=0,e||St(i,8,this.length),Sn.read(this,i,!0,52,8)},ye.prototype.readDoubleBE=function(i,e){return i>>>=0,e||St(i,8,this.length),Sn.read(this,i,!1,52,8)},ye.prototype.writeUIntLE=function(i,e,t,n){i=+i,e>>>=0,t>>>=0,n||Nt(this,i,e,t,Math.pow(2,8*t)-1,0);var r=1,s=0;for(this[e]=255&i;++s<t&&(r*=256);)this[e+s]=i/r&255;return e+t},ye.prototype.writeUIntBE=function(i,e,t,n){i=+i,e>>>=0,t>>>=0,n||Nt(this,i,e,t,Math.pow(2,8*t)-1,0);var r=t-1,s=1;for(this[e+r]=255&i;--r>=0&&(s*=256);)this[e+r]=i/s&255;return e+t},ye.prototype.writeUInt8=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,1,255,0),this[e]=255&i,e+1},ye.prototype.writeUInt16LE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,2,65535,0),this[e]=255&i,this[e+1]=i>>>8,e+2},ye.prototype.writeUInt16BE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,2,65535,0),this[e]=i>>>8,this[e+1]=255&i,e+2},ye.prototype.writeUInt32LE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,4,4294967295,0),this[e+3]=i>>>24,this[e+2]=i>>>16,this[e+1]=i>>>8,this[e]=255&i,e+4},ye.prototype.writeUInt32BE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,4,4294967295,0),this[e]=i>>>24,this[e+1]=i>>>16,this[e+2]=i>>>8,this[e+3]=255&i,e+4},ye.prototype.writeIntLE=function(i,e,t,n){if(i=+i,e>>>=0,!n){var r=Math.pow(2,8*t-1);Nt(this,i,e,t,r-1,-r)}var s=0,o=1,a=0;for(this[e]=255&i;++s<t&&(o*=256);)i<0&&a===0&&this[e+s-1]!==0&&(a=1),this[e+s]=(i/o>>0)-a&255;return e+t},ye.prototype.writeIntBE=function(i,e,t,n){if(i=+i,e>>>=0,!n){var r=Math.pow(2,8*t-1);Nt(this,i,e,t,r-1,-r)}var s=t-1,o=1,a=0;for(this[e+s]=255&i;--s>=0&&(o*=256);)i<0&&a===0&&this[e+s+1]!==0&&(a=1),this[e+s]=(i/o>>0)-a&255;return e+t},ye.prototype.writeInt8=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,1,127,-128),i<0&&(i=255+i+1),this[e]=255&i,e+1},ye.prototype.writeInt16LE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,2,32767,-32768),this[e]=255&i,this[e+1]=i>>>8,e+2},ye.prototype.writeInt16BE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,2,32767,-32768),this[e]=i>>>8,this[e+1]=255&i,e+2},ye.prototype.writeInt32LE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,4,2147483647,-2147483648),this[e]=255&i,this[e+1]=i>>>8,this[e+2]=i>>>16,this[e+3]=i>>>24,e+4},ye.prototype.writeInt32BE=function(i,e,t){return i=+i,e>>>=0,t||Nt(this,i,e,4,2147483647,-2147483648),i<0&&(i=4294967295+i+1),this[e]=i>>>24,this[e+1]=i>>>16,this[e+2]=i>>>8,this[e+3]=255&i,e+4},ye.prototype.writeFloatLE=function(i,e,t){return Lu(this,i,e,!0,t)},ye.prototype.writeFloatBE=function(i,e,t){return Lu(this,i,e,!1,t)},ye.prototype.writeDoubleLE=function(i,e,t){return Ou(this,i,e,!0,t)},ye.prototype.writeDoubleBE=function(i,e,t){return Ou(this,i,e,!1,t)},ye.prototype.copy=function(i,e,t,n){if(!ye.isBuffer(i))throw new TypeError("argument should be a Buffer");if(t||(t=0),n||n===0||(n=this.length),e>=i.length&&(e=i.length),e||(e=0),n>0&&n<t&&(n=t),n===t||i.length===0||this.length===0)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(t<0||t>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),i.length-e<n-t&&(n=i.length-e+t);var r=n-t;if(this===i&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(e,t,n);else if(this===i&&t<e&&e<n)for(var s=r-1;s>=0;--s)i[s+e]=this[s+t];else Uint8Array.prototype.set.call(i,this.subarray(t,n),e);return r},ye.prototype.fill=function(i,e,t,n){if(typeof i=="string"){if(typeof e=="string"?(n=e,e=0,t=this.length):typeof t=="string"&&(n=t,t=this.length),n!==void 0&&typeof n!="string")throw new TypeError("encoding must be a string");if(typeof n=="string"&&!ye.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(i.length===1){var r=i.charCodeAt(0);(n==="utf8"&&r<128||n==="latin1")&&(i=r)}}else typeof i=="number"?i&=255:typeof i=="boolean"&&(i=Number(i));if(e<0||this.length<e||this.length<t)throw new RangeError("Out of range index");if(t<=e)return this;var s;if(e>>>=0,t=t===void 0?this.length:t>>>0,i||(i=0),typeof i=="number")for(s=e;s<t;++s)this[s]=i;else{var o=ye.isBuffer(i)?i:ye.from(i,n),a=o.length;if(a===0)throw new TypeError('The value "'+i+'" is invalid for argument "value"');for(s=0;s<t-e;++s)this[s+e]=o[s%a]}return this},fg=/[^+/0-9A-Za-z-_]/g,dg=function(){for(var i=new Array(256),e=0;e<16;++e)for(var t=16*e,n=0;n<16;++n)i[t+n]="0123456789abcdef"[e]+"0123456789abcdef"[n];return i}(),ci.Buffer,ci.INSPECT_MAX_BYTES,ci.kMaxLength,Mr={},Pr=ci,ni=Pr.Buffer,ni.from&&ni.alloc&&ni.allocUnsafe&&ni.allocUnsafeSlow?Mr=Pr:(ku(Pr,Mr),Mr.Buffer=mn),mn.prototype=Object.create(ni.prototype),ku(ni,mn),mn.from=function(i,e,t){if(typeof i=="number")throw new TypeError("Argument must not be a number");return ni(i,e,t)},mn.alloc=function(i,e,t){if(typeof i!="number")throw new TypeError("Argument must be a number");var n=ni(i);return e!==void 0?typeof t=="string"?n.fill(e,t):n.fill(e):n.fill(0),n},mn.allocUnsafe=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return ni(i)},mn.allocUnsafeSlow=function(i){if(typeof i!="number")throw new TypeError("Argument must be a number");return Pr.SlowBuffer(i)},Uu=Mr,sr={},no=Uu.Buffer,Gl=no.isEncoding||function(i){switch((i=""+i)&&i.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},sr.StringDecoder=Ar,Ar.prototype.write=function(i){if(i.length===0)return"";var e,t;if(this.lastNeed){if((e=this.fillLast(i))===void 0)return"";t=this.lastNeed,this.lastNeed=0}else t=0;return t<i.length?e?e+this.text(i,t):this.text(i,t):e||""},Ar.prototype.end=function(i){var e=i&&i.length?this.write(i):"";return this.lastNeed?e+"":e},Ar.prototype.text=function(i,e){var t=function(r,s,o){var a=s.length-1;if(a<o)return 0;var l=la(s[a]);return l>=0?(l>0&&(r.lastNeed=l-1),l):--a<o||l===-2?0:(l=la(s[a]))>=0?(l>0&&(r.lastNeed=l-2),l):--a<o||l===-2?0:(l=la(s[a]))>=0?(l>0&&(l===2?l=0:r.lastNeed=l-3),l):0}(this,i,e);if(!this.lastNeed)return i.toString("utf8",e);this.lastTotal=t;var n=i.length-(t-this.lastNeed);return i.copy(this.lastChar,0,n),i.toString("utf8",e,n)},Ar.prototype.fillLast=function(i){if(this.lastNeed<=i.length)return i.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);i.copy(this.lastChar,this.lastTotal-this.lastNeed,0,i.length),this.lastNeed-=i.length},sr.StringDecoder,sr.StringDecoder}),gg={};Fn(gg,{StringDecoder:()=>pg,default:()=>sr});var pg,Ob=At(()=>{ge(),_e(),pe(),ju(),ju(),pg=sr.StringDecoder}),_g=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{PromisePrototypeThen:n,SymbolAsyncIterator:r,SymbolIterator:s}=bt(),{Buffer:o}=(Pt(),Qe(Mt)),{ERR_INVALID_ARG_TYPE:a,ERR_STREAM_NULL_VALUES:l}=Xt().codes;function h(c,u,f){let d;if(typeof u=="string"||u instanceof o)return new c({objectMode:!0,...f,read(){this.push(u),this.push(null)}});let g;if(u&&u[r])g=!0,d=u[r]();else if(u&&u[s])g=!1,d=u[s]();else throw new a("iterable",["Iterable"],u);let y=new c({objectMode:!0,highWaterMark:1,...f}),w=!1;y._read=function(){w||(w=!0,b())},y._destroy=function(v,S){n(E(v),()=>t.nextTick(S,v),x=>t.nextTick(S,x||v))};async function E(v){let S=v!=null,x=typeof d.throw=="function";if(S&&x){let{value:T,done:I}=await d.throw(v);if(await T,I)return}if(typeof d.return=="function"){let{value:T}=await d.return();await T}}async function b(){for(;;){try{let{value:v,done:S}=g?await d.next():d.next();if(S)y.push(null);else{let x=v&&typeof v.then=="function"?await v:v;if(x===null)throw w=!1,new l;if(y.push(x))continue;w=!1}}catch(v){y.destroy(v)}break}}return y}e.exports=h}),Lo=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{ArrayPrototypeIndexOf:n,NumberIsInteger:r,NumberIsNaN:s,NumberParseInt:o,ObjectDefineProperties:a,ObjectKeys:l,ObjectSetPrototypeOf:h,Promise:c,SafeSet:u,SymbolAsyncIterator:f,Symbol:d}=bt();e.exports=M,M.ReadableState=ie;var{EventEmitter:g}=(Sr(),Qe(Bn)),{Stream:y,prependListener:w}=rc(),{Buffer:E}=(Pt(),Qe(Mt)),{addAbortSignal:b}=Mo(),v=fn(),S=Bi().debuglog("stream",p=>{S=p}),x=fb(),T=Er(),{getHighWaterMark:I,getDefaultHighWaterMark:A}=sc(),{aggregateTwoErrors:O,codes:{ERR_INVALID_ARG_TYPE:j,ERR_METHOD_NOT_IMPLEMENTED:K,ERR_OUT_OF_RANGE:R,ERR_STREAM_PUSH_AFTER_EOF:U,ERR_STREAM_UNSHIFT_AFTER_END_EVENT:V}}=Xt(),{validateObject:G}=Ao(),J=d("kPaused"),{StringDecoder:H}=(Ob(),Qe(gg)),W=_g();h(M.prototype,y.prototype),h(M,y);var se=()=>{},{errorOrDestroy:Z}=T;function ie(p,m,P){typeof P!="boolean"&&(P=m instanceof Ui()),this.objectMode=!!(p&&p.objectMode),P&&(this.objectMode=this.objectMode||!!(p&&p.readableObjectMode)),this.highWaterMark=p?I(this,p,"readableHighWaterMark",P):A(!1),this.buffer=new x,this.length=0,this.pipes=[],this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.constructed=!0,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this[J]=null,this.errorEmitted=!1,this.emitClose=!p||p.emitClose!==!1,this.autoDestroy=!p||p.autoDestroy!==!1,this.destroyed=!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this.defaultEncoding=p&&p.defaultEncoding||"utf8",this.awaitDrainWriters=null,this.multiAwaitDrain=!1,this.readingMore=!1,this.dataEmitted=!1,this.decoder=null,this.encoding=null,p&&p.encoding&&(this.decoder=new H(p.encoding),this.encoding=p.encoding)}function M(p){if(!(this instanceof M))return new M(p);let m=this instanceof Ui();this._readableState=new ie(p,this,m),p&&(typeof p.read=="function"&&(this._read=p.read),typeof p.destroy=="function"&&(this._destroy=p.destroy),typeof p.construct=="function"&&(this._construct=p.construct),p.signal&&!m&&b(p.signal,this)),y.call(this,p),T.construct(this,()=>{this._readableState.needReadable&&ae(this,this._readableState)})}M.prototype.destroy=T.destroy,M.prototype._undestroy=T.undestroy,M.prototype._destroy=function(p,m){m(p)},M.prototype[g.captureRejectionSymbol]=function(p){this.destroy(p)},M.prototype.push=function(p,m){return q(this,p,m,!1)},M.prototype.unshift=function(p,m){return q(this,p,m,!0)};function q(p,m,P,D){S("readableAddChunk",m);let C=p._readableState,N;if(C.objectMode||(typeof m=="string"?(P=P||C.defaultEncoding,C.encoding!==P&&(D&&C.encoding?m=E.from(m,P).toString(C.encoding):(m=E.from(m,P),P=""))):m instanceof E?P="":y._isUint8Array(m)?(m=y._uint8ArrayToBuffer(m),P=""):m!=null&&(N=new j("chunk",["string","Buffer","Uint8Array"],m))),N)Z(p,N);else if(m===null)C.reading=!1,L(p,C);else if(C.objectMode||m&&m.length>0)if(D)if(C.endEmitted)Z(p,new V);else{if(C.destroyed||C.errored)return!1;$(p,C,m,!0)}else if(C.ended)Z(p,new U);else{if(C.destroyed||C.errored)return!1;C.reading=!1,C.decoder&&!P?(m=C.decoder.write(m),C.objectMode||m.length!==0?$(p,C,m,!1):ae(p,C)):$(p,C,m,!1)}else D||(C.reading=!1,ae(p,C));return!C.ended&&(C.length<C.highWaterMark||C.length===0)}function $(p,m,P,D){m.flowing&&m.length===0&&!m.sync&&p.listenerCount("data")>0?(m.multiAwaitDrain?m.awaitDrainWriters.clear():m.awaitDrainWriters=null,m.dataEmitted=!0,p.emit("data",P)):(m.length+=m.objectMode?1:P.length,D?m.buffer.unshift(P):m.buffer.push(P),m.needReadable&&Q(p)),ae(p,m)}M.prototype.isPaused=function(){let p=this._readableState;return p[J]===!0||p.flowing===!1},M.prototype.setEncoding=function(p){let m=new H(p);this._readableState.decoder=m,this._readableState.encoding=this._readableState.decoder.encoding;let P=this._readableState.buffer,D="";for(let C of P)D+=m.write(C);return P.clear(),D!==""&&P.push(D),this._readableState.length=D.length,this};var we=1073741824;function oe(p){if(p>we)throw new R("size","<= 1GiB",p);return p--,p|=p>>>1,p|=p>>>2,p|=p>>>4,p|=p>>>8,p|=p>>>16,p++,p}function F(p,m){return p<=0||m.length===0&&m.ended?0:m.objectMode?1:s(p)?m.flowing&&m.length?m.buffer.first().length:m.length:p<=m.length?p:m.ended?m.length:0}M.prototype.read=function(p){S("read",p),p===void 0?p=NaN:r(p)||(p=o(p,10));let m=this._readableState,P=p;if(p>m.highWaterMark&&(m.highWaterMark=oe(p)),p!==0&&(m.emittedReadable=!1),p===0&&m.needReadable&&((m.highWaterMark!==0?m.length>=m.highWaterMark:m.length>0)||m.ended))return S("read: emitReadable",m.length,m.ended),m.length===0&&m.ended?be(this):Q(this),null;if(p=F(p,m),p===0&&m.ended)return m.length===0&&be(this),null;let D=m.needReadable;if(S("need readable",D),(m.length===0||m.length-p<m.highWaterMark)&&(D=!0,S("length less than watermark",D)),m.ended||m.reading||m.destroyed||m.errored||!m.constructed)D=!1,S("reading, ended or constructing",D);else if(D){S("do read"),m.reading=!0,m.sync=!0,m.length===0&&(m.needReadable=!0);try{this._read(m.highWaterMark)}catch(N){Z(this,N)}m.sync=!1,m.reading||(p=F(P,m))}let C;return p>0?C=te(p,m):C=null,C===null?(m.needReadable=m.length<=m.highWaterMark,p=0):(m.length-=p,m.multiAwaitDrain?m.awaitDrainWriters.clear():m.awaitDrainWriters=null),m.length===0&&(m.ended||(m.needReadable=!0),P!==p&&m.ended&&be(this)),C!==null&&!m.errorEmitted&&!m.closeEmitted&&(m.dataEmitted=!0,this.emit("data",C)),C};function L(p,m){if(S("onEofChunk"),!m.ended){if(m.decoder){let P=m.decoder.end();P&&P.length&&(m.buffer.push(P),m.length+=m.objectMode?1:P.length)}m.ended=!0,m.sync?Q(p):(m.needReadable=!1,m.emittedReadable=!0,he(p))}}function Q(p){let m=p._readableState;S("emitReadable",m.needReadable,m.emittedReadable),m.needReadable=!1,m.emittedReadable||(S("emitReadable",m.flowing),m.emittedReadable=!0,t.nextTick(he,p))}function he(p){let m=p._readableState;S("emitReadable_",m.destroyed,m.length,m.ended),!m.destroyed&&!m.errored&&(m.length||m.ended)&&(p.emit("readable"),m.emittedReadable=!1),m.needReadable=!m.flowing&&!m.ended&&m.length<=m.highWaterMark,le(p)}function ae(p,m){!m.readingMore&&m.constructed&&(m.readingMore=!0,t.nextTick(re,p,m))}function re(p,m){for(;!m.reading&&!m.ended&&(m.length<m.highWaterMark||m.flowing&&m.length===0);){let P=m.length;if(S("maybeReadMore read 0"),p.read(0),P===m.length)break}m.readingMore=!1}M.prototype._read=function(p){throw new K("_read()")},M.prototype.pipe=function(p,m){let P=this,D=this._readableState;D.pipes.length===1&&(D.multiAwaitDrain||(D.multiAwaitDrain=!0,D.awaitDrainWriters=new u(D.awaitDrainWriters?[D.awaitDrainWriters]:[]))),D.pipes.push(p),S("pipe count=%d opts=%j",D.pipes.length,m);let C=(!m||m.end!==!1)&&p!==t.stdout&&p!==t.stderr?ee:pt;D.endEmitted?t.nextTick(C):P.once("end",C),p.on("unpipe",N);function N(et,tt){S("onunpipe"),et===P&&tt&&tt.hasUnpiped===!1&&(tt.hasUnpiped=!0,ve())}function ee(){S("onend"),p.end()}let me,fe=!1;function ve(){S("cleanup"),p.removeListener("close",Lt),p.removeListener("finish",ze),me&&p.removeListener("drain",me),p.removeListener("error",rt),p.removeListener("unpipe",N),P.removeListener("end",ee),P.removeListener("end",pt),P.removeListener("data",Me),fe=!0,me&&D.awaitDrainWriters&&(!p._writableState||p._writableState.needDrain)&&me()}function xe(){fe||(D.pipes.length===1&&D.pipes[0]===p?(S("false write response, pause",0),D.awaitDrainWriters=p,D.multiAwaitDrain=!1):D.pipes.length>1&&D.pipes.includes(p)&&(S("false write response, pause",D.awaitDrainWriters.size),D.awaitDrainWriters.add(p)),P.pause()),me||(me=ue(P,p),p.on("drain",me))}P.on("data",Me);function Me(et){S("ondata");let tt=p.write(et);S("dest.write",tt),tt===!1&&xe()}function rt(et){if(S("onerror",et),pt(),p.removeListener("error",rt),p.listenerCount("error")===0){let tt=p._writableState||p._readableState;tt&&!tt.errorEmitted?Z(p,et):p.emit("error",et)}}w(p,"error",rt);function Lt(){p.removeListener("finish",ze),pt()}p.once("close",Lt);function ze(){S("onfinish"),p.removeListener("close",Lt),pt()}p.once("finish",ze);function pt(){S("unpipe"),P.unpipe(p)}return p.emit("pipe",P),p.writableNeedDrain===!0?D.flowing&&xe():D.flowing||(S("pipe resume"),P.resume()),p};function ue(p,m){return function(){let P=p._readableState;P.awaitDrainWriters===m?(S("pipeOnDrain",1),P.awaitDrainWriters=null):P.multiAwaitDrain&&(S("pipeOnDrain",P.awaitDrainWriters.size),P.awaitDrainWriters.delete(m)),(!P.awaitDrainWriters||P.awaitDrainWriters.size===0)&&p.listenerCount("data")&&p.resume()}}M.prototype.unpipe=function(p){let m=this._readableState,P={hasUnpiped:!1};if(m.pipes.length===0)return this;if(!p){let C=m.pipes;m.pipes=[],this.pause();for(let N=0;N<C.length;N++)C[N].emit("unpipe",this,{hasUnpiped:!1});return this}let D=n(m.pipes,p);return D===-1?this:(m.pipes.splice(D,1),m.pipes.length===0&&this.pause(),p.emit("unpipe",this,P),this)},M.prototype.on=function(p,m){let P=y.prototype.on.call(this,p,m),D=this._readableState;return p==="data"?(D.readableListening=this.listenerCount("readable")>0,D.flowing!==!1&&this.resume()):p==="readable"&&!D.endEmitted&&!D.readableListening&&(D.readableListening=D.needReadable=!0,D.flowing=!1,D.emittedReadable=!1,S("on readable",D.length,D.reading),D.length?Q(this):D.reading||t.nextTick(k,this)),P},M.prototype.addListener=M.prototype.on,M.prototype.removeListener=function(p,m){let P=y.prototype.removeListener.call(this,p,m);return p==="readable"&&t.nextTick(de,this),P},M.prototype.off=M.prototype.removeListener,M.prototype.removeAllListeners=function(p){let m=y.prototype.removeAllListeners.apply(this,arguments);return(p==="readable"||p===void 0)&&t.nextTick(de,this),m};function de(p){let m=p._readableState;m.readableListening=p.listenerCount("readable")>0,m.resumeScheduled&&m[J]===!1?m.flowing=!0:p.listenerCount("data")>0?p.resume():m.readableListening||(m.flowing=null)}function k(p){S("readable nexttick read 0"),p.read(0)}M.prototype.resume=function(){let p=this._readableState;return p.flowing||(S("resume"),p.flowing=!p.readableListening,X(this,p)),p[J]=!1,this};function X(p,m){m.resumeScheduled||(m.resumeScheduled=!0,t.nextTick(Y,p,m))}function Y(p,m){S("resume",m.reading),m.reading||p.read(0),m.resumeScheduled=!1,p.emit("resume"),le(p),m.flowing&&!m.reading&&p.read(0)}M.prototype.pause=function(){return S("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(S("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState[J]=!0,this};function le(p){let m=p._readableState;for(S("flow",m.flowing);m.flowing&&p.read()!==null;);}M.prototype.wrap=function(p){let m=!1;p.on("data",D=>{!this.push(D)&&p.pause&&(m=!0,p.pause())}),p.on("end",()=>{this.push(null)}),p.on("error",D=>{Z(this,D)}),p.on("close",()=>{this.destroy()}),p.on("destroy",()=>{this.destroy()}),this._read=()=>{m&&p.resume&&(m=!1,p.resume())};let P=l(p);for(let D=1;D<P.length;D++){let C=P[D];this[C]===void 0&&typeof p[C]=="function"&&(this[C]=p[C].bind(p))}return this},M.prototype[f]=function(){return ne(this)},M.prototype.iterator=function(p){return p!==void 0&&G(p,"options"),ne(this,p)};function ne(p,m){typeof p.read!="function"&&(p=M.wrap(p,{objectMode:!0}));let P=z(p,m);return P.stream=p,P}async function*z(p,m){let P=se;function D(ee){this===p?(P(),P=se):P=ee}p.on("readable",D);let C,N=v(p,{writable:!1},ee=>{C=ee?O(C,ee):null,P(),P=se});try{for(;;){let ee=p.destroyed?null:p.read();if(ee!==null)yield ee;else{if(C)throw C;if(C===null)return;await new c(D)}}}catch(ee){throw C=O(C,ee),C}finally{(C||(m==null?void 0:m.destroyOnReturn)!==!1)&&(C===void 0||p._readableState.autoDestroy)?T.destroyer(p,null):(p.off("readable",D),N())}}a(M.prototype,{readable:{__proto__:null,get(){let p=this._readableState;return!!p&&p.readable!==!1&&!p.destroyed&&!p.errorEmitted&&!p.endEmitted},set(p){this._readableState&&(this._readableState.readable=!!p)}},readableDidRead:{__proto__:null,enumerable:!1,get:function(){return this._readableState.dataEmitted}},readableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._readableState.readable!==!1&&(this._readableState.destroyed||this._readableState.errored)&&!this._readableState.endEmitted)}},readableHighWaterMark:{__proto__:null,enumerable:!1,get:function(){return this._readableState.highWaterMark}},readableBuffer:{__proto__:null,enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}},readableFlowing:{__proto__:null,enumerable:!1,get:function(){return this._readableState.flowing},set:function(p){this._readableState&&(this._readableState.flowing=p)}},readableLength:{__proto__:null,enumerable:!1,get(){return this._readableState.length}},readableObjectMode:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.objectMode:!1}},readableEncoding:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.encoding:null}},errored:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.errored:null}},closed:{__proto__:null,get(){return this._readableState?this._readableState.closed:!1}},destroyed:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.destroyed:!1},set(p){this._readableState&&(this._readableState.destroyed=p)}},readableEnded:{__proto__:null,enumerable:!1,get(){return this._readableState?this._readableState.endEmitted:!1}}}),a(ie.prototype,{pipesCount:{__proto__:null,get(){return this.pipes.length}},paused:{__proto__:null,get(){return this[J]!==!1},set(p){this[J]=!!p}}}),M._fromList=te;function te(p,m){if(m.length===0)return null;let P;return m.objectMode?P=m.buffer.shift():!p||p>=m.length?(m.decoder?P=m.buffer.join(""):m.buffer.length===1?P=m.buffer.first():P=m.buffer.concat(m.length),m.buffer.clear()):P=m.buffer.consume(p,m.decoder),P}function be(p){let m=p._readableState;S("endReadable",m.endEmitted),m.endEmitted||(m.ended=!0,t.nextTick(Se,m,p))}function Se(p,m){if(S("endReadableNT",p.endEmitted,p.length),!p.errored&&!p.closeEmitted&&!p.endEmitted&&p.length===0){if(p.endEmitted=!0,m.emit("end"),m.writable&&m.allowHalfOpen===!1)t.nextTick(Re,m);else if(p.autoDestroy){let P=m._writableState;(!P||P.autoDestroy&&(P.finished||P.writable===!1))&&m.destroy()}}}function Re(p){p.writable&&!p.writableEnded&&!p.destroyed&&p.end()}M.from=function(p,m){return W(M,p,m)};var Ae;function _(){return Ae===void 0&&(Ae={}),Ae}M.fromWeb=function(p,m){return _().newStreamReadableFromReadableStream(p,m)},M.toWeb=function(p,m){return _().newReadableStreamFromStreamReadable(p,m)},M.wrap=function(p,m){var P,D;return new M({objectMode:(P=(D=p.readableObjectMode)!==null&&D!==void 0?D:p.objectMode)!==null&&P!==void 0?P:!0,...m,destroy(C,N){T.destroyer(p,C),N(C)}}).wrap(p)}}),mg=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{ArrayPrototypeSlice:n,Error:r,FunctionPrototypeSymbolHasInstance:s,ObjectDefineProperty:o,ObjectDefineProperties:a,ObjectSetPrototypeOf:l,StringPrototypeToLowerCase:h,Symbol:c,SymbolHasInstance:u}=bt();e.exports=H,H.WritableState=G;var{EventEmitter:f}=(Sr(),Qe(Bn)),d=rc().Stream,{Buffer:g}=(Pt(),Qe(Mt)),y=Er(),{addAbortSignal:w}=Mo(),{getHighWaterMark:E,getDefaultHighWaterMark:b}=sc(),{ERR_INVALID_ARG_TYPE:v,ERR_METHOD_NOT_IMPLEMENTED:S,ERR_MULTIPLE_CALLBACK:x,ERR_STREAM_CANNOT_PIPE:T,ERR_STREAM_DESTROYED:I,ERR_STREAM_ALREADY_FINISHED:A,ERR_STREAM_NULL_VALUES:O,ERR_STREAM_WRITE_AFTER_END:j,ERR_UNKNOWN_ENCODING:K}=Xt().codes,{errorOrDestroy:R}=y;l(H.prototype,d.prototype),l(H,d);function U(){}var V=c("kOnFinished");function G(k,X,Y){typeof Y!="boolean"&&(Y=X instanceof Ui()),this.objectMode=!!(k&&k.objectMode),Y&&(this.objectMode=this.objectMode||!!(k&&k.writableObjectMode)),this.highWaterMark=k?E(this,k,"writableHighWaterMark",Y):b(!1),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;let le=!!(k&&k.decodeStrings===!1);this.decodeStrings=!le,this.defaultEncoding=k&&k.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=M.bind(void 0,X),this.writecb=null,this.writelen=0,this.afterWriteTickInfo=null,J(this),this.pendingcb=0,this.constructed=!0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!k||k.emitClose!==!1,this.autoDestroy=!k||k.autoDestroy!==!1,this.errored=null,this.closed=!1,this.closeEmitted=!1,this[V]=[]}function J(k){k.buffered=[],k.bufferedIndex=0,k.allBuffers=!0,k.allNoop=!0}G.prototype.getBuffer=function(){return n(this.buffered,this.bufferedIndex)},o(G.prototype,"bufferedRequestCount",{__proto__:null,get(){return this.buffered.length-this.bufferedIndex}});function H(k){let X=this instanceof Ui();if(!X&&!s(H,this))return new H(k);this._writableState=new G(k,this,X),k&&(typeof k.write=="function"&&(this._write=k.write),typeof k.writev=="function"&&(this._writev=k.writev),typeof k.destroy=="function"&&(this._destroy=k.destroy),typeof k.final=="function"&&(this._final=k.final),typeof k.construct=="function"&&(this._construct=k.construct),k.signal&&w(k.signal,this)),d.call(this,k),y.construct(this,()=>{let Y=this._writableState;Y.writing||oe(this,Y),he(this,Y)})}o(H,u,{__proto__:null,value:function(k){return s(this,k)?!0:this!==H?!1:k&&k._writableState instanceof G}}),H.prototype.pipe=function(){R(this,new T)};function W(k,X,Y,le){let ne=k._writableState;if(typeof Y=="function")le=Y,Y=ne.defaultEncoding;else{if(!Y)Y=ne.defaultEncoding;else if(Y!=="buffer"&&!g.isEncoding(Y))throw new K(Y);typeof le!="function"&&(le=U)}if(X===null)throw new O;if(!ne.objectMode)if(typeof X=="string")ne.decodeStrings!==!1&&(X=g.from(X,Y),Y="buffer");else if(X instanceof g)Y="buffer";else if(d._isUint8Array(X))X=d._uint8ArrayToBuffer(X),Y="buffer";else throw new v("chunk",["string","Buffer","Uint8Array"],X);let z;return ne.ending?z=new j:ne.destroyed&&(z=new I("write")),z?(t.nextTick(le,z),R(k,z,!0),z):(ne.pendingcb++,se(k,ne,X,Y,le))}H.prototype.write=function(k,X,Y){return W(this,k,X,Y)===!0},H.prototype.cork=function(){this._writableState.corked++},H.prototype.uncork=function(){let k=this._writableState;k.corked&&(k.corked--,k.writing||oe(this,k))},H.prototype.setDefaultEncoding=function(k){if(typeof k=="string"&&(k=h(k)),!g.isEncoding(k))throw new K(k);return this._writableState.defaultEncoding=k,this};function se(k,X,Y,le,ne){let z=X.objectMode?1:Y.length;X.length+=z;let te=X.length<X.highWaterMark;return te||(X.needDrain=!0),X.writing||X.corked||X.errored||!X.constructed?(X.buffered.push({chunk:Y,encoding:le,callback:ne}),X.allBuffers&&le!=="buffer"&&(X.allBuffers=!1),X.allNoop&&ne!==U&&(X.allNoop=!1)):(X.writelen=z,X.writecb=ne,X.writing=!0,X.sync=!0,k._write(Y,le,X.onwrite),X.sync=!1),te&&!X.errored&&!X.destroyed}function Z(k,X,Y,le,ne,z,te){X.writelen=le,X.writecb=te,X.writing=!0,X.sync=!0,X.destroyed?X.onwrite(new I("write")):Y?k._writev(ne,X.onwrite):k._write(ne,z,X.onwrite),X.sync=!1}function ie(k,X,Y,le){--X.pendingcb,le(Y),we(X),R(k,Y)}function M(k,X){let Y=k._writableState,le=Y.sync,ne=Y.writecb;if(typeof ne!="function"){R(k,new x);return}Y.writing=!1,Y.writecb=null,Y.length-=Y.writelen,Y.writelen=0,X?(X.stack,Y.errored||(Y.errored=X),k._readableState&&!k._readableState.errored&&(k._readableState.errored=X),le?t.nextTick(ie,k,Y,X,ne):ie(k,Y,X,ne)):(Y.buffered.length>Y.bufferedIndex&&oe(k,Y),le?Y.afterWriteTickInfo!==null&&Y.afterWriteTickInfo.cb===ne?Y.afterWriteTickInfo.count++:(Y.afterWriteTickInfo={count:1,cb:ne,stream:k,state:Y},t.nextTick(q,Y.afterWriteTickInfo)):$(k,Y,1,ne))}function q({stream:k,state:X,count:Y,cb:le}){return X.afterWriteTickInfo=null,$(k,X,Y,le)}function $(k,X,Y,le){for(!X.ending&&!k.destroyed&&X.length===0&&X.needDrain&&(X.needDrain=!1,k.emit("drain"));Y-- >0;)X.pendingcb--,le();X.destroyed&&we(X),he(k,X)}function we(k){if(k.writing)return;for(let ne=k.bufferedIndex;ne<k.buffered.length;++ne){var X;let{chunk:z,callback:te}=k.buffered[ne],be=k.objectMode?1:z.length;k.length-=be,te((X=k.errored)!==null&&X!==void 0?X:new I("write"))}let Y=k[V].splice(0);for(let ne=0;ne<Y.length;ne++){var le;Y[ne]((le=k.errored)!==null&&le!==void 0?le:new I("end"))}J(k)}function oe(k,X){if(X.corked||X.bufferProcessing||X.destroyed||!X.constructed)return;let{buffered:Y,bufferedIndex:le,objectMode:ne}=X,z=Y.length-le;if(!z)return;let te=le;if(X.bufferProcessing=!0,z>1&&k._writev){X.pendingcb-=z-1;let be=X.allNoop?U:Re=>{for(let Ae=te;Ae<Y.length;++Ae)Y[Ae].callback(Re)},Se=X.allNoop&&te===0?Y:n(Y,te);Se.allBuffers=X.allBuffers,Z(k,X,!0,X.length,Se,"",be),J(X)}else{do{let{chunk:be,encoding:Se,callback:Re}=Y[te];Y[te++]=null;let Ae=ne?1:be.length;Z(k,X,!1,Ae,be,Se,Re)}while(te<Y.length&&!X.writing);te===Y.length?J(X):te>256?(Y.splice(0,te),X.bufferedIndex=0):X.bufferedIndex=te}X.bufferProcessing=!1}H.prototype._write=function(k,X,Y){if(this._writev)this._writev([{chunk:k,encoding:X}],Y);else throw new S("_write()")},H.prototype._writev=null,H.prototype.end=function(k,X,Y){let le=this._writableState;typeof k=="function"?(Y=k,k=null,X=null):typeof X=="function"&&(Y=X,X=null);let ne;if(k!=null){let z=W(this,k,X);z instanceof r&&(ne=z)}return le.corked&&(le.corked=1,this.uncork()),ne||(!le.errored&&!le.ending?(le.ending=!0,he(this,le,!0),le.ended=!0):le.finished?ne=new A("end"):le.destroyed&&(ne=new I("end"))),typeof Y=="function"&&(ne||le.finished?t.nextTick(Y,ne):le[V].push(Y)),this};function F(k){return k.ending&&!k.destroyed&&k.constructed&&k.length===0&&!k.errored&&k.buffered.length===0&&!k.finished&&!k.writing&&!k.errorEmitted&&!k.closeEmitted}function L(k,X){let Y=!1;function le(ne){if(Y){R(k,ne??x());return}if(Y=!0,X.pendingcb--,ne){let z=X[V].splice(0);for(let te=0;te<z.length;te++)z[te](ne);R(k,ne,X.sync)}else F(X)&&(X.prefinished=!0,k.emit("prefinish"),X.pendingcb++,t.nextTick(ae,k,X))}X.sync=!0,X.pendingcb++;try{k._final(le)}catch(ne){le(ne)}X.sync=!1}function Q(k,X){!X.prefinished&&!X.finalCalled&&(typeof k._final=="function"&&!X.destroyed?(X.finalCalled=!0,L(k,X)):(X.prefinished=!0,k.emit("prefinish")))}function he(k,X,Y){F(X)&&(Q(k,X),X.pendingcb===0&&(Y?(X.pendingcb++,t.nextTick((le,ne)=>{F(ne)?ae(le,ne):ne.pendingcb--},k,X)):F(X)&&(X.pendingcb++,ae(k,X))))}function ae(k,X){X.pendingcb--,X.finished=!0;let Y=X[V].splice(0);for(let le=0;le<Y.length;le++)Y[le]();if(k.emit("finish"),X.autoDestroy){let le=k._readableState;(!le||le.autoDestroy&&(le.endEmitted||le.readable===!1))&&k.destroy()}}a(H.prototype,{closed:{__proto__:null,get(){return this._writableState?this._writableState.closed:!1}},destroyed:{__proto__:null,get(){return this._writableState?this._writableState.destroyed:!1},set(k){this._writableState&&(this._writableState.destroyed=k)}},writable:{__proto__:null,get(){let k=this._writableState;return!!k&&k.writable!==!1&&!k.destroyed&&!k.errored&&!k.ending&&!k.ended},set(k){this._writableState&&(this._writableState.writable=!!k)}},writableFinished:{__proto__:null,get(){return this._writableState?this._writableState.finished:!1}},writableObjectMode:{__proto__:null,get(){return this._writableState?this._writableState.objectMode:!1}},writableBuffer:{__proto__:null,get(){return this._writableState&&this._writableState.getBuffer()}},writableEnded:{__proto__:null,get(){return this._writableState?this._writableState.ending:!1}},writableNeedDrain:{__proto__:null,get(){let k=this._writableState;return k?!k.destroyed&&!k.ending&&k.needDrain:!1}},writableHighWaterMark:{__proto__:null,get(){return this._writableState&&this._writableState.highWaterMark}},writableCorked:{__proto__:null,get(){return this._writableState?this._writableState.corked:0}},writableLength:{__proto__:null,get(){return this._writableState&&this._writableState.length}},errored:{__proto__:null,enumerable:!1,get(){return this._writableState?this._writableState.errored:null}},writableAborted:{__proto__:null,enumerable:!1,get:function(){return!!(this._writableState.writable!==!1&&(this._writableState.destroyed||this._writableState.errored)&&!this._writableState.finished)}}});var re=y.destroy;H.prototype.destroy=function(k,X){let Y=this._writableState;return!Y.destroyed&&(Y.bufferedIndex<Y.buffered.length||Y[V].length)&&t.nextTick(we,Y),re.call(this,k,X),this},H.prototype._undestroy=y.undestroy,H.prototype._destroy=function(k,X){X(k)},H.prototype[f.captureRejectionSymbol]=function(k){this.destroy(k)};var ue;function de(){return ue===void 0&&(ue={}),ue}H.fromWeb=function(k,X){return de().newStreamWritableFromWritableStream(k,X)},H.toWeb=function(k){return de().newWritableStreamFromStreamWritable(k)}}),kb=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),n=(Pt(),Qe(Mt)),{isReadable:r,isWritable:s,isIterable:o,isNodeStream:a,isReadableNodeStream:l,isWritableNodeStream:h,isDuplexNodeStream:c}=zi(),u=fn(),{AbortError:f,codes:{ERR_INVALID_ARG_TYPE:d,ERR_INVALID_RETURN_VALUE:g}}=Xt(),{destroyer:y}=Er(),w=Ui(),E=Lo(),{createDeferredPromise:b}=Bi(),v=_g(),S=globalThis.Blob||n.Blob,x=typeof S<"u"?function(K){return K instanceof S}:function(K){return!1},T=globalThis.AbortController||nc().AbortController,{FunctionPrototypeCall:I}=bt(),A=class extends w{constructor(K){super(K),(K==null?void 0:K.readable)===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),(K==null?void 0:K.writable)===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)}};e.exports=function K(R,U){if(c(R))return R;if(l(R))return j({readable:R});if(h(R))return j({writable:R});if(a(R))return j({writable:!1,readable:!1});if(typeof R=="function"){let{value:G,write:J,final:H,destroy:W}=O(R);if(o(G))return v(A,G,{objectMode:!0,write:J,final:H,destroy:W});let se=G==null?void 0:G.then;if(typeof se=="function"){let Z,ie=I(se,G,M=>{if(M!=null)throw new g("nully","body",M)},M=>{y(Z,M)});return Z=new A({objectMode:!0,readable:!1,write:J,final(M){H(async()=>{try{await ie,t.nextTick(M,null)}catch(q){t.nextTick(M,q)}})},destroy:W})}throw new g("Iterable, AsyncIterable or AsyncFunction",U,G)}if(x(R))return K(R.arrayBuffer());if(o(R))return v(A,R,{objectMode:!0,writable:!1});if(typeof(R==null?void 0:R.writable)=="object"||typeof(R==null?void 0:R.readable)=="object"){let G=R!=null&&R.readable?l(R==null?void 0:R.readable)?R==null?void 0:R.readable:K(R.readable):void 0,J=R!=null&&R.writable?h(R==null?void 0:R.writable)?R==null?void 0:R.writable:K(R.writable):void 0;return j({readable:G,writable:J})}let V=R==null?void 0:R.then;if(typeof V=="function"){let G;return I(V,R,J=>{J!=null&&G.push(J),G.push(null)},J=>{y(G,J)}),G=new A({objectMode:!0,writable:!1,read(){}})}throw new d(U,["Blob","ReadableStream","WritableStream","Stream","Iterable","AsyncIterable","Function","{ readable, writable } pair","Promise"],R)};function O(K){let{promise:R,resolve:U}=b(),V=new T,G=V.signal;return{value:K(async function*(){for(;;){let J=R;R=null;let{chunk:H,done:W,cb:se}=await J;if(t.nextTick(se),W)return;if(G.aborted)throw new f(void 0,{cause:G.reason});({promise:R,resolve:U}=b()),yield H}}(),{signal:G}),write(J,H,W){let se=U;U=null,se({chunk:J,done:!1,cb:W})},final(J){let H=U;U=null,H({done:!0,cb:J})},destroy(J,H){V.abort(),H(J)}}}function j(K){let R=K.readable&&typeof K.readable.read!="function"?E.wrap(K.readable):K.readable,U=K.writable,V=!!r(R),G=!!s(U),J,H,W,se,Z;function ie(M){let q=se;se=null,q?q(M):M&&Z.destroy(M)}return Z=new A({readableObjectMode:!!(R!=null&&R.readableObjectMode),writableObjectMode:!!(U!=null&&U.writableObjectMode),readable:V,writable:G}),G&&(u(U,M=>{G=!1,M&&y(R,M),ie(M)}),Z._write=function(M,q,$){U.write(M,q)?$():J=$},Z._final=function(M){U.end(),H=M},U.on("drain",function(){if(J){let M=J;J=null,M()}}),U.on("finish",function(){if(H){let M=H;H=null,M()}})),V&&(u(R,M=>{V=!1,M&&y(R,M),ie(M)}),R.on("readable",function(){if(W){let M=W;W=null,M()}}),R.on("end",function(){Z.push(null)}),Z._read=function(){for(;;){let M=R.read();if(M===null){W=Z._read;return}if(!Z.push(M))return}}),Z._destroy=function(M,q){!M&&se!==null&&(M=new f),W=null,J=null,H=null,se===null?q(M):(se=q,y(U,M),y(R,M))},Z}}),Ui=Ee((i,e)=>{ge(),_e(),pe();var{ObjectDefineProperties:t,ObjectGetOwnPropertyDescriptor:n,ObjectKeys:r,ObjectSetPrototypeOf:s}=bt();e.exports=l;var o=Lo(),a=mg();s(l.prototype,o.prototype),s(l,o);{let f=r(a.prototype);for(let d=0;d<f.length;d++){let g=f[d];l.prototype[g]||(l.prototype[g]=a.prototype[g])}}function l(f){if(!(this instanceof l))return new l(f);o.call(this,f),a.call(this,f),f?(this.allowHalfOpen=f.allowHalfOpen!==!1,f.readable===!1&&(this._readableState.readable=!1,this._readableState.ended=!0,this._readableState.endEmitted=!0),f.writable===!1&&(this._writableState.writable=!1,this._writableState.ending=!0,this._writableState.ended=!0,this._writableState.finished=!0)):this.allowHalfOpen=!0}t(l.prototype,{writable:{__proto__:null,...n(a.prototype,"writable")},writableHighWaterMark:{__proto__:null,...n(a.prototype,"writableHighWaterMark")},writableObjectMode:{__proto__:null,...n(a.prototype,"writableObjectMode")},writableBuffer:{__proto__:null,...n(a.prototype,"writableBuffer")},writableLength:{__proto__:null,...n(a.prototype,"writableLength")},writableFinished:{__proto__:null,...n(a.prototype,"writableFinished")},writableCorked:{__proto__:null,...n(a.prototype,"writableCorked")},writableEnded:{__proto__:null,...n(a.prototype,"writableEnded")},writableNeedDrain:{__proto__:null,...n(a.prototype,"writableNeedDrain")},destroyed:{__proto__:null,get(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set(f){this._readableState&&this._writableState&&(this._readableState.destroyed=f,this._writableState.destroyed=f)}}});var h;function c(){return h===void 0&&(h={}),h}l.fromWeb=function(f,d){return c().newStreamDuplexFromReadableWritablePair(f,d)},l.toWeb=function(f){return c().newReadableWritablePairFromDuplex(f)};var u;l.from=function(f){return u||(u=kb()),u(f,"body")}}),yg=Ee((i,e)=>{ge(),_e(),pe();var{ObjectSetPrototypeOf:t,Symbol:n}=bt();e.exports=l;var{ERR_METHOD_NOT_IMPLEMENTED:r}=Xt().codes,s=Ui(),{getHighWaterMark:o}=sc();t(l.prototype,s.prototype),t(l,s);var a=n("kCallback");function l(u){if(!(this instanceof l))return new l(u);let f=u?o(this,u,"readableHighWaterMark",!0):null;f===0&&(u={...u,highWaterMark:null,readableHighWaterMark:f,writableHighWaterMark:u.writableHighWaterMark||0}),s.call(this,u),this._readableState.sync=!1,this[a]=null,u&&(typeof u.transform=="function"&&(this._transform=u.transform),typeof u.flush=="function"&&(this._flush=u.flush)),this.on("prefinish",c)}function h(u){typeof this._flush=="function"&&!this.destroyed?this._flush((f,d)=>{if(f){u?u(f):this.destroy(f);return}d!=null&&this.push(d),this.push(null),u&&u()}):(this.push(null),u&&u())}function c(){this._final!==h&&h.call(this)}l.prototype._final=h,l.prototype._transform=function(u,f,d){throw new r("_transform()")},l.prototype._write=function(u,f,d){let g=this._readableState,y=this._writableState,w=g.length;this._transform(u,f,(E,b)=>{if(E){d(E);return}b!=null&&this.push(b),y.ended||w===g.length||g.length<g.highWaterMark?d():this[a]=d})},l.prototype._read=function(){if(this[a]){let u=this[a];this[a]=null,u()}}}),wg=Ee((i,e)=>{ge(),_e(),pe();var{ObjectSetPrototypeOf:t}=bt();e.exports=r;var n=yg();t(r.prototype,n.prototype),t(r,n);function r(s){if(!(this instanceof r))return new r(s);n.call(this,s)}r.prototype._transform=function(s,o,a){a(null,s)}}),lc=Ee((i,e)=>{ge(),_e(),pe();var t=Nn(),{ArrayIsArray:n,Promise:r,SymbolAsyncIterator:s}=bt(),o=fn(),{once:a}=Bi(),l=Er(),h=Ui(),{aggregateTwoErrors:c,codes:{ERR_INVALID_ARG_TYPE:u,ERR_INVALID_RETURN_VALUE:f,ERR_MISSING_ARGS:d,ERR_STREAM_DESTROYED:g,ERR_STREAM_PREMATURE_CLOSE:y},AbortError:w}=Xt(),{validateFunction:E,validateAbortSignal:b}=Ao(),{isIterable:v,isReadable:S,isReadableNodeStream:x,isNodeStream:T,isTransformStream:I,isWebStream:A,isReadableStream:O,isReadableEnded:j}=zi(),K=globalThis.AbortController||nc().AbortController,R,U;function V(q,$,we){let oe=!1;q.on("close",()=>{oe=!0});let F=o(q,{readable:$,writable:we},L=>{oe=!L});return{destroy:L=>{oe||(oe=!0,l.destroyer(q,L||new g("pipe")))},cleanup:F}}function G(q){return E(q[q.length-1],"streams[stream.length - 1]"),q.pop()}function J(q){if(v(q))return q;if(x(q))return H(q);throw new u("val",["Readable","Iterable","AsyncIterable"],q)}async function*H(q){U||(U=Lo()),yield*U.prototype[s].call(q)}async function W(q,$,we,{end:oe}){let F,L=null,Q=re=>{if(re&&(F=re),L){let ue=L;L=null,ue()}},he=()=>new r((re,ue)=>{F?ue(F):L=()=>{F?ue(F):re()}});$.on("drain",Q);let ae=o($,{readable:!1},Q);try{$.writableNeedDrain&&await he();for await(let re of q)$.write(re)||await he();oe&&$.end(),await he(),we()}catch(re){we(F!==re?c(F,re):re)}finally{ae(),$.off("drain",Q)}}async function se(q,$,we,{end:oe}){I($)&&($=$.writable);let F=$.getWriter();try{for await(let L of q)await F.ready,F.write(L).catch(()=>{});await F.ready,oe&&await F.close(),we()}catch(L){try{await F.abort(L),we(L)}catch(Q){we(Q)}}}function Z(...q){return ie(q,a(G(q)))}function ie(q,$,we){if(q.length===1&&n(q[0])&&(q=q[0]),q.length<2)throw new d("streams");let oe=new K,F=oe.signal,L=we==null?void 0:we.signal,Q=[];b(L,"options.signal");function he(){X(new w)}L==null||L.addEventListener("abort",he);let ae,re,ue=[],de=0;function k(z){X(z,--de===0)}function X(z,te){if(z&&(!ae||ae.code==="ERR_STREAM_PREMATURE_CLOSE")&&(ae=z),!(!ae&&!te)){for(;ue.length;)ue.shift()(ae);L==null||L.removeEventListener("abort",he),oe.abort(),te&&(ae||Q.forEach(be=>be()),t.nextTick($,ae,re))}}let Y;for(let z=0;z<q.length;z++){let te=q[z],be=z<q.length-1,Se=z>0,Re=be||(we==null?void 0:we.end)!==!1,Ae=z===q.length-1;if(T(te)){let _=function(p){p&&p.name!=="AbortError"&&p.code!=="ERR_STREAM_PREMATURE_CLOSE"&&k(p)};if(Re){let{destroy:p,cleanup:m}=V(te,be,Se);ue.push(p),S(te)&&Ae&&Q.push(m)}te.on("error",_),S(te)&&Ae&&Q.push(()=>{te.removeListener("error",_)})}if(z===0)if(typeof te=="function"){if(Y=te({signal:F}),!v(Y))throw new f("Iterable, AsyncIterable or Stream","source",Y)}else v(te)||x(te)||I(te)?Y=te:Y=h.from(te);else if(typeof te=="function"){if(I(Y)){var le;Y=J((le=Y)===null||le===void 0?void 0:le.readable)}else Y=J(Y);if(Y=te(Y,{signal:F}),be){if(!v(Y,!0))throw new f("AsyncIterable",`transform[${z-1}]`,Y)}else{var ne;R||(R=wg());let _=new R({objectMode:!0}),p=(ne=Y)===null||ne===void 0?void 0:ne.then;if(typeof p=="function")de++,p.call(Y,D=>{re=D,D!=null&&_.write(D),Re&&_.end(),t.nextTick(k)},D=>{_.destroy(D),t.nextTick(k,D)});else if(v(Y,!0))de++,W(Y,_,k,{end:Re});else if(O(Y)||I(Y)){let D=Y.readable||Y;de++,W(D,_,k,{end:Re})}else throw new f("AsyncIterable or Promise","destination",Y);Y=_;let{destroy:m,cleanup:P}=V(Y,!1,!0);ue.push(m),Ae&&Q.push(P)}}else if(T(te)){if(x(Y)){de+=2;let _=M(Y,te,k,{end:Re});S(te)&&Ae&&Q.push(_)}else if(I(Y)||O(Y)){let _=Y.readable||Y;de++,W(_,te,k,{end:Re})}else if(v(Y))de++,W(Y,te,k,{end:Re});else throw new u("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Y);Y=te}else if(A(te)){if(x(Y))de++,se(J(Y),te,k,{end:Re});else if(O(Y)||v(Y))de++,se(Y,te,k,{end:Re});else if(I(Y))de++,se(Y.readable,te,k,{end:Re});else throw new u("val",["Readable","Iterable","AsyncIterable","ReadableStream","TransformStream"],Y);Y=te}else Y=h.from(te)}return(F!=null&&F.aborted||L!=null&&L.aborted)&&t.nextTick(he),Y}function M(q,$,we,{end:oe}){let F=!1;if($.on("close",()=>{F||we(new y)}),q.pipe($,{end:!1}),oe){let L=function(){F=!0,$.end()};j(q)?t.nextTick(L):q.once("end",L)}else we();return o(q,{readable:!0,writable:!1},L=>{let Q=q._readableState;L&&L.code==="ERR_STREAM_PREMATURE_CLOSE"&&Q&&Q.ended&&!Q.errored&&!Q.errorEmitted?q.once("end",we).once("error",we):we(L)}),o($,{readable:!1,writable:!0},we)}e.exports={pipelineImpl:ie,pipeline:Z}}),bg=Ee((i,e)=>{ge(),_e(),pe();var{pipeline:t}=lc(),n=Ui(),{destroyer:r}=Er(),{isNodeStream:s,isReadable:o,isWritable:a,isWebStream:l,isTransformStream:h,isWritableStream:c,isReadableStream:u}=zi(),{AbortError:f,codes:{ERR_INVALID_ARG_VALUE:d,ERR_MISSING_ARGS:g}}=Xt(),y=fn();e.exports=function(...w){if(w.length===0)throw new g("streams");if(w.length===1)return n.from(w[0]);let E=[...w];if(typeof w[0]=="function"&&(w[0]=n.from(w[0])),typeof w[w.length-1]=="function"){let R=w.length-1;w[R]=n.from(w[R])}for(let R=0;R<w.length;++R)if(!(!s(w[R])&&!l(w[R]))){if(R<w.length-1&&!(o(w[R])||u(w[R])||h(w[R])))throw new d(`streams[${R}]`,E[R],"must be readable");if(R>0&&!(a(w[R])||c(w[R])||h(w[R])))throw new d(`streams[${R}]`,E[R],"must be writable")}let b,v,S,x,T;function I(R){let U=x;x=null,U?U(R):R?T.destroy(R):!K&&!j&&T.destroy()}let A=w[0],O=t(w,I),j=!!(a(A)||c(A)||h(A)),K=!!(o(O)||u(O)||h(O));if(T=new n({writableObjectMode:!!(A!=null&&A.writableObjectMode),readableObjectMode:!!(O!=null&&O.writableObjectMode),writable:j,readable:K}),j){if(s(A))T._write=function(U,V,G){A.write(U,V)?G():b=G},T._final=function(U){A.end(),v=U},A.on("drain",function(){if(b){let U=b;b=null,U()}});else if(l(A)){let U=(h(A)?A.writable:A).getWriter();T._write=async function(V,G,J){try{await U.ready,U.write(V).catch(()=>{}),J()}catch(H){J(H)}},T._final=async function(V){try{await U.ready,U.close().catch(()=>{}),v=V}catch(G){V(G)}}}let R=h(O)?O.readable:O;y(R,()=>{if(v){let U=v;v=null,U()}})}if(K){if(s(O))O.on("readable",function(){if(S){let R=S;S=null,R()}}),O.on("end",function(){T.push(null)}),T._read=function(){for(;;){let R=O.read();if(R===null){S=T._read;return}if(!T.push(R))return}};else if(l(O)){let R=(h(O)?O.readable:O).getReader();T._read=async function(){for(;;)try{let{value:U,done:V}=await R.read();if(!T.push(U))return;if(V){T.push(null);return}}catch{return}}}}return T._destroy=function(R,U){!R&&x!==null&&(R=new f),S=null,b=null,v=null,x===null?U(R):(x=U,s(O)&&r(O,R))},T}}),Db=Ee((i,e)=>{ge(),_e(),pe();var t=globalThis.AbortController||nc().AbortController,{codes:{ERR_INVALID_ARG_VALUE:n,ERR_INVALID_ARG_TYPE:r,ERR_MISSING_ARGS:s,ERR_OUT_OF_RANGE:o},AbortError:a}=Xt(),{validateAbortSignal:l,validateInteger:h,validateObject:c}=Ao(),u=bt().Symbol("kWeak"),{finished:f}=fn(),d=bg(),{addAbortSignalNoValidate:g}=Mo(),{isWritable:y,isNodeStream:w}=zi(),{ArrayPrototypePush:E,MathFloor:b,Number:v,NumberIsNaN:S,Promise:x,PromiseReject:T,PromisePrototypeThen:I,Symbol:A}=bt(),O=A("kEmpty"),j=A("kEof");function K(oe,F){if(F!=null&&c(F,"options"),(F==null?void 0:F.signal)!=null&&l(F.signal,"options.signal"),w(oe)&&!y(oe))throw new n("stream",oe,"must be writable");let L=d(this,oe);return F!=null&&F.signal&&g(F.signal,L),L}function R(oe,F){if(typeof oe!="function")throw new r("fn",["Function","AsyncFunction"],oe);F!=null&&c(F,"options"),(F==null?void 0:F.signal)!=null&&l(F.signal,"options.signal");let L=1;return(F==null?void 0:F.concurrency)!=null&&(L=b(F.concurrency)),h(L,"concurrency",1),(async function*(){var Q,he;let ae=new t,re=this,ue=[],de=ae.signal,k={signal:de},X=()=>ae.abort();F!=null&&(Q=F.signal)!==null&&Q!==void 0&&Q.aborted&&X(),F==null||(he=F.signal)===null||he===void 0||he.addEventListener("abort",X);let Y,le,ne=!1;function z(){ne=!0}async function te(){try{for await(let Re of re){var be;if(ne)return;if(de.aborted)throw new a;try{Re=oe(Re,k)}catch(Ae){Re=T(Ae)}Re!==O&&(typeof((be=Re)===null||be===void 0?void 0:be.catch)=="function"&&Re.catch(z),ue.push(Re),Y&&(Y(),Y=null),!ne&&ue.length&&ue.length>=L&&await new x(Ae=>{le=Ae}))}ue.push(j)}catch(Re){let Ae=T(Re);I(Ae,void 0,z),ue.push(Ae)}finally{var Se;ne=!0,Y&&(Y(),Y=null),F==null||(Se=F.signal)===null||Se===void 0||Se.removeEventListener("abort",X)}}te();try{for(;;){for(;ue.length>0;){let be=await ue[0];if(be===j)return;if(de.aborted)throw new a;be!==O&&(yield be),ue.shift(),le&&(le(),le=null)}await new x(be=>{Y=be})}}finally{ae.abort(),ne=!0,le&&(le(),le=null)}}).call(this)}function U(oe=void 0){return oe!=null&&c(oe,"options"),(oe==null?void 0:oe.signal)!=null&&l(oe.signal,"options.signal"),(async function*(){let F=0;for await(let Q of this){var L;if(oe!=null&&(L=oe.signal)!==null&&L!==void 0&&L.aborted)throw new a({cause:oe.signal.reason});yield[F++,Q]}}).call(this)}async function V(oe,F=void 0){for await(let L of W.call(this,oe,F))return!0;return!1}async function G(oe,F=void 0){if(typeof oe!="function")throw new r("fn",["Function","AsyncFunction"],oe);return!await V.call(this,async(...L)=>!await oe(...L),F)}async function J(oe,F){for await(let L of W.call(this,oe,F))return L}async function H(oe,F){if(typeof oe!="function")throw new r("fn",["Function","AsyncFunction"],oe);async function L(Q,he){return await oe(Q,he),O}for await(let Q of R.call(this,L,F));}function W(oe,F){if(typeof oe!="function")throw new r("fn",["Function","AsyncFunction"],oe);async function L(Q,he){return await oe(Q,he)?Q:O}return R.call(this,L,F)}var se=class extends s{constructor(){super("reduce"),this.message="Reduce of an empty stream requires an initial value"}};async function Z(oe,F,L){var Q;if(typeof oe!="function")throw new r("reducer",["Function","AsyncFunction"],oe);L!=null&&c(L,"options"),(L==null?void 0:L.signal)!=null&&l(L.signal,"options.signal");let he=arguments.length>1;if(L!=null&&(Q=L.signal)!==null&&Q!==void 0&&Q.aborted){let k=new a(void 0,{cause:L.signal.reason});throw this.once("error",()=>{}),await f(this.destroy(k)),k}let ae=new t,re=ae.signal;if(L!=null&&L.signal){let k={once:!0,[u]:this};L.signal.addEventListener("abort",()=>ae.abort(),k)}let ue=!1;try{for await(let k of this){var de;if(ue=!0,L!=null&&(de=L.signal)!==null&&de!==void 0&&de.aborted)throw new a;he?F=await oe(F,k,{signal:re}):(F=k,he=!0)}if(!ue&&!he)throw new se}finally{ae.abort()}return F}async function ie(oe){oe!=null&&c(oe,"options"),(oe==null?void 0:oe.signal)!=null&&l(oe.signal,"options.signal");let F=[];for await(let Q of this){var L;if(oe!=null&&(L=oe.signal)!==null&&L!==void 0&&L.aborted)throw new a(void 0,{cause:oe.signal.reason});E(F,Q)}return F}function M(oe,F){let L=R.call(this,oe,F);return(async function*(){for await(let Q of L)yield*Q}).call(this)}function q(oe){if(oe=v(oe),S(oe))return 0;if(oe<0)throw new o("number",">= 0",oe);return oe}function $(oe,F=void 0){return F!=null&&c(F,"options"),(F==null?void 0:F.signal)!=null&&l(F.signal,"options.signal"),oe=q(oe),(async function*(){var L;if(F!=null&&(L=F.signal)!==null&&L!==void 0&&L.aborted)throw new a;for await(let he of this){var Q;if(F!=null&&(Q=F.signal)!==null&&Q!==void 0&&Q.aborted)throw new a;oe--<=0&&(yield he)}}).call(this)}function we(oe,F=void 0){return F!=null&&c(F,"options"),(F==null?void 0:F.signal)!=null&&l(F.signal,"options.signal"),oe=q(oe),(async function*(){var L;if(F!=null&&(L=F.signal)!==null&&L!==void 0&&L.aborted)throw new a;for await(let he of this){var Q;if(F!=null&&(Q=F.signal)!==null&&Q!==void 0&&Q.aborted)throw new a;if(oe-- >0)yield he;else return}}).call(this)}e.exports.streamReturningOperators={asIndexedPairs:U,drop:$,filter:W,flatMap:M,map:R,take:we,compose:K},e.exports.promiseReturningOperators={every:G,forEach:H,reduce:Z,toArray:ie,some:V,find:J}}),vg=Ee((i,e)=>{ge(),_e(),pe();var{ArrayPrototypePop:t,Promise:n}=bt(),{isIterable:r,isNodeStream:s,isWebStream:o}=zi(),{pipelineImpl:a}=lc(),{finished:l}=fn();Eg();function h(...c){return new n((u,f)=>{let d,g,y=c[c.length-1];if(y&&typeof y=="object"&&!s(y)&&!r(y)&&!o(y)){let w=t(c);d=w.signal,g=w.end}a(c,(w,E)=>{w?f(w):u(E)},{signal:d,end:g})})}e.exports={finished:l,pipeline:h}}),Eg=Ee((i,e)=>{ge(),_e(),pe();var{Buffer:t}=(Pt(),Qe(Mt)),{ObjectDefineProperty:n,ObjectKeys:r,ReflectApply:s}=bt(),{promisify:{custom:o}}=Bi(),{streamReturningOperators:a,promiseReturningOperators:l}=Db(),{codes:{ERR_ILLEGAL_CONSTRUCTOR:h}}=Xt(),c=bg(),{pipeline:u}=lc(),{destroyer:f}=Er(),d=fn(),g=vg(),y=zi(),w=e.exports=rc().Stream;w.isDisturbed=y.isDisturbed,w.isErrored=y.isErrored,w.isReadable=y.isReadable,w.Readable=Lo();for(let b of r(a)){let v=function(...x){if(new.target)throw h();return w.Readable.from(s(S,this,x))},S=a[b];n(v,"name",{__proto__:null,value:S.name}),n(v,"length",{__proto__:null,value:S.length}),n(w.Readable.prototype,b,{__proto__:null,value:v,enumerable:!1,configurable:!0,writable:!0})}for(let b of r(l)){let v=function(...x){if(new.target)throw h();return s(S,this,x)},S=l[b];n(v,"name",{__proto__:null,value:S.name}),n(v,"length",{__proto__:null,value:S.length}),n(w.Readable.prototype,b,{__proto__:null,value:v,enumerable:!1,configurable:!0,writable:!0})}w.Writable=mg(),w.Duplex=Ui(),w.Transform=yg(),w.PassThrough=wg(),w.pipeline=u;var{addAbortSignal:E}=Mo();w.addAbortSignal=E,w.finished=d,w.destroy=f,w.compose=c,n(w,"promises",{__proto__:null,configurable:!0,enumerable:!0,get(){return g}}),n(u,o,{__proto__:null,enumerable:!0,get(){return g.pipeline}}),n(d,o,{__proto__:null,enumerable:!0,get(){return g.finished}}),w.Stream=w,w._isUint8Array=function(b){return b instanceof Uint8Array},w._uint8ArrayToBuffer=function(b){return t.from(b.buffer,b.byteOffset,b.byteLength)}}),Un=Ee((i,e)=>{ge(),_e(),pe();var t=Eg(),n=vg(),r=t.Readable.destroy;e.exports=t.Readable,e.exports._uint8ArrayToBuffer=t._uint8ArrayToBuffer,e.exports._isUint8Array=t._isUint8Array,e.exports.isDisturbed=t.isDisturbed,e.exports.isErrored=t.isErrored,e.exports.isReadable=t.isReadable,e.exports.Readable=t.Readable,e.exports.Writable=t.Writable,e.exports.Duplex=t.Duplex,e.exports.Transform=t.Transform,e.exports.PassThrough=t.PassThrough,e.exports.addAbortSignal=t.addAbortSignal,e.exports.finished=t.finished,e.exports.destroy=t.destroy,e.exports.destroy=r,e.exports.pipeline=t.pipeline,e.exports.compose=t.compose,Object.defineProperty(t,"promises",{configurable:!0,enumerable:!0,get(){return n}}),e.exports.Stream=t.Stream,e.exports.default=e.exports}),Fb=Ee((i,e)=>{ge(),_e(),pe(),typeof Object.create=="function"?e.exports=function(t,n){n&&(t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(t,n){if(n){t.super_=n;var r=function(){};r.prototype=n.prototype,t.prototype=new r,t.prototype.constructor=t}}}),Nb=Ee((i,e)=>{ge(),_e(),pe();var{Buffer:t}=(Pt(),Qe(Mt)),n=Symbol.for("BufferList");function r(s){if(!(this instanceof r))return new r(s);r._init.call(this,s)}r._init=function(s){Object.defineProperty(this,n,{value:!0}),this._bufs=[],this.length=0,s&&this.append(s)},r.prototype._new=function(s){return new r(s)},r.prototype._offset=function(s){if(s===0)return[0,0];let o=0;for(let a=0;a<this._bufs.length;a++){let l=o+this._bufs[a].length;if(s<l||a===this._bufs.length-1)return[a,s-o];o=l}},r.prototype._reverseOffset=function(s){let o=s[0],a=s[1];for(let l=0;l<o;l++)a+=this._bufs[l].length;return a},r.prototype.get=function(s){if(s>this.length||s<0)return;let o=this._offset(s);return this._bufs[o[0]][o[1]]},r.prototype.slice=function(s,o){return typeof s=="number"&&s<0&&(s+=this.length),typeof o=="number"&&o<0&&(o+=this.length),this.copy(null,0,s,o)},r.prototype.copy=function(s,o,a,l){if((typeof a!="number"||a<0)&&(a=0),(typeof l!="number"||l>this.length)&&(l=this.length),a>=this.length||l<=0)return s||t.alloc(0);let h=!!s,c=this._offset(a),u=l-a,f=u,d=h&&o||0,g=c[1];if(a===0&&l===this.length){if(!h)return this._bufs.length===1?this._bufs[0]:t.concat(this._bufs,this.length);for(let y=0;y<this._bufs.length;y++)this._bufs[y].copy(s,d),d+=this._bufs[y].length;return s}if(f<=this._bufs[c[0]].length-g)return h?this._bufs[c[0]].copy(s,o,g,g+f):this._bufs[c[0]].slice(g,g+f);h||(s=t.allocUnsafe(u));for(let y=c[0];y<this._bufs.length;y++){let w=this._bufs[y].length-g;if(f>w)this._bufs[y].copy(s,d,g),d+=w;else{this._bufs[y].copy(s,d,g,g+f),d+=w;break}f-=w,g&&(g=0)}return s.length>d?s.slice(0,d):s},r.prototype.shallowSlice=function(s,o){if(s=s||0,o=typeof o!="number"?this.length:o,s<0&&(s+=this.length),o<0&&(o+=this.length),s===o)return this._new();let a=this._offset(s),l=this._offset(o),h=this._bufs.slice(a[0],l[0]+1);return l[1]===0?h.pop():h[h.length-1]=h[h.length-1].slice(0,l[1]),a[1]!==0&&(h[0]=h[0].slice(a[1])),this._new(h)},r.prototype.toString=function(s,o,a){return this.slice(o,a).toString(s)},r.prototype.consume=function(s){if(s=Math.trunc(s),Number.isNaN(s)||s<=0)return this;for(;this._bufs.length;)if(s>=this._bufs[0].length)s-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(s),this.length-=s;break}return this},r.prototype.duplicate=function(){let s=this._new();for(let o=0;o<this._bufs.length;o++)s.append(this._bufs[o]);return s},r.prototype.append=function(s){if(s==null)return this;if(s.buffer)this._appendBuffer(t.from(s.buffer,s.byteOffset,s.byteLength));else if(Array.isArray(s))for(let o=0;o<s.length;o++)this.append(s[o]);else if(this._isBufferList(s))for(let o=0;o<s._bufs.length;o++)this.append(s._bufs[o]);else typeof s=="number"&&(s=s.toString()),this._appendBuffer(t.from(s));return this},r.prototype._appendBuffer=function(s){this._bufs.push(s),this.length+=s.length},r.prototype.indexOf=function(s,o,a){if(a===void 0&&typeof o=="string"&&(a=o,o=void 0),typeof s=="function"||Array.isArray(s))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof s=="number"?s=t.from([s]):typeof s=="string"?s=t.from(s,a):this._isBufferList(s)?s=s.slice():Array.isArray(s.buffer)?s=t.from(s.buffer,s.byteOffset,s.byteLength):t.isBuffer(s)||(s=t.from(s)),o=Number(o||0),isNaN(o)&&(o=0),o<0&&(o=this.length+o),o<0&&(o=0),s.length===0)return o>this.length?this.length:o;let l=this._offset(o),h=l[0],c=l[1];for(;h<this._bufs.length;h++){let u=this._bufs[h];for(;c<u.length;)if(u.length-c>=s.length){let f=u.indexOf(s,c);if(f!==-1)return this._reverseOffset([h,f]);c=u.length-s.length+1}else{let f=this._reverseOffset([h,c]);if(this._match(f,s))return f;c++}c=0}return-1},r.prototype._match=function(s,o){if(this.length-s<o.length)return!1;for(let a=0;a<o.length;a++)if(this.get(s+a)!==o[a])return!1;return!0},function(){let s={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readBigInt64BE:8,readBigInt64LE:8,readBigUInt64BE:8,readBigUInt64LE:8,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let o in s)(function(a){s[a]===null?r.prototype[a]=function(l,h){return this.slice(l,l+h)[a](0,h)}:r.prototype[a]=function(l=0){return this.slice(l,l+s[a])[a](0)}})(o)}(),r.prototype._isBufferList=function(s){return s instanceof r||r.isBufferList(s)},r.isBufferList=function(s){return s!=null&&s[n]},e.exports=r}),Bb=Ee((i,e)=>{ge(),_e(),pe();var t=Un().Duplex,n=Fb(),r=Nb();function s(o){if(!(this instanceof s))return new s(o);if(typeof o=="function"){this._callback=o;let a=(function(l){this._callback&&(this._callback(l),this._callback=null)}).bind(this);this.on("pipe",function(l){l.on("error",a)}),this.on("unpipe",function(l){l.removeListener("error",a)}),o=null}r._init.call(this,o),t.call(this)}n(s,t),Object.assign(s.prototype,r.prototype),s.prototype._new=function(o){return new s(o)},s.prototype._write=function(o,a,l){this._appendBuffer(o),typeof l=="function"&&l()},s.prototype._read=function(o){if(!this.length)return this.push(null);o=Math.min(o,this.length),this.push(this.slice(0,o)),this.consume(o)},s.prototype.end=function(o){t.prototype.end.call(this,o),this._callback&&(this._callback(null,this.slice()),this._callback=null)},s.prototype._destroy=function(o,a){this._bufs.length=0,this.length=0,a(o)},s.prototype._isBufferList=function(o){return o instanceof s||o instanceof r||s.isBufferList(o)},s.isBufferList=r.isBufferList,e.exports=s,e.exports.BufferListStream=s,e.exports.BufferList=r}),Ub=Ee((i,e)=>{ge(),_e(),pe();var t=class{constructor(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}};e.exports=t}),Sg=Ee((i,e)=>{ge(),_e(),pe();var t=e.exports,{Buffer:n}=(Pt(),Qe(Mt));t.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},t.requiredHeaderFlags={1:0,2:0,4:0,5:0,6:2,7:0,8:2,9:0,10:2,11:0,12:0,13:0,14:0,15:0},t.requiredHeaderFlagsErrors={};for(let s in t.requiredHeaderFlags){let o=t.requiredHeaderFlags[s];t.requiredHeaderFlagsErrors[s]="Invalid header flag bits, must be 0x"+o.toString(16)+" for "+t.types[s]+" packet"}t.codes={};for(let s in t.types){let o=t.types[s];t.codes[o]=s}t.CMD_SHIFT=4,t.CMD_MASK=240,t.DUP_MASK=8,t.QOS_MASK=3,t.QOS_SHIFT=1,t.RETAIN_MASK=1,t.VARBYTEINT_MASK=127,t.VARBYTEINT_FIN_MASK=128,t.VARBYTEINT_MAX=268435455,t.SESSIONPRESENT_MASK=1,t.SESSIONPRESENT_HEADER=n.from([t.SESSIONPRESENT_MASK]),t.CONNACK_HEADER=n.from([t.codes.connack<<t.CMD_SHIFT]),t.USERNAME_MASK=128,t.PASSWORD_MASK=64,t.WILL_RETAIN_MASK=32,t.WILL_QOS_MASK=24,t.WILL_QOS_SHIFT=3,t.WILL_FLAG_MASK=4,t.CLEAN_SESSION_MASK=2,t.CONNECT_HEADER=n.from([t.codes.connect<<t.CMD_SHIFT]),t.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},t.propertiesCodes={};for(let s in t.properties){let o=t.properties[s];t.propertiesCodes[o]=s}t.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int16",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"};function r(s){return[0,1,2].map(o=>[0,1].map(a=>[0,1].map(l=>{let h=n.alloc(1);return h.writeUInt8(t.codes[s]<<t.CMD_SHIFT|(a?t.DUP_MASK:0)|o<<t.QOS_SHIFT|l,0,!0),h})))}t.PUBLISH_HEADER=r("publish"),t.SUBSCRIBE_HEADER=r("subscribe"),t.SUBSCRIBE_OPTIONS_QOS_MASK=3,t.SUBSCRIBE_OPTIONS_NL_MASK=1,t.SUBSCRIBE_OPTIONS_NL_SHIFT=2,t.SUBSCRIBE_OPTIONS_RAP_MASK=1,t.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,t.SUBSCRIBE_OPTIONS_RH_MASK=3,t.SUBSCRIBE_OPTIONS_RH_SHIFT=4,t.SUBSCRIBE_OPTIONS_RH=[0,16,32],t.SUBSCRIBE_OPTIONS_NL=4,t.SUBSCRIBE_OPTIONS_RAP=8,t.SUBSCRIBE_OPTIONS_QOS=[0,1,2],t.UNSUBSCRIBE_HEADER=r("unsubscribe"),t.ACKS={unsuback:r("unsuback"),puback:r("puback"),pubcomp:r("pubcomp"),pubrel:r("pubrel"),pubrec:r("pubrec")},t.SUBACK_HEADER=n.from([t.codes.suback<<t.CMD_SHIFT]),t.VERSION3=n.from([3]),t.VERSION4=n.from([4]),t.VERSION5=n.from([5]),t.VERSION131=n.from([131]),t.VERSION132=n.from([132]),t.QOS=[0,1,2].map(s=>n.from([s])),t.EMPTY={pingreq:n.from([t.codes.pingreq<<4,0]),pingresp:n.from([t.codes.pingresp<<4,0]),disconnect:n.from([t.codes.disconnect<<4,0])},t.MQTT5_PUBACK_PUBREC_CODES={0:"Success",16:"No matching subscribers",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",144:"Topic Name invalid",145:"Packet identifier in use",151:"Quota exceeded",153:"Payload format invalid"},t.MQTT5_PUBREL_PUBCOMP_CODES={0:"Success",146:"Packet Identifier not found"},t.MQTT5_SUBACK_CODES={0:"Granted QoS 0",1:"Granted QoS 1",2:"Granted QoS 2",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use",151:"Quota exceeded",158:"Shared Subscriptions not supported",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_UNSUBACK_CODES={0:"Success",17:"No subscription existed",128:"Unspecified error",131:"Implementation specific error",135:"Not authorized",143:"Topic Filter invalid",145:"Packet Identifier in use"},t.MQTT5_DISCONNECT_CODES={0:"Normal disconnection",4:"Disconnect with Will Message",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",135:"Not authorized",137:"Server busy",139:"Server shutting down",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"},t.MQTT5_AUTH_CODES={0:"Success",24:"Continue authentication",25:"Re-authenticate"}}),jb=Ee((i,e)=>{ge(),_e(),pe();var t=1e3,n=t*60,r=n*60,s=r*24,o=s*7,a=s*365.25;e.exports=function(f,d){d=d||{};var g=typeof f;if(g==="string"&&f.length>0)return l(f);if(g==="number"&&isFinite(f))return d.long?c(f):h(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function l(f){if(f=String(f),!(f.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(d){var g=parseFloat(d[1]),y=(d[2]||"ms").toLowerCase();switch(y){case"years":case"year":case"yrs":case"yr":case"y":return g*a;case"weeks":case"week":case"w":return g*o;case"days":case"day":case"d":return g*s;case"hours":case"hour":case"hrs":case"hr":case"h":return g*r;case"minutes":case"minute":case"mins":case"min":case"m":return g*n;case"seconds":case"second":case"secs":case"sec":case"s":return g*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function h(f){var d=Math.abs(f);return d>=s?Math.round(f/s)+"d":d>=r?Math.round(f/r)+"h":d>=n?Math.round(f/n)+"m":d>=t?Math.round(f/t)+"s":f+"ms"}function c(f){var d=Math.abs(f);return d>=s?u(f,d,s,"day"):d>=r?u(f,d,r,"hour"):d>=n?u(f,d,n,"minute"):d>=t?u(f,d,t,"second"):f+" ms"}function u(f,d,g,y){var w=d>=g*1.5;return Math.round(f/g)+" "+y+(w?"s":"")}}),Wb=Ee((i,e)=>{ge(),_e(),pe();function t(n){s.debug=s,s.default=s,s.coerce=u,s.disable=l,s.enable=a,s.enabled=h,s.humanize=jb(),s.destroy=f,Object.keys(n).forEach(d=>{s[d]=n[d]}),s.names=[],s.skips=[],s.formatters={};function r(d){let g=0;for(let y=0;y<d.length;y++)g=(g<<5)-g+d.charCodeAt(y),g|=0;return s.colors[Math.abs(g)%s.colors.length]}s.selectColor=r;function s(d){let g,y=null,w,E;function b(...v){if(!b.enabled)return;let S=b,x=Number(new Date),T=x-(g||x);S.diff=T,S.prev=g,S.curr=x,g=x,v[0]=s.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let I=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(A,O)=>{if(A==="%%")return"%";I++;let j=s.formatters[O];if(typeof j=="function"){let K=v[I];A=j.call(S,K),v.splice(I,1),I--}return A}),s.formatArgs.call(S,v),(S.log||s.log).apply(S,v)}return b.namespace=d,b.useColors=s.useColors(),b.color=s.selectColor(d),b.extend=o,b.destroy=s.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>y!==null?y:(w!==s.namespaces&&(w=s.namespaces,E=s.enabled(d)),E),set:v=>{y=v}}),typeof s.init=="function"&&s.init(b),b}function o(d,g){let y=s(this.namespace+(typeof g>"u"?":":g)+d);return y.log=this.log,y}function a(d){s.save(d),s.namespaces=d,s.names=[],s.skips=[];let g,y=(typeof d=="string"?d:"").split(/[\s,]+/),w=y.length;for(g=0;g<w;g++)y[g]&&(d=y[g].replace(/\*/g,".*?"),d[0]==="-"?s.skips.push(new RegExp("^"+d.slice(1)+"$")):s.names.push(new RegExp("^"+d+"$")))}function l(){let d=[...s.names.map(c),...s.skips.map(c).map(g=>"-"+g)].join(",");return s.enable(""),d}function h(d){if(d[d.length-1]==="*")return!0;let g,y;for(g=0,y=s.skips.length;g<y;g++)if(s.skips[g].test(d))return!1;for(g=0,y=s.names.length;g<y;g++)if(s.names[g].test(d))return!0;return!1}function c(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function u(d){return d instanceof Error?d.stack||d.message:d}function f(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return s.enable(s.load()),s}e.exports=t}),ji=Ee((i,e)=>{ge(),_e(),pe(),i.formatArgs=n,i.save=r,i.load=s,i.useColors=t,i.storage=o(),i.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;let h="color: "+this.color;l.splice(1,0,h,"color: inherit");let c=0,u=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(c++,f==="%c"&&(u=c))}),l.splice(u,0,h)}i.log=console.debug||console.log||(()=>{});function r(l){try{l?i.storage.setItem("debug",l):i.storage.removeItem("debug")}catch{}}function s(){let l;try{l=i.storage.getItem("debug")}catch{}return!l&&typeof Ve<"u"&&"env"in Ve&&(l=Ve.env.DEBUG),l}function o(){try{return localStorage}catch{}}e.exports=Wb()(i);var{formatters:a}=e.exports;a.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}}),Gb=Ee((i,e)=>{ge(),_e(),pe();var t=Bb(),{EventEmitter:n}=(Sr(),Qe(Bn)),r=Ub(),s=Sg(),o=ji()("mqtt-packet:parser"),a=class zl extends n{constructor(){super(),this.parser=this.constructor.parser}static parser(h){return this instanceof zl?(this.settings=h||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState(),this):new zl().parser(h)}_resetState(){o("_resetState: resetting packet, error, _list, and _stateCounter"),this.packet=new r,this.error=null,this._list=t(),this._stateCounter=0}parse(h){for(this.error&&this._resetState(),this._list.append(h),o("parse: current state: %s",this._states[this._stateCounter]);(this.packet.length!==-1||this._list.length>0)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,o("parse: state complete. _stateCounter is now: %d",this._stateCounter),o("parse: packet.length: %d, buffer list length: %d",this.packet.length,this._list.length),this._stateCounter>=this._states.length&&(this._stateCounter=0);return o("parse: exited while loop. packet: %d, buffer list length: %d",this.packet.length,this._list.length),this._list.length}_parseHeader(){let h=this._list.readUInt8(0),c=h>>s.CMD_SHIFT;this.packet.cmd=s.types[c];let u=h&15,f=s.requiredHeaderFlags[c];return f!=null&&u!==f?this._emitError(new Error(s.requiredHeaderFlagsErrors[c])):(this.packet.retain=(h&s.RETAIN_MASK)!==0,this.packet.qos=h>>s.QOS_SHIFT&s.QOS_MASK,this.packet.qos>2?this._emitError(new Error("Packet must not have both QoS bits set to 1")):(this.packet.dup=(h&s.DUP_MASK)!==0,o("_parseHeader: packet: %o",this.packet),this._list.consume(1),!0))}_parseLength(){let h=this._parseVarByteNum(!0);return h&&(this.packet.length=h.value,this._list.consume(h.bytes)),o("_parseLength %d",h.value),!!h}_parsePayload(){o("_parsePayload: payload %O",this._list);let h=!1;if(this.packet.length===0||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}h=!0}return o("_parsePayload complete result: %s",h),h}_parseConnect(){o("_parseConnect");let h,c,u,f,d={},g=this.packet,y=this._parseString();if(y===null)return this._emitError(new Error("Cannot parse protocolId"));if(y!=="MQTT"&&y!=="MQIsdp")return this._emitError(new Error("Invalid protocolId"));if(g.protocolId=y,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(g.protocolVersion=this._list.readUInt8(this._pos),g.protocolVersion>=128&&(g.bridgeMode=!0,g.protocolVersion=g.protocolVersion-128),g.protocolVersion!==3&&g.protocolVersion!==4&&g.protocolVersion!==5)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(this._list.readUInt8(this._pos)&1)return this._emitError(new Error("Connect flag bit 0 must be 0, but got 1"));d.username=this._list.readUInt8(this._pos)&s.USERNAME_MASK,d.password=this._list.readUInt8(this._pos)&s.PASSWORD_MASK,d.will=this._list.readUInt8(this._pos)&s.WILL_FLAG_MASK;let w=!!(this._list.readUInt8(this._pos)&s.WILL_RETAIN_MASK),E=(this._list.readUInt8(this._pos)&s.WILL_QOS_MASK)>>s.WILL_QOS_SHIFT;if(d.will)g.will={},g.will.retain=w,g.will.qos=E;else{if(w)return this._emitError(new Error("Will Retain Flag must be set to zero when Will Flag is set to 0"));if(E)return this._emitError(new Error("Will QoS must be set to zero when Will Flag is set to 0"))}if(g.clean=(this._list.readUInt8(this._pos)&s.CLEAN_SESSION_MASK)!==0,this._pos++,g.keepalive=this._parseNum(),g.keepalive===-1)return this._emitError(new Error("Packet too short"));if(g.protocolVersion===5){let v=this._parseProperties();Object.getOwnPropertyNames(v).length&&(g.properties=v)}let b=this._parseString();if(b===null)return this._emitError(new Error("Packet too short"));if(g.clientId=b,o("_parseConnect: packet.clientId: %s",g.clientId),d.will){if(g.protocolVersion===5){let v=this._parseProperties();Object.getOwnPropertyNames(v).length&&(g.will.properties=v)}if(h=this._parseString(),h===null)return this._emitError(new Error("Cannot parse will topic"));if(g.will.topic=h,o("_parseConnect: packet.will.topic: %s",g.will.topic),c=this._parseBuffer(),c===null)return this._emitError(new Error("Cannot parse will payload"));g.will.payload=c,o("_parseConnect: packet.will.paylaod: %s",g.will.payload)}if(d.username){if(f=this._parseString(),f===null)return this._emitError(new Error("Cannot parse username"));g.username=f,o("_parseConnect: packet.username: %s",g.username)}if(d.password){if(u=this._parseBuffer(),u===null)return this._emitError(new Error("Cannot parse password"));g.password=u}return this.settings=g,o("_parseConnect: complete"),g}_parseConnack(){o("_parseConnack");let h=this.packet;if(this._list.length<1)return null;let c=this._list.readUInt8(this._pos++);if(c>1)return this._emitError(new Error("Invalid connack flags, bits 7-1 must be set to 0"));if(h.sessionPresent=!!(c&s.SESSIONPRESENT_MASK),this.settings.protocolVersion===5)this._list.length>=2?h.reasonCode=this._list.readUInt8(this._pos++):h.reasonCode=0;else{if(this._list.length<2)return null;h.returnCode=this._list.readUInt8(this._pos++)}if(h.returnCode===-1||h.reasonCode===-1)return this._emitError(new Error("Cannot parse return code"));if(this.settings.protocolVersion===5){let u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(h.properties=u)}o("_parseConnack: complete")}_parsePublish(){o("_parsePublish");let h=this.packet;if(h.topic=this._parseString(),h.topic===null)return this._emitError(new Error("Cannot parse topic"));if(!(h.qos>0&&!this._parseMessageId())){if(this.settings.protocolVersion===5){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(h.properties=c)}h.payload=this._list.slice(this._pos,h.length),o("_parsePublish: payload from buffer list: %o",h.payload)}}_parseSubscribe(){o("_parseSubscribe");let h=this.packet,c,u,f,d,g,y,w;if(h.subscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let E=this._parseProperties();Object.getOwnPropertyNames(E).length&&(h.properties=E)}if(h.length<=0)return this._emitError(new Error("Malformed subscribe, no payload specified"));for(;this._pos<h.length;){if(c=this._parseString(),c===null)return this._emitError(new Error("Cannot parse topic"));if(this._pos>=h.length)return this._emitError(new Error("Malformed Subscribe Payload"));if(u=this._parseByte(),this.settings.protocolVersion===5){if(u&192)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-6 must be 0"))}else if(u&252)return this._emitError(new Error("Invalid subscribe topic flag bits, bits 7-2 must be 0"));if(f=u&s.SUBSCRIBE_OPTIONS_QOS_MASK,f>2)return this._emitError(new Error("Invalid subscribe QoS, must be <= 2"));if(y=(u>>s.SUBSCRIBE_OPTIONS_NL_SHIFT&s.SUBSCRIBE_OPTIONS_NL_MASK)!==0,g=(u>>s.SUBSCRIBE_OPTIONS_RAP_SHIFT&s.SUBSCRIBE_OPTIONS_RAP_MASK)!==0,d=u>>s.SUBSCRIBE_OPTIONS_RH_SHIFT&s.SUBSCRIBE_OPTIONS_RH_MASK,d>2)return this._emitError(new Error("Invalid retain handling, must be <= 2"));w={topic:c,qos:f},this.settings.protocolVersion===5?(w.nl=y,w.rap=g,w.rh=d):this.settings.bridgeMode&&(w.rh=0,w.rap=!0,w.nl=!0),o("_parseSubscribe: push subscription `%s` to subscription",w),h.subscriptions.push(w)}}}_parseSuback(){o("_parseSuback");let h=this.packet;if(this.packet.granted=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(h.properties=c)}if(h.length<=0)return this._emitError(new Error("Malformed suback, no payload specified"));for(;this._pos<this.packet.length;){let c=this._list.readUInt8(this._pos++);if(this.settings.protocolVersion===5){if(!s.MQTT5_SUBACK_CODES[c])return this._emitError(new Error("Invalid suback code"))}else if(c>2&&c!==128)return this._emitError(new Error("Invalid suback QoS, must be 0, 1, 2 or 128"));this.packet.granted.push(c)}}}_parseUnsubscribe(){o("_parseUnsubscribe");let h=this.packet;if(h.unsubscriptions=[],!!this._parseMessageId()){if(this.settings.protocolVersion===5){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(h.properties=c)}if(h.length<=0)return this._emitError(new Error("Malformed unsubscribe, no payload specified"));for(;this._pos<h.length;){let c=this._parseString();if(c===null)return this._emitError(new Error("Cannot parse topic"));o("_parseUnsubscribe: push topic `%s` to unsubscriptions",c),h.unsubscriptions.push(c)}}}_parseUnsuback(){o("_parseUnsuback");let h=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if((this.settings.protocolVersion===3||this.settings.protocolVersion===4)&&h.length!==2)return this._emitError(new Error("Malformed unsuback, payload length must be 2"));if(h.length<=0)return this._emitError(new Error("Malformed unsuback, no payload specified"));if(this.settings.protocolVersion===5){let c=this._parseProperties();for(Object.getOwnPropertyNames(c).length&&(h.properties=c),h.granted=[];this._pos<this.packet.length;){let u=this._list.readUInt8(this._pos++);if(!s.MQTT5_UNSUBACK_CODES[u])return this._emitError(new Error("Invalid unsuback code"));this.packet.granted.push(u)}}}_parseConfirmation(){o("_parseConfirmation: packet.cmd: `%s`",this.packet.cmd);let h=this.packet;if(this._parseMessageId(),this.settings.protocolVersion===5){if(h.length>2){switch(h.reasonCode=this._parseByte(),this.packet.cmd){case"puback":case"pubrec":if(!s.MQTT5_PUBACK_PUBREC_CODES[h.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break;case"pubrel":case"pubcomp":if(!s.MQTT5_PUBREL_PUBCOMP_CODES[h.reasonCode])return this._emitError(new Error("Invalid "+this.packet.cmd+" reason code"));break}o("_parseConfirmation: packet.reasonCode `%d`",h.reasonCode)}else h.reasonCode=0;if(h.length>3){let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(h.properties=c)}}return!0}_parseDisconnect(){let h=this.packet;if(o("_parseDisconnect"),this.settings.protocolVersion===5){this._list.length>0?(h.reasonCode=this._parseByte(),s.MQTT5_DISCONNECT_CODES[h.reasonCode]||this._emitError(new Error("Invalid disconnect reason code"))):h.reasonCode=0;let c=this._parseProperties();Object.getOwnPropertyNames(c).length&&(h.properties=c)}return o("_parseDisconnect result: true"),!0}_parseAuth(){o("_parseAuth");let h=this.packet;if(this.settings.protocolVersion!==5)return this._emitError(new Error("Not supported auth packet for this version MQTT"));if(h.reasonCode=this._parseByte(),!s.MQTT5_AUTH_CODES[h.reasonCode])return this._emitError(new Error("Invalid auth reason code"));let c=this._parseProperties();return Object.getOwnPropertyNames(c).length&&(h.properties=c),o("_parseAuth: result: true"),!0}_parseMessageId(){let h=this.packet;return h.messageId=this._parseNum(),h.messageId===null?(this._emitError(new Error("Cannot parse messageId")),!1):(o("_parseMessageId: packet.messageId %d",h.messageId),!0)}_parseString(h){let c=this._parseNum(),u=c+this._pos;if(c===-1||u>this._list.length||u>this.packet.length)return null;let f=this._list.toString("utf8",this._pos,u);return this._pos+=c,o("_parseString: result: %s",f),f}_parseStringPair(){return o("_parseStringPair"),{name:this._parseString(),value:this._parseString()}}_parseBuffer(){let h=this._parseNum(),c=h+this._pos;if(h===-1||c>this._list.length||c>this.packet.length)return null;let u=this._list.slice(this._pos,c);return this._pos+=h,o("_parseBuffer: result: %o",u),u}_parseNum(){if(this._list.length-this._pos<2)return-1;let h=this._list.readUInt16BE(this._pos);return this._pos+=2,o("_parseNum: result: %s",h),h}_parse4ByteNum(){if(this._list.length-this._pos<4)return-1;let h=this._list.readUInt32BE(this._pos);return this._pos+=4,o("_parse4ByteNum: result: %s",h),h}_parseVarByteNum(h){o("_parseVarByteNum");let c=4,u=0,f=1,d=0,g=!1,y,w=this._pos?this._pos:0;for(;u<c&&w+u<this._list.length;){if(y=this._list.readUInt8(w+u++),d+=f*(y&s.VARBYTEINT_MASK),f*=128,!(y&s.VARBYTEINT_FIN_MASK)){g=!0;break}if(this._list.length<=u)break}return!g&&u===c&&this._list.length>=u&&this._emitError(new Error("Invalid variable byte integer")),w&&(this._pos+=u),g?h?g={bytes:u,value:d}:g=d:g=!1,o("_parseVarByteNum: result: %o",g),g}_parseByte(){let h;return this._pos<this._list.length&&(h=this._list.readUInt8(this._pos),this._pos++),o("_parseByte: result: %o",h),h}_parseByType(h){switch(o("_parseByType: type: %s",h),h){case"byte":return this._parseByte()!==0;case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}}_parseProperties(){o("_parseProperties");let h=this._parseVarByteNum(),c=this._pos+h,u={};for(;this._pos<c;){let f=this._parseByte();if(!f)return this._emitError(new Error("Cannot parse property code type")),!1;let d=s.propertiesCodes[f];if(!d)return this._emitError(new Error("Unknown property")),!1;if(d==="userProperties"){u[d]||(u[d]=Object.create(null));let g=this._parseByType(s.propertiesTypes[d]);if(u[d][g.name])if(Array.isArray(u[d][g.name]))u[d][g.name].push(g.value);else{let y=u[d][g.name];u[d][g.name]=[y],u[d][g.name].push(g.value)}else u[d][g.name]=g.value;continue}u[d]?Array.isArray(u[d])?u[d].push(this._parseByType(s.propertiesTypes[d])):(u[d]=[u[d]],u[d].push(this._parseByType(s.propertiesTypes[d]))):u[d]=this._parseByType(s.propertiesTypes[d])}return u}_newPacket(){return o("_newPacket"),this.packet&&(this._list.consume(this.packet.length),o("_newPacket: parser emit packet: packet.cmd: %s, packet.payload: %s, packet.length: %d",this.packet.cmd,this.packet.payload,this.packet.length),this.emit("packet",this.packet)),o("_newPacket: new packet"),this.packet=new r,this._pos=0,!0}_emitError(h){o("_emitError",h),this.error=h,this.emit("error",h)}};e.exports=a}),zb=Ee((i,e)=>{ge(),_e(),pe();var{Buffer:t}=(Pt(),Qe(Mt)),n=65536,r={},s=t.isBuffer(t.from([1,2]).subarray(0,1));function o(c){let u=t.allocUnsafe(2);return u.writeUInt8(c>>8,0),u.writeUInt8(c&255,0+1),u}function a(){for(let c=0;c<n;c++)r[c]=o(c)}function l(c){let u=0,f=0,d=t.allocUnsafe(4);do u=c%128|0,c=c/128|0,c>0&&(u=u|128),d.writeUInt8(u,f++);while(c>0&&f<4);return c>0&&(f=0),s?d.subarray(0,f):d.slice(0,f)}function h(c){let u=t.allocUnsafe(4);return u.writeUInt32BE(c,0),u}e.exports={cache:r,generateCache:a,generateNumber:o,genBufVariableByteInt:l,generate4ByteBuffer:h}}),Yb=Ee((i,e)=>{ge(),_e(),pe(),typeof Ve>"u"||!Ve.version||Ve.version.indexOf("v0.")===0||Ve.version.indexOf("v1.")===0&&Ve.version.indexOf("v1.8.")!==0?e.exports={nextTick:t}:e.exports=Ve;function t(n,r,s,o){if(typeof n!="function")throw new TypeError('"callback" argument must be a function');var a=arguments.length,l,h;switch(a){case 0:case 1:return Ve.nextTick(n);case 2:return Ve.nextTick(function(){n.call(null,r)});case 3:return Ve.nextTick(function(){n.call(null,r,s)});case 4:return Ve.nextTick(function(){n.call(null,r,s,o)});default:for(l=new Array(a-1),h=0;h<l.length;)l[h++]=arguments[h];return Ve.nextTick(function(){n.apply(null,l)})}}}),xg=Ee((i,e)=>{ge(),_e(),pe();var t=Sg(),{Buffer:n}=(Pt(),Qe(Mt)),r=n.allocUnsafe(0),s=n.from([0]),o=zb(),a=Yb().nextTick,l=ji()("mqtt-packet:writeToStream"),h=o.cache,c=o.generateNumber,u=o.generateCache,f=o.genBufVariableByteInt,d=o.generate4ByteBuffer,g=H,y=!0;function w(F,L,Q){switch(l("generate called"),L.cork&&(L.cork(),a(E,L)),y&&(y=!1,u()),l("generate: packet.cmd: %s",F.cmd),F.cmd){case"connect":return b(F,L);case"connack":return v(F,L,Q);case"publish":return S(F,L,Q);case"puback":case"pubrec":case"pubrel":case"pubcomp":return x(F,L,Q);case"subscribe":return T(F,L,Q);case"suback":return I(F,L,Q);case"unsubscribe":return A(F,L,Q);case"unsuback":return O(F,L,Q);case"pingreq":case"pingresp":return j(F,L);case"disconnect":return K(F,L,Q);case"auth":return R(F,L,Q);default:return L.destroy(new Error("Unknown command")),!1}}Object.defineProperty(w,"cacheNumbers",{get(){return g===H},set(F){F?((!h||Object.keys(h).length===0)&&(y=!0),g=H):(y=!1,g=W)}});function E(F){F.uncork()}function b(F,L,Q){let he=F||{},ae=he.protocolId||"MQTT",re=he.protocolVersion||4,ue=he.will,de=he.clean,k=he.keepalive||0,X=he.clientId||"",Y=he.username,le=he.password,ne=he.properties;de===void 0&&(de=!0);let z=0;if(!ae||typeof ae!="string"&&!n.isBuffer(ae))return L.destroy(new Error("Invalid protocolId")),!1;if(z+=ae.length+2,re!==3&&re!==4&&re!==5)return L.destroy(new Error("Invalid protocol version")),!1;if(z+=1,(typeof X=="string"||n.isBuffer(X))&&(X||re>=4)&&(X||de))z+=n.byteLength(X)+2;else{if(re<4)return L.destroy(new Error("clientId must be supplied before 3.1.1")),!1;if(de*1===0)return L.destroy(new Error("clientId must be given if cleanSession set to 0")),!1}if(typeof k!="number"||k<0||k>65535||k%1!==0)return L.destroy(new Error("Invalid keepalive")),!1;z+=2,z+=1;let te,be;if(re===5){if(te=ie(L,ne),!te)return!1;z+=te.length}if(ue){if(typeof ue!="object")return L.destroy(new Error("Invalid will")),!1;if(!ue.topic||typeof ue.topic!="string")return L.destroy(new Error("Invalid will topic")),!1;if(z+=n.byteLength(ue.topic)+2,z+=2,ue.payload)if(ue.payload.length>=0)typeof ue.payload=="string"?z+=n.byteLength(ue.payload):z+=ue.payload.length;else return L.destroy(new Error("Invalid will payload")),!1;if(be={},re===5){if(be=ie(L,ue.properties),!be)return!1;z+=be.length}}let Se=!1;if(Y!=null)if(oe(Y))Se=!0,z+=n.byteLength(Y)+2;else return L.destroy(new Error("Invalid username")),!1;if(le!=null){if(!Se)return L.destroy(new Error("Username is required to use password")),!1;if(oe(le))z+=we(le)+2;else return L.destroy(new Error("Invalid password")),!1}L.write(t.CONNECT_HEADER),V(L,z),Z(L,ae),he.bridgeMode&&(re+=128),L.write(re===131?t.VERSION131:re===132?t.VERSION132:re===4?t.VERSION4:re===5?t.VERSION5:t.VERSION3);let Re=0;return Re|=Y!=null?t.USERNAME_MASK:0,Re|=le!=null?t.PASSWORD_MASK:0,Re|=ue&&ue.retain?t.WILL_RETAIN_MASK:0,Re|=ue&&ue.qos?ue.qos<<t.WILL_QOS_SHIFT:0,Re|=ue?t.WILL_FLAG_MASK:0,Re|=de?t.CLEAN_SESSION_MASK:0,L.write(n.from([Re])),g(L,k),re===5&&te.write(),Z(L,X),ue&&(re===5&&be.write(),G(L,ue.topic),Z(L,ue.payload)),Y!=null&&Z(L,Y),le!=null&&Z(L,le),!0}function v(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=he===5?ae.reasonCode:ae.returnCode,ue=ae.properties,de=2;if(typeof re!="number")return L.destroy(new Error("Invalid return code")),!1;let k=null;if(he===5){if(k=ie(L,ue),!k)return!1;de+=k.length}return L.write(t.CONNACK_HEADER),V(L,de),L.write(ae.sessionPresent?t.SESSIONPRESENT_HEADER:s),L.write(n.from([re])),k==null||k.write(),!0}function S(F,L,Q){l("publish: packet: %o",F);let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.qos||0,ue=ae.retain?t.RETAIN_MASK:0,de=ae.topic,k=ae.payload||r,X=ae.messageId,Y=ae.properties,le=0;if(typeof de=="string")le+=n.byteLength(de)+2;else if(n.isBuffer(de))le+=de.length+2;else return L.destroy(new Error("Invalid topic")),!1;if(n.isBuffer(k)?le+=k.length:le+=n.byteLength(k),re&&typeof X!="number")return L.destroy(new Error("Invalid messageId")),!1;re&&(le+=2);let ne=null;if(he===5){if(ne=ie(L,Y),!ne)return!1;le+=ne.length}return L.write(t.PUBLISH_HEADER[re][ae.dup?1:0][ue?1:0]),V(L,le),g(L,we(de)),L.write(de),re>0&&g(L,X),ne==null||ne.write(),l("publish: payload: %o",k),L.write(k)}function x(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.cmd||"puback",ue=ae.messageId,de=ae.dup&&re==="pubrel"?t.DUP_MASK:0,k=0,X=ae.reasonCode,Y=ae.properties,le=he===5?3:2;if(re==="pubrel"&&(k=1),typeof ue!="number")return L.destroy(new Error("Invalid messageId")),!1;let ne=null;if(he===5&&typeof Y=="object"){if(ne=M(L,Y,Q,le),!ne)return!1;le+=ne.length}return L.write(t.ACKS[re][k][de][0]),le===3&&(le+=X!==0?1:-1),V(L,le),g(L,ue),he===5&&le!==2&&L.write(n.from([X])),ne!==null?ne.write():le===4&&L.write(n.from([0])),!0}function T(F,L,Q){l("subscribe: packet: ");let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.dup?t.DUP_MASK:0,ue=ae.messageId,de=ae.subscriptions,k=ae.properties,X=0;if(typeof ue!="number")return L.destroy(new Error("Invalid messageId")),!1;X+=2;let Y=null;if(he===5){if(Y=ie(L,k),!Y)return!1;X+=Y.length}if(typeof de=="object"&&de.length)for(let ne=0;ne<de.length;ne+=1){let z=de[ne].topic,te=de[ne].qos;if(typeof z!="string")return L.destroy(new Error("Invalid subscriptions - invalid topic")),!1;if(typeof te!="number")return L.destroy(new Error("Invalid subscriptions - invalid qos")),!1;if(he===5){if(typeof(de[ne].nl||!1)!="boolean")return L.destroy(new Error("Invalid subscriptions - invalid No Local")),!1;if(typeof(de[ne].rap||!1)!="boolean")return L.destroy(new Error("Invalid subscriptions - invalid Retain as Published")),!1;let be=de[ne].rh||0;if(typeof be!="number"||be>2)return L.destroy(new Error("Invalid subscriptions - invalid Retain Handling")),!1}X+=n.byteLength(z)+2+1}else return L.destroy(new Error("Invalid subscriptions")),!1;l("subscribe: writing to stream: %o",t.SUBSCRIBE_HEADER),L.write(t.SUBSCRIBE_HEADER[1][re?1:0][0]),V(L,X),g(L,ue),Y!==null&&Y.write();let le=!0;for(let ne of de){let z=ne.topic,te=ne.qos,be=+ne.nl,Se=+ne.rap,Re=ne.rh,Ae;G(L,z),Ae=t.SUBSCRIBE_OPTIONS_QOS[te],he===5&&(Ae|=be?t.SUBSCRIBE_OPTIONS_NL:0,Ae|=Se?t.SUBSCRIBE_OPTIONS_RAP:0,Ae|=Re?t.SUBSCRIBE_OPTIONS_RH[Re]:0),le=L.write(n.from([Ae]))}return le}function I(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.messageId,ue=ae.granted,de=ae.properties,k=0;if(typeof re!="number")return L.destroy(new Error("Invalid messageId")),!1;if(k+=2,typeof ue=="object"&&ue.length)for(let Y=0;Y<ue.length;Y+=1){if(typeof ue[Y]!="number")return L.destroy(new Error("Invalid qos vector")),!1;k+=1}else return L.destroy(new Error("Invalid qos vector")),!1;let X=null;if(he===5){if(X=M(L,de,Q,k),!X)return!1;k+=X.length}return L.write(t.SUBACK_HEADER),V(L,k),g(L,re),X!==null&&X.write(),L.write(n.from(ue))}function A(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.messageId,ue=ae.dup?t.DUP_MASK:0,de=ae.unsubscriptions,k=ae.properties,X=0;if(typeof re!="number")return L.destroy(new Error("Invalid messageId")),!1;if(X+=2,typeof de=="object"&&de.length)for(let ne=0;ne<de.length;ne+=1){if(typeof de[ne]!="string")return L.destroy(new Error("Invalid unsubscriptions")),!1;X+=n.byteLength(de[ne])+2}else return L.destroy(new Error("Invalid unsubscriptions")),!1;let Y=null;if(he===5){if(Y=ie(L,k),!Y)return!1;X+=Y.length}L.write(t.UNSUBSCRIBE_HEADER[1][ue?1:0][0]),V(L,X),g(L,re),Y!==null&&Y.write();let le=!0;for(let ne=0;ne<de.length;ne++)le=G(L,de[ne]);return le}function O(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.messageId,ue=ae.dup?t.DUP_MASK:0,de=ae.granted,k=ae.properties,X=ae.cmd,Y=0,le=2;if(typeof re!="number")return L.destroy(new Error("Invalid messageId")),!1;if(he===5)if(typeof de=="object"&&de.length)for(let z=0;z<de.length;z+=1){if(typeof de[z]!="number")return L.destroy(new Error("Invalid qos vector")),!1;le+=1}else return L.destroy(new Error("Invalid qos vector")),!1;let ne=null;if(he===5){if(ne=M(L,k,Q,le),!ne)return!1;le+=ne.length}return L.write(t.ACKS[X][Y][ue][0]),V(L,le),g(L,re),ne!==null&&ne.write(),he===5&&L.write(n.from(de)),!0}function j(F,L,Q){return L.write(t.EMPTY[F.cmd])}function K(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.reasonCode,ue=ae.properties,de=he===5?1:0,k=null;if(he===5){if(k=M(L,ue,Q,de),!k)return!1;de+=k.length}return L.write(n.from([t.codes.disconnect<<4])),V(L,de),he===5&&L.write(n.from([re])),k!==null&&k.write(),!0}function R(F,L,Q){let he=Q?Q.protocolVersion:4,ae=F||{},re=ae.reasonCode,ue=ae.properties,de=he===5?1:0;he!==5&&L.destroy(new Error("Invalid mqtt version for auth packet"));let k=M(L,ue,Q,de);return k?(de+=k.length,L.write(n.from([t.codes.auth<<4])),V(L,de),L.write(n.from([re])),k!==null&&k.write(),!0):!1}var U={};function V(F,L){if(L>t.VARBYTEINT_MAX)return F.destroy(new Error(`Invalid variable byte integer: ${L}`)),!1;let Q=U[L];return Q||(Q=f(L),L<16384&&(U[L]=Q)),l("writeVarByteInt: writing to stream: %o",Q),F.write(Q)}function G(F,L){let Q=n.byteLength(L);return g(F,Q),l("writeString: %s",L),F.write(L,"utf8")}function J(F,L,Q){G(F,L),G(F,Q)}function H(F,L){return l("writeNumberCached: number: %d",L),l("writeNumberCached: %o",h[L]),F.write(h[L])}function W(F,L){let Q=c(L);return l("writeNumberGenerated: %o",Q),F.write(Q)}function se(F,L){let Q=d(L);return l("write4ByteNumber: %o",Q),F.write(Q)}function Z(F,L){typeof L=="string"?G(F,L):L?(g(F,L.length),F.write(L)):g(F,0)}function ie(F,L){if(typeof L!="object"||L.length!=null)return{length:1,write(){$(F,{},0)}};let Q=0;function he(ae,re){let ue=t.propertiesTypes[ae],de=0;switch(ue){case"byte":{if(typeof re!="boolean")return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+1;break}case"int8":{if(typeof re!="number"||re<0||re>255)return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+1;break}case"binary":{if(re&&re===null)return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+n.byteLength(re)+2;break}case"int16":{if(typeof re!="number"||re<0||re>65535)return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+2;break}case"int32":{if(typeof re!="number"||re<0||re>4294967295)return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+4;break}case"var":{if(typeof re!="number"||re<0||re>268435455)return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+n.byteLength(f(re));break}case"string":{if(typeof re!="string")return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=1+2+n.byteLength(re.toString());break}case"pair":{if(typeof re!="object")return F.destroy(new Error(`Invalid ${ae}: ${re}`)),!1;de+=Object.getOwnPropertyNames(re).reduce((k,X)=>{let Y=re[X];return Array.isArray(Y)?k+=Y.reduce((le,ne)=>(le+=1+2+n.byteLength(X.toString())+2+n.byteLength(ne.toString()),le),0):k+=1+2+n.byteLength(X.toString())+2+n.byteLength(re[X].toString()),k},0);break}default:return F.destroy(new Error(`Invalid property ${ae}: ${re}`)),!1}return de}if(L)for(let ae in L){let re=0,ue=0,de=L[ae];if(Array.isArray(de))for(let k=0;k<de.length;k++){if(ue=he(ae,de[k]),!ue)return!1;re+=ue}else{if(ue=he(ae,de),!ue)return!1;re=ue}if(!re)return!1;Q+=re}return{length:n.byteLength(f(Q))+Q,write(){$(F,L,Q)}}}function M(F,L,Q,he){let ae=["reasonString","userProperties"],re=Q&&Q.properties&&Q.properties.maximumPacketSize?Q.properties.maximumPacketSize:0,ue=ie(F,L);if(re)for(;he+ue.length>re;){let de=ae.shift();if(de&&L[de])delete L[de],ue=ie(F,L);else return!1}return ue}function q(F,L,Q){switch(t.propertiesTypes[L]){case"byte":{F.write(n.from([t.properties[L]])),F.write(n.from([+Q]));break}case"int8":{F.write(n.from([t.properties[L]])),F.write(n.from([Q]));break}case"binary":{F.write(n.from([t.properties[L]])),Z(F,Q);break}case"int16":{F.write(n.from([t.properties[L]])),g(F,Q);break}case"int32":{F.write(n.from([t.properties[L]])),se(F,Q);break}case"var":{F.write(n.from([t.properties[L]])),V(F,Q);break}case"string":{F.write(n.from([t.properties[L]])),G(F,Q);break}case"pair":{Object.getOwnPropertyNames(Q).forEach(he=>{let ae=Q[he];Array.isArray(ae)?ae.forEach(re=>{F.write(n.from([t.properties[L]])),J(F,he.toString(),re.toString())}):(F.write(n.from([t.properties[L]])),J(F,he.toString(),ae.toString()))});break}default:return F.destroy(new Error(`Invalid property ${L} value: ${Q}`)),!1}}function $(F,L,Q){V(F,Q);for(let he in L)if(Object.prototype.hasOwnProperty.call(L,he)&&L[he]!==null){let ae=L[he];if(Array.isArray(ae))for(let re=0;re<ae.length;re++)q(F,he,ae[re]);else q(F,he,ae)}}function we(F){return F?F instanceof n?F.length:n.byteLength(F):0}function oe(F){return typeof F=="string"||F instanceof n}e.exports=w}),Xb=Ee((i,e)=>{ge(),_e(),pe();var t=xg(),{EventEmitter:n}=(Sr(),Qe(Bn)),{Buffer:r}=(Pt(),Qe(Mt));function s(a,l){let h=new o;return t(a,h,l),h.concat()}var o=class extends n{constructor(){super(),this._array=new Array(20),this._i=0}write(a){return this._array[this._i++]=a,!0}concat(){let a=0,l=new Array(this._array.length),h=this._array,c=0,u;for(u=0;u<h.length&&h[u]!==void 0;u++)typeof h[u]!="string"?l[u]=h[u].length:l[u]=r.byteLength(h[u]),a+=l[u];let f=r.allocUnsafe(a);for(u=0;u<h.length&&h[u]!==void 0;u++)typeof h[u]!="string"?(h[u].copy(f,c),c+=l[u]):(f.write(h[u],c),c+=l[u]);return f}destroy(a){a&&this.emit("error",a)}};e.exports=s}),$b=Ee(i=>{ge(),_e(),pe(),i.parser=Gb().parser,i.generate=Xb(),i.writeToStream=xg()}),Tg=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=class{constructor(){this.nextId=Math.max(1,Math.floor(Math.random()*65535))}allocate(){let t=this.nextId++;return this.nextId===65536&&(this.nextId=1),t}getLastAllocated(){return this.nextId===1?65535:this.nextId-1}register(t){return!0}deallocate(t){}clear(){}};i.default=e}),Vb=Ee((i,e)=>{ge(),_e(),pe(),e.exports=n;function t(s){return s instanceof to?to.from(s):new s.constructor(s.buffer.slice(),s.byteOffset,s.length)}function n(s){if(s=s||{},s.circles)return r(s);return s.proto?l:a;function o(h,c){for(var u=Object.keys(h),f=new Array(u.length),d=0;d<u.length;d++){var g=u[d],y=h[g];typeof y!="object"||y===null?f[g]=y:y instanceof Date?f[g]=new Date(y):ArrayBuffer.isView(y)?f[g]=t(y):f[g]=c(y)}return f}function a(h){if(typeof h!="object"||h===null)return h;if(h instanceof Date)return new Date(h);if(Array.isArray(h))return o(h,a);if(h instanceof Map)return new Map(o(Array.from(h),a));if(h instanceof Set)return new Set(o(Array.from(h),a));var c={};for(var u in h)if(Object.hasOwnProperty.call(h,u)!==!1){var f=h[u];typeof f!="object"||f===null?c[u]=f:f instanceof Date?c[u]=new Date(f):f instanceof Map?c[u]=new Map(o(Array.from(f),a)):f instanceof Set?c[u]=new Set(o(Array.from(f),a)):ArrayBuffer.isView(f)?c[u]=t(f):c[u]=a(f)}return c}function l(h){if(typeof h!="object"||h===null)return h;if(h instanceof Date)return new Date(h);if(Array.isArray(h))return o(h,l);if(h instanceof Map)return new Map(o(Array.from(h),l));if(h instanceof Set)return new Set(o(Array.from(h),l));var c={};for(var u in h){var f=h[u];typeof f!="object"||f===null?c[u]=f:f instanceof Date?c[u]=new Date(f):f instanceof Map?c[u]=new Map(o(Array.from(f),l)):f instanceof Set?c[u]=new Set(o(Array.from(f),l)):ArrayBuffer.isView(f)?c[u]=t(f):c[u]=l(f)}return c}}function r(s){var o=[],a=[];return s.proto?c:h;function l(u,f){for(var d=Object.keys(u),g=new Array(d.length),y=0;y<d.length;y++){var w=d[y],E=u[w];if(typeof E!="object"||E===null)g[w]=E;else if(E instanceof Date)g[w]=new Date(E);else if(ArrayBuffer.isView(E))g[w]=t(E);else{var b=o.indexOf(E);b!==-1?g[w]=a[b]:g[w]=f(E)}}return g}function h(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return l(u,h);if(u instanceof Map)return new Map(l(Array.from(u),h));if(u instanceof Set)return new Set(l(Array.from(u),h));var f={};o.push(u),a.push(f);for(var d in u)if(Object.hasOwnProperty.call(u,d)!==!1){var g=u[d];if(typeof g!="object"||g===null)f[d]=g;else if(g instanceof Date)f[d]=new Date(g);else if(g instanceof Map)f[d]=new Map(l(Array.from(g),h));else if(g instanceof Set)f[d]=new Set(l(Array.from(g),h));else if(ArrayBuffer.isView(g))f[d]=t(g);else{var y=o.indexOf(g);y!==-1?f[d]=a[y]:f[d]=h(g)}}return o.pop(),a.pop(),f}function c(u){if(typeof u!="object"||u===null)return u;if(u instanceof Date)return new Date(u);if(Array.isArray(u))return l(u,c);if(u instanceof Map)return new Map(l(Array.from(u),c));if(u instanceof Set)return new Set(l(Array.from(u),c));var f={};o.push(u),a.push(f);for(var d in u){var g=u[d];if(typeof g!="object"||g===null)f[d]=g;else if(g instanceof Date)f[d]=new Date(g);else if(g instanceof Map)f[d]=new Map(l(Array.from(g),c));else if(g instanceof Set)f[d]=new Set(l(Array.from(g),c));else if(ArrayBuffer.isView(g))f[d]=t(g);else{var y=o.indexOf(g);y!==-1?f[d]=a[y]:f[d]=c(g)}}return o.pop(),a.pop(),f}}}),Kb=Ee((i,e)=>{ge(),_e(),pe(),e.exports=Vb()()}),Hb=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.validateTopics=i.validateTopic=void 0;function e(n){let r=n.split("/");for(let s=0;s<r.length;s++)if(r[s]!=="+"){if(r[s]==="#")return s===r.length-1;if(r[s].indexOf("+")!==-1||r[s].indexOf("#")!==-1)return!1}return!0}i.validateTopic=e;function t(n){if(n.length===0)return"empty_topic_list";for(let r=0;r<n.length;r++)if(!e(n[r]))return n[r];return null}i.validateTopics=t}),Rg=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=Un(),t={objectMode:!0},n={clean:!0},r=class{constructor(s){this.options=s||{},this.options=Object.assign(Object.assign({},n),s),this._inflights=new Map}put(s,o){return this._inflights.set(s.messageId,s),o&&o(),this}createStream(){let s=new e.Readable(t),o=[],a=!1,l=0;return this._inflights.forEach((h,c)=>{o.push(h)}),s._read=()=>{!a&&l<o.length?s.push(o[l++]):s.push(null)},s.destroy=h=>{if(!a)return a=!0,setTimeout(()=>{s.emit("close")},0),s},s}del(s,o){let a=this._inflights.get(s.messageId);return a?(this._inflights.delete(s.messageId),o(null,a)):o&&o(new Error("missing packet")),this}get(s,o){let a=this._inflights.get(s.messageId);return a?o(null,a):o&&o(new Error("missing packet")),this}close(s){this.options.clean&&(this._inflights=null),s&&s()}};i.default=r}),qb=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=[0,16,128,131,135,144,145,151,153],t=(n,r,s)=>{n.log("handlePublish: packet %o",r),s=typeof s<"u"?s:n.noop;let o=r.topic.toString(),a=r.payload,{qos:l}=r,{messageId:h}=r,{options:c}=n;if(n.options.protocolVersion===5){let u;if(r.properties&&(u=r.properties.topicAlias),typeof u<"u")if(o.length===0)if(u>0&&u<=65535){let f=n.topicAliasRecv.getTopicByAlias(u);if(f)o=f,n.log("handlePublish :: topic complemented by alias. topic: %s - alias: %d",o,u);else{n.log("handlePublish :: unregistered topic alias. alias: %d",u),n.emit("error",new Error("Received unregistered Topic Alias"));return}}else{n.log("handlePublish :: topic alias out of range. alias: %d",u),n.emit("error",new Error("Received Topic Alias is out of range"));return}else if(n.topicAliasRecv.put(o,u))n.log("handlePublish :: registered topic: %s - alias: %d",o,u);else{n.log("handlePublish :: topic alias out of range. alias: %d",u),n.emit("error",new Error("Received Topic Alias is out of range"));return}}switch(n.log("handlePublish: qos %d",l),l){case 2:{c.customHandleAcks(o,a,r,(u,f)=>{if(typeof u=="number"&&(f=u,u=null),u)return n.emit("error",u);if(e.indexOf(f)===-1)return n.emit("error",new Error("Wrong reason code for pubrec"));f?n._sendPacket({cmd:"pubrec",messageId:h,reasonCode:f},s):n.incomingStore.put(r,()=>{n._sendPacket({cmd:"pubrec",messageId:h},s)})});break}case 1:{c.customHandleAcks(o,a,r,(u,f)=>{if(typeof u=="number"&&(f=u,u=null),u)return n.emit("error",u);if(e.indexOf(f)===-1)return n.emit("error",new Error("Wrong reason code for puback"));f||n.emit("message",o,a,r),n.handleMessage(r,d=>{if(d)return s&&s(d);n._sendPacket({cmd:"puback",messageId:h,reasonCode:f},s)})});break}case 0:n.emit("message",o,a,r),n.handleMessage(r,s);break;default:n.log("handlePublish: unknown QoS. Doing nothing.");break}};i.default=t}),Zb=Ee((i,e)=>{e.exports={version:"5.10.3"}}),xr=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.MQTTJS_VERSION=i.nextTick=i.applyMixin=i.ErrorWithReasonCode=void 0;var e=class Ig extends Error{constructor(r,s){super(r),this.code=s,Object.setPrototypeOf(this,Ig.prototype),Object.getPrototypeOf(this).name="ErrorWithReasonCode"}};i.ErrorWithReasonCode=e;function t(n,r,s=!1){var o;let a=[r];for(;;){let l=a[0],h=Object.getPrototypeOf(l);if(h!=null&&h.prototype)a.unshift(h);else break}for(let l of a)for(let h of Object.getOwnPropertyNames(l.prototype))(s||h!=="constructor")&&Object.defineProperty(n.prototype,h,(o=Object.getOwnPropertyDescriptor(l.prototype,h))!==null&&o!==void 0?o:Object.create(null))}i.applyMixin=t,i.nextTick=typeof(Ve==null?void 0:Ve.nextTick)=="function"?Ve.nextTick:n=>{setTimeout(n,0)},i.MQTTJS_VERSION=Zb().version}),Oo=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.ReasonCodes=void 0;var e=xr();i.ReasonCodes={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};var t=(n,r)=>{let{messageId:s}=r,o=r.cmd,a=null,l=n.outgoing[s]?n.outgoing[s].cb:null,h=null;if(!l){n.log("_handleAck :: Server sent an ack in error. Ignoring.");return}switch(n.log("_handleAck :: packet type",o),o){case"pubcomp":case"puback":{let c=r.reasonCode;c&&c>0&&c!==16?(h=new e.ErrorWithReasonCode(`Publish error: ${i.ReasonCodes[c]}`,c),n._removeOutgoingAndStoreMessage(s,()=>{l(h,r)})):n._removeOutgoingAndStoreMessage(s,l);break}case"pubrec":{a={cmd:"pubrel",qos:2,messageId:s};let c=r.reasonCode;c&&c>0&&c!==16?(h=new e.ErrorWithReasonCode(`Publish error: ${i.ReasonCodes[c]}`,c),n._removeOutgoingAndStoreMessage(s,()=>{l(h,r)})):n._sendPacket(a);break}case"suback":{delete n.outgoing[s],n.messageIdProvider.deallocate(s);let c=r.granted;for(let u=0;u<c.length;u++){let f=c[u];if(f&128){h=new Error(`Subscribe error: ${i.ReasonCodes[f]}`),h.code=f;let d=n.messageIdToTopic[s];d&&d.forEach(g=>{delete n._resubscribeTopics[g]})}}delete n.messageIdToTopic[s],n._invokeStoreProcessingQueue(),l(h,r);break}case"unsuback":{delete n.outgoing[s],n.messageIdProvider.deallocate(s),n._invokeStoreProcessingQueue(),l(null,r);break}default:n.emit("error",new Error("unrecognized packet type"))}n.disconnecting&&Object.keys(n.outgoing).length===0&&n.emit("outgoingEmpty")};i.default=t}),Jb=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=xr(),t=Oo(),n=(r,s)=>{let{options:o}=r,a=o.protocolVersion,l=a===5?s.reasonCode:s.returnCode;if(a!==5){let h=new e.ErrorWithReasonCode(`Protocol error: Auth packets are only supported in MQTT 5. Your version:${a}`,l);r.emit("error",h);return}r.handleAuth(s,(h,c)=>{if(h){r.emit("error",h);return}if(l===24)r.reconnecting=!1,r._sendPacket(c);else{let u=new e.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[l]}`,l);r.emit("error",u)}})};i.default=n}),Qb=Ee(i=>{var d,g,y,w,E,b,v,S,x,T,I,A,O,j,K,R,U,V,G,J,H,W,se,Z,ie,M,Yl,$,we,oe,F,L,Cg,he,ae,re,ue,en,k,tn,Y,Xl,ne,ks,te,Ds,Se,lt,Ae,$l,p,Wr,P;ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.LRUCache=void 0;var e=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,t=new Set,n=typeof Ve=="object"&&Ve?Ve:{},r=(D,C,N,ee)=>{typeof n.emitWarning=="function"?n.emitWarning(D,C,N,ee):console.error(`[${N}] ${C}: ${D}`)},s=globalThis.AbortController,o=globalThis.AbortSignal;if(typeof s>"u"){o=class{constructor(){at(this,"onabort");at(this,"_onabort",[]);at(this,"reason");at(this,"aborted",!1)}addEventListener(N,ee){this._onabort.push(ee)}},s=class{constructor(){at(this,"signal",new o);C()}abort(N){var ee,me;if(!this.signal.aborted){this.signal.reason=N,this.signal.aborted=!0;for(let fe of this.signal._onabort)fe(N);(me=(ee=this.signal).onabort)==null||me.call(ee,N)}}};let D=((d=n.env)==null?void 0:d.LRU_CACHE_IGNORE_AC_WARNING)!=="1",C=()=>{D&&(D=!1,r("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",C))}}var a=D=>!t.has(D),l=D=>D&&D===Math.floor(D)&&D>0&&isFinite(D),h=D=>l(D)?D<=Math.pow(2,8)?Uint8Array:D<=Math.pow(2,16)?Uint16Array:D<=Math.pow(2,32)?Uint32Array:D<=Number.MAX_SAFE_INTEGER?c:null:null,c=class extends Array{constructor(D){super(D),this.fill(0)}},u=(g=class{constructor(C,N){at(this,"heap");at(this,"length");if(!B(g,y))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new N(C),this.length=0}static create(C){let N=h(C);if(!N)return[];Pe(g,y,!0);let ee=new g(C,N);return Pe(g,y,!1),ee}push(C){this.heap[this.length++]=C}pop(){return this.heap[--this.length]}},y=new WeakMap,De(g,y,!1),g),f=(P=class{constructor(C){De(this,M);De(this,L);De(this,ue);De(this,k);De(this,Y);De(this,ne);De(this,te);De(this,Se);De(this,Ae);De(this,p);De(this,w,void 0);De(this,E,void 0);De(this,b,void 0);De(this,v,void 0);De(this,S,void 0);at(this,"ttl");at(this,"ttlResolution");at(this,"ttlAutopurge");at(this,"updateAgeOnGet");at(this,"updateAgeOnHas");at(this,"allowStale");at(this,"noDisposeOnSet");at(this,"noUpdateTTL");at(this,"maxEntrySize");at(this,"sizeCalculation");at(this,"noDeleteOnFetchRejection");at(this,"noDeleteOnStaleGet");at(this,"allowStaleOnFetchAbort");at(this,"allowStaleOnFetchRejection");at(this,"ignoreFetchAbort");De(this,x,void 0);De(this,T,void 0);De(this,I,void 0);De(this,A,void 0);De(this,O,void 0);De(this,j,void 0);De(this,K,void 0);De(this,R,void 0);De(this,U,void 0);De(this,V,void 0);De(this,G,void 0);De(this,J,void 0);De(this,H,void 0);De(this,W,void 0);De(this,se,void 0);De(this,Z,void 0);De(this,ie,void 0);De(this,$,()=>{});De(this,we,()=>{});De(this,oe,()=>{});De(this,F,()=>!1);De(this,he,C=>{});De(this,ae,(C,N,ee)=>{});De(this,re,(C,N,ee,me)=>{if(ee||me)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});let{max:N=0,ttl:ee,ttlResolution:me=1,ttlAutopurge:fe,updateAgeOnGet:ve,updateAgeOnHas:xe,allowStale:Me,dispose:rt,disposeAfter:Lt,noDisposeOnSet:ze,noUpdateTTL:pt,maxSize:et=0,maxEntrySize:tt=0,sizeCalculation:st,fetchMethod:mt,noDeleteOnFetchRejection:Ie,noDeleteOnStaleGet:$e,allowStaleOnFetchRejection:Je,allowStaleOnFetchAbort:He,ignoreFetchAbort:ot}=C;if(N!==0&&!l(N))throw new TypeError("max option must be a nonnegative integer");let Rt=N?h(N):Array;if(!Rt)throw new Error("invalid max value: "+N);if(Pe(this,w,N),Pe(this,E,et),this.maxEntrySize=tt||B(this,E),this.sizeCalculation=st,this.sizeCalculation){if(!B(this,E)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(mt!==void 0&&typeof mt!="function")throw new TypeError("fetchMethod must be a function if specified");if(Pe(this,S,mt),Pe(this,Z,!!mt),Pe(this,I,new Map),Pe(this,A,new Array(N).fill(void 0)),Pe(this,O,new Array(N).fill(void 0)),Pe(this,j,new Rt(N)),Pe(this,K,new Rt(N)),Pe(this,R,0),Pe(this,U,0),Pe(this,V,u.create(N)),Pe(this,x,0),Pe(this,T,0),typeof rt=="function"&&Pe(this,b,rt),typeof Lt=="function"?(Pe(this,v,Lt),Pe(this,G,[])):(Pe(this,v,void 0),Pe(this,G,void 0)),Pe(this,se,!!B(this,b)),Pe(this,ie,!!B(this,v)),this.noDisposeOnSet=!!ze,this.noUpdateTTL=!!pt,this.noDeleteOnFetchRejection=!!Ie,this.allowStaleOnFetchRejection=!!Je,this.allowStaleOnFetchAbort=!!He,this.ignoreFetchAbort=!!ot,this.maxEntrySize!==0){if(B(this,E)!==0&&!l(B(this,E)))throw new TypeError("maxSize must be a positive integer if specified");if(!l(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Ce(this,L,Cg).call(this)}if(this.allowStale=!!Me,this.noDeleteOnStaleGet=!!$e,this.updateAgeOnGet=!!ve,this.updateAgeOnHas=!!xe,this.ttlResolution=l(me)||me===0?me:1,this.ttlAutopurge=!!fe,this.ttl=ee||0,this.ttl){if(!l(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Ce(this,M,Yl).call(this)}if(B(this,w)===0&&this.ttl===0&&B(this,E)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!B(this,w)&&!B(this,E)){let vt="LRU_CACHE_UNBOUNDED";a(vt)&&(t.add(vt),r("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",vt,P))}}static unsafeExposeInternals(C){return{starts:B(C,H),ttls:B(C,W),sizes:B(C,J),keyMap:B(C,I),keyList:B(C,A),valList:B(C,O),next:B(C,j),prev:B(C,K),get head(){return B(C,R)},get tail(){return B(C,U)},free:B(C,V),isBackgroundFetch:N=>{var ee;return Ce(ee=C,Se,lt).call(ee,N)},backgroundFetch:(N,ee,me,fe)=>{var ve;return Ce(ve=C,te,Ds).call(ve,N,ee,me,fe)},moveToTail:N=>{var ee;return Ce(ee=C,p,Wr).call(ee,N)},indexes:N=>{var ee;return Ce(ee=C,ue,en).call(ee,N)},rindexes:N=>{var ee;return Ce(ee=C,k,tn).call(ee,N)},isStale:N=>{var ee;return B(ee=C,F).call(ee,N)}}}get max(){return B(this,w)}get maxSize(){return B(this,E)}get calculatedSize(){return B(this,T)}get size(){return B(this,x)}get fetchMethod(){return B(this,S)}get dispose(){return B(this,b)}get disposeAfter(){return B(this,v)}getRemainingTTL(C){return B(this,I).has(C)?1/0:0}*entries(){for(let C of Ce(this,ue,en).call(this))B(this,O)[C]!==void 0&&B(this,A)[C]!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield[B(this,A)[C],B(this,O)[C]])}*rentries(){for(let C of Ce(this,k,tn).call(this))B(this,O)[C]!==void 0&&B(this,A)[C]!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield[B(this,A)[C],B(this,O)[C]])}*keys(){for(let C of Ce(this,ue,en).call(this)){let N=B(this,A)[C];N!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield N)}}*rkeys(){for(let C of Ce(this,k,tn).call(this)){let N=B(this,A)[C];N!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield N)}}*values(){for(let C of Ce(this,ue,en).call(this))B(this,O)[C]!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield B(this,O)[C])}*rvalues(){for(let C of Ce(this,k,tn).call(this))B(this,O)[C]!==void 0&&!Ce(this,Se,lt).call(this,B(this,O)[C])&&(yield B(this,O)[C])}[Symbol.iterator](){return this.entries()}find(C,N={}){for(let ee of Ce(this,ue,en).call(this)){let me=B(this,O)[ee],fe=Ce(this,Se,lt).call(this,me)?me.__staleWhileFetching:me;if(fe!==void 0&&C(fe,B(this,A)[ee],this))return this.get(B(this,A)[ee],N)}}forEach(C,N=this){for(let ee of Ce(this,ue,en).call(this)){let me=B(this,O)[ee],fe=Ce(this,Se,lt).call(this,me)?me.__staleWhileFetching:me;fe!==void 0&&C.call(N,fe,B(this,A)[ee],this)}}rforEach(C,N=this){for(let ee of Ce(this,k,tn).call(this)){let me=B(this,O)[ee],fe=Ce(this,Se,lt).call(this,me)?me.__staleWhileFetching:me;fe!==void 0&&C.call(N,fe,B(this,A)[ee],this)}}purgeStale(){let C=!1;for(let N of Ce(this,k,tn).call(this,{allowStale:!0}))B(this,F).call(this,N)&&(this.delete(B(this,A)[N]),C=!0);return C}dump(){let C=[];for(let N of Ce(this,ue,en).call(this,{allowStale:!0})){let ee=B(this,A)[N],me=B(this,O)[N],fe=Ce(this,Se,lt).call(this,me)?me.__staleWhileFetching:me;if(fe===void 0||ee===void 0)continue;let ve={value:fe};if(B(this,W)&&B(this,H)){ve.ttl=B(this,W)[N];let xe=e.now()-B(this,H)[N];ve.start=Math.floor(Date.now()-xe)}B(this,J)&&(ve.size=B(this,J)[N]),C.unshift([ee,ve])}return C}load(C){this.clear();for(let[N,ee]of C){if(ee.start){let me=Date.now()-ee.start;ee.start=e.now()-me}this.set(N,ee.value,ee)}}set(C,N,ee={}){var pt,et,tt,st,mt;if(N===void 0)return this.delete(C),this;let{ttl:me=this.ttl,start:fe,noDisposeOnSet:ve=this.noDisposeOnSet,sizeCalculation:xe=this.sizeCalculation,status:Me}=ee,{noUpdateTTL:rt=this.noUpdateTTL}=ee,Lt=B(this,re).call(this,C,N,ee.size||0,xe);if(this.maxEntrySize&&Lt>this.maxEntrySize)return Me&&(Me.set="miss",Me.maxEntrySizeExceeded=!0),this.delete(C),this;let ze=B(this,x)===0?void 0:B(this,I).get(C);if(ze===void 0)ze=B(this,x)===0?B(this,U):B(this,V).length!==0?B(this,V).pop():B(this,x)===B(this,w)?Ce(this,ne,ks).call(this,!1):B(this,x),B(this,A)[ze]=C,B(this,O)[ze]=N,B(this,I).set(C,ze),B(this,j)[B(this,U)]=ze,B(this,K)[ze]=B(this,U),Pe(this,U,ze),ds(this,x)._++,B(this,ae).call(this,ze,Lt,Me),Me&&(Me.set="add"),rt=!1;else{Ce(this,p,Wr).call(this,ze);let Ie=B(this,O)[ze];if(N!==Ie){if(B(this,Z)&&Ce(this,Se,lt).call(this,Ie)){Ie.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:$e}=Ie;$e!==void 0&&!ve&&(B(this,se)&&((pt=B(this,b))==null||pt.call(this,$e,C,"set")),B(this,ie)&&((et=B(this,G))==null||et.push([$e,C,"set"])))}else ve||(B(this,se)&&((tt=B(this,b))==null||tt.call(this,Ie,C,"set")),B(this,ie)&&((st=B(this,G))==null||st.push([Ie,C,"set"])));if(B(this,he).call(this,ze),B(this,ae).call(this,ze,Lt,Me),B(this,O)[ze]=N,Me){Me.set="replace";let $e=Ie&&Ce(this,Se,lt).call(this,Ie)?Ie.__staleWhileFetching:Ie;$e!==void 0&&(Me.oldValue=$e)}}else Me&&(Me.set="update")}if(me!==0&&!B(this,W)&&Ce(this,M,Yl).call(this),B(this,W)&&(rt||B(this,oe).call(this,ze,me,fe),Me&&B(this,we).call(this,Me,ze)),!ve&&B(this,ie)&&B(this,G)){let Ie=B(this,G),$e;for(;$e=Ie==null?void 0:Ie.shift();)(mt=B(this,v))==null||mt.call(this,...$e)}return this}pop(){var C;try{for(;B(this,x);){let N=B(this,O)[B(this,R)];if(Ce(this,ne,ks).call(this,!0),Ce(this,Se,lt).call(this,N)){if(N.__staleWhileFetching)return N.__staleWhileFetching}else if(N!==void 0)return N}}finally{if(B(this,ie)&&B(this,G)){let N=B(this,G),ee;for(;ee=N==null?void 0:N.shift();)(C=B(this,v))==null||C.call(this,...ee)}}}has(C,N={}){let{updateAgeOnHas:ee=this.updateAgeOnHas,status:me}=N,fe=B(this,I).get(C);if(fe!==void 0){let ve=B(this,O)[fe];if(Ce(this,Se,lt).call(this,ve)&&ve.__staleWhileFetching===void 0)return!1;if(B(this,F).call(this,fe))me&&(me.has="stale",B(this,we).call(this,me,fe));else return ee&&B(this,$).call(this,fe),me&&(me.has="hit",B(this,we).call(this,me,fe)),!0}else me&&(me.has="miss");return!1}peek(C,N={}){let{allowStale:ee=this.allowStale}=N,me=B(this,I).get(C);if(me!==void 0&&(ee||!B(this,F).call(this,me))){let fe=B(this,O)[me];return Ce(this,Se,lt).call(this,fe)?fe.__staleWhileFetching:fe}}async fetch(C,N={}){let{allowStale:ee=this.allowStale,updateAgeOnGet:me=this.updateAgeOnGet,noDeleteOnStaleGet:fe=this.noDeleteOnStaleGet,ttl:ve=this.ttl,noDisposeOnSet:xe=this.noDisposeOnSet,size:Me=0,sizeCalculation:rt=this.sizeCalculation,noUpdateTTL:Lt=this.noUpdateTTL,noDeleteOnFetchRejection:ze=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:pt=this.allowStaleOnFetchRejection,ignoreFetchAbort:et=this.ignoreFetchAbort,allowStaleOnFetchAbort:tt=this.allowStaleOnFetchAbort,context:st,forceRefresh:mt=!1,status:Ie,signal:$e}=N;if(!B(this,Z))return Ie&&(Ie.fetch="get"),this.get(C,{allowStale:ee,updateAgeOnGet:me,noDeleteOnStaleGet:fe,status:Ie});let Je={allowStale:ee,updateAgeOnGet:me,noDeleteOnStaleGet:fe,ttl:ve,noDisposeOnSet:xe,size:Me,sizeCalculation:rt,noUpdateTTL:Lt,noDeleteOnFetchRejection:ze,allowStaleOnFetchRejection:pt,allowStaleOnFetchAbort:tt,ignoreFetchAbort:et,status:Ie,signal:$e},He=B(this,I).get(C);if(He===void 0){Ie&&(Ie.fetch="miss");let ot=Ce(this,te,Ds).call(this,C,He,Je,st);return ot.__returned=ot}else{let ot=B(this,O)[He];if(Ce(this,Se,lt).call(this,ot)){let Et=ee&&ot.__staleWhileFetching!==void 0;return Ie&&(Ie.fetch="inflight",Et&&(Ie.returnedStale=!0)),Et?ot.__staleWhileFetching:ot.__returned=ot}let Rt=B(this,F).call(this,He);if(!mt&&!Rt)return Ie&&(Ie.fetch="hit"),Ce(this,p,Wr).call(this,He),me&&B(this,$).call(this,He),Ie&&B(this,we).call(this,Ie,He),ot;let vt=Ce(this,te,Ds).call(this,C,He,Je,st),nt=vt.__staleWhileFetching!==void 0&&ee;return Ie&&(Ie.fetch=Rt?"stale":"refresh",nt&&Rt&&(Ie.returnedStale=!0)),nt?vt.__staleWhileFetching:vt.__returned=vt}}get(C,N={}){let{allowStale:ee=this.allowStale,updateAgeOnGet:me=this.updateAgeOnGet,noDeleteOnStaleGet:fe=this.noDeleteOnStaleGet,status:ve}=N,xe=B(this,I).get(C);if(xe!==void 0){let Me=B(this,O)[xe],rt=Ce(this,Se,lt).call(this,Me);return ve&&B(this,we).call(this,ve,xe),B(this,F).call(this,xe)?(ve&&(ve.get="stale"),rt?(ve&&ee&&Me.__staleWhileFetching!==void 0&&(ve.returnedStale=!0),ee?Me.__staleWhileFetching:void 0):(fe||this.delete(C),ve&&ee&&(ve.returnedStale=!0),ee?Me:void 0)):(ve&&(ve.get="hit"),rt?Me.__staleWhileFetching:(Ce(this,p,Wr).call(this,xe),me&&B(this,$).call(this,xe),Me))}else ve&&(ve.get="miss")}delete(C){var ee,me,fe,ve;let N=!1;if(B(this,x)!==0){let xe=B(this,I).get(C);if(xe!==void 0)if(N=!0,B(this,x)===1)this.clear();else{B(this,he).call(this,xe);let Me=B(this,O)[xe];Ce(this,Se,lt).call(this,Me)?Me.__abortController.abort(new Error("deleted")):(B(this,se)||B(this,ie))&&(B(this,se)&&((ee=B(this,b))==null||ee.call(this,Me,C,"delete")),B(this,ie)&&((me=B(this,G))==null||me.push([Me,C,"delete"]))),B(this,I).delete(C),B(this,A)[xe]=void 0,B(this,O)[xe]=void 0,xe===B(this,U)?Pe(this,U,B(this,K)[xe]):xe===B(this,R)?Pe(this,R,B(this,j)[xe]):(B(this,j)[B(this,K)[xe]]=B(this,j)[xe],B(this,K)[B(this,j)[xe]]=B(this,K)[xe]),ds(this,x)._--,B(this,V).push(xe)}}if(B(this,ie)&&((fe=B(this,G))!=null&&fe.length)){let xe=B(this,G),Me;for(;Me=xe==null?void 0:xe.shift();)(ve=B(this,v))==null||ve.call(this,...Me)}return N}clear(){var C,N,ee;for(let me of Ce(this,k,tn).call(this,{allowStale:!0})){let fe=B(this,O)[me];if(Ce(this,Se,lt).call(this,fe))fe.__abortController.abort(new Error("deleted"));else{let ve=B(this,A)[me];B(this,se)&&((C=B(this,b))==null||C.call(this,fe,ve,"delete")),B(this,ie)&&((N=B(this,G))==null||N.push([fe,ve,"delete"]))}}if(B(this,I).clear(),B(this,O).fill(void 0),B(this,A).fill(void 0),B(this,W)&&B(this,H)&&(B(this,W).fill(0),B(this,H).fill(0)),B(this,J)&&B(this,J).fill(0),Pe(this,R,0),Pe(this,U,0),B(this,V).length=0,Pe(this,T,0),Pe(this,x,0),B(this,ie)&&B(this,G)){let me=B(this,G),fe;for(;fe=me==null?void 0:me.shift();)(ee=B(this,v))==null||ee.call(this,...fe)}}},w=new WeakMap,E=new WeakMap,b=new WeakMap,v=new WeakMap,S=new WeakMap,x=new WeakMap,T=new WeakMap,I=new WeakMap,A=new WeakMap,O=new WeakMap,j=new WeakMap,K=new WeakMap,R=new WeakMap,U=new WeakMap,V=new WeakMap,G=new WeakMap,J=new WeakMap,H=new WeakMap,W=new WeakMap,se=new WeakMap,Z=new WeakMap,ie=new WeakMap,M=new WeakSet,Yl=function(){let C=new c(B(this,w)),N=new c(B(this,w));Pe(this,W,C),Pe(this,H,N),Pe(this,oe,(fe,ve,xe=e.now())=>{if(N[fe]=ve!==0?xe:0,C[fe]=ve,ve!==0&&this.ttlAutopurge){let Me=setTimeout(()=>{B(this,F).call(this,fe)&&this.delete(B(this,A)[fe])},ve+1);Me.unref&&Me.unref()}}),Pe(this,$,fe=>{N[fe]=C[fe]!==0?e.now():0}),Pe(this,we,(fe,ve)=>{if(C[ve]){let xe=C[ve],Me=N[ve];fe.ttl=xe,fe.start=Me,fe.now=ee||me();let rt=fe.now-Me;fe.remainingTTL=xe-rt}});let ee=0,me=()=>{let fe=e.now();if(this.ttlResolution>0){ee=fe;let ve=setTimeout(()=>ee=0,this.ttlResolution);ve.unref&&ve.unref()}return fe};this.getRemainingTTL=fe=>{let ve=B(this,I).get(fe);if(ve===void 0)return 0;let xe=C[ve],Me=N[ve];if(xe===0||Me===0)return 1/0;let rt=(ee||me())-Me;return xe-rt},Pe(this,F,fe=>C[fe]!==0&&N[fe]!==0&&(ee||me())-N[fe]>C[fe])},$=new WeakMap,we=new WeakMap,oe=new WeakMap,F=new WeakMap,L=new WeakSet,Cg=function(){let C=new c(B(this,w));Pe(this,T,0),Pe(this,J,C),Pe(this,he,N=>{Pe(this,T,B(this,T)-C[N]),C[N]=0}),Pe(this,re,(N,ee,me,fe)=>{if(Ce(this,Se,lt).call(this,ee))return 0;if(!l(me))if(fe){if(typeof fe!="function")throw new TypeError("sizeCalculation must be a function");if(me=fe(ee,N),!l(me))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return me}),Pe(this,ae,(N,ee,me)=>{if(C[N]=ee,B(this,E)){let fe=B(this,E)-C[N];for(;B(this,T)>fe;)Ce(this,ne,ks).call(this,!0)}Pe(this,T,B(this,T)+C[N]),me&&(me.entrySize=ee,me.totalCalculatedSize=B(this,T))})},he=new WeakMap,ae=new WeakMap,re=new WeakMap,ue=new WeakSet,en=function*({allowStale:C=this.allowStale}={}){if(B(this,x))for(let N=B(this,U);!(!Ce(this,Y,Xl).call(this,N)||((C||!B(this,F).call(this,N))&&(yield N),N===B(this,R)));)N=B(this,K)[N]},k=new WeakSet,tn=function*({allowStale:C=this.allowStale}={}){if(B(this,x))for(let N=B(this,R);!(!Ce(this,Y,Xl).call(this,N)||((C||!B(this,F).call(this,N))&&(yield N),N===B(this,U)));)N=B(this,j)[N]},Y=new WeakSet,Xl=function(C){return C!==void 0&&B(this,I).get(B(this,A)[C])===C},ne=new WeakSet,ks=function(C){var fe,ve;let N=B(this,R),ee=B(this,A)[N],me=B(this,O)[N];return B(this,Z)&&Ce(this,Se,lt).call(this,me)?me.__abortController.abort(new Error("evicted")):(B(this,se)||B(this,ie))&&(B(this,se)&&((fe=B(this,b))==null||fe.call(this,me,ee,"evict")),B(this,ie)&&((ve=B(this,G))==null||ve.push([me,ee,"evict"]))),B(this,he).call(this,N),C&&(B(this,A)[N]=void 0,B(this,O)[N]=void 0,B(this,V).push(N)),B(this,x)===1?(Pe(this,R,Pe(this,U,0)),B(this,V).length=0):Pe(this,R,B(this,j)[N]),B(this,I).delete(ee),ds(this,x)._--,N},te=new WeakSet,Ds=function(C,N,ee,me){let fe=N===void 0?void 0:B(this,O)[N];if(Ce(this,Se,lt).call(this,fe))return fe;let ve=new s,{signal:xe}=ee;xe==null||xe.addEventListener("abort",()=>ve.abort(xe.reason),{signal:ve.signal});let Me={signal:ve.signal,options:ee,context:me},rt=(st,mt=!1)=>{let{aborted:Ie}=ve.signal,$e=ee.ignoreFetchAbort&&st!==void 0;if(ee.status&&(Ie&&!mt?(ee.status.fetchAborted=!0,ee.status.fetchError=ve.signal.reason,$e&&(ee.status.fetchAbortIgnored=!0)):ee.status.fetchResolved=!0),Ie&&!$e&&!mt)return ze(ve.signal.reason);let Je=et;return B(this,O)[N]===et&&(st===void 0?Je.__staleWhileFetching?B(this,O)[N]=Je.__staleWhileFetching:this.delete(C):(ee.status&&(ee.status.fetchUpdated=!0),this.set(C,st,Me.options))),st},Lt=st=>(ee.status&&(ee.status.fetchRejected=!0,ee.status.fetchError=st),ze(st)),ze=st=>{let{aborted:mt}=ve.signal,Ie=mt&&ee.allowStaleOnFetchAbort,$e=Ie||ee.allowStaleOnFetchRejection,Je=$e||ee.noDeleteOnFetchRejection,He=et;if(B(this,O)[N]===et&&(!Je||He.__staleWhileFetching===void 0?this.delete(C):Ie||(B(this,O)[N]=He.__staleWhileFetching)),$e)return ee.status&&He.__staleWhileFetching!==void 0&&(ee.status.returnedStale=!0),He.__staleWhileFetching;if(He.__returned===He)throw st},pt=(st,mt)=>{var $e;let Ie=($e=B(this,S))==null?void 0:$e.call(this,C,fe,Me);Ie&&Ie instanceof Promise&&Ie.then(Je=>st(Je===void 0?void 0:Je),mt),ve.signal.addEventListener("abort",()=>{(!ee.ignoreFetchAbort||ee.allowStaleOnFetchAbort)&&(st(void 0),ee.allowStaleOnFetchAbort&&(st=Je=>rt(Je,!0)))})};ee.status&&(ee.status.fetchDispatched=!0);let et=new Promise(pt).then(rt,Lt),tt=Object.assign(et,{__abortController:ve,__staleWhileFetching:fe,__returned:void 0});return N===void 0?(this.set(C,tt,{...Me.options,status:void 0}),N=B(this,I).get(C)):B(this,O)[N]=tt,tt},Se=new WeakSet,lt=function(C){if(!B(this,Z))return!1;let N=C;return!!N&&N instanceof Promise&&N.hasOwnProperty("__staleWhileFetching")&&N.__abortController instanceof s},Ae=new WeakSet,$l=function(C,N){B(this,K)[N]=C,B(this,j)[C]=N},p=new WeakSet,Wr=function(C){C!==B(this,U)&&(C===B(this,R)?Pe(this,R,B(this,j)[C]):Ce(this,Ae,$l).call(this,B(this,K)[C],B(this,j)[C]),Ce(this,Ae,$l).call(this,B(this,U),C),Pe(this,U,C))},P);i.LRUCache=f}),Yi=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.ContainerIterator=i.Container=i.Base=void 0;var e=class{constructor(r=0){this.iteratorType=r}equals(r){return this.o===r.o}};i.ContainerIterator=e;var t=class{constructor(){this.i=0}get length(){return this.i}size(){return this.i}empty(){return this.i===0}};i.Base=t;var n=class extends t{};i.Container=n}),ev=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Yi(),t=class extends e.Base{constructor(r=[]){super(),this.S=[];let s=this;r.forEach(function(o){s.push(o)})}clear(){this.i=0,this.S=[]}push(r){return this.S.push(r),this.i+=1,this.i}pop(){if(this.i!==0)return this.i-=1,this.S.pop()}top(){return this.S[this.i-1]}},n=t;i.default=n}),tv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Yi(),t=class extends e.Base{constructor(r=[]){super(),this.j=0,this.q=[];let s=this;r.forEach(function(o){s.push(o)})}clear(){this.q=[],this.i=this.j=0}push(r){let s=this.q.length;if(this.j/s>.5&&this.j+this.i>=s&&s>4096){let o=this.i;for(let a=0;a<o;++a)this.q[a]=this.q[this.j+a];this.j=0,this.q[this.i]=r}else this.q[this.j+this.i]=r;return++this.i}pop(){if(this.i===0)return;let r=this.q[this.j++];return this.i-=1,r}front(){if(this.i!==0)return this.q[this.j]}},n=t;i.default=n}),iv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Yi(),t=class extends e.Base{constructor(r=[],s=function(a,l){return a>l?-1:a<l?1:0},o=!0){if(super(),this.v=s,Array.isArray(r))this.C=o?[...r]:r;else{this.C=[];let l=this;r.forEach(function(h){l.C.push(h)})}this.i=this.C.length;let a=this.i>>1;for(let l=this.i-1>>1;l>=0;--l)this.k(l,a)}m(r){let s=this.C[r];for(;r>0;){let o=r-1>>1,a=this.C[o];if(this.v(a,s)<=0)break;this.C[r]=a,r=o}this.C[r]=s}k(r,s){let o=this.C[r];for(;r<s;){let a=r<<1|1,l=a+1,h=this.C[a];if(l<this.i&&this.v(h,this.C[l])>0&&(a=l,h=this.C[l]),this.v(h,o)>=0)break;this.C[r]=h,r=a}this.C[r]=o}clear(){this.i=0,this.C.length=0}push(r){this.C.push(r),this.m(this.i),this.i+=1}pop(){if(this.i===0)return;let r=this.C[0],s=this.C.pop();return this.i-=1,this.i&&(this.C[0]=s,this.k(0,this.i>>1)),r}top(){return this.C[0]}find(r){return this.C.indexOf(r)>=0}remove(r){let s=this.C.indexOf(r);return s<0?!1:(s===0?this.pop():s===this.i-1?(this.C.pop(),this.i-=1):(this.C.splice(s,1,this.C.pop()),this.i-=1,this.m(s),this.k(s,this.i>>1)),!0)}updateItem(r){let s=this.C.indexOf(r);return s<0?!1:(this.m(s),this.k(s,this.i>>1),!0)}toArray(){return[...this.C]}},n=t;i.default=n}),hc=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Yi(),t=class extends e.Container{},n=t;i.default=n}),Xi=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.throwIteratorAccessError=e;function e(){throw new RangeError("Iterator access denied!")}}),Ag=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.RandomIterator=void 0;var e=Yi(),t=Xi(),n=class extends e.ContainerIterator{constructor(r,s){super(s),this.o=r,this.iteratorType===0?(this.pre=function(){return this.o===0&&(0,t.throwIteratorAccessError)(),this.o-=1,this},this.next=function(){return this.o===this.container.size()&&(0,t.throwIteratorAccessError)(),this.o+=1,this}):(this.pre=function(){return this.o===this.container.size()-1&&(0,t.throwIteratorAccessError)(),this.o+=1,this},this.next=function(){return this.o===-1&&(0,t.throwIteratorAccessError)(),this.o-=1,this})}get pointer(){return this.container.getElementByPos(this.o)}set pointer(r){this.container.setElementByPos(this.o,r)}};i.RandomIterator=n}),nv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=n(hc()),t=Ag();function n(a){return a&&a.t?a:{default:a}}var r=class Mg extends t.RandomIterator{constructor(l,h,c){super(l,c),this.container=h}copy(){return new Mg(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(a=[],l=!0){if(super(),Array.isArray(a))this.J=l?[...a]:a,this.i=a.length;else{this.J=[];let h=this;a.forEach(function(c){h.pushBack(c)})}}clear(){this.i=0,this.J.length=0}begin(){return new r(0,this)}end(){return new r(this.i,this)}rBegin(){return new r(this.i-1,this,1)}rEnd(){return new r(-1,this,1)}front(){return this.J[0]}back(){return this.J[this.i-1]}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J[a]}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;return this.J.splice(a,1),this.i-=1,this.i}eraseElementByValue(a){let l=0;for(let h=0;h<this.i;++h)this.J[h]!==a&&(this.J[l++]=this.J[h]);return this.i=this.J.length=l,this.i}eraseElementByIterator(a){let l=a.o;return a=a.next(),this.eraseElementByPos(l),a}pushBack(a){return this.J.push(a),this.i+=1,this.i}popBack(){if(this.i!==0)return this.i-=1,this.J.pop()}setElementByPos(a,l){if(a<0||a>this.i-1)throw new RangeError;this.J[a]=l}insert(a,l,h=1){if(a<0||a>this.i)throw new RangeError;return this.J.splice(a,0,...new Array(h).fill(l)),this.i+=h,this.i}find(a){for(let l=0;l<this.i;++l)if(this.J[l]===a)return new r(l,this);return this.end()}reverse(){this.J.reverse()}unique(){let a=1;for(let l=1;l<this.i;++l)this.J[l]!==this.J[l-1]&&(this.J[a++]=this.J[l]);return this.i=this.J.length=a,this.i}sort(a){this.J.sort(a)}forEach(a){for(let l=0;l<this.i;++l)a(this.J[l],l,this)}[Symbol.iterator](){return(function*(){yield*this.J}).bind(this)()}},o=s;i.default=o}),rv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=r(hc()),t=Yi(),n=Xi();function r(l){return l&&l.t?l:{default:l}}var s=class Pg extends t.ContainerIterator{constructor(h,c,u,f){super(f),this.o=h,this.h=c,this.container=u,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.L,this})}get pointer(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.l}set pointer(h){this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.l=h}copy(){return new Pg(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[]){super(),this.h={},this.p=this._=this.h.L=this.h.B=this.h;let h=this;l.forEach(function(c){h.pushBack(c)})}V(l){let{L:h,B:c}=l;h.B=c,c.L=h,l===this.p&&(this.p=c),l===this._&&(this._=h),this.i-=1}G(l,h){let c=h.B,u={l,L:h,B:c};h.B=u,c.L=u,h===this.h&&(this.p=u),c===this.h&&(this._=u),this.i+=1}clear(){this.i=0,this.p=this._=this.h.L=this.h.B=this.h}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.p.l}back(){return this._.l}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let h=this.p;for(;l--;)h=h.B;return h.l}eraseElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let h=this.p;for(;l--;)h=h.B;return this.V(h),this.i}eraseElementByValue(l){let h=this.p;for(;h!==this.h;)h.l===l&&this.V(h),h=h.B;return this.i}eraseElementByIterator(l){let h=l.o;return h===this.h&&(0,n.throwIteratorAccessError)(),l=l.next(),this.V(h),l}pushBack(l){return this.G(l,this._),this.i}popBack(){if(this.i===0)return;let l=this._.l;return this.V(this._),l}pushFront(l){return this.G(l,this.h),this.i}popFront(){if(this.i===0)return;let l=this.p.l;return this.V(this.p),l}setElementByPos(l,h){if(l<0||l>this.i-1)throw new RangeError;let c=this.p;for(;l--;)c=c.B;c.l=h}insert(l,h,c=1){if(l<0||l>this.i)throw new RangeError;if(c<=0)return this.i;if(l===0)for(;c--;)this.pushFront(h);else if(l===this.i)for(;c--;)this.pushBack(h);else{let u=this.p;for(let d=1;d<l;++d)u=u.B;let f=u.B;for(this.i+=c;c--;)u.B={l:h,L:u},u.B.L=u,u=u.B;u.B=f,f.L=u}return this.i}find(l){let h=this.p;for(;h!==this.h;){if(h.l===l)return new s(h,this.h,this);h=h.B}return this.end()}reverse(){if(this.i<=1)return;let l=this.p,h=this._,c=0;for(;c<<1<this.i;){let u=l.l;l.l=h.l,h.l=u,l=l.B,h=h.L,c+=1}}unique(){if(this.i<=1)return this.i;let l=this.p;for(;l!==this.h;){let h=l;for(;h.B!==this.h&&h.l===h.B.l;)h=h.B,this.i-=1;l.B=h.B,l.B.L=l,l=l.B}return this.i}sort(l){if(this.i<=1)return;let h=[];this.forEach(function(u){h.push(u)}),h.sort(l);let c=this.p;h.forEach(function(u){c.l=u,c=c.B})}merge(l){let h=this;if(this.i===0)l.forEach(function(c){h.pushBack(c)});else{let c=this.p;l.forEach(function(u){for(;c!==h.h&&c.l<=u;)c=c.B;h.G(u,c.L)})}return this.i}forEach(l){let h=this.p,c=0;for(;h!==this.h;)l(h.l,c++,this),h=h.B}[Symbol.iterator](){return(function*(){if(this.i===0)return;let l=this.p;for(;l!==this.h;)yield l.l,l=l.B}).bind(this)()}},a=o;i.default=a}),sv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=n(hc()),t=Ag();function n(a){return a&&a.t?a:{default:a}}var r=class Lg extends t.RandomIterator{constructor(l,h,c){super(l,c),this.container=h}copy(){return new Lg(this.o,this.container,this.iteratorType)}},s=class extends e.default{constructor(a=[],l=4096){super(),this.j=0,this.D=0,this.R=0,this.N=0,this.P=0,this.A=[];let h=(()=>{if(typeof a.length=="number")return a.length;if(typeof a.size=="number")return a.size;if(typeof a.size=="function")return a.size();throw new TypeError("Cannot get the length or size of the container")})();this.F=l,this.P=Math.max(Math.ceil(h/this.F),1);for(let f=0;f<this.P;++f)this.A.push(new Array(this.F));let c=Math.ceil(h/this.F);this.j=this.R=(this.P>>1)-(c>>1),this.D=this.N=this.F-h%this.F>>1;let u=this;a.forEach(function(f){u.pushBack(f)})}T(){let a=[],l=Math.max(this.P>>1,1);for(let h=0;h<l;++h)a[h]=new Array(this.F);for(let h=this.j;h<this.P;++h)a[a.length]=this.A[h];for(let h=0;h<this.R;++h)a[a.length]=this.A[h];a[a.length]=[...this.A[this.R]],this.j=l,this.R=a.length-1;for(let h=0;h<l;++h)a[a.length]=new Array(this.F);this.A=a,this.P=a.length}O(a){let l=this.D+a+1,h=l%this.F,c=h-1,u=this.j+(l-h)/this.F;return h===0&&(u-=1),u%=this.P,c<0&&(c+=this.F),{curNodeBucketIndex:u,curNodePointerIndex:c}}clear(){this.A=[new Array(this.F)],this.P=1,this.j=this.R=this.i=0,this.D=this.N=this.F>>1}begin(){return new r(0,this)}end(){return new r(this.i,this)}rBegin(){return new r(this.i-1,this,1)}rEnd(){return new r(-1,this,1)}front(){if(this.i!==0)return this.A[this.j][this.D]}back(){if(this.i!==0)return this.A[this.R][this.N]}pushBack(a){return this.i&&(this.N<this.F-1?this.N+=1:this.R<this.P-1?(this.R+=1,this.N=0):(this.R=0,this.N=0),this.R===this.j&&this.N===this.D&&this.T()),this.i+=1,this.A[this.R][this.N]=a,this.i}popBack(){if(this.i===0)return;let a=this.A[this.R][this.N];return this.i!==1&&(this.N>0?this.N-=1:this.R>0?(this.R-=1,this.N=this.F-1):(this.R=this.P-1,this.N=this.F-1)),this.i-=1,a}pushFront(a){return this.i&&(this.D>0?this.D-=1:this.j>0?(this.j-=1,this.D=this.F-1):(this.j=this.P-1,this.D=this.F-1),this.j===this.R&&this.D===this.N&&this.T()),this.i+=1,this.A[this.j][this.D]=a,this.i}popFront(){if(this.i===0)return;let a=this.A[this.j][this.D];return this.i!==1&&(this.D<this.F-1?this.D+=1:this.j<this.P-1?(this.j+=1,this.D=0):(this.j=0,this.D=0)),this.i-=1,a}getElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:l,curNodePointerIndex:h}=this.O(a);return this.A[l][h]}setElementByPos(a,l){if(a<0||a>this.i-1)throw new RangeError;let{curNodeBucketIndex:h,curNodePointerIndex:c}=this.O(a);this.A[h][c]=l}insert(a,l,h=1){if(a<0||a>this.i)throw new RangeError;if(a===0)for(;h--;)this.pushFront(l);else if(a===this.i)for(;h--;)this.pushBack(l);else{let c=[];for(let u=a;u<this.i;++u)c.push(this.getElementByPos(u));this.cut(a-1);for(let u=0;u<h;++u)this.pushBack(l);for(let u=0;u<c.length;++u)this.pushBack(c[u])}return this.i}cut(a){if(a<0)return this.clear(),0;let{curNodeBucketIndex:l,curNodePointerIndex:h}=this.O(a);return this.R=l,this.N=h,this.i=a+1,this.i}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;if(a===0)this.popFront();else if(a===this.i-1)this.popBack();else{let l=[];for(let c=a+1;c<this.i;++c)l.push(this.getElementByPos(c));this.cut(a),this.popBack();let h=this;l.forEach(function(c){h.pushBack(c)})}return this.i}eraseElementByValue(a){if(this.i===0)return 0;let l=[];for(let c=0;c<this.i;++c){let u=this.getElementByPos(c);u!==a&&l.push(u)}let h=l.length;for(let c=0;c<h;++c)this.setElementByPos(c,l[c]);return this.cut(h-1)}eraseElementByIterator(a){let l=a.o;return this.eraseElementByPos(l),a=a.next(),a}find(a){for(let l=0;l<this.i;++l)if(this.getElementByPos(l)===a)return new r(l,this);return this.end()}reverse(){let a=0,l=this.i-1;for(;a<l;){let h=this.getElementByPos(a);this.setElementByPos(a,this.getElementByPos(l)),this.setElementByPos(l,h),a+=1,l-=1}}unique(){if(this.i<=1)return this.i;let a=1,l=this.getElementByPos(0);for(let h=1;h<this.i;++h){let c=this.getElementByPos(h);c!==l&&(l=c,this.setElementByPos(a++,c))}for(;this.i>a;)this.popBack();return this.i}sort(a){let l=[];for(let h=0;h<this.i;++h)l.push(this.getElementByPos(h));l.sort(a);for(let h=0;h<this.i;++h)this.setElementByPos(h,l[h])}shrinkToFit(){if(this.i===0)return;let a=[];this.forEach(function(l){a.push(l)}),this.P=Math.max(Math.ceil(this.i/this.F),1),this.i=this.j=this.R=this.D=this.N=0,this.A=[];for(let l=0;l<this.P;++l)this.A.push(new Array(this.F));for(let l=0;l<a.length;++l)this.pushBack(a[l])}forEach(a){for(let l=0;l<this.i;++l)a(this.getElementByPos(l),l,this)}[Symbol.iterator](){return(function*(){for(let a=0;a<this.i;++a)yield this.getElementByPos(a)}).bind(this)()}},o=s;i.default=o}),ov=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.TreeNodeEnableIndex=i.TreeNode=void 0;var e=class{constructor(n,r){this.ee=1,this.u=void 0,this.l=void 0,this.U=void 0,this.W=void 0,this.tt=void 0,this.u=n,this.l=r}L(){let n=this;if(n.ee===1&&n.tt.tt===n)n=n.W;else if(n.U)for(n=n.U;n.W;)n=n.W;else{let r=n.tt;for(;r.U===n;)n=r,r=n.tt;n=r}return n}B(){let n=this;if(n.W){for(n=n.W;n.U;)n=n.U;return n}else{let r=n.tt;for(;r.W===n;)n=r,r=n.tt;return n.W!==r?r:n}}te(){let n=this.tt,r=this.W,s=r.U;return n.tt===this?n.tt=r:n.U===this?n.U=r:n.W=r,r.tt=n,r.U=this,this.tt=r,this.W=s,s&&(s.tt=this),r}se(){let n=this.tt,r=this.U,s=r.W;return n.tt===this?n.tt=r:n.U===this?n.U=r:n.W=r,r.tt=n,r.W=this,this.tt=r,this.U=s,s&&(s.tt=this),r}};i.TreeNode=e;var t=class extends e{constructor(){super(...arguments),this.rt=1}te(){let n=super.te();return this.ie(),n.ie(),n}se(){let n=super.se();return this.ie(),n.ie(),n}ie(){this.rt=1,this.U&&(this.rt+=this.U.rt),this.W&&(this.rt+=this.W.rt)}};i.TreeNodeEnableIndex=t}),Og=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=ov(),t=Yi(),n=Xi(),r=class extends t.Container{constructor(o=function(l,h){return l<h?-1:l>h?1:0},a=!1){super(),this.Y=void 0,this.v=o,a?(this.re=e.TreeNodeEnableIndex,this.M=function(l,h,c){let u=this.ne(l,h,c);if(u){let f=u.tt;for(;f!==this.h;)f.rt+=1,f=f.tt;let d=this.he(u);if(d){let{parentNode:g,grandParent:y,curNode:w}=d;g.ie(),y.ie(),w.ie()}}return this.i},this.V=function(l){let h=this.fe(l);for(;h!==this.h;)h.rt-=1,h=h.tt}):(this.re=e.TreeNode,this.M=function(l,h,c){let u=this.ne(l,h,c);return u&&this.he(u),this.i},this.V=this.fe),this.h=new this.re}X(o,a){let l=this.h;for(;o;){let h=this.v(o.u,a);if(h<0)o=o.W;else if(h>0)l=o,o=o.U;else return o}return l}Z(o,a){let l=this.h;for(;o;)this.v(o.u,a)<=0?o=o.W:(l=o,o=o.U);return l}$(o,a){let l=this.h;for(;o;){let h=this.v(o.u,a);if(h<0)l=o,o=o.W;else if(h>0)o=o.U;else return o}return l}rr(o,a){let l=this.h;for(;o;)this.v(o.u,a)<0?(l=o,o=o.W):o=o.U;return l}ue(o){for(;;){let a=o.tt;if(a===this.h)return;if(o.ee===1){o.ee=0;return}if(o===a.U){let l=a.W;if(l.ee===1)l.ee=0,a.ee=1,a===this.Y?this.Y=a.te():a.te();else if(l.W&&l.W.ee===1){l.ee=a.ee,a.ee=0,l.W.ee=0,a===this.Y?this.Y=a.te():a.te();return}else l.U&&l.U.ee===1?(l.ee=1,l.U.ee=0,l.se()):(l.ee=1,o=a)}else{let l=a.U;if(l.ee===1)l.ee=0,a.ee=1,a===this.Y?this.Y=a.se():a.se();else if(l.U&&l.U.ee===1){l.ee=a.ee,a.ee=0,l.U.ee=0,a===this.Y?this.Y=a.se():a.se();return}else l.W&&l.W.ee===1?(l.ee=1,l.W.ee=0,l.te()):(l.ee=1,o=a)}}}fe(o){if(this.i===1)return this.clear(),this.h;let a=o;for(;a.U||a.W;){if(a.W)for(a=a.W;a.U;)a=a.U;else a=a.U;[o.u,a.u]=[a.u,o.u],[o.l,a.l]=[a.l,o.l],o=a}this.h.U===a?this.h.U=a.tt:this.h.W===a&&(this.h.W=a.tt),this.ue(a);let l=a.tt;return a===l.U?l.U=void 0:l.W=void 0,this.i-=1,this.Y.ee=0,l}oe(o,a){return o===void 0?!1:this.oe(o.U,a)||a(o)?!0:this.oe(o.W,a)}he(o){for(;;){let a=o.tt;if(a.ee===0)return;let l=a.tt;if(a===l.U){let h=l.W;if(h&&h.ee===1){if(h.ee=a.ee=0,l===this.Y)return;l.ee=1,o=l;continue}else if(o===a.W){if(o.ee=0,o.U&&(o.U.tt=a),o.W&&(o.W.tt=l),a.W=o.U,l.U=o.W,o.U=a,o.W=l,l===this.Y)this.Y=o,this.h.tt=o;else{let c=l.tt;c.U===l?c.U=o:c.W=o}return o.tt=l.tt,a.tt=o,l.tt=o,l.ee=1,{parentNode:a,grandParent:l,curNode:o}}else a.ee=0,l===this.Y?this.Y=l.se():l.se(),l.ee=1}else{let h=l.U;if(h&&h.ee===1){if(h.ee=a.ee=0,l===this.Y)return;l.ee=1,o=l;continue}else if(o===a.U){if(o.ee=0,o.U&&(o.U.tt=l),o.W&&(o.W.tt=a),l.W=o.U,a.U=o.W,o.U=l,o.W=a,l===this.Y)this.Y=o,this.h.tt=o;else{let c=l.tt;c.U===l?c.U=o:c.W=o}return o.tt=l.tt,a.tt=o,l.tt=o,l.ee=1,{parentNode:a,grandParent:l,curNode:o}}else a.ee=0,l===this.Y?this.Y=l.te():l.te(),l.ee=1}return}}ne(o,a,l){if(this.Y===void 0){this.i+=1,this.Y=new this.re(o,a),this.Y.ee=0,this.Y.tt=this.h,this.h.tt=this.Y,this.h.U=this.Y,this.h.W=this.Y;return}let h,c=this.h.U,u=this.v(c.u,o);if(u===0){c.l=a;return}else if(u>0)c.U=new this.re(o,a),c.U.tt=c,h=c.U,this.h.U=h;else{let f=this.h.W,d=this.v(f.u,o);if(d===0){f.l=a;return}else if(d<0)f.W=new this.re(o,a),f.W.tt=f,h=f.W,this.h.W=h;else{if(l!==void 0){let g=l.o;if(g!==this.h){let y=this.v(g.u,o);if(y===0){g.l=a;return}else if(y>0){let w=g.L(),E=this.v(w.u,o);if(E===0){w.l=a;return}else E<0&&(h=new this.re(o,a),w.W===void 0?(w.W=h,h.tt=w):(g.U=h,h.tt=g))}}}if(h===void 0)for(h=this.Y;;){let g=this.v(h.u,o);if(g>0){if(h.U===void 0){h.U=new this.re(o,a),h.U.tt=h,h=h.U;break}h=h.U}else if(g<0){if(h.W===void 0){h.W=new this.re(o,a),h.W.tt=h,h=h.W;break}h=h.W}else{h.l=a;return}}}}return this.i+=1,h}I(o,a){for(;o;){let l=this.v(o.u,a);if(l<0)o=o.W;else if(l>0)o=o.U;else return o}return o||this.h}clear(){this.i=0,this.Y=void 0,this.h.tt=void 0,this.h.U=this.h.W=void 0}updateKeyByIterator(o,a){let l=o.o;if(l===this.h&&(0,n.throwIteratorAccessError)(),this.i===1)return l.u=a,!0;if(l===this.h.U)return this.v(l.B().u,a)>0?(l.u=a,!0):!1;if(l===this.h.W)return this.v(l.L().u,a)<0?(l.u=a,!0):!1;let h=l.L().u;if(this.v(h,a)>=0)return!1;let c=l.B().u;return this.v(c,a)<=0?!1:(l.u=a,!0)}eraseElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=0,l=this;return this.oe(this.Y,function(h){return o===a?(l.V(h),!0):(a+=1,!1)}),this.i}eraseElementByKey(o){if(this.i===0)return!1;let a=this.I(this.Y,o);return a===this.h?!1:(this.V(a),!0)}eraseElementByIterator(o){let a=o.o;a===this.h&&(0,n.throwIteratorAccessError)();let l=a.W===void 0;return o.iteratorType===0?l&&o.next():(!l||a.U===void 0)&&o.next(),this.V(a),o}forEach(o){let a=0;for(let l of this)o(l,a++,this)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a,l=0;for(let h of this){if(l===o){a=h;break}l+=1}return a}getHeight(){if(this.i===0)return 0;let o=function(a){return a?Math.max(o(a.U),o(a.W))+1:0};return o(this.Y)}},s=r;i.default=s}),kg=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Yi(),t=Xi(),n=class extends e.ContainerIterator{constructor(s,o,a){super(a),this.o=s,this.h=o,this.iteratorType===0?(this.pre=function(){return this.o===this.h.U&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this}):(this.pre=function(){return this.o===this.h.W&&(0,t.throwIteratorAccessError)(),this.o=this.o.B(),this},this.next=function(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o=this.o.L(),this})}get index(){let s=this.o,o=this.h.tt;if(s===this.h)return o?o.rt-1:0;let a=0;for(s.U&&(a+=s.U.rt);s!==o;){let l=s.tt;s===l.W&&(a+=1,l.U&&(a+=l.U.rt)),s=l}return a}},r=n;i.default=r}),av=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=r(Og()),t=r(kg()),n=Xi();function r(l){return l&&l.t?l:{default:l}}var s=class Dg extends t.default{constructor(h,c,u,f){super(h,c,f),this.container=u}get pointer(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o.u}copy(){return new Dg(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[],h,c){super(h,c);let u=this;l.forEach(function(f){u.insert(f)})}*K(l){l!==void 0&&(yield*this.K(l.U),yield l.u,yield*this.K(l.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){return this.h.U?this.h.U.u:void 0}back(){return this.h.W?this.h.W.u:void 0}insert(l,h){return this.M(l,void 0,h)}find(l){let h=this.I(this.Y,l);return new s(h,this.h,this)}lowerBound(l){let h=this.X(this.Y,l);return new s(h,this.h,this)}upperBound(l){let h=this.Z(this.Y,l);return new s(h,this.h,this)}reverseLowerBound(l){let h=this.$(this.Y,l);return new s(h,this.h,this)}reverseUpperBound(l){let h=this.rr(this.Y,l);return new s(h,this.h,this)}union(l){let h=this;return l.forEach(function(c){h.insert(c)}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;i.default=a}),lv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=r(Og()),t=r(kg()),n=Xi();function r(l){return l&&l.t?l:{default:l}}var s=class Fg extends t.default{constructor(h,c,u,f){super(h,c,f),this.container=u}get pointer(){this.o===this.h&&(0,n.throwIteratorAccessError)();let h=this;return new Proxy([],{get(c,u){if(u==="0")return h.o.u;if(u==="1")return h.o.l},set(c,u,f){if(u!=="1")throw new TypeError("props must be 1");return h.o.l=f,!0}})}copy(){return new Fg(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.default{constructor(l=[],h,c){super(h,c);let u=this;l.forEach(function(f){u.setElement(f[0],f[1])})}*K(l){l!==void 0&&(yield*this.K(l.U),yield[l.u,l.l],yield*this.K(l.W))}begin(){return new s(this.h.U||this.h,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this.h.W||this.h,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i===0)return;let l=this.h.U;return[l.u,l.l]}back(){if(this.i===0)return;let l=this.h.W;return[l.u,l.l]}lowerBound(l){let h=this.X(this.Y,l);return new s(h,this.h,this)}upperBound(l){let h=this.Z(this.Y,l);return new s(h,this.h,this)}reverseLowerBound(l){let h=this.$(this.Y,l);return new s(h,this.h,this)}reverseUpperBound(l){let h=this.rr(this.Y,l);return new s(h,this.h,this)}setElement(l,h,c){return this.M(l,h,c)}find(l){let h=this.I(this.Y,l);return new s(h,this.h,this)}getElementByKey(l){return this.I(this.Y,l).l}union(l){let h=this;return l.forEach(function(c){h.setElement(c[0],c[1])}),this.i}[Symbol.iterator](){return this.K(this.Y)}},a=o;i.default=a}),Ng=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=e;function e(t){let n=typeof t;return n==="object"&&t!==null||n==="function"}}),Bg=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.HashContainerIterator=i.HashContainer=void 0;var e=Yi(),t=r(Ng()),n=Xi();function r(a){return a&&a.t?a:{default:a}}var s=class extends e.ContainerIterator{constructor(a,l,h){super(h),this.o=a,this.h=l,this.iteratorType===0?(this.pre=function(){return this.o.L===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.L,this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.B,this}):(this.pre=function(){return this.o.B===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.B,this},this.next=function(){return this.o===this.h&&(0,n.throwIteratorAccessError)(),this.o=this.o.L,this})}};i.HashContainerIterator=s;var o=class extends e.Container{constructor(){super(),this.H=[],this.g={},this.HASH_TAG=Symbol("@@HASH_TAG"),Object.setPrototypeOf(this.g,null),this.h={},this.h.L=this.h.B=this.p=this._=this.h}V(a){let{L:l,B:h}=a;l.B=h,h.L=l,a===this.p&&(this.p=h),a===this._&&(this._=l),this.i-=1}M(a,l,h){h===void 0&&(h=(0,t.default)(a));let c;if(h){let u=a[this.HASH_TAG];if(u!==void 0)return this.H[u].l=l,this.i;Object.defineProperty(a,this.HASH_TAG,{value:this.H.length,configurable:!0}),c={u:a,l,L:this._,B:this.h},this.H.push(c)}else{let u=this.g[a];if(u)return u.l=l,this.i;c={u:a,l,L:this._,B:this.h},this.g[a]=c}return this.i===0?(this.p=c,this.h.B=c):this._.B=c,this._=c,this.h.L=c,++this.i}I(a,l){if(l===void 0&&(l=(0,t.default)(a)),l){let h=a[this.HASH_TAG];return h===void 0?this.h:this.H[h]}else return this.g[a]||this.h}clear(){let a=this.HASH_TAG;this.H.forEach(function(l){delete l.u[a]}),this.H=[],this.g={},Object.setPrototypeOf(this.g,null),this.i=0,this.p=this._=this.h.L=this.h.B=this.h}eraseElementByKey(a,l){let h;if(l===void 0&&(l=(0,t.default)(a)),l){let c=a[this.HASH_TAG];if(c===void 0)return!1;delete a[this.HASH_TAG],h=this.H[c],delete this.H[c]}else{if(h=this.g[a],h===void 0)return!1;delete this.g[a]}return this.V(h),!0}eraseElementByIterator(a){let l=a.o;return l===this.h&&(0,n.throwIteratorAccessError)(),this.V(l),a.next()}eraseElementByPos(a){if(a<0||a>this.i-1)throw new RangeError;let l=this.p;for(;a--;)l=l.B;return this.V(l),this.i}};i.HashContainer=o}),hv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Bg(),t=Xi(),n=class Ug extends e.HashContainerIterator{constructor(a,l,h,c){super(a,l,c),this.container=h}get pointer(){return this.o===this.h&&(0,t.throwIteratorAccessError)(),this.o.u}copy(){return new Ug(this.o,this.h,this.container,this.iteratorType)}},r=class extends e.HashContainer{constructor(o=[]){super();let a=this;o.forEach(function(l){a.insert(l)})}begin(){return new n(this.p,this.h,this)}end(){return new n(this.h,this.h,this)}rBegin(){return new n(this._,this.h,this,1)}rEnd(){return new n(this.h,this.h,this,1)}front(){return this.p.u}back(){return this._.u}insert(o,a){return this.M(o,void 0,a)}getElementByPos(o){if(o<0||o>this.i-1)throw new RangeError;let a=this.p;for(;o--;)a=a.B;return a.u}find(o,a){let l=this.I(o,a);return new n(l,this.h,this)}forEach(o){let a=0,l=this.p;for(;l!==this.h;)o(l.u,a++,this),l=l.B}[Symbol.iterator](){return(function*(){let o=this.p;for(;o!==this.h;)yield o.u,o=o.B}).bind(this)()}},s=r;i.default=s}),cv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),i.default=void 0;var e=Bg(),t=r(Ng()),n=Xi();function r(l){return l&&l.t?l:{default:l}}var s=class jg extends e.HashContainerIterator{constructor(h,c,u,f){super(h,c,f),this.container=u}get pointer(){this.o===this.h&&(0,n.throwIteratorAccessError)();let h=this;return new Proxy([],{get(c,u){if(u==="0")return h.o.u;if(u==="1")return h.o.l},set(c,u,f){if(u!=="1")throw new TypeError("props must be 1");return h.o.l=f,!0}})}copy(){return new jg(this.o,this.h,this.container,this.iteratorType)}},o=class extends e.HashContainer{constructor(l=[]){super();let h=this;l.forEach(function(c){h.setElement(c[0],c[1])})}begin(){return new s(this.p,this.h,this)}end(){return new s(this.h,this.h,this)}rBegin(){return new s(this._,this.h,this,1)}rEnd(){return new s(this.h,this.h,this,1)}front(){if(this.i!==0)return[this.p.u,this.p.l]}back(){if(this.i!==0)return[this._.u,this._.l]}setElement(l,h,c){return this.M(l,h,c)}getElementByKey(l,h){if(h===void 0&&(h=(0,t.default)(l)),h){let u=l[this.HASH_TAG];return u!==void 0?this.H[u].l:void 0}let c=this.g[l];return c?c.l:void 0}getElementByPos(l){if(l<0||l>this.i-1)throw new RangeError;let h=this.p;for(;l--;)h=h.B;return[h.u,h.l]}find(l,h){let c=this.I(l,h);return new s(c,this.h,this)}forEach(l){let h=0,c=this.p;for(;c!==this.h;)l([c.u,c.l],h++,this),c=c.B}[Symbol.iterator](){return(function*(){let l=this.p;for(;l!==this.h;)yield[l.u,l.l],l=l.B}).bind(this)()}},a=o;i.default=a}),uv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"t",{value:!0}),Object.defineProperty(i,"Deque",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(i,"HashMap",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(i,"HashSet",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(i,"LinkList",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(i,"OrderedMap",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(i,"OrderedSet",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(i,"PriorityQueue",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(i,"Queue",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(i,"Stack",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(i,"Vector",{enumerable:!0,get:function(){return r.default}});var e=u(ev()),t=u(tv()),n=u(iv()),r=u(nv()),s=u(rv()),o=u(sv()),a=u(av()),l=u(lv()),h=u(hv()),c=u(cv());function u(f){return f&&f.t?f:{default:f}}}),fv=Ee((i,e)=>{ge(),_e(),pe();var t=uv().OrderedSet,n=ji()("number-allocator:trace"),r=ji()("number-allocator:error");function s(a,l){this.low=a,this.high=l}s.prototype.equals=function(a){return this.low===a.low&&this.high===a.high},s.prototype.compare=function(a){return this.low<a.low&&this.high<a.low?-1:a.low<this.low&&a.high<this.low?1:0};function o(a,l){if(!(this instanceof o))return new o(a,l);this.min=a,this.max=l,this.ss=new t([],(h,c)=>h.compare(c)),n("Create"),this.clear()}o.prototype.firstVacant=function(){return this.ss.size()===0?null:this.ss.front().low},o.prototype.alloc=function(){if(this.ss.size()===0)return n("alloc():empty"),null;let a=this.ss.begin(),l=a.pointer.low,h=a.pointer.high,c=l;return c+1<=h?this.ss.updateKeyByIterator(a,new s(l+1,h)):this.ss.eraseElementByPos(0),n("alloc():"+c),c},o.prototype.use=function(a){let l=new s(a,a),h=this.ss.lowerBound(l);if(!h.equals(this.ss.end())){let c=h.pointer.low,u=h.pointer.high;return h.pointer.equals(l)?(this.ss.eraseElementByIterator(h),n("use():"+a),!0):c>a?!1:c===a?(this.ss.updateKeyByIterator(h,new s(c+1,u)),n("use():"+a),!0):u===a?(this.ss.updateKeyByIterator(h,new s(c,u-1)),n("use():"+a),!0):(this.ss.updateKeyByIterator(h,new s(a+1,u)),this.ss.insert(new s(c,a-1)),n("use():"+a),!0)}return n("use():failed"),!1},o.prototype.free=function(a){if(a<this.min||a>this.max){r("free():"+a+" is out of range");return}let l=new s(a,a),h=this.ss.upperBound(l);if(h.equals(this.ss.end())){if(h.equals(this.ss.begin())){this.ss.insert(l);return}h.pre();let c=h.pointer.high;h.pointer.high+1===a?this.ss.updateKeyByIterator(h,new s(c,a)):this.ss.insert(l)}else if(h.equals(this.ss.begin()))if(a+1===h.pointer.low){let c=h.pointer.high;this.ss.updateKeyByIterator(h,new s(a,c))}else this.ss.insert(l);else{let c=h.pointer.low,u=h.pointer.high;h.pre();let f=h.pointer.low;h.pointer.high+1===a?a+1===c?(this.ss.eraseElementByIterator(h),this.ss.updateKeyByIterator(h,new s(f,u))):this.ss.updateKeyByIterator(h,new s(f,a)):a+1===c?(this.ss.eraseElementByIterator(h.next()),this.ss.insert(new s(a,u))):this.ss.insert(l)}n("free():"+a)},o.prototype.clear=function(){n("clear()"),this.ss.clear(),this.ss.insert(new s(this.min,this.max))},o.prototype.intervalCount=function(){return this.ss.size()},o.prototype.dump=function(){console.log("length:"+this.ss.size());for(let a of this.ss)console.log(a)},e.exports=o}),Wg=Ee((i,e)=>{ge(),_e(),pe();var t=fv();e.exports.NumberAllocator=t}),dv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=Qb(),t=Wg(),n=class{constructor(r){r>0&&(this.aliasToTopic=new e.LRUCache({max:r}),this.topicToAlias={},this.numberAllocator=new t.NumberAllocator(1,r),this.max=r,this.length=0)}put(r,s){if(s===0||s>this.max)return!1;let o=this.aliasToTopic.get(s);return o&&delete this.topicToAlias[o],this.aliasToTopic.set(s,r),this.topicToAlias[r]=s,this.numberAllocator.use(s),this.length=this.aliasToTopic.size,!0}getTopicByAlias(r){return this.aliasToTopic.get(r)}getAliasByTopic(r){let s=this.topicToAlias[r];return typeof s<"u"&&this.aliasToTopic.get(s),s}clear(){this.aliasToTopic.clear(),this.topicToAlias={},this.numberAllocator.clear(),this.length=0}getLruAlias(){return this.numberAllocator.firstVacant()||[...this.aliasToTopic.keys()][this.aliasToTopic.size-1]}};i.default=n}),gv=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(i,"__esModule",{value:!0});var t=Oo(),n=e(dv()),r=xr(),s=(o,a)=>{o.log("_handleConnack");let{options:l}=o,h=l.protocolVersion===5?a.reasonCode:a.returnCode;if(clearTimeout(o.connackTimer),delete o.topicAliasSend,a.properties){if(a.properties.topicAliasMaximum){if(a.properties.topicAliasMaximum>65535){o.emit("error",new Error("topicAliasMaximum from broker is out of range"));return}a.properties.topicAliasMaximum>0&&(o.topicAliasSend=new n.default(a.properties.topicAliasMaximum))}a.properties.serverKeepAlive&&l.keepalive&&(l.keepalive=a.properties.serverKeepAlive),a.properties.maximumPacketSize&&(l.properties||(l.properties={}),l.properties.maximumPacketSize=a.properties.maximumPacketSize)}if(h===0)o.reconnecting=!1,o._onConnect(a);else if(h>0){let c=new r.ErrorWithReasonCode(`Connection refused: ${t.ReasonCodes[h]}`,h);o.emit("error",c),o.options.reconnectOnConnackError&&o._cleanUp(!0)}};i.default=s}),pv=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=(t,n,r)=>{t.log("handling pubrel packet");let s=typeof r<"u"?r:t.noop,{messageId:o}=n,a={cmd:"pubcomp",messageId:o};t.incomingStore.get(n,(l,h)=>{l?t._sendPacket(a,s):(t.emit("message",h.topic,h.payload,h),t.handleMessage(h,c=>{if(c)return s(c);t.incomingStore.del(h,t.noop),t._sendPacket(a,s)}))})};i.default=e}),_v=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(i,"__esModule",{value:!0});var t=e(qb()),n=e(Jb()),r=e(gv()),s=e(Oo()),o=e(pv()),a=(l,h,c)=>{let{options:u}=l;if(u.protocolVersion===5&&u.properties&&u.properties.maximumPacketSize&&u.properties.maximumPacketSize<h.length)return l.emit("error",new Error(`exceeding packets size ${h.cmd}`)),l.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),l;switch(l.log("_handlePacket :: emitting packetreceive"),l.emit("packetreceive",h),h.cmd){case"publish":(0,t.default)(l,h,c);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":l.reschedulePing(),(0,s.default)(l,h),c();break;case"pubrel":l.reschedulePing(),(0,o.default)(l,h,c);break;case"connack":(0,r.default)(l,h),c();break;case"auth":l.reschedulePing(),(0,n.default)(l,h),c();break;case"pingresp":l.log("_handlePacket :: received pingresp"),l.reschedulePing(!0),c();break;case"disconnect":l.emit("disconnect",h),c();break;default:l.log("_handlePacket :: unknown command"),c();break}};i.default=a}),mv=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(i,"__esModule",{value:!0}),i.TypedEventEmitter=void 0;var t=e((Sr(),Qe(Bn))),n=xr(),r=class{};i.TypedEventEmitter=r,(0,n.applyMixin)(r,t.default)}),ko=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.isReactNativeBrowser=i.isWebWorker=void 0;var e=()=>{var s;return typeof window<"u"?typeof navigator<"u"&&((s=navigator.userAgent)===null||s===void 0?void 0:s.toLowerCase().indexOf(" electron/"))>-1&&Ve!=null&&Ve.versions?!Object.prototype.hasOwnProperty.call(Ve.versions,"electron"):typeof window.document<"u":!1},t=()=>{var s,o;return!!(typeof self=="object"&&!((o=(s=self==null?void 0:self.constructor)===null||s===void 0?void 0:s.name)===null||o===void 0)&&o.includes("WorkerGlobalScope"))},n=()=>typeof navigator<"u"&&navigator.product==="ReactNative",r=e()||t()||n();i.isWebWorker=t(),i.isReactNativeBrowser=n(),i.default=r}),yv=Ee((i,e)=>{ge(),_e(),pe(),function(t,n){typeof i=="object"&&typeof e<"u"?n(i):typeof define=="function"&&define.amd?define(["exports"],n):(t=typeof globalThis<"u"?globalThis:t||self,n(t.fastUniqueNumbers={}))}(i,function(t){var n=function(d){return function(g){var y=d(g);return g.add(y),y}},r=function(d){return function(g,y){return d.set(g,y),y}},s=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,o=536870912,a=o*2,l=function(d,g){return function(y){var w=g.get(y),E=w===void 0?y.size:w<a?w+1:0;if(!y.has(E))return d(y,E);if(y.size<o){for(;y.has(E);)E=Math.floor(Math.random()*a);return d(y,E)}if(y.size>s)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;y.has(E);)E=Math.floor(Math.random()*s);return d(y,E)}},h=new WeakMap,c=r(h),u=l(c,h),f=n(u);t.addUniqueNumber=f,t.generateUniqueNumber=u})}),wv=Ee((i,e)=>{ge(),_e(),pe(),function(t,n){typeof i=="object"&&typeof e<"u"?n(i,yv()):typeof define=="function"&&define.amd?define(["exports","fast-unique-numbers"],n):(t=typeof globalThis<"u"?globalThis:t||self,n(t.workerTimersBroker={},t.fastUniqueNumbers))}(i,function(t,n){var r=function(a){return a.method!==void 0&&a.method==="call"},s=function(a){return a.error===null&&typeof a.id=="number"},o=function(a){var l=new Map([[0,function(){}]]),h=new Map([[0,function(){}]]),c=new Map,u=new Worker(a);u.addEventListener("message",function(w){var E=w.data;if(r(E)){var b=E.params,v=b.timerId,S=b.timerType;if(S==="interval"){var x=l.get(v);if(typeof x=="number"){var T=c.get(x);if(T===void 0||T.timerId!==v||T.timerType!==S)throw new Error("The timer is in an undefined state.")}else if(typeof x<"u")x();else throw new Error("The timer is in an undefined state.")}else if(S==="timeout"){var I=h.get(v);if(typeof I=="number"){var A=c.get(I);if(A===void 0||A.timerId!==v||A.timerType!==S)throw new Error("The timer is in an undefined state.")}else if(typeof I<"u")I(),h.delete(v);else throw new Error("The timer is in an undefined state.")}}else if(s(E)){var O=E.id,j=c.get(O);if(j===void 0)throw new Error("The timer is in an undefined state.");var K=j.timerId,R=j.timerType;c.delete(O),R==="interval"?l.delete(K):h.delete(K)}else{var U=E.error.message;throw new Error(U)}});var f=function(w){var E=n.generateUniqueNumber(c);c.set(E,{timerId:w,timerType:"interval"}),l.set(w,E),u.postMessage({id:E,method:"clear",params:{timerId:w,timerType:"interval"}})},d=function(w){var E=n.generateUniqueNumber(c);c.set(E,{timerId:w,timerType:"timeout"}),h.set(w,E),u.postMessage({id:E,method:"clear",params:{timerId:w,timerType:"timeout"}})},g=function(w){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,b=n.generateUniqueNumber(l);return l.set(b,function(){w(),typeof l.get(b)=="function"&&u.postMessage({id:null,method:"set",params:{delay:E,now:performance.now(),timerId:b,timerType:"interval"}})}),u.postMessage({id:null,method:"set",params:{delay:E,now:performance.now(),timerId:b,timerType:"interval"}}),b},y=function(w){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,b=n.generateUniqueNumber(h);return h.set(b,w),u.postMessage({id:null,method:"set",params:{delay:E,now:performance.now(),timerId:b,timerType:"timeout"}}),b};return{clearInterval:f,clearTimeout:d,setInterval:g,setTimeout:y}};t.load=o})}),bv=Ee((i,e)=>{ge(),_e(),pe(),function(t,n){typeof i=="object"&&typeof e<"u"?n(i,wv()):typeof define=="function"&&define.amd?define(["exports","worker-timers-broker"],n):(t=typeof globalThis<"u"?globalThis:t||self,n(t.workerTimers={},t.workerTimersBroker))}(i,function(t,n){var r=function(u,f){var d=null;return function(){if(d!==null)return d;var g=new Blob([f],{type:"application/javascript; charset=utf-8"}),y=URL.createObjectURL(g);return d=u(y),setTimeout(function(){return URL.revokeObjectURL(y)}),d}},s=`(()=>{var e={472:(e,t,r)=>{var o,i;void 0===(i="function"==typeof(o=function(){"use strict";var e=new Map,t=new Map,r=function(t){var r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)},o=function(e){var r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)},i=function(e,t){var r,o=performance.now();return{expected:o+(r=e-Math.max(0,o-t)),remainingDelay:r}},n=function e(t,r,o,i){var n=performance.now();n>o?postMessage({id:null,method:"call",params:{timerId:r,timerType:i}}):t.set(r,setTimeout(e,o-n,t,r,o,i))},a=function(t,r,o){var a=i(t,o),s=a.expected,d=a.remainingDelay;e.set(r,setTimeout(n,d,e,r,s,"interval"))},s=function(e,r,o){var a=i(e,o),s=a.expected,d=a.remainingDelay;t.set(r,setTimeout(n,d,t,r,s,"timeout"))};addEventListener("message",(function(e){var t=e.data;try{if("clear"===t.method){var i=t.id,n=t.params,d=n.timerId,c=n.timerType;if("interval"===c)r(d),postMessage({error:null,id:i});else{if("timeout"!==c)throw new Error('The given type "'.concat(c,'" is not supported'));o(d),postMessage({error:null,id:i})}}else{if("set"!==t.method)throw new Error('The given method "'.concat(t.method,'" is not supported'));var u=t.params,l=u.delay,p=u.now,m=u.timerId,v=u.timerType;if("interval"===v)a(l,m,p);else{if("timeout"!==v)throw new Error('The given type "'.concat(v,'" is not supported'));s(l,m,p)}}}catch(e){postMessage({error:{message:e.message},id:t.id,result:null})}}))})?o.call(t,r,t,e):o)||(e.exports=i)}},t={};function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";r(472)})()})();`,o=r(n.load,s),a=function(u){return o().clearInterval(u)},l=function(u){return o().clearTimeout(u)},h=function(){var u;return(u=o()).setInterval.apply(u,arguments)},c=function(){var u;return(u=o()).setTimeout.apply(u,arguments)};t.clearInterval=a,t.clearTimeout=l,t.setInterval=h,t.setTimeout=c})}),vv=Ee(i=>{ge(),_e(),pe();var e=i&&i.__createBinding||(Object.create?function(h,c,u,f){f===void 0&&(f=u);var d=Object.getOwnPropertyDescriptor(c,u);(!d||("get"in d?!c.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return c[u]}}),Object.defineProperty(h,f,d)}:function(h,c,u,f){f===void 0&&(f=u),h[f]=c[u]}),t=i&&i.__setModuleDefault||(Object.create?function(h,c){Object.defineProperty(h,"default",{enumerable:!0,value:c})}:function(h,c){h.default=c}),n=i&&i.__importStar||function(h){if(h&&h.__esModule)return h;var c={};if(h!=null)for(var u in h)u!=="default"&&Object.prototype.hasOwnProperty.call(h,u)&&e(c,h,u);return t(c,h),c};Object.defineProperty(i,"__esModule",{value:!0});var r=n(ko()),s=bv(),o={set:s.setInterval,clear:s.clearInterval},a={set:(h,c)=>setInterval(h,c),clear:h=>clearInterval(h)},l=h=>{switch(h){case"native":return a;case"worker":return o;case"auto":default:return r.default&&!r.isWebWorker&&!r.isReactNativeBrowser?o:a}};i.default=l}),Gg=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(i,"__esModule",{value:!0});var t=e(vv()),n=class{get keepaliveTimeoutTimestamp(){return this._keepaliveTimeoutTimestamp}get intervalEvery(){return this._intervalEvery}get keepalive(){return this._keepalive}constructor(r,s){this.destroyed=!1,this.client=r,this.timer=typeof s=="object"&&"set"in s&&"clear"in s?s:(0,t.default)(s),this.setKeepalive(r.options.keepalive)}clear(){this.timerId&&(this.timer.clear(this.timerId),this.timerId=null)}setKeepalive(r){if(r*=1e3,isNaN(r)||r<=0||r>2147483647)throw new Error(`Keepalive value must be an integer between 0 and 2147483647. Provided value is ${r}`);this._keepalive=r,this.reschedule(),this.client.log(`KeepaliveManager: set keepalive to ${r}ms`)}destroy(){this.clear(),this.destroyed=!0}reschedule(){if(this.destroyed)return;this.clear(),this.counter=0;let r=Math.ceil(this._keepalive*1.5);this._keepaliveTimeoutTimestamp=Date.now()+r,this._intervalEvery=Math.ceil(this._keepalive/2),this.timerId=this.timer.set(()=>{this.destroyed||(this.counter+=1,this.counter===2?this.client.sendPing():this.counter>2&&this.client.onKeepaliveTimeout())},this._intervalEvery)}};i.default=n}),Vl=Ee(i=>{ge(),_e(),pe();var e=i&&i.__createBinding||(Object.create?function(x,T,I,A){A===void 0&&(A=I);var O=Object.getOwnPropertyDescriptor(T,I);(!O||("get"in O?!T.__esModule:O.writable||O.configurable))&&(O={enumerable:!0,get:function(){return T[I]}}),Object.defineProperty(x,A,O)}:function(x,T,I,A){A===void 0&&(A=I),x[A]=T[I]}),t=i&&i.__setModuleDefault||(Object.create?function(x,T){Object.defineProperty(x,"default",{enumerable:!0,value:T})}:function(x,T){x.default=T}),n=i&&i.__importStar||function(x){if(x&&x.__esModule)return x;var T={};if(x!=null)for(var I in x)I!=="default"&&Object.prototype.hasOwnProperty.call(x,I)&&e(T,x,I);return t(T,x),T},r=i&&i.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(i,"__esModule",{value:!0});var s=r(cb()),o=r($b()),a=r(Tg()),l=Un(),h=r(Kb()),c=n(Hb()),u=r(ji()),f=r(Rg()),d=r(_v()),g=xr(),y=mv(),w=r(Gg()),E=n(ko()),b=globalThis.setImmediate||((...x)=>{let T=x.shift();(0,g.nextTick)(()=>{T(...x)})}),v={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:30*1e3,clean:!0,resubscribe:!0,writeCache:!0,timerVariant:"auto"},S=class Kl extends y.TypedEventEmitter{static defaultId(){return`mqttjs_${Math.random().toString(16).substr(2,8)}`}constructor(T,I){super(),this.options=I||{};for(let A in v)typeof this.options[A]>"u"?this.options[A]=v[A]:this.options[A]=I[A];this.log=this.options.log||(0,u.default)("mqttjs:client"),this.noop=this._noop.bind(this),this.log("MqttClient :: version:",Kl.VERSION),E.isWebWorker?this.log("MqttClient :: environment","webworker"):this.log("MqttClient :: environment",E.default?"browser":"node"),this.log("MqttClient :: options.protocol",I.protocol),this.log("MqttClient :: options.protocolVersion",I.protocolVersion),this.log("MqttClient :: options.username",I.username),this.log("MqttClient :: options.keepalive",I.keepalive),this.log("MqttClient :: options.reconnectPeriod",I.reconnectPeriod),this.log("MqttClient :: options.rejectUnauthorized",I.rejectUnauthorized),this.log("MqttClient :: options.properties.topicAliasMaximum",I.properties?I.properties.topicAliasMaximum:void 0),this.options.clientId=typeof I.clientId=="string"?I.clientId:Kl.defaultId(),this.log("MqttClient :: clientId",this.options.clientId),this.options.customHandleAcks=I.protocolVersion===5&&I.customHandleAcks?I.customHandleAcks:(...A)=>{A[3](null,0)},this.options.writeCache||(o.default.writeToStream.cacheNumbers=!1),this.streamBuilder=T,this.messageIdProvider=typeof this.options.messageIdProvider>"u"?new a.default:this.options.messageIdProvider,this.outgoingStore=I.outgoingStore||new f.default,this.incomingStore=I.incomingStore||new f.default,this.queueQoSZero=I.queueQoSZero===void 0?!0:I.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.keepaliveManager=null,this.connected=!1,this.disconnecting=!1,this.reconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this._storeProcessingQueue=[],this.outgoing={},this._firstConnection=!0,I.properties&&I.properties.topicAliasMaximum>0&&(I.properties.topicAliasMaximum>65535?this.log("MqttClient :: options.properties.topicAliasMaximum is out of range"):this.topicAliasRecv=new s.default(I.properties.topicAliasMaximum)),this.on("connect",()=>{let{queue:A}=this,O=()=>{let j=A.shift();this.log("deliver :: entry %o",j);let K=null;if(!j){this._resubscribe();return}K=j.packet,this.log("deliver :: call _sendPacket for %o",K);let R=!0;K.messageId&&K.messageId!==0&&(this.messageIdProvider.register(K.messageId)||(R=!1)),R?this._sendPacket(K,U=>{j.cb&&j.cb(U),O()}):(this.log("messageId: %d has already used. The message is skipped and removed.",K.messageId),O())};this.log("connect :: sending queued packets"),O()}),this.on("close",()=>{this.log("close :: connected set to `false`"),this.connected=!1,this.log("close :: clearing connackTimer"),clearTimeout(this.connackTimer),this._destroyKeepaliveManager(),this.topicAliasRecv&&this.topicAliasRecv.clear(),this.log("close :: calling _setupReconnect"),this._setupReconnect()}),this.options.manualConnect||(this.log("MqttClient :: setting up stream"),this.connect())}handleAuth(T,I){I()}handleMessage(T,I){I()}_nextId(){return this.messageIdProvider.allocate()}getLastMessageId(){return this.messageIdProvider.getLastAllocated()}connect(){var T;let I=new l.Writable,A=o.default.parser(this.options),O=null,j=[];this.log("connect :: calling method to clear reconnect"),this._clearReconnect(),this.disconnected&&!this.reconnecting&&(this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1),this.log("connect :: using streamBuilder provided to client to create stream"),this.stream=this.streamBuilder(this),A.on("packet",G=>{this.log("parser :: on packet push to packets array."),j.push(G)});let K=()=>{this.log("work :: getting next packet in queue");let G=j.shift();if(G)this.log("work :: packet pulled from queue"),(0,d.default)(this,G,R);else{this.log("work :: no packets in queue");let J=O;O=null,this.log("work :: done flag is %s",!!J),J&&J()}},R=()=>{if(j.length)(0,g.nextTick)(K);else{let G=O;O=null,G()}};I._write=(G,J,H)=>{O=H,this.log("writable stream :: parsing buffer"),A.parse(G),K()};let U=G=>{this.log("streamErrorHandler :: error",G.message),G.code?(this.log("streamErrorHandler :: emitting error"),this.emit("error",G)):this.noop(G)};this.log("connect :: pipe stream to writable stream"),this.stream.pipe(I),this.stream.on("error",U),this.stream.on("close",()=>{this.log("(%s)stream :: on close",this.options.clientId),this._flushVolatile(),this.log("stream: emit close to MqttClient"),this.emit("close")}),this.log("connect: sending packet `connect`");let V={cmd:"connect",protocolId:this.options.protocolId,protocolVersion:this.options.protocolVersion,clean:this.options.clean,clientId:this.options.clientId,keepalive:this.options.keepalive,username:this.options.username,password:this.options.password,properties:this.options.properties};if(this.options.will&&(V.will=Object.assign(Object.assign({},this.options.will),{payload:(T=this.options.will)===null||T===void 0?void 0:T.payload})),this.topicAliasRecv&&(V.properties||(V.properties={}),this.topicAliasRecv&&(V.properties.topicAliasMaximum=this.topicAliasRecv.max)),this._writePacket(V),A.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.end(()=>this.emit("error",new Error("Packet has no Authentication Method"))),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&typeof this.options.authPacket=="object"){let G=Object.assign({cmd:"auth",reasonCode:0},this.options.authPacket);this._writePacket(G)}}return this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(()=>{this.log("!!connectTimeout hit!! Calling _cleanUp with force `true`"),this.emit("error",new Error("connack timeout")),this._cleanUp(!0)},this.options.connectTimeout),this}publish(T,I,A,O){this.log("publish :: message `%s` to topic `%s`",I,T);let{options:j}=this;typeof A=="function"&&(O=A,A=null),A=A||{},A=Object.assign(Object.assign({},{qos:0,retain:!1,dup:!1}),A);let{qos:K,retain:R,dup:U,properties:V,cbStorePut:G}=A;if(this._checkDisconnecting(O))return this;let J=()=>{let H=0;if((K===1||K===2)&&(H=this._nextId(),H===null))return this.log("No messageId left"),!1;let W={cmd:"publish",topic:T,payload:I,qos:K,retain:R,messageId:H,dup:U};switch(j.protocolVersion===5&&(W.properties=V),this.log("publish :: qos",K),K){case 1:case 2:this.outgoing[W.messageId]={volatile:!1,cb:O||this.noop},this.log("MqttClient:publish: packet cmd: %s",W.cmd),this._sendPacket(W,void 0,G);break;default:this.log("MqttClient:publish: packet cmd: %s",W.cmd),this._sendPacket(W,O,G);break}return!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!J())&&this._storeProcessingQueue.push({invoke:J,cbStorePut:A.cbStorePut,callback:O}),this}publishAsync(T,I,A){return new Promise((O,j)=>{this.publish(T,I,A,(K,R)=>{K?j(K):O(R)})})}subscribe(T,I,A){let O=this.options.protocolVersion;typeof I=="function"&&(A=I),A=A||this.noop;let j=!1,K=[];typeof T=="string"?(T=[T],K=T):Array.isArray(T)?K=T:typeof T=="object"&&(j=T.resubscribe,delete T.resubscribe,K=Object.keys(T));let R=c.validateTopics(K);if(R!==null)return b(A,new Error(`Invalid topic ${R}`)),this;if(this._checkDisconnecting(A))return this.log("subscribe: discconecting true"),this;let U={qos:0};O===5&&(U.nl=!1,U.rap=!1,U.rh=0),I=Object.assign(Object.assign({},U),I);let V=I.properties,G=[],J=(W,se)=>{if(se=se||I,!Object.prototype.hasOwnProperty.call(this._resubscribeTopics,W)||this._resubscribeTopics[W].qos<se.qos||j){let Z={topic:W,qos:se.qos};O===5&&(Z.nl=se.nl,Z.rap=se.rap,Z.rh=se.rh,Z.properties=V),this.log("subscribe: pushing topic `%s` and qos `%s` to subs list",Z.topic,Z.qos),G.push(Z)}};if(Array.isArray(T)?T.forEach(W=>{this.log("subscribe: array topic %s",W),J(W)}):Object.keys(T).forEach(W=>{this.log("subscribe: object topic %s, %o",W,T[W]),J(W,T[W])}),!G.length)return A(null,[]),this;let H=()=>{let W=this._nextId();if(W===null)return this.log("No messageId left"),!1;let se={cmd:"subscribe",subscriptions:G,messageId:W};if(V&&(se.properties=V),this.options.resubscribe){this.log("subscribe :: resubscribe true");let Z=[];G.forEach(ie=>{if(this.options.reconnectPeriod>0){let M={qos:ie.qos};O===5&&(M.nl=ie.nl||!1,M.rap=ie.rap||!1,M.rh=ie.rh||0,M.properties=ie.properties),this._resubscribeTopics[ie.topic]=M,Z.push(ie.topic)}}),this.messageIdToTopic[se.messageId]=Z}return this.outgoing[se.messageId]={volatile:!0,cb(Z,ie){if(!Z){let{granted:M}=ie;for(let q=0;q<M.length;q+=1)G[q].qos=M[q]}A(Z,G,ie)}},this.log("subscribe :: call _sendPacket"),this._sendPacket(se),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!H())&&this._storeProcessingQueue.push({invoke:H,callback:A}),this}subscribeAsync(T,I){return new Promise((A,O)=>{this.subscribe(T,I,(j,K)=>{j?O(j):A(K)})})}unsubscribe(T,I,A){typeof T=="string"&&(T=[T]),typeof I=="function"&&(A=I),A=A||this.noop;let O=c.validateTopics(T);if(O!==null)return b(A,new Error(`Invalid topic ${O}`)),this;if(this._checkDisconnecting(A))return this;let j=()=>{let K=this._nextId();if(K===null)return this.log("No messageId left"),!1;let R={cmd:"unsubscribe",messageId:K,unsubscriptions:[]};return typeof T=="string"?R.unsubscriptions=[T]:Array.isArray(T)&&(R.unsubscriptions=T),this.options.resubscribe&&R.unsubscriptions.forEach(U=>{delete this._resubscribeTopics[U]}),typeof I=="object"&&I.properties&&(R.properties=I.properties),this.outgoing[R.messageId]={volatile:!0,cb:A},this.log("unsubscribe: call _sendPacket"),this._sendPacket(R),!0};return(this._storeProcessing||this._storeProcessingQueue.length>0||!j())&&this._storeProcessingQueue.push({invoke:j,callback:A}),this}unsubscribeAsync(T,I){return new Promise((A,O)=>{this.unsubscribe(T,I,(j,K)=>{j?O(j):A(K)})})}end(T,I,A){this.log("end :: (%s)",this.options.clientId),(T==null||typeof T!="boolean")&&(A=A||I,I=T,T=!1),typeof I!="object"&&(A=A||I,I=null),this.log("end :: cb? %s",!!A),(!A||typeof A!="function")&&(A=this.noop);let O=()=>{this.log("end :: closeStores: closing incoming and outgoing stores"),this.disconnected=!0,this.incomingStore.close(K=>{this.outgoingStore.close(R=>{if(this.log("end :: closeStores: emitting end"),this.emit("end"),A){let U=K||R;this.log("end :: closeStores: invoking callback with args"),A(U)}})}),this._deferredReconnect?this._deferredReconnect():(this.options.reconnectPeriod===0||this.options.manualConnect)&&(this.disconnecting=!1)},j=()=>{this.log("end :: (%s) :: finish :: calling _cleanUp with force %s",this.options.clientId,T),this._cleanUp(T,()=>{this.log("end :: finish :: calling process.nextTick on closeStores"),(0,g.nextTick)(O)},I)};return this.disconnecting?(A(),this):(this._clearReconnect(),this.disconnecting=!0,!T&&Object.keys(this.outgoing).length>0?(this.log("end :: (%s) :: calling finish in 10ms once outgoing is empty",this.options.clientId),this.once("outgoingEmpty",setTimeout.bind(null,j,10))):(this.log("end :: (%s) :: immediately calling finish",this.options.clientId),j()),this)}endAsync(T,I){return new Promise((A,O)=>{this.end(T,I,j=>{j?O(j):A()})})}removeOutgoingMessage(T){if(this.outgoing[T]){let{cb:I}=this.outgoing[T];this._removeOutgoingAndStoreMessage(T,()=>{I(new Error("Message removed"))})}return this}reconnect(T){this.log("client reconnect");let I=()=>{T?(this.options.incomingStore=T.incomingStore,this.options.outgoingStore=T.outgoingStore):(this.options.incomingStore=null,this.options.outgoingStore=null),this.incomingStore=this.options.incomingStore||new f.default,this.outgoingStore=this.options.outgoingStore||new f.default,this.disconnecting=!1,this.disconnected=!1,this._deferredReconnect=null,this._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=I:I(),this}_flushVolatile(){this.outgoing&&(this.log("_flushVolatile :: deleting volatile messages from the queue and setting their callbacks as error function"),Object.keys(this.outgoing).forEach(T=>{this.outgoing[T].volatile&&typeof this.outgoing[T].cb=="function"&&(this.outgoing[T].cb(new Error("Connection closed")),delete this.outgoing[T])}))}_flush(){this.outgoing&&(this.log("_flush: queue exists? %b",!!this.outgoing),Object.keys(this.outgoing).forEach(T=>{typeof this.outgoing[T].cb=="function"&&(this.outgoing[T].cb(new Error("Connection closed")),delete this.outgoing[T])}))}_removeTopicAliasAndRecoverTopicName(T){let I;T.properties&&(I=T.properties.topicAlias);let A=T.topic.toString();if(this.log("_removeTopicAliasAndRecoverTopicName :: alias %d, topic %o",I,A),A.length===0){if(typeof I>"u")return new Error("Unregistered Topic Alias");if(A=this.topicAliasSend.getTopicByAlias(I),typeof A>"u")return new Error("Unregistered Topic Alias");T.topic=A}I&&delete T.properties.topicAlias}_checkDisconnecting(T){return this.disconnecting&&(T&&T!==this.noop?T(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting}_reconnect(){this.log("_reconnect: emitting reconnect to client"),this.emit("reconnect"),this.connected?(this.end(()=>{this.connect()}),this.log("client already connected. disconnecting first.")):(this.log("_reconnect: calling connect"),this.connect())}_setupReconnect(){!this.disconnecting&&!this.reconnectTimer&&this.options.reconnectPeriod>0?(this.reconnecting||(this.log("_setupReconnect :: emit `offline` state"),this.emit("offline"),this.log("_setupReconnect :: set `reconnecting` to `true`"),this.reconnecting=!0),this.log("_setupReconnect :: setting reconnectTimer for %d ms",this.options.reconnectPeriod),this.reconnectTimer=setInterval(()=>{this.log("reconnectTimer :: reconnect triggered!"),this._reconnect()},this.options.reconnectPeriod)):this.log("_setupReconnect :: doing nothing...")}_clearReconnect(){this.log("_clearReconnect : clearing reconnect timer"),this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)}_cleanUp(T,I,A={}){if(I&&(this.log("_cleanUp :: done callback provided for on stream close"),this.stream.on("close",I)),this.log("_cleanUp :: forced? %s",T),T)this.options.reconnectPeriod===0&&this.options.clean&&this._flush(),this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),this.stream.destroy();else{let O=Object.assign({cmd:"disconnect"},A);this.log("_cleanUp :: (%s) :: call _sendPacket with disconnect packet",this.options.clientId),this._sendPacket(O,()=>{this.log("_cleanUp :: (%s) :: destroying stream",this.options.clientId),b(()=>{this.stream.end(()=>{this.log("_cleanUp :: (%s) :: stream destroyed",this.options.clientId)})})})}!this.disconnecting&&!this.reconnecting&&(this.log("_cleanUp :: client not disconnecting/reconnecting. Clearing and resetting reconnect."),this._clearReconnect(),this._setupReconnect()),this._destroyKeepaliveManager(),I&&!this.connected&&(this.log("_cleanUp :: (%s) :: removing stream `done` callback `close` listener",this.options.clientId),this.stream.removeListener("close",I),I())}_storeAndSend(T,I,A){this.log("storeAndSend :: store packet with cmd %s to outgoingStore",T.cmd);let O=T,j;if(O.cmd==="publish"&&(O=(0,h.default)(T),j=this._removeTopicAliasAndRecoverTopicName(O),j))return I&&I(j);this.outgoingStore.put(O,K=>{if(K)return I&&I(K);A(),this._writePacket(T,I)})}_applyTopicAlias(T){if(this.options.protocolVersion===5&&T.cmd==="publish"){let I;T.properties&&(I=T.properties.topicAlias);let A=T.topic.toString();if(this.topicAliasSend)if(I){if(A.length!==0&&(this.log("applyTopicAlias :: register topic: %s - alias: %d",A,I),!this.topicAliasSend.put(A,I)))return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",A,I),new Error("Sending Topic Alias out of range")}else A.length!==0&&(this.options.autoAssignTopicAlias?(I=this.topicAliasSend.getAliasByTopic(A),I?(T.topic="",T.properties=Object.assign(Object.assign({},T.properties),{topicAlias:I}),this.log("applyTopicAlias :: auto assign(use) topic: %s - alias: %d",A,I)):(I=this.topicAliasSend.getLruAlias(),this.topicAliasSend.put(A,I),T.properties=Object.assign(Object.assign({},T.properties),{topicAlias:I}),this.log("applyTopicAlias :: auto assign topic: %s - alias: %d",A,I))):this.options.autoUseTopicAlias&&(I=this.topicAliasSend.getAliasByTopic(A),I&&(T.topic="",T.properties=Object.assign(Object.assign({},T.properties),{topicAlias:I}),this.log("applyTopicAlias :: auto use topic: %s - alias: %d",A,I))));else if(I)return this.log("applyTopicAlias :: error out of range. topic: %s - alias: %d",A,I),new Error("Sending Topic Alias out of range")}}_noop(T){this.log("noop ::",T)}_writePacket(T,I){this.log("_writePacket :: packet: %O",T),this.log("_writePacket :: emitting `packetsend`"),this.emit("packetsend",T),this.log("_writePacket :: writing to stream");let A=o.default.writeToStream(T,this.stream,this.options);this.log("_writePacket :: writeToStream result %s",A),!A&&I&&I!==this.noop?(this.log("_writePacket :: handle events on `drain` once through callback."),this.stream.once("drain",I)):I&&(this.log("_writePacket :: invoking cb"),I())}_sendPacket(T,I,A,O){this.log("_sendPacket :: (%s) ::  start",this.options.clientId),A=A||this.noop,I=I||this.noop;let j=this._applyTopicAlias(T);if(j){I(j);return}if(!this.connected){if(T.cmd==="auth"){this._writePacket(T,I);return}this.log("_sendPacket :: client not connected. Storing packet offline."),this._storePacket(T,I,A);return}if(O){this._writePacket(T,I);return}switch(T.cmd){case"publish":break;case"pubrel":this._storeAndSend(T,I,A);return;default:this._writePacket(T,I);return}switch(T.qos){case 2:case 1:this._storeAndSend(T,I,A);break;case 0:default:this._writePacket(T,I);break}this.log("_sendPacket :: (%s) ::  end",this.options.clientId)}_storePacket(T,I,A){this.log("_storePacket :: packet: %o",T),this.log("_storePacket :: cb? %s",!!I),A=A||this.noop;let O=T;if(O.cmd==="publish"){O=(0,h.default)(T);let K=this._removeTopicAliasAndRecoverTopicName(O);if(K)return I&&I(K)}let j=O.qos||0;j===0&&this.queueQoSZero||O.cmd!=="publish"?this.queue.push({packet:O,cb:I}):j>0?(I=this.outgoing[O.messageId]?this.outgoing[O.messageId].cb:null,this.outgoingStore.put(O,K=>{if(K)return I&&I(K);A()})):I&&I(new Error("No connection to broker"))}_setupKeepaliveManager(){this.log("_setupKeepaliveManager :: keepalive %d (seconds)",this.options.keepalive),!this.keepaliveManager&&this.options.keepalive&&(this.keepaliveManager=new w.default(this,this.options.timerVariant))}_destroyKeepaliveManager(){this.keepaliveManager&&(this.log("_destroyKeepaliveManager :: destroying keepalive manager"),this.keepaliveManager.destroy(),this.keepaliveManager=null)}reschedulePing(T=!1){this.keepaliveManager&&this.options.keepalive&&(T||this.options.reschedulePings)&&this._reschedulePing()}_reschedulePing(){this.log("_reschedulePing :: rescheduling ping"),this.keepaliveManager.reschedule()}sendPing(){this.log("_sendPing :: sending pingreq"),this._sendPacket({cmd:"pingreq"})}onKeepaliveTimeout(){this.emit("error",new Error("Keepalive timeout")),this.log("onKeepaliveTimeout :: calling _cleanUp with force true"),this._cleanUp(!0)}_resubscribe(){this.log("_resubscribe");let T=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||this.options.protocolVersion>=4&&!this.connackPacket.sessionPresent)&&T.length>0)if(this.options.resubscribe)if(this.options.protocolVersion===5){this.log("_resubscribe: protocolVersion 5");for(let I=0;I<T.length;I++){let A={};A[T[I]]=this._resubscribeTopics[T[I]],A.resubscribe=!0,this.subscribe(A,{properties:A[T[I]].properties})}}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1}_onConnect(T){if(this.disconnected){this.emit("connect",T);return}this.connackPacket=T,this.messageIdProvider.clear(),this._setupKeepaliveManager(),this.connected=!0;let I=()=>{let A=this.outgoingStore.createStream(),O=()=>{A.destroy(),A=null,this._flushStoreProcessingQueue(),j()},j=()=>{this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={}};this.once("close",O),A.on("error",R=>{j(),this._flushStoreProcessingQueue(),this.removeListener("close",O),this.emit("error",R)});let K=()=>{if(!A)return;let R=A.read(1),U;if(!R){A.once("readable",K);return}if(this._storeProcessing=!0,this._packetIdsDuringStoreProcessing[R.messageId]){K();return}!this.disconnecting&&!this.reconnectTimer?(U=this.outgoing[R.messageId]?this.outgoing[R.messageId].cb:null,this.outgoing[R.messageId]={volatile:!1,cb(V,G){U&&U(V,G),K()}},this._packetIdsDuringStoreProcessing[R.messageId]=!0,this.messageIdProvider.register(R.messageId)?this._sendPacket(R,void 0,void 0,!0):this.log("messageId: %d has already used.",R.messageId)):A.destroy&&A.destroy()};A.on("end",()=>{let R=!0;for(let U in this._packetIdsDuringStoreProcessing)if(!this._packetIdsDuringStoreProcessing[U]){R=!1;break}this.removeListener("close",O),R?(j(),this._invokeAllStoreProcessingQueue(),this.emit("connect",T)):I()}),K()};I()}_invokeStoreProcessingQueue(){if(!this._storeProcessing&&this._storeProcessingQueue.length>0){let T=this._storeProcessingQueue[0];if(T&&T.invoke())return this._storeProcessingQueue.shift(),!0}return!1}_invokeAllStoreProcessingQueue(){for(;this._invokeStoreProcessingQueue(););}_flushStoreProcessingQueue(){for(let T of this._storeProcessingQueue)T.cbStorePut&&T.cbStorePut(new Error("Connection closed")),T.callback&&T.callback(new Error("Connection closed"));this._storeProcessingQueue.splice(0)}_removeOutgoingAndStoreMessage(T,I){delete this.outgoing[T],this.outgoingStore.del({messageId:T},(A,O)=>{I(A,O),this.messageIdProvider.deallocate(T),this._invokeStoreProcessingQueue()})}};S.VERSION=g.MQTTJS_VERSION,i.default=S}),Ev=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=Wg(),t=class{constructor(){this.numberAllocator=new e.NumberAllocator(1,65535)}allocate(){return this.lastId=this.numberAllocator.alloc(),this.lastId}getLastAllocated(){return this.lastId}register(n){return this.numberAllocator.use(n)}deallocate(n){this.numberAllocator.free(n)}clear(){this.numberAllocator.clear()}};i.default=t});function wn(i){throw new RangeError(Yg[i])}function Wu(i,e){let t=i.split("@"),n="";t.length>1&&(n=t[0]+"@",i=t[1]);let r=function(s,o){let a=[],l=s.length;for(;l--;)a[l]=o(s[l]);return a}((i=i.replace(zg,".")).split("."),e).join(".");return n+r}function Gu(i){let e=[],t=0,n=i.length;for(;t<n;){let r=i.charCodeAt(t++);if(r>=55296&&r<=56319&&t<n){let s=i.charCodeAt(t++);(64512&s)==56320?e.push(((1023&r)<<10)+(1023&s)+65536):(e.push(r),t--)}else e.push(r)}return e}var zu,Yu,zg,Yg,ii,Rs,ca,ua,fa,da,nn,Sv=At(()=>{ge(),_e(),pe(),zu=/^xn--/,Yu=/[^\0-\x7E]/,zg=/[\x2E\u3002\uFF0E\uFF61]/g,Yg={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ii=Math.floor,Rs=String.fromCharCode,ca=function(i,e){return i+22+75*(i<26)-((e!=0)<<5)},ua=function(i,e,t){let n=0;for(i=t?ii(i/700):i>>1,i+=ii(i/e);i>455;n+=36)i=ii(i/35);return ii(n+36*i/(i+38))},fa=function(i){let e=[],t=i.length,n=0,r=128,s=72,o=i.lastIndexOf("-");o<0&&(o=0);for(let l=0;l<o;++l)i.charCodeAt(l)>=128&&wn("not-basic"),e.push(i.charCodeAt(l));for(let l=o>0?o+1:0;l<t;){let h=n;for(let u=1,f=36;;f+=36){l>=t&&wn("invalid-input");let d=(a=i.charCodeAt(l++))-48<10?a-22:a-65<26?a-65:a-97<26?a-97:36;(d>=36||d>ii((2147483647-n)/u))&&wn("overflow"),n+=d*u;let g=f<=s?1:f>=s+26?26:f-s;if(d<g)break;let y=36-g;u>ii(2147483647/y)&&wn("overflow"),u*=y}let c=e.length+1;s=ua(n-h,c,h==0),ii(n/c)>2147483647-r&&wn("overflow"),r+=ii(n/c),n%=c,e.splice(n++,0,r)}var a;return String.fromCodePoint(...e)},da=function(i){let e=[],t=(i=Gu(i)).length,n=128,r=0,s=72;for(let l of i)l<128&&e.push(Rs(l));let o=e.length,a=o;for(o&&e.push("-");a<t;){let l=2147483647;for(let c of i)c>=n&&c<l&&(l=c);let h=a+1;l-n>ii((2147483647-r)/h)&&wn("overflow"),r+=(l-n)*h,n=l;for(let c of i)if(c<n&&++r>2147483647&&wn("overflow"),c==n){let u=r;for(let f=36;;f+=36){let d=f<=s?1:f>=s+26?26:f-s;if(u<d)break;let g=u-d,y=36-d;e.push(Rs(ca(d+g%y,0))),u=ii(g/y)}e.push(Rs(ca(u,0))),s=ua(r,h,a==o),r=0,++a}++r,++n}return e.join("")},nn={version:"2.1.0",ucs2:{decode:Gu,encode:i=>String.fromCodePoint(...i)},decode:fa,encode:da,toASCII:function(i){return Wu(i,function(e){return Yu.test(e)?"xn--"+da(e):e})},toUnicode:function(i){return Wu(i,function(e){return zu.test(e)?fa(e.slice(4).toLowerCase()):e})}},nn.decode,nn.encode,nn.toASCII,nn.toUnicode,nn.ucs2,nn.version});function xv(i,e){return Object.prototype.hasOwnProperty.call(i,e)}var Xu,Hn,$u,ui,Tv=At(()=>{ge(),_e(),pe(),Xu=function(i,e,t,n){e=e||"&",t=t||"=";var r={};if(typeof i!="string"||i.length===0)return r;var s=/\+/g;i=i.split(e);var o=1e3;n&&typeof n.maxKeys=="number"&&(o=n.maxKeys);var a=i.length;o>0&&a>o&&(a=o);for(var l=0;l<a;++l){var h,c,u,f,d=i[l].replace(s,"%20"),g=d.indexOf(t);g>=0?(h=d.substr(0,g),c=d.substr(g+1)):(h=d,c=""),u=decodeURIComponent(h),f=decodeURIComponent(c),xv(r,u)?Array.isArray(r[u])?r[u].push(f):r[u]=[r[u],f]:r[u]=f}return r},Hn=function(i){switch(typeof i){case"string":return i;case"boolean":return i?"true":"false";case"number":return isFinite(i)?i:"";default:return""}},$u=function(i,e,t,n){return e=e||"&",t=t||"=",i===null&&(i=void 0),typeof i=="object"?Object.keys(i).map(function(r){var s=encodeURIComponent(Hn(r))+t;return Array.isArray(i[r])?i[r].map(function(o){return s+encodeURIComponent(Hn(o))}).join(e):s+encodeURIComponent(Hn(i[r]))}).join(e):n?encodeURIComponent(Hn(n))+t+encodeURIComponent(Hn(i)):""},ui={},ui.decode=ui.parse=Xu,ui.encode=ui.stringify=$u,ui.decode,ui.encode,ui.parse,ui.stringify});function Hl(){throw new Error("setTimeout has not been defined")}function ql(){throw new Error("clearTimeout has not been defined")}function Xg(i){if(Ii===setTimeout)return setTimeout(i,0);if((Ii===Hl||!Ii)&&setTimeout)return Ii=setTimeout,setTimeout(i,0);try{return Ii(i,0)}catch{try{return Ii.call(null,i,0)}catch{return Ii.call(this||Pn,i,0)}}}function Rv(){Ln&&An&&(Ln=!1,An.length?mi=An.concat(mi):Yr=-1,mi.length&&$g())}function $g(){if(!Ln){var i=Xg(Rv);Ln=!0;for(var e=mi.length;e;){for(An=mi,mi=[];++Yr<e;)An&&An[Yr].run();Yr=-1,e=mi.length}An=null,Ln=!1,function(t){if(Ci===clearTimeout)return clearTimeout(t);if((Ci===ql||!Ci)&&clearTimeout)return Ci=clearTimeout,clearTimeout(t);try{Ci(t)}catch{try{return Ci.call(null,t)}catch{return Ci.call(this||Pn,t)}}}(i)}}function Vu(i,e){(this||Pn).fun=i,(this||Pn).array=e}function Ei(){}var Ku,Ii,Ci,Pn,ft,An,mi,Ln,Yr,ut,Iv=At(()=>{ge(),_e(),pe(),Pn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,ft=Ku={},function(){try{Ii=typeof setTimeout=="function"?setTimeout:Hl}catch{Ii=Hl}try{Ci=typeof clearTimeout=="function"?clearTimeout:ql}catch{Ci=ql}}(),mi=[],Ln=!1,Yr=-1,ft.nextTick=function(i){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];mi.push(new Vu(i,e)),mi.length!==1||Ln||Xg($g)},Vu.prototype.run=function(){(this||Pn).fun.apply(null,(this||Pn).array)},ft.title="browser",ft.browser=!0,ft.env={},ft.argv=[],ft.version="",ft.versions={},ft.on=Ei,ft.addListener=Ei,ft.once=Ei,ft.off=Ei,ft.removeListener=Ei,ft.removeAllListeners=Ei,ft.emit=Ei,ft.prependListener=Ei,ft.prependOnceListener=Ei,ft.listeners=function(i){return[]},ft.binding=function(i){throw new Error("process.binding is not supported")},ft.cwd=function(){return"/"},ft.chdir=function(i){throw new Error("process.chdir is not supported")},ft.umask=function(){return 0},ut=Ku,ut.addListener,ut.argv,ut.binding,ut.browser,ut.chdir,ut.cwd,ut.emit,ut.env,ut.listeners,ut.nextTick,ut.off,ut.on,ut.once,ut.prependListener,ut.prependOnceListener,ut.removeAllListeners,ut.removeListener,ut.title,ut.umask,ut.version,ut.versions});function Cv(){if(Zl)return Fs;Zl=!0;var i=Fs={},e,t;function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?e=setTimeout:e=n}catch{e=n}try{typeof clearTimeout=="function"?t=clearTimeout:t=r}catch{t=r}})();function s(y){if(e===setTimeout)return setTimeout(y,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(y,0);try{return e(y,0)}catch{try{return e.call(null,y,0)}catch{return e.call(this||En,y,0)}}}function o(y){if(t===clearTimeout)return clearTimeout(y);if((t===r||!t)&&clearTimeout)return t=clearTimeout,clearTimeout(y);try{return t(y)}catch{try{return t.call(null,y)}catch{return t.call(this||En,y)}}}var a=[],l=!1,h,c=-1;function u(){!l||!h||(l=!1,h.length?a=h.concat(a):c=-1,a.length&&f())}function f(){if(!l){var y=s(u);l=!0;for(var w=a.length;w;){for(h=a,a=[];++c<w;)h&&h[c].run();c=-1,w=a.length}h=null,l=!1,o(y)}}i.nextTick=function(y){var w=new Array(arguments.length-1);if(arguments.length>1)for(var E=1;E<arguments.length;E++)w[E-1]=arguments[E];a.push(new d(y,w)),a.length===1&&!l&&s(f)};function d(y,w){(this||En).fun=y,(this||En).array=w}d.prototype.run=function(){(this||En).fun.apply(null,(this||En).array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={};function g(){}return i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(y){return[]},i.binding=function(y){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(y){throw new Error("process.chdir is not supported")},i.umask=function(){return 0},Fs}var Fs,Zl,En,ht,Vg=At(()=>{ge(),_e(),pe(),Fs={},Zl=!1,En=typeof globalThis<"u"?globalThis:typeof self<"u"?self:global,ht=Cv(),ht.platform="browser",ht.addListener,ht.argv,ht.binding,ht.browser,ht.chdir,ht.cwd,ht.emit,ht.env,ht.listeners,ht.nextTick,ht.off,ht.on,ht.once,ht.prependListener,ht.prependOnceListener,ht.removeAllListeners,ht.removeListener,ht.title,ht.umask,ht.version,ht.versions});function Av(){if(Jl)return Ns;Jl=!0;var i=ht;function e(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function t(s,o){for(var a="",l=0,h=-1,c=0,u,f=0;f<=s.length;++f){if(f<s.length)u=s.charCodeAt(f);else{if(u===47)break;u=47}if(u===47){if(!(h===f-1||c===1))if(h!==f-1&&c===2){if(a.length<2||l!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var d=a.lastIndexOf("/");if(d!==a.length-1){d===-1?(a="",l=0):(a=a.slice(0,d),l=a.length-1-a.lastIndexOf("/")),h=f,c=0;continue}}else if(a.length===2||a.length===1){a="",l=0,h=f,c=0;continue}}o&&(a.length>0?a+="/..":a="..",l=2)}else a.length>0?a+="/"+s.slice(h+1,f):a=s.slice(h+1,f),l=f-h-1;h=f,c=0}else u===46&&c!==-1?++c:c=-1}return a}function n(s,o){var a=o.dir||o.root,l=o.base||(o.name||"")+(o.ext||"");return a?a===o.root?a+l:a+s+l:l}var r={resolve:function(){for(var s="",o=!1,a,l=arguments.length-1;l>=-1&&!o;l--){var h;l>=0?h=arguments[l]:(a===void 0&&(a=i.cwd()),h=a),e(h),h.length!==0&&(s=h+"/"+s,o=h.charCodeAt(0)===47)}return s=t(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(e(s),s.length===0)return".";var o=s.charCodeAt(0)===47,a=s.charCodeAt(s.length-1)===47;return s=t(s,!o),s.length===0&&!o&&(s="."),s.length>0&&a&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return e(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var a=arguments[o];e(a),a.length>0&&(s===void 0?s=a:s+="/"+a)}return s===void 0?".":r.normalize(s)},relative:function(s,o){if(e(s),e(o),s===o||(s=r.resolve(s),o=r.resolve(o),s===o))return"";for(var a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var l=s.length,h=l-a,c=1;c<o.length&&o.charCodeAt(c)===47;++c);for(var u=o.length,f=u-c,d=h<f?h:f,g=-1,y=0;y<=d;++y){if(y===d){if(f>d){if(o.charCodeAt(c+y)===47)return o.slice(c+y+1);if(y===0)return o.slice(c+y)}else h>d&&(s.charCodeAt(a+y)===47?g=y:y===0&&(g=0));break}var w=s.charCodeAt(a+y),E=o.charCodeAt(c+y);if(w!==E)break;w===47&&(g=y)}var b="";for(y=a+g+1;y<=l;++y)(y===l||s.charCodeAt(y)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+o.slice(c+g):(c+=g,o.charCodeAt(c)===47&&++c,o.slice(c))},_makeLong:function(s){return s},dirname:function(s){if(e(s),s.length===0)return".";for(var o=s.charCodeAt(0),a=o===47,l=-1,h=!0,c=s.length-1;c>=1;--c)if(o=s.charCodeAt(c),o===47){if(!h){l=c;break}}else h=!1;return l===-1?a?"/":".":a&&l===1?"//":s.slice(0,l)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');e(s);var a=0,l=-1,h=!0,c;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var u=o.length-1,f=-1;for(c=s.length-1;c>=0;--c){var d=s.charCodeAt(c);if(d===47){if(!h){a=c+1;break}}else f===-1&&(h=!1,f=c+1),u>=0&&(d===o.charCodeAt(u)?--u===-1&&(l=c):(u=-1,l=f))}return a===l?l=f:l===-1&&(l=s.length),s.slice(a,l)}else{for(c=s.length-1;c>=0;--c)if(s.charCodeAt(c)===47){if(!h){a=c+1;break}}else l===-1&&(h=!1,l=c+1);return l===-1?"":s.slice(a,l)}},extname:function(s){e(s);for(var o=-1,a=0,l=-1,h=!0,c=0,u=s.length-1;u>=0;--u){var f=s.charCodeAt(u);if(f===47){if(!h){a=u+1;break}continue}l===-1&&(h=!1,l=u+1),f===46?o===-1?o=u:c!==1&&(c=1):o!==-1&&(c=-1)}return o===-1||l===-1||c===0||c===1&&o===l-1&&o===a+1?"":s.slice(o,l)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return n("/",s)},parse:function(s){e(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var a=s.charCodeAt(0),l=a===47,h;l?(o.root="/",h=1):h=0;for(var c=-1,u=0,f=-1,d=!0,g=s.length-1,y=0;g>=h;--g){if(a=s.charCodeAt(g),a===47){if(!d){u=g+1;break}continue}f===-1&&(d=!1,f=g+1),a===46?c===-1?c=g:y!==1&&(y=1):c!==-1&&(y=-1)}return c===-1||f===-1||y===0||y===1&&c===f-1&&c===u+1?f!==-1&&(u===0&&l?o.base=o.name=s.slice(1,f):o.base=o.name=s.slice(u,f)):(u===0&&l?(o.name=s.slice(1,c),o.base=s.slice(1,f)):(o.name=s.slice(u,c),o.base=s.slice(u,f)),o.ext=s.slice(c,f)),u>0?o.dir=s.slice(0,u-1):l&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,Ns=r,Ns}var Ns,Jl,Ql,Mv=At(()=>{ge(),_e(),pe(),Vg(),Ns={},Jl=!1,Ql=Av()}),Kg={};Fn(Kg,{URL:()=>fp,Url:()=>ap,default:()=>qe,fileURLToPath:()=>Hg,format:()=>lp,parse:()=>up,pathToFileURL:()=>qg,resolve:()=>hp,resolveObject:()=>cp});function qt(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function Lr(i,e,t){if(i&&ri.isObject(i)&&i instanceof qt)return i;var n=new qt;return n.parse(i,e,t),n}function Pv(){if(eh)return Bs;eh=!0;var i=ut;function e(s){if(typeof s!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(s))}function t(s,o){for(var a="",l=0,h=-1,c=0,u,f=0;f<=s.length;++f){if(f<s.length)u=s.charCodeAt(f);else{if(u===47)break;u=47}if(u===47){if(!(h===f-1||c===1))if(h!==f-1&&c===2){if(a.length<2||l!==2||a.charCodeAt(a.length-1)!==46||a.charCodeAt(a.length-2)!==46){if(a.length>2){var d=a.lastIndexOf("/");if(d!==a.length-1){d===-1?(a="",l=0):(a=a.slice(0,d),l=a.length-1-a.lastIndexOf("/")),h=f,c=0;continue}}else if(a.length===2||a.length===1){a="",l=0,h=f,c=0;continue}}o&&(a.length>0?a+="/..":a="..",l=2)}else a.length>0?a+="/"+s.slice(h+1,f):a=s.slice(h+1,f),l=f-h-1;h=f,c=0}else u===46&&c!==-1?++c:c=-1}return a}function n(s,o){var a=o.dir||o.root,l=o.base||(o.name||"")+(o.ext||"");return a?a===o.root?a+l:a+s+l:l}var r={resolve:function(){for(var s="",o=!1,a,l=arguments.length-1;l>=-1&&!o;l--){var h;l>=0?h=arguments[l]:(a===void 0&&(a=i.cwd()),h=a),e(h),h.length!==0&&(s=h+"/"+s,o=h.charCodeAt(0)===47)}return s=t(s,!o),o?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(s){if(e(s),s.length===0)return".";var o=s.charCodeAt(0)===47,a=s.charCodeAt(s.length-1)===47;return s=t(s,!o),s.length===0&&!o&&(s="."),s.length>0&&a&&(s+="/"),o?"/"+s:s},isAbsolute:function(s){return e(s),s.length>0&&s.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var s,o=0;o<arguments.length;++o){var a=arguments[o];e(a),a.length>0&&(s===void 0?s=a:s+="/"+a)}return s===void 0?".":r.normalize(s)},relative:function(s,o){if(e(s),e(o),s===o||(s=r.resolve(s),o=r.resolve(o),s===o))return"";for(var a=1;a<s.length&&s.charCodeAt(a)===47;++a);for(var l=s.length,h=l-a,c=1;c<o.length&&o.charCodeAt(c)===47;++c);for(var u=o.length,f=u-c,d=h<f?h:f,g=-1,y=0;y<=d;++y){if(y===d){if(f>d){if(o.charCodeAt(c+y)===47)return o.slice(c+y+1);if(y===0)return o.slice(c+y)}else h>d&&(s.charCodeAt(a+y)===47?g=y:y===0&&(g=0));break}var w=s.charCodeAt(a+y),E=o.charCodeAt(c+y);if(w!==E)break;w===47&&(g=y)}var b="";for(y=a+g+1;y<=l;++y)(y===l||s.charCodeAt(y)===47)&&(b.length===0?b+="..":b+="/..");return b.length>0?b+o.slice(c+g):(c+=g,o.charCodeAt(c)===47&&++c,o.slice(c))},_makeLong:function(s){return s},dirname:function(s){if(e(s),s.length===0)return".";for(var o=s.charCodeAt(0),a=o===47,l=-1,h=!0,c=s.length-1;c>=1;--c)if(o=s.charCodeAt(c),o===47){if(!h){l=c;break}}else h=!1;return l===-1?a?"/":".":a&&l===1?"//":s.slice(0,l)},basename:function(s,o){if(o!==void 0&&typeof o!="string")throw new TypeError('"ext" argument must be a string');e(s);var a=0,l=-1,h=!0,c;if(o!==void 0&&o.length>0&&o.length<=s.length){if(o.length===s.length&&o===s)return"";var u=o.length-1,f=-1;for(c=s.length-1;c>=0;--c){var d=s.charCodeAt(c);if(d===47){if(!h){a=c+1;break}}else f===-1&&(h=!1,f=c+1),u>=0&&(d===o.charCodeAt(u)?--u===-1&&(l=c):(u=-1,l=f))}return a===l?l=f:l===-1&&(l=s.length),s.slice(a,l)}else{for(c=s.length-1;c>=0;--c)if(s.charCodeAt(c)===47){if(!h){a=c+1;break}}else l===-1&&(h=!1,l=c+1);return l===-1?"":s.slice(a,l)}},extname:function(s){e(s);for(var o=-1,a=0,l=-1,h=!0,c=0,u=s.length-1;u>=0;--u){var f=s.charCodeAt(u);if(f===47){if(!h){a=u+1;break}continue}l===-1&&(h=!1,l=u+1),f===46?o===-1?o=u:c!==1&&(c=1):o!==-1&&(c=-1)}return o===-1||l===-1||c===0||c===1&&o===l-1&&o===a+1?"":s.slice(o,l)},format:function(s){if(s===null||typeof s!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof s);return n("/",s)},parse:function(s){e(s);var o={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return o;var a=s.charCodeAt(0),l=a===47,h;l?(o.root="/",h=1):h=0;for(var c=-1,u=0,f=-1,d=!0,g=s.length-1,y=0;g>=h;--g){if(a=s.charCodeAt(g),a===47){if(!d){u=g+1;break}continue}f===-1&&(d=!1,f=g+1),a===46?c===-1?c=g:y!==1&&(y=1):c!==-1&&(y=-1)}return c===-1||f===-1||y===0||y===1&&c===f-1&&c===u+1?f!==-1&&(u===0&&l?o.base=o.name=s.slice(1,f):o.base=o.name=s.slice(u,f)):(u===0&&l?(o.name=s.slice(1,c),o.base=s.slice(1,f)):(o.name=s.slice(u,c),o.base=s.slice(u,f)),o.ext=s.slice(c,f)),u>0?o.dir=s.slice(0,u-1):l&&(o.dir="/"),o},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,Bs=r,Bs}function Lv(i){if(typeof i=="string")i=new URL(i);else if(!(i instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(i.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return ro?Ov(i):kv(i)}function Ov(i){let e=i.hostname,t=i.pathname;for(let n=0;n<t.length;n++)if(t[n]==="%"){let r=t.codePointAt(n+2)||32;if(t[n+1]==="2"&&r===102||t[n+1]==="5"&&r===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(t=t.replace(tp,"\\"),t=decodeURIComponent(t),e!=="")return`\\\\${e}${t}`;{let n=t.codePointAt(1)|32,r=t[2];if(n<Qg||n>ep||r!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return t.slice(1)}}function kv(i){if(i.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=i.pathname;for(let t=0;t<e.length;t++)if(e[t]==="%"){let n=e.codePointAt(t+2)||32;if(e[t+1]==="2"&&n===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function Dv(i){let e=th.resolve(i),t=i.charCodeAt(i.length-1);(t===Jg||ro&&t===Zg)&&e[e.length-1]!==th.sep&&(e+="/");let n=new URL("file://");return e.includes("%")&&(e=e.replace(ip,"%25")),!ro&&e.includes("\\")&&(e=e.replace(np,"%5C")),e.includes(`
`)&&(e=e.replace(rp,"%0A")),e.includes("\r")&&(e=e.replace(sp,"%0D")),e.includes("	")&&(e=e.replace(op,"%09")),n.pathname=e,n}function Hg(i){if(typeof i=="string")i=new URL(i);else if(!(i instanceof URL))throw new Deno.errors.InvalidData("invalid argument path , must be a string or URL");if(i.protocol!=="file:")throw new Deno.errors.InvalidData("invalid url scheme");return so?Fv(i):Nv(i)}function Fv(i){let e=i.hostname,t=i.pathname;for(let n=0;n<t.length;n++)if(t[n]==="%"){let r=t.codePointAt(n+2)||32;if(t[n+1]==="2"&&r===102||t[n+1]==="5"&&r===99)throw new Deno.errors.InvalidData("must not include encoded \\ or / characters")}if(t=t.replace(mp,"\\"),t=decodeURIComponent(t),e!=="")return`\\\\${e}${t}`;{let n=t.codePointAt(1)|32,r=t[2];if(n<pp||n>_p||r!==":")throw new Deno.errors.InvalidData("file url path must be absolute");return t.slice(1)}}function Nv(i){if(i.hostname!=="")throw new Deno.errors.InvalidData("invalid file url hostname");let e=i.pathname;for(let t=0;t<e.length;t++)if(e[t]==="%"){let n=e.codePointAt(t+2)||32;if(e[t+1]==="2"&&n===102)throw new Deno.errors.InvalidData("must not include encoded / characters")}return decodeURIComponent(e)}function qg(i){let e=Ql.resolve(i),t=i.charCodeAt(i.length-1);(t===gp||so&&t===dp)&&e[e.length-1]!==Ql.sep&&(e+="/");let n=new URL("file://");return e.includes("%")&&(e=e.replace(yp,"%25")),!so&&e.includes("\\")&&(e=e.replace(wp,"%5C")),e.includes(`
`)&&(e=e.replace(bp,"%0A")),e.includes("\r")&&(e=e.replace(vp,"%0D")),e.includes("	")&&(e=e.replace(Ep,"%09")),n.pathname=e,n}var qe,Hu,ri,qu,Zu,Ju,Qu,Is,ga,pa,_a,ef,tf,Cs,bn,As,Bs,eh,th,nf,Zg,Jg,Qg,ep,ro,tp,ip,np,rp,sp,op,rf,ap,lp,hp,cp,up,fp,dp,gp,pp,_p,so,mp,yp,wp,bp,vp,Ep,Bv=At(()=>{ge(),_e(),pe(),Sv(),Tv(),Iv(),Mv(),Vg(),qe={},Hu=nn,ri={isString:function(i){return typeof i=="string"},isObject:function(i){return typeof i=="object"&&i!==null},isNull:function(i){return i===null},isNullOrUndefined:function(i){return i==null}},qe.parse=Lr,qe.resolve=function(i,e){return Lr(i,!1,!0).resolve(e)},qe.resolveObject=function(i,e){return i?Lr(i,!1,!0).resolveObject(e):e},qe.format=function(i){return ri.isString(i)&&(i=Lr(i)),i instanceof qt?i.format():qt.prototype.format.call(i)},qe.Url=qt,qu=/^([a-z0-9.+-]+:)/i,Zu=/:[0-9]*$/,Ju=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,Qu=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r",`
`,"	"]),Is=["'"].concat(Qu),ga=["%","/","?",";","#"].concat(Is),pa=["/","?","#"],_a=/^[+a-z0-9A-Z_-]{0,63}$/,ef=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,tf={javascript:!0,"javascript:":!0},Cs={javascript:!0,"javascript:":!0},bn={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},As=ui,qt.prototype.parse=function(i,e,t){if(!ri.isString(i))throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var n=i.indexOf("?"),r=n!==-1&&n<i.indexOf("#")?"?":"#",s=i.split(r);s[0]=s[0].replace(/\\/g,"/");var o=i=s.join(r);if(o=o.trim(),!t&&i.split("#").length===1){var a=Ju.exec(o);if(a)return this.path=o,this.href=o,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?As.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=qu.exec(o);if(l){var h=(l=l[0]).toLowerCase();this.protocol=h,o=o.substr(l.length)}if(t||l||o.match(/^\/\/[^@\/]+@[^@\/]+/)){var c=o.substr(0,2)==="//";!c||l&&Cs[l]||(o=o.substr(2),this.slashes=!0)}if(!Cs[l]&&(c||l&&!bn[l])){for(var u,f,d=-1,g=0;g<pa.length;g++)(y=o.indexOf(pa[g]))!==-1&&(d===-1||y<d)&&(d=y);for((f=d===-1?o.lastIndexOf("@"):o.lastIndexOf("@",d))!==-1&&(u=o.slice(0,f),o=o.slice(f+1),this.auth=decodeURIComponent(u)),d=-1,g=0;g<ga.length;g++){var y;(y=o.indexOf(ga[g]))!==-1&&(d===-1||y<d)&&(d=y)}d===-1&&(d=o.length),this.host=o.slice(0,d),o=o.slice(d),this.parseHost(),this.hostname=this.hostname||"";var w=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!w)for(var E=this.hostname.split(/\./),b=(g=0,E.length);g<b;g++){var v=E[g];if(v&&!v.match(_a)){for(var S="",x=0,T=v.length;x<T;x++)v.charCodeAt(x)>127?S+="x":S+=v[x];if(!S.match(_a)){var I=E.slice(0,g),A=E.slice(g+1),O=v.match(ef);O&&(I.push(O[1]),A.unshift(O[2])),A.length&&(o="/"+A.join(".")+o),this.hostname=I.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),w||(this.hostname=Hu.toASCII(this.hostname));var j=this.port?":"+this.port:"",K=this.hostname||"";this.host=K+j,this.href+=this.host,w&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),o[0]!=="/"&&(o="/"+o))}if(!tf[h])for(g=0,b=Is.length;g<b;g++){var R=Is[g];if(o.indexOf(R)!==-1){var U=encodeURIComponent(R);U===R&&(U=escape(R)),o=o.split(R).join(U)}}var V=o.indexOf("#");V!==-1&&(this.hash=o.substr(V),o=o.slice(0,V));var G=o.indexOf("?");if(G!==-1?(this.search=o.substr(G),this.query=o.substr(G+1),e&&(this.query=As.parse(this.query)),o=o.slice(0,G)):e&&(this.search="",this.query={}),o&&(this.pathname=o),bn[h]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){j=this.pathname||"";var J=this.search||"";this.path=j+J}return this.href=this.format(),this},qt.prototype.format=function(){var i=this.auth||"";i&&(i=(i=encodeURIComponent(i)).replace(/%3A/i,":"),i+="@");var e=this.protocol||"",t=this.pathname||"",n=this.hash||"",r=!1,s="";this.host?r=i+this.host:this.hostname&&(r=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&ri.isObject(this.query)&&Object.keys(this.query).length&&(s=As.stringify(this.query));var o=this.search||s&&"?"+s||"";return e&&e.substr(-1)!==":"&&(e+=":"),this.slashes||(!e||bn[e])&&r!==!1?(r="//"+(r||""),t&&t.charAt(0)!=="/"&&(t="/"+t)):r||(r=""),n&&n.charAt(0)!=="#"&&(n="#"+n),o&&o.charAt(0)!=="?"&&(o="?"+o),e+r+(t=t.replace(/[?#]/g,function(a){return encodeURIComponent(a)}))+(o=o.replace("#","%23"))+n},qt.prototype.resolve=function(i){return this.resolveObject(Lr(i,!1,!0)).format()},qt.prototype.resolveObject=function(i){if(ri.isString(i)){var e=new qt;e.parse(i,!1,!0),i=e}for(var t=new qt,n=Object.keys(this),r=0;r<n.length;r++){var s=n[r];t[s]=this[s]}if(t.hash=i.hash,i.href==="")return t.href=t.format(),t;if(i.slashes&&!i.protocol){for(var o=Object.keys(i),a=0;a<o.length;a++){var l=o[a];l!=="protocol"&&(t[l]=i[l])}return bn[t.protocol]&&t.hostname&&!t.pathname&&(t.path=t.pathname="/"),t.href=t.format(),t}if(i.protocol&&i.protocol!==t.protocol){if(!bn[i.protocol]){for(var h=Object.keys(i),c=0;c<h.length;c++){var u=h[c];t[u]=i[u]}return t.href=t.format(),t}if(t.protocol=i.protocol,i.host||Cs[i.protocol])t.pathname=i.pathname;else{for(var f=(i.pathname||"").split("/");f.length&&!(i.host=f.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),f[0]!==""&&f.unshift(""),f.length<2&&f.unshift(""),t.pathname=f.join("/")}if(t.search=i.search,t.query=i.query,t.host=i.host||"",t.auth=i.auth,t.hostname=i.hostname||i.host,t.port=i.port,t.pathname||t.search){var d=t.pathname||"",g=t.search||"";t.path=d+g}return t.slashes=t.slashes||i.slashes,t.href=t.format(),t}var y=t.pathname&&t.pathname.charAt(0)==="/",w=i.host||i.pathname&&i.pathname.charAt(0)==="/",E=w||y||t.host&&i.pathname,b=E,v=t.pathname&&t.pathname.split("/")||[],S=(f=i.pathname&&i.pathname.split("/")||[],t.protocol&&!bn[t.protocol]);if(S&&(t.hostname="",t.port=null,t.host&&(v[0]===""?v[0]=t.host:v.unshift(t.host)),t.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(f[0]===""?f[0]=i.host:f.unshift(i.host)),i.host=null),E=E&&(f[0]===""||v[0]==="")),w)t.host=i.host||i.host===""?i.host:t.host,t.hostname=i.hostname||i.hostname===""?i.hostname:t.hostname,t.search=i.search,t.query=i.query,v=f;else if(f.length)v||(v=[]),v.pop(),v=v.concat(f),t.search=i.search,t.query=i.query;else if(!ri.isNullOrUndefined(i.search))return S&&(t.hostname=t.host=v.shift(),(O=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"))&&(t.auth=O.shift(),t.host=t.hostname=O.shift())),t.search=i.search,t.query=i.query,ri.isNull(t.pathname)&&ri.isNull(t.search)||(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.href=t.format(),t;if(!v.length)return t.pathname=null,t.search?t.path="/"+t.search:t.path=null,t.href=t.format(),t;for(var x=v.slice(-1)[0],T=(t.host||i.host||v.length>1)&&(x==="."||x==="..")||x==="",I=0,A=v.length;A>=0;A--)(x=v[A])==="."?v.splice(A,1):x===".."?(v.splice(A,1),I++):I&&(v.splice(A,1),I--);if(!E&&!b)for(;I--;I)v.unshift("..");!E||v[0]===""||v[0]&&v[0].charAt(0)==="/"||v.unshift(""),T&&v.join("/").substr(-1)!=="/"&&v.push("");var O,j=v[0]===""||v[0]&&v[0].charAt(0)==="/";return S&&(t.hostname=t.host=j?"":v.length?v.shift():"",(O=!!(t.host&&t.host.indexOf("@")>0)&&t.host.split("@"))&&(t.auth=O.shift(),t.host=t.hostname=O.shift())),(E=E||t.host&&v.length)&&!j&&v.unshift(""),v.length?t.pathname=v.join("/"):(t.pathname=null,t.path=null),ri.isNull(t.pathname)&&ri.isNull(t.search)||(t.path=(t.pathname?t.pathname:"")+(t.search?t.search:"")),t.auth=i.auth||t.auth,t.slashes=t.slashes||i.slashes,t.href=t.format(),t},qt.prototype.parseHost=function(){var i=this.host,e=Zu.exec(i);e&&((e=e[0])!==":"&&(this.port=e.substr(1)),i=i.substr(0,i.length-e.length)),i&&(this.hostname=i)},qe.Url,qe.format,qe.resolve,qe.resolveObject,Bs={},eh=!1,th=Pv(),nf=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,qe.URL=typeof URL<"u"?URL:null,qe.pathToFileURL=Dv,qe.fileURLToPath=Lv,qe.Url,qe.format,qe.resolve,qe.resolveObject,qe.URL,Zg=92,Jg=47,Qg=97,ep=122,ro=nf==="win32",tp=/\//g,ip=/%/g,np=/\\/g,rp=/\n/g,sp=/\r/g,op=/\t/g,rf=typeof Deno<"u"?Deno.build.os==="windows"?"win32":Deno.build.os:void 0,qe.URL=typeof URL<"u"?URL:null,qe.pathToFileURL=qg,qe.fileURLToPath=Hg,ap=qe.Url,lp=qe.format,hp=qe.resolve,cp=qe.resolveObject,up=qe.parse,fp=qe.URL,dp=92,gp=47,pp=97,_p=122,so=rf==="win32",mp=/\//g,yp=/%/g,wp=/\\/g,bp=/\n/g,vp=/\r/g,Ep=/\t/g}),Uv=Ee((i,e)=>{ge(),_e(),pe(),e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),cc=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0}),i.BufferedDuplex=i.writev=void 0;var e=Un(),t=(Pt(),Qe(Mt));function n(s,o){let a=new Array(s.length);for(let l=0;l<s.length;l++)typeof s[l].chunk=="string"?a[l]=t.Buffer.from(s[l].chunk,"utf8"):a[l]=s[l].chunk;this._write(t.Buffer.concat(a),"binary",o)}i.writev=n;var r=class extends e.Duplex{constructor(s,o,a){super({objectMode:!0}),this.proxy=o,this.socket=a,this.writeQueue=[],s.objectMode||(this._writev=n.bind(this)),this.isSocketOpen=!1,this.proxy.on("data",l=>{this.destroyed||this.push(l)})}_read(s){this.proxy.read(s)}_write(s,o,a){this.isSocketOpen?this.writeToProxy(s,o,a):this.writeQueue.push({chunk:s,encoding:o,cb:a})}_final(s){this.writeQueue=[],this.proxy.end(s)}_destroy(s,o){this.writeQueue=[],this.proxy.destroy(),o(s)}socketReady(){this.emit("connect"),this.isSocketOpen=!0,this.processWriteQueue()}writeToProxy(s,o,a){this.proxy.write(s,o)===!1?this.proxy.once("drain",a):a()}processWriteQueue(){for(;this.writeQueue.length>0;){let{chunk:s,encoding:o,cb:a}=this.writeQueue.shift();this.writeToProxy(s,o,a)}}};i.BufferedDuplex=r}),Ms=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(i,"__esModule",{value:!0}),i.streamBuilder=i.browserStreamBuilder=void 0;var t=(Pt(),Qe(Mt)),n=e(Uv()),r=e(ji()),s=Un(),o=e(ko()),a=cc(),l=(0,r.default)("mqttjs:ws"),h=["rejectUnauthorized","ca","cert","key","pfx","passphrase"];function c(E,b){let v=`${E.protocol}://${E.hostname}:${E.port}${E.path}`;return typeof E.transformWsUrl=="function"&&(v=E.transformWsUrl(v,E,b)),v}function u(E){let b=E;return E.port||(E.protocol==="wss"?b.port=443:b.port=80),E.path||(b.path="/"),E.wsOptions||(b.wsOptions={}),!o.default&&!E.forceNativeWebSocket&&E.protocol==="wss"&&h.forEach(v=>{Object.prototype.hasOwnProperty.call(E,v)&&!Object.prototype.hasOwnProperty.call(E.wsOptions,v)&&(b.wsOptions[v]=E[v])}),b}function f(E){let b=u(E);if(b.hostname||(b.hostname=b.host),!b.hostname){if(typeof document>"u")throw new Error("Could not determine host. Specify host manually.");let v=new URL(document.URL);b.hostname=v.hostname,b.port||(b.port=Number(v.port))}return b.objectMode===void 0&&(b.objectMode=!(b.binary===!0||b.binary===void 0)),b}function d(E,b,v){l("createWebSocket"),l(`protocol: ${v.protocolId} ${v.protocolVersion}`);let S=v.protocolId==="MQIsdp"&&v.protocolVersion===3?"mqttv3.1":"mqtt";l(`creating new Websocket for url: ${b} and protocol: ${S}`);let x;return v.createWebsocket?x=v.createWebsocket(b,[S],v):x=new n.default(b,[S],v.wsOptions),x}function g(E,b){let v=b.protocolId==="MQIsdp"&&b.protocolVersion===3?"mqttv3.1":"mqtt",S=c(b,E),x;return b.createWebsocket?x=b.createWebsocket(S,[v],b):x=new WebSocket(S,[v]),x.binaryType="arraybuffer",x}var y=(E,b)=>{l("streamBuilder");let v=u(b);v.hostname=v.hostname||v.host||"localhost";let S=c(v,E),x=d(E,S,v),T=n.default.createWebSocketStream(x,v.wsOptions);return T.url=S,x.on("close",()=>{T.destroy()}),T};i.streamBuilder=y;var w=(E,b)=>{l("browserStreamBuilder");let v,S=f(b).browserBufferSize||1024*512,x=b.browserBufferTimeout||1e3,T=!b.objectMode,I=g(E,b),A=j(b,G,J);b.objectMode||(A._writev=a.writev.bind(A)),A.on("close",()=>{I.close()});let O=typeof I.addEventListener<"u";I.readyState===I.OPEN?(v=A,v.socket=I):(v=new a.BufferedDuplex(b,A,I),O?I.addEventListener("open",K):I.onopen=K),O?(I.addEventListener("close",R),I.addEventListener("error",U),I.addEventListener("message",V)):(I.onclose=R,I.onerror=U,I.onmessage=V);function j(H,W,se){let Z=new s.Transform({objectMode:H.objectMode});return Z._write=W,Z._flush=se,Z}function K(){l("WebSocket onOpen"),v instanceof a.BufferedDuplex&&v.socketReady()}function R(H){l("WebSocket onClose",H),v.end(),v.destroy()}function U(H){l("WebSocket onError",H);let W=new Error("WebSocket error");W.event=H,v.destroy(W)}async function V(H){let{data:W}=H;W instanceof ArrayBuffer?W=t.Buffer.from(W):W instanceof Blob?W=t.Buffer.from(await new Response(W).arrayBuffer()):W=t.Buffer.from(W,"utf8"),A&&!A.destroyed&&A.push(W)}function G(H,W,se){if(I.bufferedAmount>S){setTimeout(G,x,H,W,se);return}T&&typeof H=="string"&&(H=t.Buffer.from(H,"utf8"));try{I.send(H)}catch(Z){return se(Z)}se()}function J(H){I.close(),H()}return v};i.browserStreamBuilder=w}),uc={};Fn(uc,{Server:()=>ct,Socket:()=>ct,Stream:()=>ct,_createServerHandle:()=>ct,_normalizeArgs:()=>ct,_setSimultaneousAccepts:()=>ct,connect:()=>ct,createConnection:()=>ct,createServer:()=>ct,default:()=>Sp,isIP:()=>ct,isIPv4:()=>ct,isIPv6:()=>ct});function ct(){throw new Error("Node.js net module is not supported by JSPM core outside of Node.js")}var Sp,xp=At(()=>{ge(),_e(),pe(),Sp={_createServerHandle:ct,_normalizeArgs:ct,_setSimultaneousAccepts:ct,connect:ct,createConnection:ct,createServer:ct,isIP:ct,isIPv4:ct,isIPv6:ct,Server:ct,Socket:ct,Stream:ct}}),sf=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(i,"__esModule",{value:!0});var t=e((xp(),Qe(uc))),n=e(ji()),r=(0,n.default)("mqttjs:tcp"),s=(o,a)=>{a.port=a.port||1883,a.hostname=a.hostname||a.host||"localhost";let{port:l,path:h}=a,c=a.hostname;return r("port %d and host %s",l,c),t.default.createConnection({port:l,host:c,path:h})};i.default=s}),Tp={};Fn(Tp,{default:()=>Rp});var Rp,jv=At(()=>{ge(),_e(),pe(),Rp={}}),of=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(i,"__esModule",{value:!0});var t=e((jv(),Qe(Tp))),n=e((xp(),Qe(uc))),r=e(ji()),s=(0,r.default)("mqttjs:tls"),o=(a,l)=>{l.port=l.port||8883,l.host=l.hostname||l.host||"localhost",n.default.isIP(l.host)===0&&(l.servername=l.host),l.rejectUnauthorized=l.rejectUnauthorized!==!1,delete l.path,s("port %d host %s rejectUnauthorized %b",l.port,l.host,l.rejectUnauthorized);let h=t.default.connect(l);h.on("secureConnect",()=>{l.rejectUnauthorized&&!h.authorized?h.emit("error",new Error("TLS not authorized")):h.removeListener("error",c)});function c(u){l.rejectUnauthorized&&a.emit("error",u),h.end()}return h.on("error",c),h};i.default=o}),af=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=(Pt(),Qe(Mt)),t=Un(),n=cc(),r,s,o;function a(){let f=new t.Transform;return f._write=(d,g,y)=>{r.send({data:d.buffer,success(){y()},fail(w){y(new Error(w))}})},f._flush=d=>{r.close({success(){d()}})},f}function l(f){f.hostname||(f.hostname="localhost"),f.path||(f.path="/"),f.wsOptions||(f.wsOptions={})}function h(f,d){let g=f.protocol==="wxs"?"wss":"ws",y=`${g}://${f.hostname}${f.path}`;return f.port&&f.port!==80&&f.port!==443&&(y=`${g}://${f.hostname}:${f.port}${f.path}`),typeof f.transformWsUrl=="function"&&(y=f.transformWsUrl(y,f,d)),y}function c(){r.onOpen(()=>{o.socketReady()}),r.onMessage(f=>{let{data:d}=f;d instanceof ArrayBuffer?d=e.Buffer.from(d):d=e.Buffer.from(d,"utf8"),s.push(d)}),r.onClose(()=>{o.emit("close"),o.end(),o.destroy()}),r.onError(f=>{let d=new Error(f.errMsg);o.destroy(d)})}var u=(f,d)=>{if(d.hostname=d.hostname||d.host,!d.hostname)throw new Error("Could not determine host. Specify host manually.");let g=d.protocolId==="MQIsdp"&&d.protocolVersion===3?"mqttv3.1":"mqtt";l(d);let y=h(d,f);r=wx.connectSocket({url:y,protocols:[g]}),s=a(),o=new n.BufferedDuplex(d,s,r),o._destroy=(E,b)=>{r.close({success(){b&&b(E)}})};let w=o.destroy;return o.destroy=(E,b)=>(o.destroy=w,setTimeout(()=>{r.close({fail(){o._destroy(E,b)}})},0),o),c(),o};i.default=u}),lf=Ee(i=>{ge(),_e(),pe(),Object.defineProperty(i,"__esModule",{value:!0});var e=(Pt(),Qe(Mt)),t=Un(),n=cc(),r,s,o,a=!1;function l(){let d=new t.Transform;return d._write=(g,y,w)=>{r.sendSocketMessage({data:g.buffer,success(){w()},fail(){w(new Error)}})},d._flush=g=>{r.closeSocket({success(){g()}})},d}function h(d){d.hostname||(d.hostname="localhost"),d.path||(d.path="/"),d.wsOptions||(d.wsOptions={})}function c(d,g){let y=d.protocol==="alis"?"wss":"ws",w=`${y}://${d.hostname}${d.path}`;return d.port&&d.port!==80&&d.port!==443&&(w=`${y}://${d.hostname}:${d.port}${d.path}`),typeof d.transformWsUrl=="function"&&(w=d.transformWsUrl(w,d,g)),w}function u(){a||(a=!0,r.onSocketOpen(()=>{o.socketReady()}),r.onSocketMessage(d=>{if(typeof d.data=="string"){let g=e.Buffer.from(d.data,"base64");s.push(g)}else{let g=new FileReader;g.addEventListener("load",()=>{let y=g.result;y instanceof ArrayBuffer?y=e.Buffer.from(y):y=e.Buffer.from(y,"utf8"),s.push(y)}),g.readAsArrayBuffer(d.data)}}),r.onSocketClose(()=>{o.end(),o.destroy()}),r.onSocketError(d=>{o.destroy(d)}))}var f=(d,g)=>{if(g.hostname=g.hostname||g.host,!g.hostname)throw new Error("Could not determine host. Specify host manually.");let y=g.protocolId==="MQIsdp"&&g.protocolVersion===3?"mqttv3.1":"mqtt";h(g);let w=c(g,d);return r=g.my,r.connectSocket({url:w,protocols:y}),s=l(),o=new n.BufferedDuplex(g,s,r),u(),o};i.default=f}),Wv=Ee(i=>{ge(),_e(),pe();var e=i&&i.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(i,"__esModule",{value:!0}),i.connectAsync=void 0;var t=e(ji()),n=e((Bv(),Qe(Kg))),r=e(Vl()),s=e(ko());typeof(Ve==null?void 0:Ve.nextTick)!="function"&&(Ve.nextTick=setImmediate);var o=(0,t.default)("mqttjs"),a=null;function l(u){let f;u.auth&&(f=u.auth.match(/^(.+):(.+)$/),f?(u.username=f[1],u.password=f[2]):u.username=u.auth)}function h(u,f){var d,g,y,w;if(o("connecting to an MQTT broker..."),typeof u=="object"&&!f&&(f=u,u=""),f=f||{},u&&typeof u=="string"){let v=n.default.parse(u,!0),S={};if(v.port!=null&&(S.port=Number(v.port)),S.host=v.hostname,S.query=v.query,S.auth=v.auth,S.protocol=v.protocol,S.path=v.path,S.protocol=(d=S.protocol)===null||d===void 0?void 0:d.replace(/:$/,""),f=Object.assign(Object.assign({},S),f),!f.protocol)throw new Error("Missing protocol")}if(f.unixSocket=f.unixSocket||((g=f.protocol)===null||g===void 0?void 0:g.includes("+unix")),f.unixSocket?f.protocol=f.protocol.replace("+unix",""):!(!((y=f.protocol)===null||y===void 0)&&y.startsWith("ws"))&&!(!((w=f.protocol)===null||w===void 0)&&w.startsWith("wx"))&&delete f.path,l(f),f.query&&typeof f.query.clientId=="string"&&(f.clientId=f.query.clientId),f.cert&&f.key)if(f.protocol){if(["mqtts","wss","wxs","alis"].indexOf(f.protocol)===-1)switch(f.protocol){case"mqtt":f.protocol="mqtts";break;case"ws":f.protocol="wss";break;case"wx":f.protocol="wxs";break;case"ali":f.protocol="alis";break;default:throw new Error(`Unknown protocol for secure connection: "${f.protocol}"!`)}}else throw new Error("Missing secure protocol key");if(a||(a={},!s.default&&!f.forceNativeWebSocket?(a.ws=Ms().streamBuilder,a.wss=Ms().streamBuilder,a.mqtt=sf().default,a.tcp=sf().default,a.ssl=of().default,a.tls=a.ssl,a.mqtts=of().default):(a.ws=Ms().browserStreamBuilder,a.wss=Ms().browserStreamBuilder,a.wx=af().default,a.wxs=af().default,a.ali=lf().default,a.alis=lf().default)),!a[f.protocol]){let v=["mqtts","wss"].indexOf(f.protocol)!==-1;f.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter((S,x)=>v&&x%2===0?!1:typeof a[S]=="function")[0]}if(f.clean===!1&&!f.clientId)throw new Error("Missing clientId for unclean clients");f.protocol&&(f.defaultProtocol=f.protocol);function E(v){return f.servers&&((!v._reconnectCount||v._reconnectCount===f.servers.length)&&(v._reconnectCount=0),f.host=f.servers[v._reconnectCount].host,f.port=f.servers[v._reconnectCount].port,f.protocol=f.servers[v._reconnectCount].protocol?f.servers[v._reconnectCount].protocol:f.defaultProtocol,f.hostname=f.host,v._reconnectCount++),o("calling streambuilder for",f.protocol),a[f.protocol](v,f)}let b=new r.default(E,f);return b.on("error",()=>{}),b}function c(u,f,d=!0){return new Promise((g,y)=>{let w=h(u,f),E={connect:v=>{b(),g(w)},end:()=>{b(),g(w)},error:v=>{b(),w.end(),y(v)}};d===!1&&(E.close=()=>{E.error(new Error("Couldn't connect to server"))});function b(){Object.keys(E).forEach(v=>{w.off(v,E[v])})}Object.keys(E).forEach(v=>{w.on(v,E[v])})})}i.connectAsync=c,i.default=h}),hf=Ee(i=>{ge(),_e(),pe();var e=i&&i.__createBinding||(Object.create?function(d,g,y,w){w===void 0&&(w=y);var E=Object.getOwnPropertyDescriptor(g,y);(!E||("get"in E?!g.__esModule:E.writable||E.configurable))&&(E={enumerable:!0,get:function(){return g[y]}}),Object.defineProperty(d,w,E)}:function(d,g,y,w){w===void 0&&(w=y),d[w]=g[y]}),t=i&&i.__setModuleDefault||(Object.create?function(d,g){Object.defineProperty(d,"default",{enumerable:!0,value:g})}:function(d,g){d.default=g}),n=i&&i.__importStar||function(d){if(d&&d.__esModule)return d;var g={};if(d!=null)for(var y in d)y!=="default"&&Object.prototype.hasOwnProperty.call(d,y)&&e(g,d,y);return t(g,d),g},r=i&&i.__exportStar||function(d,g){for(var y in d)y!=="default"&&!Object.prototype.hasOwnProperty.call(g,y)&&e(g,d,y)},s=i&&i.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(i,"__esModule",{value:!0}),i.ReasonCodes=i.KeepaliveManager=i.UniqueMessageIdProvider=i.DefaultMessageIdProvider=i.Store=i.MqttClient=i.connectAsync=i.connect=i.Client=void 0;var o=s(Vl());i.MqttClient=o.default;var a=s(Tg());i.DefaultMessageIdProvider=a.default;var l=s(Ev());i.UniqueMessageIdProvider=l.default;var h=s(Rg());i.Store=h.default;var c=n(Wv());i.connect=c.default,Object.defineProperty(i,"connectAsync",{enumerable:!0,get:function(){return c.connectAsync}});var u=s(Gg());i.KeepaliveManager=u.default,i.Client=o.default,r(Vl(),i),r(xr(),i);var f=Oo();Object.defineProperty(i,"ReasonCodes",{enumerable:!0,get:function(){return f.ReasonCodes}})}),Gv=Ee(i=>{ge(),_e(),pe();var e=i&&i.__createBinding||(Object.create?function(o,a,l,h){h===void 0&&(h=l);var c=Object.getOwnPropertyDescriptor(a,l);(!c||("get"in c?!a.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return a[l]}}),Object.defineProperty(o,h,c)}:function(o,a,l,h){h===void 0&&(h=l),o[h]=a[l]}),t=i&&i.__setModuleDefault||(Object.create?function(o,a){Object.defineProperty(o,"default",{enumerable:!0,value:a})}:function(o,a){o.default=a}),n=i&&i.__importStar||function(o){if(o&&o.__esModule)return o;var a={};if(o!=null)for(var l in o)l!=="default"&&Object.prototype.hasOwnProperty.call(o,l)&&e(a,o,l);return t(a,o),a},r=i&&i.__exportStar||function(o,a){for(var l in o)l!=="default"&&!Object.prototype.hasOwnProperty.call(a,l)&&e(a,o,l)};Object.defineProperty(i,"__esModule",{value:!0});var s=n(hf());i.default=s,r(hf(),i)});const zv=Gv();/*! Bundled license information:

@jspm/core/nodelibs/browser/buffer.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
*/const Yv="9a7317d72e8341e799f120847251701";let oo="";const Xv="wss://dtracker.no:8080/mqtt2wslive.py",cf="users/location",rs=new jy({target:"map",layers:[new L1({source:new sw})],view:new fi({center:_h([10.7522,59.9139]),zoom:10})}),ss=new eb,$v=new $w({source:ss});rs.addLayer($v);const ih=zv.connect(Xv);ih.on("connect",()=>{console.log("Connected to MQTT broker"),ih.subscribe(cf,i=>{i?console.error("Error subscribing to MQTT topic:",i):console.log(`Subscribed to topic: ${cf}`)})});ih.on("message",(i,e)=>{console.log(`Message received on topic ${i}:`,e.toString());try{const t=JSON.parse(e.toString()),{latitude:n,longitude:r,id:s}=t,o=_h([r,n]),a=new Nd({geometry:new Th(o)});a.setStyle(new hr({image:new xo({src:"/icons/pin-icon.png",scale:.1})})),ss.clear(),ss.addFeature(a),rs.getView().setCenter(o),rs.getView().setZoom(14),Ip(n,r)}catch(t){console.error("Error processing MQTT message:",t)}});window.setUserName=function(){oo=document.getElementById("userName").value,document.getElementById("user-name").innerHTML=`Name: ${oo}`};function Ip(i,e){const t=`https://api.weatherapi.com/v1/current.json?key=${Yv}&q=${i},${e}&aqi=no`;fetch(t).then(n=>n.json()).then(n=>{const r=n.current.condition.text,s=n.current.temp_c,o=n.location.name;document.getElementById("weather-info").innerHTML=`
        <h3>Weather in ${o}:</h3>
        <p>Weather: ${r}</p>
        <p>Temperature: ${s}C</p>
      `}).catch(n=>{console.error("Error fetching weather data:",n),alert("Unable to retrieve weather data.")})}Vv();function Vv(){navigator.geolocation?navigator.geolocation.watchPosition(i=>{const e=i.coords.latitude,t=i.coords.longitude;console.log("User position:",e,t);const n=_h([t,e]),r=new Nd({geometry:new Th(n)});r.setStyle(new hr({image:new xo({src:"/icons/pin-icon.png",scale:.1})})),ss.clear(),ss.addFeature(r),rs.getView().setCenter(n),rs.getView().setZoom(14),oo&&(document.getElementById("user-name").innerHTML=`Name: ${oo}`),Ip(e,t)},i=>{console.error("Geolocation error:",i),alert("Unable to retrieve your location.")},{enableHighAccuracy:!0,maximumAge:1e4,timeout:5e3}):alert("Geolocation is not supported by this browser.")}
